<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>  
	  
  	玩转iOS开发：使用自定义《UIActivity》进行内容分享 - Cain For iOS
  	
	</title>

  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="atom.xml" rel="alternate" title="Cain For iOS" type="application/atom+xml">

	<link href="asset/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="asset/stylesheets/font-awesome.min.css" media="screen, projection" rel="stylesheet" type="text/css">
	<script src="asset/javascripts/jquery.min.js"></script>
	<script src="asset/highlightjs/highlight.pack.js"></script>
	<link href="asset/highlightjs/styles/solarized_dark.css" media="screen, projection" rel="stylesheet" type="text/css">
<script>hljs.initHighlightingOnLoad();</script>

	<!--[if lt IE 9]><script src="asset/javascripts/html5.js"></script><![endif]-->
	<!-- <link href='http://fonts.googleapis.com/css?family=Nunito:400,300,700' rel='stylesheet' type='text/css'> -->
	<style type="text/css">
/* latin */
@font-face {
  font-family: 'Nunito';
  font-style: normal;
  font-weight: 300;
  src: local('Nunito-Light'), url(asset/font/1TiHc9yag0wq3lDO9cw0voX0hVgzZQUfRDuZrPvH3D8.woff2) format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
}
/* latin */
@font-face {
  font-family: 'Nunito';
  font-style: normal;
  font-weight: 400;
  src: local('Nunito-Regular'), url(asset/font/6TbRXKWJjpj6V2v_WyRbMX-_kf6ByYO6CLYdB4HQE-Y.woff2) format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
}
/* latin */
@font-face {
  font-family: 'Nunito';
  font-style: normal;
  font-weight: 700;
  src: local('Nunito-Bold'), url(asset/font/TttUCfJ272GBgSKaOaD7KoX0hVgzZQUfRDuZrPvH3D8.woff2) format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
}
	</style>
	
	<style type="text/css">
	.container .left-col{ opacity: 1;}
	#pagenavi a{ font-size: 1.3em;}
	#pagenavi .next:before{ top: 3px;}
	#pagenavi .prev:before{ top: 3px;}
	.container .mid-col .mid-col-container #content .archives .title{ font-size: 1.5em;}
	.container .mid-col .mid-col-container #content article{ padding: 15px 0px;}
	#header .subtitle {
		line-height: 1.2em;
		padding-top: 8px;
	}
	article pre{ background: none; border: none; padding: 0;}
	article .entry-content{text-align: left;}
	.share-comment{ padding: 25px 0px; clear: both;}
	hr{ margin: 20px 0px;border: 0; border-top:solid 1px #ddd;}
	</style>
  

</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
				<header id="header" class="inner">
				 
				 	<div class="profilepic">
						<img src="asset/icon.png" style="width:160px;">
					</div>
            	
					
					<h1><a href="index.html">Cain For iOS</a></h1>
					<p class="subtitle">指弹吉他演奏爱好者, 摄影爱好者, iOS 开发工程师, 如果您有更好的建议或者其他不明白的地方, 可以联系我QQ: 350116542</p>
					<nav id="main-nav">
						<ul class="main">
						
						  <li id=""><a target="self" href="index.html">Home</a></li>
						
						  <li id=""><a target="_self" href="archives.html">Archives</a></li>
						
						</ul>
					</nav>

					<nav id="sub-nav">
						<div class="social">




<a target="_blank" class="linkedin" href="www.linkedin.com/in/cainluo" title="LinkedIn">LinkedIn</a>



<a target="_blank" class="weibo" href="http://weibo.com/1826190094" title="weibo">Weibo</a>

<a target="_blank" class="github" target="_blank" href="https://github.com/CainRun" title="GitHub">GitHub</a>
<a target="_blank" class="email" href="mailto:zhebushimengfei@qq.com" title="Email">Email</a>

								

								<a class="rss" href="atom.xml" title="RSS">RSS</a>
							
						</div>
					</nav>
				</header>				
			</div>
		</div>	
		<div class="mid-col">
			<div class="mid-col-container"> <div id="content" class="inner">

	<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
		<h1 class="title" itemprop="name">玩转iOS开发：使用自定义《UIActivity》进行内容分享</h1>
		<div class="entry-content" itemprop="articleBody">
			<h3 id="toc_0">作者感言</h3>

<blockquote>
<p>在我写这篇文章的时候, 虽然国内有一堆文章介绍<strong><code>UIActivityViewController</code></strong>和<strong><code>UIActivity</code></strong>, 但都是零零散散的, 哪怕我翻墙出去看<strong><code>YouTube</code></strong>, 或者是著名的<strong><a href="http://nshipster.com/uiactivityviewcontroller/">黑胡子博客</a></strong>, 都没有详细的讲解怎么去自定义所需的<strong><code>UIActivity</code></strong>, 最后基本上翻遍了谷歌, 才找到了所需的.</p>

<p><strong><font color=purple>最后:</font></strong><br/>
<strong><font color=purple>如果你有更好的建议或者对这篇文章有不满的地方, 请联系我, 我会参考你们的意见再进行修改, 联系我时, 请备注</strong><code>UIActivityViewController</code><strong>如果觉得好的话, 希望大家也可以打赏一下~嘻嘻~祝大家学习愉快~谢谢~</font></strong></p>
</blockquote>

<span id="more"></span><!-- more -->

<hr/>

<h3 id="toc_1">简介</h3>

<blockquote>
<p>这段时间有很多朋友都问我关于怎么去集成<strong><code>ShareSDK</code></strong>或者<strong><code>友盟社会化分享SDK</code></strong>的问题, 其实我想说, <strong><code>Apple</code></strong>一开始就提供了一个类, 供我们去使用分享了, 在<strong><code>iOS 6</code></strong>之后更加增强了这个类, 使我们不再需要集成第三方的, 而且还支持自定义分享的<strong><code>item</code></strong>.</p>
</blockquote>

<hr/>

<h3 id="toc_2">创建新工程</h3>

<p><img src="https://raw.githubusercontent.com/CainRun/ActivityControllerDemo/master/Image-file/1.png" alt="1 | center | 1080x0"/></p>

<p><img src="https://raw.githubusercontent.com/CainRun/ActivityControllerDemo/master/Image-file/2.png" alt="2 | center | 1080x0"/></p>

<hr/>

<h3 id="toc_3">创建一个继承与UIActivityViewController的类</h3>

<p><img src="https://raw.githubusercontent.com/CainRun/ActivityControllerDemo/master/Image-file/3.png" alt="3 | center | 1080x0"/></p>

<p><img src="https://raw.githubusercontent.com/CainRun/ActivityControllerDemo/master/Image-file/4.png" alt="4 | center | 1080x0"/></p>

<hr/>

<h3 id="toc_4">创建一个继承与UIActivity的类</h3>

<p><img src="https://raw.githubusercontent.com/CainRun/ActivityControllerDemo/master/Image-file/5.png" alt="5 | center | 1080x0"/></p>

<blockquote>
<p>这时候我们就要来给这个自定义的<strong><code>UIActivity</code></strong>类写上我们需要的内容, 首先我们可以去到系统提供的<strong><code>UIActivity</code></strong>头文件看<strong><code>API</code></strong>, 获取我们所需的<strong><code>API</code></strong>.</p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/ActivityControllerDemo/master/Image-file/6.png" alt="6  | center | 1080x0"/></p>

<hr/>

<h3 id="toc_5">配置UIActivity和UIActivityViewController</h3>

<blockquote>
<p>下面是我写好的自定义<strong><code>WeiboActivity</code></strong> <strong><code>API</code></strong></p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/ActivityControllerDemo/master/Image-file/7.png" alt="7  | center | 1080x0"/></p>

<blockquote>
<p>具体实现的代码:</p>
</blockquote>

<pre><code class="language-Objective-c">#import &quot;WeiboActivity.h&quot;

@implementation WeiboActivity

- (NSString *)activityType {
    
    return @&quot;CustomWeiboActivity&quot;;
}

- (NSString *)activityTitle {
    
    return @&quot;新浪微博&quot;;
}

- (UIImage *)activityImage {
    
    return [UIImage imageNamed:@&quot;ShareBundle.bundle/share_icon_1&quot;];
}

- (void)performActivity {
    [self activityDidFinish:YES];
}

@end
</code></pre>

<blockquote>
<p>下面是我写好的自定义<strong><code>UIActivityController</code></strong></p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/ActivityControllerDemo/master/Image-file/8.png" alt="8  | center | 1080x0"/></p>

<blockquote>
<p>具体实现的代码:</p>
</blockquote>

<pre><code class="language-Objective-c">#import &quot;UIActivityController.h&quot;
#import &quot;WeiboActivity.h&quot;

#define CAL_GET_OBJECT(objc) if (objc) return objc

@interface UIActivityController ()

@property (nonatomic, strong) WeiboActivity *weiboActivity;

@end

@implementation UIActivityController

- (instancetype)initAspActivityControllerWithContent:(NSArray *)activityContent {
    
    NSArray *activitys = @[self.weiboActivity];
    
    if (self = [super initWithActivityItems:activityContent applicationActivities:activitys]) {
        
        self.excludedActivityTypes = @[UIActivityTypePostToFacebook,
                                       UIActivityTypePostToTwitter,
                                       UIActivityTypePostToWeibo,
                                       UIActivityTypeMail,
                                       UIActivityTypePrint,
                                       UIActivityTypeCopyToPasteboard,
                                       UIActivityTypeAssignToContact,
                                       UIActivityTypeSaveToCameraRoll,
                                       UIActivityTypeAddToReadingList,
                                       UIActivityTypePostToFlickr,
                                       UIActivityTypePostToVimeo,
                                       UIActivityTypePostToTencentWeibo,
                                       UIActivityTypeAirDrop,
                                       UIActivityTypeOpenInIBooks];
    }
    
    return self;
}

- (WeiboActivity *)weiboActivity {
    
    CAL_GET_OBJECT(_weiboActivity);
    
    _weiboActivity = [[WeiboActivity alloc] init];
    
    return _weiboActivity;
}

@end
</code></pre>

<blockquote>
<p>这里和大家说说<strong><code>excludedActivityTypes</code></strong>这个属性, 这个属性其实是一个数组属性, 代表的是, 如果我们不需要系统的服务就可以给它赋值, 这样子<strong><code>UIActivityViewController</code></strong>就不会显示对应的服务, 我这里默认全部干掉, 一个服务都不需要, 当然如果需要干掉我们自定义的<strong><code>UIActivity</code></strong>, 也可以在这里写上.</p>

<p>还有一点, 就是我们给<strong><code>UIActivityViewController</code></strong>赋值自定义的<strong><code>UIActivity</code></strong></p>

<p>PS: 注意一点, 这个赋值只能在<strong><code>initWithActivityItems: applicationActivities:</code></strong>这个方法的<strong><code>applicationActivities:</code></strong>赋值, 而且只能在初始化的时候赋值, 一旦赋值之后就不能再修改了.</p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/ActivityControllerDemo/master/Image-file/9.png" alt="9  | center | 1080x0"/></p>

<hr/>

<h3 id="toc_6">调起UIActivityViewController</h3>

<blockquote>
<p>最重要的地方来了, 就是调起我们自定义的<strong><code>UIActivityController</code></strong>.</p>

<p>首先我们要在<strong><code>Main.storyboard</code></strong>中拖一个<strong><code>UIButton</code></strong>, 然后添加对应的代码.</p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/ActivityControllerDemo/master/Image-file/10.png" alt="10  | center | 1080x0"/></p>

<blockquote>
<p>代码: </p>
</blockquote>

<pre><code class="language-Objective-c">#import &quot;ViewController.h&quot;
#import &quot;UIActivityController.h&quot;

@interface ViewController ()

@property (nonatomic, strong) UIActivityController *activityController;

@end

@implementation ViewController

- (IBAction)popActivityController:(UIButton *)sender {
    
    [self presentViewController:self.activityController animated:YES completion:nil];
}

- (UIActivityController *)activityController {
    
    NSString *shareTitle = @&quot;分享的标题&quot;;
    UIImage *shareImage = [UIImage imageNamed:@&quot;ShareBundle.bundle/share_icon_1&quot;];
    
    if (!_activityController) {
        
        _activityController = [[UIActivityController alloc] initAspActivityControllerWithContent:@[shareTitle, shareImage]];
    }
    
    return _activityController;
}

@end
</code></pre>

<blockquote>
<p>最后我们运行一下看看效果</p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/ActivityControllerDemo/master/Image-file/11.png" alt="10  | center | 720x0"/></p>

<blockquote>
<p>发现什么都没有, 肯定在喷我, 觉得我是在耍你们, 哈哈, 其实在这里我们少了一个方法没有添加, 回到我们自定义的<strong><code>WeiboActivity</code></strong>中, 添加上就OK了</p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/ActivityControllerDemo/master/Image-file/12.png" alt="12  | center | 1080x0"/></p>

<blockquote>
<p>具体实现的代码:</p>
</blockquote>

<pre><code class="language-Objective-c">- (BOOL)canPerformWithActivityItems:(NSArray *)activityItems {
    
    if (activityItems.count &gt; 0) {
        
        return YES;
    }
    
    return NO;
}
</code></pre>

<blockquote>
<p>再来运行看看效果</p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/ActivityControllerDemo/master/Image-file/13.png" alt="13  | center | 720x0"/></p>

<blockquote>
<p>好了, <strong><code>item</code></strong>出来了, 但好像有什么不对, 图标呢???!!! 为啥是灰色的? 楼主你耍我, 我要去爆你菊花!!!!!</p>

<p>别紧张, 在系统默认的<strong><code>UIActivityViewController</code></strong>中, 下面这部分是属于系统服务, 默认只会显示一个轮廓, 并不会显示整张图片, 下面我们把自定义的<strong><code>WeiboActivity</code></strong>显示图片的方法改改就好了.</p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/ActivityControllerDemo/master/Image-file/14.png" alt="14  | center | 1080x0"/></p>

<blockquote>
<p>代码:</p>
</blockquote>

<pre><code class="language-Objective-c">- (UIImage *)_activityImage {
    
    return [UIImage imageNamed:@&quot;ShareBundle.bundle/share_icon_1&quot;];
}
</code></pre>

<p><img src="https://raw.githubusercontent.com/CainRun/ActivityControllerDemo/master/Image-file/15.png" alt="15  | center | 720x0"/></p>

<blockquote>
<p>好了, 我的菊花保住了, 图标出来了, 把我吓了一身冷汗</p>

<p>图标出来了, 我们就要给这个<strong><code>item</code></strong>添加点击事件了, 做什么好呢, 总不可能让我去导个微信微博等SDK进来演示, 毕竟还要去申请<strong><code>AppID</code></strong>和<strong><code>AppKey</code></strong>呢, 我们来个弹框吧~~~</p>

<p>我一般喜欢写个<strong><code>Block</code></strong>把点击事件抛出去做处理, 这次我也不例外~~</p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/ActivityControllerDemo/master/Image-file/16.png" alt="16  | center | 1080x0"/></p>

<blockquote>
<p>具体实现的代码:</p>
</blockquote>

<pre><code class="language-Objective-c">- (void)performActivity {
    [self activityDidFinish:YES];
    
    if (self.weiboBlock) {
        self.weiboBlock();
    }
}
</code></pre>

<p><img src="https://raw.githubusercontent.com/CainRun/ActivityControllerDemo/master/Image-file/17.png" alt="17  | center | 1080x0"/></p>

<blockquote>
<p>具体实现的代码: </p>
</blockquote>

<pre><code class="language-Objective-c">- (WeiboActivity *)weiboActivity {
    
    CAL_GET_OBJECT(_weiboActivity);
    
    _weiboActivity = [[WeiboActivity alloc] init];
    
    [_weiboActivity setWeiboBlock:^{
        
        UIAlertView *alertView = [[UIAlertView alloc] initWithTitle:@&quot;新浪微博&quot;
                                                            message:@&quot;分享至新浪微博&quot;
                                                           delegate:nil
                                                  cancelButtonTitle:@&quot;好的&quot;
                                                  otherButtonTitles:nil, nil];
        
        [alertView show];
    }];

    return _weiboActivity;
}
</code></pre>

<blockquote>
<p>PS: 由于我这里是做示范, 所以使用<strong><code>UIAlertView</code></strong>, 如果大家要在项目中使用的话, 尽量使用<strong><code>UIAlertController</code></strong>.</p>
</blockquote>

<hr/>

<h3 id="toc_7">最终效果</h3>

<p><img src="https://raw.githubusercontent.com/CainRun/ActivityControllerDemo/master/Image-file/18.png" alt="15  | center | 720x0"/></p>

<hr/>

<h3 id="toc_8">工程地址</h3>

<p>项目地址: <a href="https://github.com/CainRun/ActivityControllerDemo/tree/master/UIActivityViewControllerDemo">https://github.com/CainRun/ActivityControllerDemo/tree/master/UIActivityViewControllerDemo</a></p>

		</div>
	</article>
	<div class="share-comment">
	 

	  

	  
	      <div class="ds-thread" data-thread-key="14729665774054.html" data-url="https://cainrun.github.io/14729665774054.html" data-title="玩转iOS开发：使用自定义《UIActivity》进行内容分享"></div>
	  

	</div>
</div>        </div>
			<footer id="footer" class="inner">Copyright &copy; 2014
Powered by <a target="_blank" href="https://cainrun.github.io">Cain</a> &nbsp;&nbsp; 
Theme by <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a>
      </footer>
		</div>
	</div>

  


<script type="text/javascript">
var duoshuoQuery = {short_name:'cainluo'};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
  </script>
    
<script src="asset/chart/all-min.js"></script><script type="text/javascript">$(function(){    var mwebii=0;    var mwebChartEleId = 'mweb-chart-ele-';    $('pre>code').each(function(){        mwebii++;        var eleiid = mwebChartEleId+mwebii;        if($(this).hasClass('language-sequence')){            var ele = $(this).addClass('nohighlight').parent();            $('<div id="'+eleiid+'"></div>').insertAfter(ele);            ele.hide();            var diagram = Diagram.parse($(this).text());            diagram.drawSVG(eleiid,{theme: 'simple'});        }else if($(this).hasClass('language-flow')){            var ele = $(this).addClass('nohighlight').parent();            $('<div id="'+eleiid+'"></div>').insertAfter(ele);            ele.hide();            var diagram = flowchart.parse($(this).text());            diagram.drawSVG(eleiid);        }    });});</script>
<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({TeX: { equationNumbers: { autoNumber: "AMS" } }});</script>

</body>
</html>