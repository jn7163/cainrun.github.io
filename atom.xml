<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Cain For iOS]]></title>
  <link href="https://cainrun.github.io/atom.xml" rel="self"/>
  <link href="https://cainrun.github.io/"/>
  <updated>2017-06-16T12:23:33+08:00</updated>
  <id>https://cainrun.github.io/</id>
  <author>
    <name><![CDATA[]]></name>
    
  </author>
  <generator uri="http://www.coderforart.com/">CoderForArt</generator>

  
  <entry>
    <title type="html"><![CDATA[ç©è½¬iOSå¼€å‘ï¼šiOS 10 æ–°ç‰¹æ€§ã€ŠSpeechã€‹]]></title>
    <link href="https://cainrun.github.io/14976719349322.html"/>
    <updated>2017-06-17T11:58:54+08:00</updated>
    <id>https://cainrun.github.io/14976719349322.html</id>
    <content type="html"><![CDATA[
<h3 id="toc_0">è¯­éŸ³è¯†åˆ«</h3>

<p>ä¹‹å‰åœ¨çœ‹é”¤å­çš„å‘å¸ƒä¼šçš„æ—¶å€™, çœ‹åˆ°äº†ä¸€ä¸ªå¾ˆå±Œçš„äº‹æƒ…å°±æ˜¯è®¯é£çš„è¯­éŸ³è¯†åˆ«æ æ çš„, å¯ä»¥æ ¹æ®äººè¯´çš„è¯­å¥æ¥è¾“å…¥æ–‡å­—, è€Œä¸”é”™åˆ«ç‡å¾ˆä½, ä¸šç•Œéƒ½è¯´<code>666</code>.</p>

<p>å¥½åœ¨è‹¹æœçˆ¸çˆ¸ä¹Ÿä¸è®¤è¾“, ä¹Ÿæœ‰ä¸ªåŸç”Ÿçš„è¯­éŸ³è¯†åˆ«æ¡†æ¶<code>Speech</code>, åºŸè¯å°‘è¯´äº†, æˆ‘ä»¬ç›´æ¥æ¥çœ‹çœ‹<code>Speech</code>æ¡†æ¶.</p>

<p>æˆ‘è¿™é‡Œæ˜¯<code>Objective-C</code>ç‰ˆæœ¬, å¦‚æœæƒ³çœ‹<code>Swift</code>ç‰ˆæœ¬çš„è¯, å¯ä»¥åˆ°<a href="https://github.com/shinobicontrols/iOS10-day-by-day/tree/master/08%20-%20Speech">è¿™é‡Œ</a>å»çœ‹.</p>

<span id="more"></span><!-- more -->

<hr/>

<h3 id="toc_1">New Project</h3>

<p>æ€ä¹ˆåˆ›å»ºæ–°é¡¹ç›®è¿™é‡Œå°±ä¸å¤šè¯´äº†, ç›´æ¥ä¸Šé¡¹ç›®æ¶æ„å›¾:</p>

<p><img src="https://raw.githubusercontent.com/CainRun/iOS-10-Characteristic/master/8.Speech/Images/1.png" alt="1"/></p>

<hr/>

<h3 id="toc_2">é…ç½®é¡¹ç›®</h3>

<p>ç”±äºç°åœ¨è‹¹æœè¶Šæ¥è¶Šæ³¨é‡ç”¨æˆ·çš„éšç§, å°±è¿æœ€ç®€å•çš„è¯·æ±‚ä½¿ç”¨éº¦å…‹é£, æ‘„åƒå¤´éƒ½éœ€è¦ç»è¿‡ç”¨æˆ·çš„å…è®¸, è¿™é‡Œæˆ‘ä»¬å°±éœ€è¦é…ç½®ä¸€ä¸‹è¿™äº›è¯·æ±‚:</p>

<p><img src="https://raw.githubusercontent.com/CainRun/iOS-10-Characteristic/master/8.Speech/Images/2.png" alt="2"/></p>

<p>è¯·æ±‚éº¦å…‹é£</p>

<ul>
<li>Privacy - Microphone Usage Description</li>
</ul>

<p>è¯·æ±‚è¯­éŸ³è¯†åˆ«ç³»ç»Ÿ</p>

<ul>
<li>Privacy - Speech Recognition Usage Description</li>
</ul>

<p>é‡Œé¢çš„æç¤ºæ–‡å­—å°±æ ¹æ®å¤§å®¶çš„å–œçˆ±æ¥è‡ªè¡Œç¼–å†™å§, è¿˜æœ‰æ›´å¤šçš„è¯·æ±‚è¿™é‡Œå°±ä¸å†™äº†, æœ‰éœ€è¦çš„æœ‹å‹å¯ä»¥è‡ªè¡Œå»æŸ¥èµ„æ–™æŠŠ.</p>

<hr/>

<h3 id="toc_3">SpeechLogic</h3>

<p>æˆ‘è¿™é‡Œæ–°å»ºäº†ä¸€ä¸ªç±», ä¸“é—¨ç”¨æ¥ç®¡ç†<code>Speech</code>, ç”±äºæˆ‘ç”¨ä¸ä¸Š<code>Speech</code>è¿™ä¸ªæ¡†æ¶, è¿™é‡Œæˆ‘å°±éšä¾¿å°è£…äº†, ç”¨åˆ°ä¸Šçš„æœ‹å‹å¯ä»¥è‡ªè¡Œå¦å¤–å°è£…å“ˆ.</p>

<p>æ–¹æ³•, å±æ€§éƒ½å·²ç»åœ¨æ–‡ä»¶é‡Œå¤‡æ³¨å¥½äº†, è‡ªè¡ŒæŸ¥çœ‹å°±å¥½äº†.</p>

<p><img src="https://raw.githubusercontent.com/CainRun/iOS-10-Characteristic/master/8.Speech/Images/3.png" alt="3"/></p>

<p><img src="https://raw.githubusercontent.com/CainRun/iOS-10-Characteristic/master/8.Speech/Images/4.png" alt="4"/></p>

<p><code>UI</code>ç•Œé¢ä¹Ÿå¾ˆç®€å•, è¿™é‡Œå°±æ›´åŠ ä¸ç”¨å»è§£é‡Šäº†</p>

<hr/>

<h3 id="toc_4">å¼€å§‹è¯­éŸ³è¯†åˆ«</h3>

<p>ç”±äºæˆ‘æ²¡èƒ½åœ¨æ¨¡æ‹Ÿå™¨ä¸Šé¢å®ç°, è¿™é‡Œæˆ‘å°±ç”¨äº†å¦å¤–çš„æ–¹æ³•, æœ‰äº›è›‹ç–¼:</p>

<p><img src="https://raw.githubusercontent.com/CainRun/iOS-10-Characteristic/master/8.Speech/Images/5.gif" alt="5"/></p>

<p>è‹¹æœçˆ¸çˆ¸çš„è¯­éŸ³è¯†åˆ«, ä¸åªæ˜¯èƒ½å¤Ÿè¯†åˆ«äººçš„è¯­éŸ³, è¿˜å¯ä»¥è¯»å–éŸ³é¢‘æ–‡ä»¶:</p>

<p><img src="https://raw.githubusercontent.com/CainRun/iOS-10-Characteristic/master/8.Speech/Images/6.gif" alt="6"/></p>

<hr/>

<h3 id="toc_5">æ€»ç»“</h3>

<p>æˆ‘è¿™é‡Œè®²çš„ä¸œè¥¿æ¯”è¾ƒå°‘, æœ‰å…´è¶£çš„æœ‹å‹å¯ä»¥å»çœ‹çœ‹<a href="https://my.oschina.net/u/2340880/blog/751442">Speechæ¡†æ¶APIè§£é‡Š</a>, æˆ–è€…æ˜¯è‹¹æœçˆ¸çˆ¸çš„<a href="https://developer.apple.com/reference/speech">å®˜æ–¹æ–‡æ¡£</a>, <a href="https://developer.apple.com/videos/play/wwdc2016/509/">WWDC 2016 Speechååˆ†é’Ÿè§†é¢‘</a>ä»¥åŠæˆ‘åœ¨Githubä¸Šçœ‹åˆ°çš„<a href="https://github.com/suifengqjn/IOS10Speech">iOS 10 Speeché¡¹ç›®</a>, è¿™äº›éƒ½æ˜¯æŒºä¸é”™çš„èµ„æ–™, æ–¹ä¾¿å¤§å®¶å»å­¦ä¹ .</p>

<hr/>

<h3 id="toc_6">å·¥ç¨‹åœ°å€</h3>

<p>é¡¹ç›®åœ°å€: <a href="https://github.com/CainRun/iOS-10-Characteristic/tree/master/8.Speech">https://github.com/CainRun/iOS-10-Characteristic/tree/master/8.Speech</a></p>

<hr/>

<h3 id="toc_7">æœ€å</h3>

<p><center>ç å­—å¾ˆè´¹è„‘, çœ‹å®˜èµç‚¹é¥­é’±å¯å¥½</center></p>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/WeChatPay-Objective-C/Images/%E5%BE%AE%E4%BF%A1QRC.jpg" alt="å¾®ä¿¡"/></p>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/WeChatPay-Objective-C/Images/%E6%94%AF%E4%BB%98%E5%AE%9DQRC.jpg" alt="æ”¯ä»˜å®"/></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ç©è½¬iOSå¼€å‘ï¼šiOS 10 æ–°ç‰¹æ€§ã€ŠMeasurementã€‹]]></title>
    <link href="https://cainrun.github.io/14975320210226.html"/>
    <updated>2017-06-15T21:07:01+08:00</updated>
    <id>https://cainrun.github.io/14975320210226.html</id>
    <content type="html"><![CDATA[
<h3 id="toc_0">å•ä½æ¢ç®—</h3>

<p>å•ä½æ¢ç®—å…¶å®åœ¨iOSå¼€å‘ä¸­, ä¸€ç›´æ˜¯ä¸€ä¸ªé—®é¢˜, è™½ç„¶åœ¨å¤§éƒ¨åˆ†<code>App</code>é‡Œä¸ä¸€å®šä¼šé‡åˆ°æ¢ç®—, ä½†åœ¨ä¸€äº›ä¸“ä¸šçº§çš„Appé‡Œ, æ¯”å¦‚å¯¼èˆª, æµ‹é‡, è®¡ç®—, æ±½è½¦è¾…åŠ©ç±»ç­‰<code>App</code>å°±è›‹ç–¼äº†, å› ä¸ºå®˜æ–¹å¹¶æ²¡æœ‰æä¾›è¿™ç±»çš„<code>API</code>, åŸºæœ¬ä¸Šéƒ½æ˜¯è‡ªå·±å†™, æˆ–è€…æ˜¯é›†æˆç¬¬ä¸‰æ–¹åº“.</p>

<p>è‹¹æœçˆ¸çˆ¸ä¸ºäº†å†ä¸€æ¬¡å®Œå–„<code>API</code>, åœ¨<code>Foundation</code>åº“é‡ŒåŠ äº†è¿™ä¹ˆä¸€ä¸ªå«åš<code>Measurement</code>çš„åº“, å°±æ˜¯ä¸ºäº†è§£å†³å•ä½æ¢ç®—çš„é—®é¢˜.</p>

<p>è¿™é‡Œçš„é¡¹ç›®æ˜¯<code>Objective-C</code>ç‰ˆæœ¬çš„, å¦‚æœå–œæ¬¢<code>Swift</code>ç‰ˆæœ¬çš„è¯, å¯ä»¥åˆ°<a href="https://github.com/shinobicontrols/iOS10-day-by-day/tree/master/07%20-%20Measurement">è¿™é‡Œ</a>å»æŸ¥çœ‹.</p>

<span id="more"></span><!-- more -->

<hr/>

<h3 id="toc_1">åˆ›å»ºé¡¹ç›®</h3>

<p>ç”±äºè¿™é‡Œè¦è®²çš„ä¸œè¥¿å¾ˆç®€å•, æˆ‘å°±ä¸è¿‡å¤šçš„å¤æ‚åŒ–ç›´æ¥çœ‹ä»£ç å¥½äº†:</p>

<pre><code class="language-objectivec">    // åˆå§‹åŒ–ä¸€ä¸ªç§’æ•°çš„åŸºæ•°
    NSMeasurement *seconds = [[NSMeasurement alloc] initWithDoubleValue:666
                                                                       unit:NSUnitDuration.seconds];
    
    // è½¬æ¢ä¸ºåˆ†é’Ÿ
    NSMeasurement *minutes = [seconds measurementByConvertingToUnit:NSUnitDuration.minutes];
    
    // è½¬æ¢ä¸ºå°æ—¶
    NSMeasurement *hours   = [seconds measurementByConvertingToUnit:NSUnitDuration.hours];

    NSString *secondsString = [NSString stringWithFormat:@&quot;%.2f ç§’&quot;, seconds.doubleValue];
    NSString *minutesString = [NSString stringWithFormat:@&quot;%.2f åˆ†é’Ÿ&quot;, minutes.doubleValue];
    NSString *hoursString   = [NSString stringWithFormat:@&quot;%.2f å°æ—¶&quot;, hours.doubleValue];
</code></pre>

<p><code>UI</code>çš„ä»£ç æˆ‘å°±ä¸è´´ä¸Šæ¥äº†, å¤§ä¼™å¯ä»¥å»é¡¹ç›®é‡Œè‡ªå·±å»çœ‹çœ‹, æ•´ä½“æ•ˆæœå°±é…±ç´«:</p>

<p><img src="https://raw.githubusercontent.com/CainRun/iOS-10-Characteristic/master/7.Measurement/Images/1.png" alt="1"/></p>

<hr/>

<h3 id="toc_2">æ”¯æŒæ¢ç®—å•ä½çš„ç±»å‹</h3>

<ul>
<li>NSDimension ç»´åº¦</li>
<li>NSUnitAcceleration æ¯ç§’/å¹³æ–¹ç±³</li>
<li>NSUnitAngle è§’åº¦</li>
<li>NSUnitArea å¹³æ–¹ç±³</li>
<li>NSUnitConcentrationMass æ¯å…‹/å‡</li>
<li>NSUnitDispersion ç™¾ä¸‡åˆ†ä¹‹</li>
<li>NSUnitDuration ç§’</li>
<li>NSUnitElectricCharge åº“ä»‘</li>
<li>NSUnitElectricCurrent å®‰åŸ¹</li>
<li>NSUnitElectricPotentialDifference ä¼</li>
<li>NSUnitElectricResistance æ¬§å§†</li>
<li>NSUnitEnergy ç„¦è€³</li>
<li>NSUnitFrequency èµ«å…¹</li>
<li>NSUnitFuelEfficiency å‡/æ¯100å…¬é‡Œ</li>
<li>NSUnitLength ç±³</li>
<li>NSUnitIlluminance å…¬æ–¤</li>
<li>NSUnitPower ç¾å›½ç“¦èŒ¨</li>
<li>NSUnitPressure ç‰›é¡¿/æ¯å¹³æ–¹ç±³</li>
<li>NSUnitSpeed ç§’/ç±³</li>
<li>NSUnitTemperature å¼€å°”æ–‡</li>
<li>NSUnitVolume å‡</li>
</ul>

<hr/>

<h3 id="toc_3">æ€»ç»“</h3>

<p>è‹¹æœçˆ¸çˆ¸åœ¨è¿™ä¸ªåº“é‡Œæä¾›äº†<code>170</code>å¤šç§ä¸åŒçš„å•ä½æ¢ç®—, æˆ‘è¿™é‡Œåªæ˜¯ç”¨äº†ä¸€ä¸¢ä¸¢, æ›´å¤šçš„æ–¹æ³•æœ‰å¾…å„ä½å»æŒ–æ˜, å¦‚æœæƒ³äº†è§£æ›´å¤šçš„è¯, å¯ä»¥å»çœ‹çœ‹<a href="https://developer.apple.com/videos/play/wwdc2016/238/">WWDC 2016</a>çš„è§†é¢‘è®²è§£.</p>

<hr/>

<h3 id="toc_4">å·¥ç¨‹åœ°å€</h3>

<p>é¡¹ç›®åœ°å€: <a href="https://github.com/CainRun/iOS-10-Characteristic/tree/master/7.Measurement">https://github.com/CainRun/iOS-10-Characteristic/tree/master/7.Measurement</a></p>

<hr/>

<h3 id="toc_5">æœ€å</h3>

<p><center>ç å­—å¾ˆè´¹è„‘, çœ‹å®˜èµç‚¹é¥­é’±å¯å¥½</center></p>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/WeChatPay-Objective-C/Images/%E5%BE%AE%E4%BF%A1QRC.jpg" alt="å¾®ä¿¡"/></p>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/WeChatPay-Objective-C/Images/%E6%94%AF%E4%BB%98%E5%AE%9DQRC.jpg" alt="æ”¯ä»˜å®"/></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ç©è½¬iOSå¼€å‘ï¼šiOS 10 æ–°ç‰¹æ€§ã€ŠNotification Content Extensionsã€‹]]></title>
    <link href="https://cainrun.github.io/14974988224036.html"/>
    <updated>2017-06-15T11:53:42+08:00</updated>
    <id>https://cainrun.github.io/14974988224036.html</id>
    <content type="html"><![CDATA[
<h3 id="toc_0">Notification Content Extensions</h3>

<p>åœ¨ä¹‹å‰æˆ‘ä»¬å°±è®²è¿‡è‹¹æœçˆ¸çˆ¸åœ¨<code>iOS 10</code>æ¨å‡ºäº†ä¸€ä¸ªæ–°çš„<code>UserNotification</code>æ¡†æ¶, ä½†è‹¹æœçˆ¸çˆ¸çš„é‡å¿ƒä¸å°, ä¸å•å•æ¨å‡ºæ¡†æ¶é‚£ä¹ˆç®€å•, è€Œä¸”è¿<code>Extension</code>éƒ½ç»™ä½ æäº†ä¸€ä¸ª, å“¼å“¼, æˆ‘çœ‹è¿˜æœ‰è°~</p>

<p>è¿™é‡Œæ‰€æ¼”ç¤ºçš„é¡¹ç›®æ˜¯å’Œä¹‹å‰ä¸€æ ·çš„, å¦‚æœæ‰¾ä¸åˆ°çš„ç›†å‹å¯ä»¥åˆ°<a href="https://cainrun.github.io/14973700585982.html">è¿™é‡Œ</a>å»çœ‹çœ‹.</p>

<span id="more"></span><!-- more -->

<hr/>

<h3 id="toc_1">æ·»åŠ Notification Extension</h3>

<p>å›åˆ°æˆ‘ä»¬çš„é¡¹ç›®, æ‹·è´ä¸€ä»½æ–°çš„, ç„¶åæ·»åŠ <code>Notification Extension</code>:</p>

<p><img src="https://raw.githubusercontent.com/CainRun/iOS-10-Characteristic/master/6.Notification%20Content%20Extension/Images/1.png" alt="1"/></p>

<p><img src="https://raw.githubusercontent.com/CainRun/iOS-10-Characteristic/master/6.Notification%20Content%20Extension/Images/2.png" alt="2"/></p>

<p><img src="https://raw.githubusercontent.com/CainRun/iOS-10-Characteristic/master/6.Notification%20Content%20Extension/Images/3.png" alt="3"/></p>

<hr/>

<h3 id="toc_2">é…ç½®Notification Extension Info</h3>

<p>æ·»åŠ å®Œ<code>Extension</code>ä¹‹å, æˆ‘ä»¬éœ€è¦æ¥é…ç½®ä¸€ä¸‹<code>Info.plist</code>æ–‡ä»¶, è¿™é‡Œæˆ‘ä»¬è¦æ·»åŠ ç‚¹ä¸œè¥¿:</p>

<ul>
<li>UNNotificationExtensionDefaultContentHidden

<ul>
<li>è®¾ç½®æˆä¸ºYES</li>
</ul></li>
<li>UNNotificationExtensionCategory

<ul>
<li>å’Œæˆ‘ä»¬ä¹‹å‰é¡¹ç›®çš„<code>AppDelegate.m</code>æ–‡ä»¶æ‰€æ·»åŠ çš„<code>Category</code>ä¿æŒä¸€è‡´, æˆ‘è¿™é‡Œæ˜¯<code>reminder</code></li>
</ul></li>
<li>UNNotificationExtensionInitialContentSizeRatio

<ul>
<li>è¿™ä¸ªä¸œä¸œæˆ‘æ”¹ä¸º0.5</li>
</ul></li>
</ul>

<p>ä¿®æ”¹å®Œæˆåçš„ç»“æœ:</p>

<p><img src="https://raw.githubusercontent.com/CainRun/iOS-10-Characteristic/master/6.Notification%20Content%20Extension/Images/4.png" alt="4"/></p>

<p>æ¥é€šçŸ¥çš„æ•ˆæœ:</p>

<p><img src="https://raw.githubusercontent.com/CainRun/iOS-10-Characteristic/master/6.Notification%20Content%20Extension/Images/5.png" alt="5"/></p>

<hr/>

<h3 id="toc_3">è‡ªå®šä¹‰ä¸€ä¸ªå°æ–¹æ³•</h3>

<p>ä¸Šé¢çš„ä¸œè¥¿éƒ½æå®šäº†ä¹‹å, é‚£ä¹ˆæ¥ä¸‹æ¥å°±æ˜¯è¦è‡ªå®šä¹‰ä¸€ä¸ªå°æ–¹æ³•:</p>

<pre><code class="language-objectivec">- (void)addShakeAnimation {
    
    CAKeyframeAnimation *frameAnimation = [CAKeyframeAnimation animation];

    frameAnimation.keyPath        = @&quot;transform.translation.x&quot;;
    frameAnimation.duration       = 1;
    frameAnimation.repeatCount    = MAXFLOAT;
    frameAnimation.values         = @[@-20.0, @20.0, @-20.0, @20.0, @-10.0, @10.0, @-5.0, @5.0, @0.0];
    frameAnimation.timingFunction = [CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionLinear];
    
    [self.view.layer addAnimation:frameAnimation
                           forKey:@&quot;shake&quot;];
}

- (void)removeShakeAnimation {
    
    [self.view.layer removeAnimationForKey:@&quot;shake&quot;];
}
</code></pre>

<ul>
<li><p>addShakeAnimationæ·»åŠ æ‘‡æ‘†åŠ¨ç”»çš„æ–¹æ³•</p></li>
<li><p>removeShakeAnimationåˆ é™¤æ‘‡æ‘†åŠ¨ç”»çš„æ–¹æ³•</p></li>
</ul>

<p>æ•ˆæœ:</p>

<p><img src="https://raw.githubusercontent.com/CainRun/iOS-10-Characteristic/master/6.Notification%20Content%20Extension/Images/6.gif" alt="6"/></p>

<hr/>

<h3 id="toc_4">- didReceiveNotificationResponse:completionHandler:æ–¹æ³•</h3>

<p>åœ¨<code>Notification Extension</code>é‡Œ, æœ‰è¿™ä¹ˆä¸€ä¸ªæ–¹æ³•å«åš: <code>- didReceiveNotificationResponse:completionHandler:</code>, è¿™ä¸ªæ–¹æ³•å¯ä»¥è·å–é€šçŸ¥é‡Œçš„<code>Action</code>äº‹ä»¶, æˆ‘è¿™é‡Œæ˜¯è¿™ä¹ˆå†™çš„:</p>

<pre><code class="language-objectivec">- (void)didReceiveNotificationResponse:(UNNotificationResponse *)response
                     completionHandler:(void (^)(UNNotificationContentExtensionResponseOption))completion {
    
    if ([response.actionIdentifier isEqualToString:@&quot;cancel&quot;]) {
        
        UNNotificationRequest *request = response.notification.request;
        
        NSArray *identifiers = @[request.identifier];
        
        // æ ¹æ®æ ‡è¯†ç¬¦åˆ é™¤ç­‰å¾…é€šçŸ¥
        [[UNUserNotificationCenter currentNotificationCenter] removePendingNotificationRequestsWithIdentifiers:identifiers];
        
        // æ ¹æ®æ ‡è¯†ç¬¦åˆ é™¤å‘é€é€šçŸ¥
        [[UNUserNotificationCenter currentNotificationCenter] removeDeliveredNotificationsWithIdentifiers:identifiers];
        
        self.label.text = @&quot;ç‚¹å‡»äº†å–æ¶ˆæŒ‰é’®&quot;;
        
        // åˆ é™¤åŠ¨ç”»æ•ˆæœ
        [self removeShakeAnimation];
        
        // ä¸éšè—é€šçŸ¥é¡µé¢
        completion(UNNotificationContentExtensionResponseOptionDoNotDismiss);
        
    } else {
        
        // éšè—é€šçŸ¥é¡µé¢
        completion(UNNotificationContentExtensionResponseOptionDismiss);
    }
}
</code></pre>

<p>å¦‚æœä¸æ‡‚è¿™ä¸ªåŠ¨ç”»åº”ç”¨çš„è¯, æˆ‘åœ¨åº¦å¨˜é‡Œçœ‹åˆ°äº†ä¸€ç¯‡æ–‡ç« , å¯ä»¥æ¥çœ‹çœ‹<a href="http://www.tuicool.com/articles/jeYfIv">IOS æ ¸å¿ƒåŠ¨ç”»ä¹‹CAKeyframeAnimation</a></p>

<p>æ•´ä½“çš„è¿è¡Œæ•ˆæœ:</p>

<p><img src="https://raw.githubusercontent.com/CainRun/iOS-10-Characteristic/master/6.Notification%20Content%20Extension/Images/7.gif" alt="7"/></p>

<hr/>

<h3 id="toc_5">æ€»ç»“</h3>

<p>æ–‡ç« é‡Œåªæ˜¯ç®€å•çš„è®²è§£, å¦‚æœè¿˜æƒ³äº†è§£æ›´å¤šçš„è¯, å¯ä»¥è‡ªè¡Œå»æŸ¥çœ‹<a href="https://developer.apple.com/videos/play/wwdc2016/708/">WWDC 2016</a>çš„è§†é¢‘è®²è§£.</p>

<hr/>

<h3 id="toc_6">å·¥ç¨‹åœ°å€</h3>

<p>é¡¹ç›®åœ°å€: <a href="https://github.com/CainRun/iOS-10-Characteristic/tree/master/6.Notification%20Content%20Extension">https://github.com/CainRun/iOS-10-Characteristic/tree/master/6.Notification%20Content%20Extension</a></p>

<hr/>

<h3 id="toc_7">æœ€å</h3>

<p><center>ç å­—å¾ˆè´¹è„‘, çœ‹å®˜èµç‚¹é¥­é’±å¯å¥½</center></p>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/WeChatPay-Objective-C/Images/%E5%BE%AE%E4%BF%A1QRC.jpg" alt="å¾®ä¿¡"/></p>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/WeChatPay-Objective-C/Images/%E6%94%AF%E4%BB%98%E5%AE%9DQRC.jpg" alt="æ”¯ä»˜å®"/></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ç©è½¬iOSå¼€å‘ï¼šiOS 10 æ–°ç‰¹æ€§ã€ŠUserNotificationsã€‹]]></title>
    <link href="https://cainrun.github.io/14973700585982.html"/>
    <updated>2017-06-14T00:07:38+08:00</updated>
    <id>https://cainrun.github.io/14973700585982.html</id>
    <content type="html"><![CDATA[
<h3 id="toc_0">UserNotifications</h3>

<p><code>Notification</code>åœ¨<code>iOS</code>ä»¥æ¥å‘å±•ä»¥æ¥éƒ½æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„åŠŸèƒ½ä¹‹ä¸€, å„ç±»<code>App</code>éƒ½éœ€è¦é€šè¿‡é€šçŸ¥æ¥æ¨é€æ¶ˆæ¯, ä¸ç„¶æ€ä¹ˆå‘Šè¯‰ç”¨æˆ·, <code>App</code>æ¥æ¶ˆæ¯æ¨é€å•¦, æˆ–è€…æœ‰ä»€ä¹ˆå®‰æ’äº‹é¡¹åˆ°ç‚¹è¦å‘Šè¯‰ä½ äº†, è¿™äº›éƒ½æ˜¯éœ€è¦æ¨é€çš„.</p>

<p>ä½†æˆ‘ä»¬éƒ½çŸ¥é“, åœ¨ä¹‹å‰çš„æ¶ˆæ¯æ¨é€é‡Œ, æ— è®ºæ˜¯<code>UI</code>è¿˜æ˜¯å†…å®¹, éƒ½æ˜¯éå¸¸çš„æ­», ä¸å¤Ÿäººæ€§åŒ–, å¥½åœ¨è‹¹æœçˆ¸çˆ¸ä¹Ÿçœ‹åˆ°äº†è¿™ä¸€ç‚¹, åœ¨<code>iOS 10</code>å°±æ”¹å–„äº†è¿™ä¸ªä¸œè¥¿.</p>

<p>åŒæ ·æˆ‘è¿™é‡Œä¹Ÿæ˜¯<code>Objective-C</code>ç‰ˆæœ¬, å–œæ¬¢çœ‹<code>Swift</code>ç‰ˆæœ¬çš„å¯ä»¥åˆ°<a href="https://github.com/shinobicontrols/iOS10-day-by-day/tree/master/05%20-%20User%20Notifications">è¿™é‡Œ</a>å»çœ‹.</p>

<span id="more"></span><!-- more -->

<hr/>

<h3 id="toc_1">UNUserNotification Of iOS 10</h3>

<p>é‚£ä¹ˆåœ¨<code>iOS 10</code>è‹¹æœçˆ¸çˆ¸æ¨å‡ºäº†<code>UNUserNotification</code>è¿™å¥—æ¡†æ¶, é™¤å»äº†ä»¥å‰é‚£å¥—ç¡¬é‚¦é‚¦çš„é€šçŸ¥ä¹‹å¤–, æˆ‘ä»¬å¯ä»¥é¢å¤–ç»™é€šçŸ¥æ·»åŠ ä¸€äº›<code>Action Button</code>, æˆ–è€…æ˜¯ä¸€äº›ä¸ä¸€æ ·çš„å†…å®¹, è¯´é‚£ä¹ˆå¤šåºŸè¯, ç›´æ¥æ¥çœ‹é¡¹ç›®å§.</p>

<hr/>

<h3 id="toc_2">åˆ›å»ºé¡¹ç›®</h3>

<p>æ–°å·¥ç¨‹å’Œæˆ‘ä»¬ä»¥å‰åˆ›å»ºçš„ä¸€æ¯›ä¸€æ ·, è¿™é‡Œå°±ä¸è¿‡å¤šçš„æ¼”ç¤ºäº†, æ–‡ç« åé¢æœ‰é¡¹ç›®åœ°å€, å¤§å®¶å¯ä»¥è‡ªè¡Œå»çœ‹.</p>

<p>æˆ‘ä»¬æ¥çœ‹çœ‹<code>AppDelegate.m</code>æ–‡ä»¶:</p>

<p><img src="https://raw.githubusercontent.com/CainRun/iOS-10-Characteristic/master/5.UserNotifications/Images/1.png" alt="1"/></p>

<p><img src="https://raw.githubusercontent.com/CainRun/iOS-10-Characteristic/master/5.UserNotifications/Images/2.png" alt="2"/></p>

<p>è¿™é‡Œè¦è‡ªå·±å†™ä»£ç çš„åœ°æ–¹æˆ‘éƒ½æ ‡ä¸Šå»äº†, å¦‚æœè¿˜æ˜¯çœ‹ä¸æ‡‚, é‚£æˆ‘å°±çœŸçš„æ²¡åŠæ³•äº†...</p>

<p>å†æ¥çœ‹çœ‹<code>NotificationController.m</code>æ–‡ä»¶, è¿™é‡Œæˆ‘ä»¬ç›´æ¥å¿½ç•¥æ‰<code>UI</code>çš„å¸ƒå±€, å› ä¸ºè¿™ä¸æ˜¯é‡ç‚¹:</p>

<p><img src="https://raw.githubusercontent.com/CainRun/iOS-10-Characteristic/master/5.UserNotifications/Images/3.png" alt="3"/></p>

<p><img src="https://raw.githubusercontent.com/CainRun/iOS-10-Characteristic/master/5.UserNotifications/Images/4.png" alt="4"/></p>

<p><img src="https://raw.githubusercontent.com/CainRun/iOS-10-Characteristic/master/5.UserNotifications/Images/5.png" alt="5"/></p>

<p><img src="https://raw.githubusercontent.com/CainRun/iOS-10-Characteristic/master/5.UserNotifications/Images/6.png" alt="6"/></p>

<p>ç”±äºè¿™é‡Œæ²¡æœ‰ä»”ç»†çš„å»å°è£…ä»£ç , æ‰€ä»¥çœ‹èµ·æ¥æœ‰äº›è‡ƒè‚¿, è¿™ä¸ªå¤§å®¶å°±ä¸è¦å–·äº†....</p>

<p>å¯¹äº†, æˆ‘æƒ³èµ·ä¸€ä¸ªå‘, åœ¨æˆ‘å¯¼å…¥<code>MP4</code>æ–‡ä»¶çš„æ—¶å€™, æˆ‘å‘ç°æ–‡ä»¶çš„<code>Path</code>å±…ç„¶ä¸º<code>nil</code>, äºæ˜¯ä¹<code>Google</code>äº†ä¸€ä¸‹, å‘ç°æ˜¯æˆ‘å‚»ç¼ºäº†, å¿˜è®°åœ¨è¿™é‡Œç‚¹ä¸€ä¸‹:</p>

<p><img src="https://raw.githubusercontent.com/CainRun/iOS-10-Characteristic/master/5.UserNotifications/Images/7.png" alt="7"/></p>

<p>å…³äºæ€ä¹ˆæ·»åŠ ä¸€äº›<code>Action Button</code>, é¡¹ç›®é‡Œé¢æ²¡æœ‰å¼„, è¿™é‡Œç»™å¤§å®¶è´´å¥ä»£ç å§:</p>

<pre><code class="language-objectivec">UNTextInputNotificationAction *inputAction = [UNTextInputNotificationAction
                                                  actionWithIdentifier:@&quot;inputAction&quot;
                                                  title:@&quot;è¾“å…¥&quot;
                                                  options:UNNotificationActionOptionForeground
                                                  textInputButtonTitle:@&quot;å‘é€&quot;
                                                  textInputPlaceholder:@&quot;éšä¾¿è¯´è¯´&quot;];

    UNNotificationAction *goodbyeAction = [UNNotificationAction actionWithIdentifier:@&quot;goodbyeAction&quot;
                                                                               title:@&quot;å†è§&quot;
                                                                             options:UNNotificationActionOptionForeground];

    UNNotificationAction *cancelAction = [UNNotificationAction actionWithIdentifier:@&quot;cancelAction&quot;
                                                                              title:@&quot;å–æ¶ˆ&quot;
                                                                            options:UNNotificationActionOptionDestructive];


    UNNotificationCategory *category = [UNNotificationCategory categoryWithIdentifier:@&quot;inputCategory&quot; actions:@[inputAction,goodbyeAction,cancelAction] intentIdentifiers:@[] options:UNNotificationCategoryOptionCustomDismissAction];

    [[UNUserNotificationCenter currentNotificationCenter] setNotificationCategories:@[category]];
</code></pre>

<hr/>

<h3 id="toc_3">ä¸€åˆ‡å°±ç»ª</h3>

<p>ä¸€åˆ‡å°±ç»ªä¹‹å, æˆ‘ä»¬å°±è¿è¡Œæ¥çœ‹çœ‹:</p>

<p><img src="https://raw.githubusercontent.com/CainRun/iOS-10-Characteristic/master/5.UserNotifications/Images/8.png" alt="8"/></p>

<p>è¿™æ˜¯ä¸€ä¸ªæ­£å¸¸é€šçŸ¥:</p>

<p><img src="https://raw.githubusercontent.com/CainRun/iOS-10-Characteristic/master/5.UserNotifications/Images/9.png" alt="9"/></p>

<p>è¿™æ˜¯æ·»åŠ äº†<code>Image</code>çš„é€šçŸ¥:</p>

<p><img src="https://raw.githubusercontent.com/CainRun/iOS-10-Characteristic/master/5.UserNotifications/Images/10.png" alt="10"/></p>

<p>è¿™æ˜¯æ·»åŠ äº†ä¸€ä¸ª<code>Video</code>çš„é€šçŸ¥, é‡ç‚¹æ˜¯è¿˜å¯ä»¥æ’­æ”¾:</p>

<p><img src="https://raw.githubusercontent.com/CainRun/iOS-10-Characteristic/master/5.UserNotifications/Images/11.png" alt="11"/></p>

<hr/>

<h3 id="toc_4">æ³¨æ„!!!</h3>

<p>è™½ç„¶è¯´è‹¹æœçˆ¸çˆ¸åœ¨<code>UNUserNotification</code>æœ‰äº†äº›èŠ±æ ·, ä½†è¿™é‡Œè¿˜æ˜¯éœ€è¦æ³¨æ„ä¸€ç‚¹, è¿™æ˜¯æœ‰é™åˆ¶çš„, ä¸ç„¶è¿™ä¹Ÿå¤ªä¸è‹¹æœäº†, é‚£ä¹ˆæ˜¯ä»€ä¹ˆé™åˆ¶å‘¢? å¯ä»¥ç‚¹è¿›å»è¿™é‡Œçœ‹çœ‹<a href="https://developer.apple.com/documentation/usernotifications/unnotificationattachment?language=objc">UNUserNotificationç±»å‹æ–‡ä»¶é™åˆ¶</a>, ä¸€æ—¦è¶…å‡ºäº†, å‡ºç°ä»€ä¹ˆé—®é¢˜, æˆ‘å°±æ¯é¸¡äº†.</p>

<p>å†æœè¿™ç¯‡æ–‡ç« çš„æ—¶å€™, çªç„¶å‘ç°äº†æœ‰å¤§ç¥æ€»ç»“äº†<a href="http://www.jianshu.com/p/9b720efe3779">WWDC2016ç¬”è®°</a>, å¤§å®¶æœ‰éœ€è¦å¯ä»¥å»çœ‹çœ‹~~</p>

<hr/>

<h3 id="toc_5">æ€»ç»“</h3>

<p>æ–‡ç« é‡Œåªæ˜¯ç®€å•çš„è®²è§£, å¦‚æœè¿˜æƒ³äº†è§£æ›´å¤šçš„è¯, å¯ä»¥è‡ªè¡Œå»æŸ¥çœ‹<a href="https://developer.apple.com/videos/play/wwdc2016/707/">WWDC 2016</a>çš„è§†é¢‘è®²è§£.</p>

<hr/>

<h3 id="toc_6">å·¥ç¨‹åœ°å€</h3>

<p>é¡¹ç›®åœ°å€: <a href="https://github.com/CainRun/iOS-10-Characteristic/tree/master/5.UserNotifications">https://github.com/CainRun/iOS-10-Characteristic/tree/master/5.UserNotifications</a></p>

<hr/>

<h3 id="toc_7">æœ€å</h3>

<p><center>ç å­—å¾ˆè´¹è„‘, çœ‹å®˜èµç‚¹é¥­é’±å¯å¥½</center></p>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/WeChatPay-Objective-C/Images/%E5%BE%AE%E4%BF%A1QRC.jpg" alt="å¾®ä¿¡"/></p>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/WeChatPay-Objective-C/Images/%E6%94%AF%E4%BB%98%E5%AE%9DQRC.jpg" alt="æ”¯ä»˜å®"/></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ç©è½¬iOSå¼€å‘ï¼šiOS 10 æ–°ç‰¹æ€§ã€ŠUIViewPropertyAnimatorã€‹]]></title>
    <link href="https://cainrun.github.io/14972802953896.html"/>
    <updated>2017-06-12T23:11:35+08:00</updated>
    <id>https://cainrun.github.io/14972802953896.html</id>
    <content type="html"><![CDATA[
<h3 id="toc_0">UIViewPropertyAnimator</h3>

<p>æˆ‘ä»¬ä¹‹å‰åœ¨åšåŸºç¡€åŠ¨ç”»æ•ˆæœçš„æ—¶å€™, åŸºæœ¬ä¸Šçš„ä»£ç éƒ½æ˜¯:</p>

<pre><code class="language-objectivec">    [UIView animateWithDuration:1
                          delay:0
                        options:UIViewAnimationOptionCurveEaseInOut
                     animations:^{
                         
                         // Do Something
                     } completion:^(BOOL finished) {
                         
                         // Do Something
                     }];
</code></pre>

<p>ä¸€èˆ¬éƒ½ä¼šè‡ªå·±å»å°è£…ä¸€ä¸‹, å…å¾—å¤§ä¸²ä»£ç åœ¨è¿™é‡Œæ¶å¿ƒ....</p>

<p>ä½†ç°åœ¨ä¸ç”¨äº†å’¯, è‡ªä»è‹¹æœçˆ¸çˆ¸åœ¨<code>iOS 10</code>æ¨å‡ºäº†ä¸€ä¸ªæ¡†æ¶<code>UIViewPropertyAnimator</code>, å¯ä»¥æ›´ç®€æ´çš„å»çœç•¥å¾ˆå¤šä»£ç , æˆ‘è¿™é‡Œæ˜¯<code>Objective-C</code>ç‰ˆæœ¬çš„, å¦‚æœæƒ³è¦çœ‹<code>Swift</code>ç‰ˆæœ¬, å¯ä»¥åˆ°è¿™é‡Œå»çœ‹<a href="https://github.com/shinobicontrols/iOS10-day-by-day/tree/master/04%20-%20UIViewPropertyAnimator">Swiftç‰ˆæœ¬</a></p>

<span id="more"></span><!-- more -->

<hr/>

<h3 id="toc_1">åˆ›å»ºé¡¹ç›®</h3>

<p>åºŸè¯å°±å°‘è¯´äº†, ç›´æ¥çœ‹ä»£ç å§:</p>

<p><img src="https://raw.githubusercontent.com/CainRun/iOS-10-Characteristic/master/4.UIViewPropertyAnimator/Images/1.png" alt="1"/></p>

<p>å¯¹å¤–å¼€æ”¾çš„æ–¹æ³•æœ‰:<br/>
<img src="https://raw.githubusercontent.com/CainRun/iOS-10-Characteristic/master/4.UIViewPropertyAnimator/Images/2.png" alt="2"/></p>

<p>ç”¨<code>UIViewPropertyAnimator</code>è¿è¡ŒåŠ¨ç”»çš„ä»£ç :</p>

<p><img src="https://raw.githubusercontent.com/CainRun/iOS-10-Characteristic/master/4.UIViewPropertyAnimator/Images/3.png" alt="3"/></p>

<p>æ•ˆæœ:<br/>
<img src="https://raw.githubusercontent.com/CainRun/iOS-10-Characteristic/master/4.UIViewPropertyAnimator/Images/4.png" alt="4"/></p>

<p>çœ‹å®Œä¹‹åä¼°è®¡å¾ˆå¤šäººéƒ½ä¼šè¯´, è¿™ä¸ªæœ‰ä»€ä¹ˆçš„, ä¹‹å‰çš„é‚£ä¸ª<code>API</code>ä¹Ÿå¯ä»¥æå®š, é‚£æˆ‘ä»¬å°±ç»§ç»­å¾€ä¸‹çœ‹çœ‹å§.</p>

<hr/>

<h3 id="toc_2">ä¸ºä»€ä¹ˆè¦ç”¨UIViewPropertyAnimator</h3>

<p>è¿™é‡Œæˆ‘æ‰¾åˆ°äº†ä¸€æ®µæ¯”è¾ƒå®˜æ–¹çš„è¯´æ³•:</p>

<blockquote>
<p><code>UIViewPropertyAnimator</code> çš„ <code>API</code> è®¾è®¡å¾—å¾ˆå®Œå–„ï¼Œå¯æ‰©å±•æ€§ä¹Ÿå¾ˆå¥½ã€‚å®ƒ<code>cover</code>äº†ä¼ ç»Ÿ <code>UIView animation</code>åŠ¨ç”»çš„ç»å¤§éƒ¨åˆ†åŠŸèƒ½ï¼Œå¹¶ä¸”å¤§å¤§å¢å¼ºäº†ä½ å¯¹åŠ¨ç”»è¿‡ç¨‹çš„æŒæ§èƒ½åŠ›ã€‚å…·ä½“æ¥è¯´ï¼Œä½ å¯ä»¥åœ¨åŠ¨ç”»è¿‡ç¨‹ä¸­ä»»æ„æ—¶åˆ»æš‚åœï¼Œå¯ä»¥éšåå†é€‰æ‹©ç»§ç»­ï¼Œç”šè‡³è¿˜èƒ½åœ¨åŠ¨ç”»è¿‡ç¨‹ä¸­åŠ¨æ€æ”¹å˜åŠ¨ç”»çš„å±æ€§ï¼ˆä¾‹å¦‚ï¼Œæœ¬æ¥åŠ¨ç”»ç»ˆç‚¹åœ¨å±å¹•å·¦ä¸‹è§’çš„ï¼Œå¯ä»¥åœ¨åŠ¨ç”»è¿‡ç¨‹ä¸­æŠŠç»ˆç‚¹æ”¹åˆ°å³ä¸Šè§’ï¼‰ã€‚</p>
</blockquote>

<p>çœ‹å®Œä»‹ç»ä¹‹å, åˆ°åº•æ˜¯ä¸æ˜¯é…±ç´«å‘¢, æˆ‘ä»¬æ¥åŠ ä¸€å¥ä»£ç çœ‹çœ‹:</p>

<pre><code class="language-objectivec">    // æ·»åŠ å¤šä¸€ä¸ªæ¸æ¸æ¶ˆå¤±çš„åŠ¨ç”»
    [propertyAnimator addAnimations:^{
        self.basicsView.alpha = 0;
    }];
</code></pre>

<p>æ•ˆæœ:<br/>
<img src="https://raw.githubusercontent.com/CainRun/iOS-10-Characteristic/master/4.UIViewPropertyAnimator/Images/5.png" alt="5"/></p>

<p>é™¤äº†è¿™ä¸ª, å¦‚æœè¦æ·»åŠ åŠ¨ç”»å®Œæˆåçš„å¤„ç†, ç”šè‡³æ˜¯åœ¨åŠ¨ç”»è¿›è¡Œä¸­çš„ä¸€äº›æ“ä½œä¹Ÿæ˜¯å¯ä»¥çš„:</p>

<pre><code class="language-objectivec">    [propertyAnimator addCompletion:^(UIViewAnimatingPosition finalPosition) {
        
        NSLog(@&quot;åŠ¨ç”»ç»“æŸå’¯&quot;);
    }];
    
    [propertyAnimator addCompletion:^(UIViewAnimatingPosition finalPosition) {
        
        switch (finalPosition) {
                
            case UIViewAnimatingPositionStart:
                
                NSLog(@&quot;åŠ¨ç”»å¼€å§‹äº†&quot;);
                
                break;
                
            case UIViewAnimatingPositionCurrent:
                
                NSLog(@&quot;åŠ¨ç”»ç»“æŸå’¯&quot;);

                break;
                
            case UIViewAnimatingPositionEnd:
                
                NSLog(@&quot;æ­£åœ¨æ‰§è¡ŒåŠ¨ç”»&quot;);

                break;
            default:
                break;
        }
    }];
</code></pre>

<hr/>

<h3 id="toc_3">æ·»åŠ ä¸ªæ‹–æ‹½å™¨</h3>

<p><code>UIViewPropertyAnimator</code>ä¸åªæ˜¯å¯ä»¥å†™å¥½äº†è§„å®šçš„åŠ¨ç”», ä¹Ÿå¯ä»¥å’Œå…¶ä»–æ§ä»¶ä¸€èµ·é…åˆä½¿ç”¨, æ¯”å¦‚<code>UISlider</code>, ä¸ºäº†æ–¹ä¾¿, æˆ‘å°±æŠŠ<code>UIViewPropertyAnimator *propertyAnimator</code>è®¾ç½®æˆä¸€ä¸ªå…¨å±€å±æ€§:</p>

<pre><code class="language-objectivec">@property (nonatomic, strong) UIViewPropertyAnimator *propertyAnimator;
</code></pre>

<p>ç„¶åå¼€å§‹å®ç°æˆ‘ä»¬çš„æ‹–æ‹½åŠ¨ç”»:</p>

<pre><code class="language-objectivec">- (void)addSliderWithSuperView {
    
    self.propertyAnimator = [[UIViewPropertyAnimator alloc] initWithDuration:5
                                                                       curve:UIViewAnimationCurveEaseIn
                                                                  animations:^{
                                                                                         
                                                                      [self.basicsView moveViewToBottmRight];
                                                                  }];

    UISlider *slider = [[UISlider alloc] initWithFrame:CGRectMake(0, 100, self.view.frame.size.width, 40)];
    
    [slider addTarget:self
               action:@selector(sliderValueChanged:)
     forControlEvents:UIControlEventValueChanged];
    
    [self.basicsView addSubview:slider];
}

- (void)sliderValueChanged:(UISlider *)slider {
    
    self.propertyAnimator.fractionComplete = slider.value;
}
</code></pre>

<p>æ•ˆæœå›¾:<br/>
<img src="https://raw.githubusercontent.com/CainRun/iOS-10-Characteristic/master/4.UIViewPropertyAnimator/Images/6.png" alt="6"/></p>

<hr/>

<h3 id="toc_4">åå‘åŠ¨ç”»</h3>

<p>å¦‚æœä½ è§‰å¾—å°±é…±ç´«ç»“æŸäº†, é‚£å°±å¤ªæ²¡æ„æ€äº†:</p>

<pre><code class="language-objectivec">/**
 åå‘åŠ¨ç”»
 */
- (void)viewAnimationCurveEaseInOut {
    
    UIButton *resetButton = [[UIButton alloc] initWithFrame:CGRectMake((self.view.frame.size.width / 2) - 100, 100, 200, 50)];
    
    [resetButton setTitleColor:[UIColor blackColor]
                      forState:UIControlStateNormal];
    [resetButton setTitle:@&quot;å¼€å§‹åå‘åŠ¨ç”»&quot;
                 forState:UIControlStateNormal];
    [resetButton addTarget:self
                    action:@selector(resetButtonAction)
          forControlEvents:UIControlEventTouchUpInside];
    
    [self.view addSubview:resetButton];
    
    self.propertyAnimator = [[UIViewPropertyAnimator alloc] initWithDuration:3
                                                                       curve:UIViewAnimationCurveEaseInOut
                                                                  animations:^{
                                                                      
                                                                      [self.basicsView moveViewToBottmRight];
                                                                  }];
    [self.propertyAnimator startAnimation];
}

/**
 æŒ‰é’®ç‚¹å‡»äº‹ä»¶
 */
- (void)resetButtonAction {
    
    self.propertyAnimator.reversed = YES;
}
</code></pre>

<p>æ•ˆæœ:<br/>
<img src="https://raw.githubusercontent.com/CainRun/iOS-10-Characteristic/master/4.UIViewPropertyAnimator/Images/7.png" alt="7"/></p>

<hr/>

<h3 id="toc_5">UISpringTimingParameters</h3>

<p>è¿™é‡Œè¿˜å¯ä»¥é…åˆç€<code>UISpringTimingParameters</code>æ¥ä½¿ç”¨:</p>

<pre><code class="language-objectivec">- (void)springTimingParameters {
    
    weakSelf(weakSelf);

    UISpringTimingParameters *springTimingParameters = [[UISpringTimingParameters alloc] initWithDampingRatio:0.3
                                                                                              initialVelocity:CGVectorMake(0, 0)];
    
    self.propertyAnimator = [[UIViewPropertyAnimator alloc] initWithDuration:4
                                                            timingParameters:springTimingParameters];
    
    [self.propertyAnimator addAnimations:^{
        
                            [weakSelf.basicsView moveViewToBottmRight];
    } delayFactor:3.0];
    
    [self.propertyAnimator startAnimation];
}
</code></pre>

<p>æ•ˆæœ:<br/>
<img src="https://raw.githubusercontent.com/CainRun/iOS-10-Characteristic/master/4.UIViewPropertyAnimator/Images/8.png" alt="8"/></p>

<hr/>

<h3 id="toc_6">UICubicTimingParameters</h3>

<p>è¿™é‡Œä¹Ÿå¯ä»¥é…åˆç€<code>UICubicTimingParameters</code>æ¥ç©è€~~</p>

<pre><code class="language-objectivec">/**
 UICubicTimingParameters åŠ¨ç”»
 */
- (void)cubicTimingParameters {
    
    weakSelf(weakSelf);

    UICubicTimingParameters *cubicTimingParameters = [[UICubicTimingParameters alloc] initWithControlPoint1:CGPointMake(0.05, 0.95)
                                                                                              controlPoint2:CGPointMake(0.15, 0.95)];
    
    self.propertyAnimator = [[UIViewPropertyAnimator alloc] initWithDuration:4
                                                            timingParameters:cubicTimingParameters];
    
    
    [self.propertyAnimator addAnimations:^{
        
        [weakSelf.basicsView moveViewToBottmRight];
    } delayFactor:0.25];
    
    [self.propertyAnimator startAnimation];
}
</code></pre>

<p>æ•ˆæœ:<br/>
<img src="https://raw.githubusercontent.com/CainRun/iOS-10-Characteristic/master/4.UIViewPropertyAnimator/Images/9.png" alt="9"/></p>

<p>å¤§æ¦‚å°±ä»‹ç»åˆ°è¿™é‡Œå§, æ›´å¤æ‚çš„ç©æ³•å°±æœ‰å¾…å„ä½å¤§ç¥å»æ…¢æ…¢æŒ–æ˜äº†~~</p>

<hr/>

<h3 id="toc_7">æ€»ç»“</h3>

<p>æ–‡ç« é‡Œåªæ˜¯ç®€å•çš„è®²è§£, å¦‚æœè¿˜æƒ³äº†è§£æ›´å¤šçš„è¯, å¯ä»¥è‡ªè¡Œå»æŸ¥çœ‹<a href="https://developer.apple.com/videos/play/wwdc2016/216/">WWDC 2016</a>çš„è§†é¢‘è®²è§£.</p>

<hr/>

<h3 id="toc_8">å·¥ç¨‹åœ°å€</h3>

<p>é¡¹ç›®åœ°å€: <a href="https://github.com/CainRun/iOS-10-Characteristic/tree/master/4.UIViewPropertyAnimator">https://github.com/CainRun/iOS-10-Characteristic/tree/master/4.UIViewPropertyAnimator</a></p>

<hr/>

<h3 id="toc_9">æœ€å</h3>

<p><center>ç å­—å¾ˆè´¹è„‘, çœ‹å®˜èµç‚¹é¥­é’±å¯å¥½</center></p>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/WeChatPay-Objective-C/Images/%E5%BE%AE%E4%BF%A1QRC.jpg" alt="å¾®ä¿¡"/></p>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/WeChatPay-Objective-C/Images/%E6%94%AF%E4%BB%98%E5%AE%9DQRC.jpg" alt="æ”¯ä»˜å®"/></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ç©è½¬iOSå¼€å‘ï¼šiOS 10 æ–°ç‰¹æ€§ã€ŠXcode Extensionã€‹]]></title>
    <link href="https://cainrun.github.io/14972357977664.html"/>
    <updated>2017-06-12T10:49:57+08:00</updated>
    <id>https://cainrun.github.io/14972357977664.html</id>
    <content type="html"><![CDATA[
<h3 id="toc_0">Xcode Extension</h3>

<p>åš<code>macOS</code>, <code>watchOS</code>, <code>tvOS</code>, <code>iOS</code>å¼€å‘, æœ€ç¦»ä¸å¼€çš„å·¥å…·å°±æ˜¯<code>Xcode</code>, ä½†<code>Xcode</code>çœŸçš„è®©æˆ‘ä»¬åˆçˆ±åˆæ¨, è™½ç„¶æœ‰å¾ˆå¤šå¼ºå¤§çš„åŠŸèƒ½, ä½†ç»†èŠ‚æ–¹é¢çœŸçš„å¾ˆéš¾<code>Care</code>åˆ°, äºæ˜¯ä¹<a href="http://alcatraz.io">Alcatraz</a>è¯ç”Ÿäº†, åœ¨å½“æ—¶ç«çš„ä¸è¦ä¸è¦çš„, åªè¦æ˜¯è€å¸æœºéƒ½ä¼šè£…ä¸€ä¸ª.</p>

<p>ä½†ç°åœ¨è‹¹æœçˆ¸çˆ¸è²Œä¼¼çœ‹åˆ°äº†å¼€å‘è€…çš„éœ€æ±‚, æ‰€ä»¥ç°åœ¨ç»™<code>Xcode</code>åŠ äº†ä¸€ä¸ªåŠŸèƒ½, å°±æ˜¯<code>Xcode Extension</code>.</p>

<p>ä¸¥æ ¼æ¥è¯´è¿™ä¸æ˜¯<code>iOS</code>çš„ä¸œè¥¿, ä½†åˆåˆšåˆšå¥½æ˜¯éšç€<code>iOS 10</code>ä¸€èµ·å‡ºæ¥çš„, æƒ³äº†æƒ³, è¿˜æ˜¯é›†åˆåœ¨è¿™é‡Œå§.</p>

<span id="more"></span><!-- more -->

<hr/>

<h3 id="toc_1">åˆ›å»ºé¡¹ç›®</h3>

<p>è¿™é‡Œæˆ‘ä»¬éœ€è¦åˆ›å»ºçš„æ˜¯<code>macOS</code>çš„é¡¹ç›®:</p>

<p><img src="https://raw.githubusercontent.com/CainRun/iOS-10-Characteristic/master/3.Xcode%20Extensions/Images/1.png" alt="1"/></p>

<p>ç„¶ååœ¨é¡¹ç›®çš„<code>General</code>é‡Œæ‰¾åˆ°æ·»åŠ <code>Extension</code>çš„é€‰é¡¹:</p>

<p><img src="https://raw.githubusercontent.com/CainRun/iOS-10-Characteristic/master/3.Xcode%20Extensions/Images/2.png" alt="2"/></p>

<p>é€‰æ‹©<code>Xcode Editor Extension</code>:</p>

<p><img src="https://raw.githubusercontent.com/CainRun/iOS-10-Characteristic/master/3.Xcode%20Extensions/Images/3.png" alt="3"/></p>

<p>è¿™å°±æ˜¯<code>Xcode Extension</code>å•¦:</p>

<p><img src="https://raw.githubusercontent.com/CainRun/iOS-10-Characteristic/master/3.Xcode%20Extensions/Images/4.png" alt="4"/></p>

<p>é¡ºä¾¿è¯´è¯´, æˆ‘åœ¨è¿™ä¸ª<code>info.plist</code>æ”¹äº†ä¸€ä¸‹å‚æ•°:</p>

<p><img src="https://raw.githubusercontent.com/CainRun/iOS-10-Characteristic/master/3.Xcode%20Extensions/Images/5.png" alt="5"/></p>

<hr/>

<h3 id="toc_2">æ³¨æ„</h3>

<p>è¿™é‡Œæœ‰ä¸€ä¸ªå°å‘, æ³¨æ„è¦ç»™æˆ‘ä»¬<code>Xcode Extension</code>ç”³è¯·ä¸€ä¸ªè¯ä¹¦, ä¸¤è¾¹éƒ½è¦ç”³è¯·å“¦.</p>

<p><img src="https://raw.githubusercontent.com/CainRun/iOS-10-Characteristic/master/3.Xcode%20Extensions/Images/6.png" alt="6"/></p>

<p><img src="https://raw.githubusercontent.com/CainRun/iOS-10-Characteristic/master/3.Xcode%20Extensions/Images/7.png" alt="7"/></p>

<p>ä¸ç„¶å°±ä¼šæŠ¥-67050é”™è¯¯:</p>

<pre><code class="language-vim">IDESourceEditorExtension: Xcode Source Editor Extension does not meet code signing requirement: me.ocean.XcodeExt.XcodeExtTest ((null)), Error Domain=DVTSecErrorDomain Code=-67050 &quot;code failed to satisfy specified code requirement(s)&quot; UserInfo={NSLocalizedDescription=code failed to satisfy specified code requirement(s)}
</code></pre>

<p>è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªè¯¡å¼‚çš„é”™è¯¯ä»£ç 4097, ä½†æˆ‘<code>clean</code>äº†ä¸€ä¸‹å·¥ç¨‹ä¹‹åå°±æ¶ˆå¤±äº†, å¤§å®¶æ³¨æ„æ³¨æ„.</p>

<pre><code class="language-vim">Hub connection error Error Domain=NSCocoaErrorDomain Code=4097
</code></pre>

<hr/>

<h3 id="toc_3">ä»£ç ä»£ç !!!</h3>

<p>è¿™é‡Œæˆ‘å°±éšæ‰‹å†™ä¸¤å¥ä»£ç å¥½äº†, <code>Xcode</code>çš„æ‰©å±•è¿˜æ˜¯é å„ä½å¤§ç¥å»å‘æŒ¥æƒ³è±¡, æˆ‘ä»¥åå†æºå’Œå’¯.</p>

<pre><code class="language-objectivec">    XCSourceTextBuffer *textBuffer = invocation.buffer;
    XCSourceTextRange *insertPointRange = textBuffer.selections[0];
    
    NSInteger startLine = insertPointRange.start.line;
    
    [textBuffer.lines insertObject:@&quot;è¿™æ˜¯ä»€ä¹ˆé¬¼ğŸ‘»&quot; atIndex:startLine];
</code></pre>

<hr/>

<h3 id="toc_4">è¿è¡Œ</h3>

<p>ä¸€åˆ‡å°±ç»ªä¹‹å, æˆ‘ä»¬å°±è¿è¡Œ, ç„¶åé€‰æ‹©ä¸º<code>Xcode</code>æ·»åŠ æ’ä»¶:</p>

<p><img src="https://raw.githubusercontent.com/CainRun/iOS-10-Characteristic/master/3.Xcode%20Extensions/Images/8.png" alt="8"/></p>

<p>ç­‰å¾…è¿è¡Œå®Œæˆä¹‹å, ä¼šå¼¹å‡ºä¸€ä¸ªç°è‰²çš„<code>Xcode</code>:</p>

<p><img src="https://raw.githubusercontent.com/CainRun/iOS-10-Characteristic/master/3.Xcode%20Extensions/Images/9.png" alt="9"/></p>

<p>è¿™æ—¶ä¸ç”¨ç†ä¼š, æˆ‘ä»¬å›åˆ°æ­£å¸¸çš„<code>Xcode</code>, ç„¶åæ‰¾åˆ°<code>Editor</code>, ç‚¹å‡»å®ƒ, æˆ‘ä»¬å°±ä¼šå‘ç°æ’ä»¶åœ¨è¿™é‡Œå•¦:</p>

<p><img src="https://raw.githubusercontent.com/CainRun/iOS-10-Characteristic/master/3.Xcode%20Extensions/Images/10.png" alt="10"/></p>

<p>ä½†è¿™é‡Œå¤šè¯´ä¸€å¥, å½“æˆ‘ä»¬åœæ­¢è¿è¡Œä¹‹å, æ’ä»¶åˆä¼šä¸è§äº†çš„, è¿™ä¸ªéœ€è¦å¤§å®¶è‡ªè¡Œå»æ‰“åŒ…ç„¶åå‘å¸ƒå‡ºæ¥~~è¿™é‡Œå°±ä¸å¤šè¯´äº†, è¯¦ç»†å¤§å®¶å»å‚è€ƒ<a href="https://github.com/qfish/XAlign">XAlign</a>å§</p>

<hr/>

<h3 id="toc_5">æ€»ç»“</h3>

<p>æ–‡ç« é‡Œåªæ˜¯ç®€å•çš„è®²è§£, å¦‚æœè¿˜æƒ³äº†è§£æ›´å¤šçš„è¯, å¯ä»¥è‡ªè¡Œå»æŸ¥çœ‹<a href="https://developer.apple.com/videos/play/wwdc2016/414/">WWDC 2016</a>çš„è§†é¢‘è®²è§£.</p>

<hr/>

<h3 id="toc_6">å·¥ç¨‹åœ°å€</h3>

<p>é¡¹ç›®åœ°å€: <a href="https://github.com/CainRun/iOS-10-Characteristic/tree/master/3.Xcode%20Extensions">https://github.com/CainRun/iOS-10-Characteristic/tree/master/3.Xcode%20Extensions</a></p>

<hr/>

<h3 id="toc_7">æœ€å</h3>

<p><center>ç å­—å¾ˆè´¹è„‘, çœ‹å®˜èµç‚¹é¥­é’±å¯å¥½</center></p>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/WeChatPay-Objective-C/Images/%E5%BE%AE%E4%BF%A1QRC.jpg" alt="å¾®ä¿¡"/></p>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/WeChatPay-Objective-C/Images/%E6%94%AF%E4%BB%98%E5%AE%9DQRC.jpg" alt="æ”¯ä»˜å®"/></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ç©è½¬iOSå¼€å‘ï¼šiOS 10 æ–°ç‰¹æ€§ã€ŠThread Sanitizerã€‹]]></title>
    <link href="https://cainrun.github.io/14971830645415.html"/>
    <updated>2017-06-11T20:11:04+08:00</updated>
    <id>https://cainrun.github.io/14971830645415.html</id>
    <content type="html"><![CDATA[
<h3 id="toc_0">Thread Sanitizer(TSan)</h3>

<blockquote>
<p><code>Thread Sanitizer</code>è¿™ä¸ªæ€ä¹ˆç¿»è¯‘å‘¢...å…¶å®æˆ‘æƒ³äº†å¾ˆä¹…, <code>çº¿ç¨‹æ´—æ‰‹æ¶²</code>? <code>çº¿ç¨‹æ¸…æ‰«è½¦</code>? æ„Ÿè§‰éƒ½ä¸å¤ªå¯¹....äºæ˜¯ä¹è¿˜æ˜¯ä¸ç¿»è¯‘äº†, æˆ‘ä»¬åªè¦çŸ¥é“è¿™ä¸ªä¸œè¥¿æ˜¯ç”¨æ¥è§£å†³çº¿ç¨‹é—®é¢˜çš„å°±å“¦äº†, æˆ‘è¿™ä¸ªæ˜¯<code>Objective-c</code>ç‰ˆæœ¬çš„, å¦‚æœä½ ä»¬å–œæ¬¢<code>Swift</code>ç‰ˆæœ¬çš„è¯, å¯ä»¥å»æ‰¾æ‰¾<a href="https://github.com/shinobicontrols/iOS10-day-by-day/tree/master/02%20-%20Thread%20Sanitizer">Swiftç‰ˆæœ¬</a></p>
</blockquote>

<span id="more"></span><!-- more -->

<hr/>

<h3 id="toc_1">ä½¿ç”¨åœºæ™¯</h3>

<p>é‚£ä¹ˆåœ¨ä»€ä¹ˆæ—¶å€™ä¼šç”¨åˆ°è¿™ä¸ª<code>Thread Sanitizer</code>å‘¢? å…¶å®å°±æ˜¯åœ¨æˆ‘ä»¬ç²¾å¿ƒå¼€å‘å¥½ä¸€ä¸ªAppä¹‹å, å‘ç°æœ‰æ–­æ–­ç»­ç»­ä¸åœçš„å°Bug, ç„¶åä¼šå¯¼è‡´<code>Crash</code>ç­‰é—®é¢˜, ä½ åˆæ²¡æ³•æ‰¾åˆ°çš„æ—¶å€™, å°±å¯ä»¥ç”¨è¿™ä¸ªä¸œè¥¿è¯•è¯•çœ‹å•¦.</p>

<p>é‚£ä¸€èˆ¬ä¼šåœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå‘ç”Ÿå‘¢? æˆ‘æ‰¾åˆ°äº†ä¸€æ®µæ¯”è¾ƒå®˜æ–¹çš„æ–‡å­—, å¤§å®¶å‡‘åˆç€çœ‹çœ‹å§.</p>

<blockquote>
<p>é€šå¸¸ï¼Œ è¿™äº›éƒ½æ˜¯å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®å†…å­˜ä¸­çš„åŒä¸€æ®µåœ°å€é€ æˆçš„ã€‚ç›¸ä¿¡çº¿ç¨‹é—®é¢˜æ˜¯è®¸å¤šå¼€å‘äººå‘˜çš„å™©æ¢¦ã€‚å®ƒä»¬éš¾ä»¥è·Ÿè¸ªï¼Œå› ä¸ºé”™è¯¯åªå‘ç”Ÿåœ¨æŸäº›æ¡ä»¶ä¸‹ï¼Œæ‰€ä»¥ç¡®å®šé—®é¢˜çš„æ ¹æœ¬åŸå› å¯èƒ½æ˜¯éå¸¸æ£˜æ‰‹çš„ã€‚é€šå¸¸çš„åŸå› æ˜¯æ‰€è°“çš„â€œrace conditionâ€ã€‚</p>

<p>å½“ä¸¤ä¸ªçº¿ç¨‹å¹¶å‘è®¿é—®åŒä¸€ä¸ªå˜é‡ï¼Œå¹¶ä¸”è‡³å°‘æœ‰ä¸€ä¸ªè®¿é—®æ˜¯å†™æ—¶ï¼Œä¼šå‘ç”Ÿæ•°æ®ç«äº‰ã€‚</p>
</blockquote>

<hr/>

<h3 id="toc_2">Thread Sanitizer(TSan)å¯ä»¥æ£€æŸ¥çš„ç±»å‹é”™è¯¯</h3>

<p>è™½ç„¶è¯´<code>Thread Sanitizer</code>è¿™ä¸ªå·¥å…·å¾ˆç‰›é€¼, ä½†ä¹Ÿä¸æ˜¯ä¸‡èƒ½çš„, å®ƒåªèƒ½å¤Ÿæ£€æµ‹å‡ºä»¥ä¸‹å‡ ç§é”™è¯¯.</p>

<ul>
<li>Use of uninitialized mutexes</li>
<li>Thread leaks (missing phread_johin)</li>
<li>Unsafe calls in signal handlers (ex:malloc)</li>
<li>Unlock from wrong thread</li>
<li>Data race</li>
</ul>

<hr/>

<h3 id="toc_3">æ‰“å¼€Thread Sanitizerå·¥å…·</h3>

<p><code>Thread Sanitizer</code>å·¥å…·æ˜¯åœ¨å·¥ç¨‹é‡Œçš„<code>Edit Scheme</code> -&gt; <code>Diagnostics</code>æ‰“å¼€, <br/>
å¹¶ä¸åƒ<code>Instruments</code>é‚£æ ·åœ¨<code>Developer Tools</code>é‡Œæ‰“å¼€.</p>

<p><img src="https://raw.githubusercontent.com/CainRun/iOS-10-Characteristic/master/2.Thread%20Sanitizer/Images/1.png" alt="1"/></p>

<hr/>

<h3 id="toc_4">åˆ›å»ºé¡¹ç›®</h3>

<p>ä¸€åˆ‡æ‰€æœ‰çš„ä¸œè¥¿, éƒ½è¦ä»ä»£ç å…¥æ‰‹, è¿™é‡Œæˆ‘ä»¬ä¹Ÿæ˜¯ä¸€æ ·, å†™ä¸€ä¸ªå°å°çš„<code>Demo</code>æ¥æ¼”ç¤ºæ¼”ç¤º, <code>UI</code>ç•¥ä¸‘, å¤§å®¶å‡‘åˆç€çœ‹å§....ä»£ç çš„è¯, åœ¨å·¥ç¨‹é‡Œè‡ªè¡Œå»ç¿»æŸ¥å§~</p>

<p><img src="https://raw.githubusercontent.com/CainRun/iOS-10-Characteristic/master/2.Thread%20Sanitizer/Images/2.png" alt="2"/></p>

<p>é‡Œé¢çš„å¸ƒå±€ä»£ç ä¹Ÿæ²¡æœ‰ä»€ä¹ˆå¥½çœ‹çš„, è¿™é‡Œç›´æ¥ç”¨çš„æ˜¯<code>Masonry</code>, æ„Ÿè°¢<code>Masonry</code>ä½œè€…çš„æ— ç§å¥‰çŒ®~~</p>

<hr/>

<h3 id="toc_5">è¿ç®—é€»è¾‘</h3>

<p>è¿™é‡Œæˆ‘å°±ä¸å†™é‚£ä¹ˆå¤§çš„æ•°é¢äº†, å°±å–åä½æ•°å“¦äº†(åˆ«è¯´æˆ‘å°æ°”), </p>

<p>è¿™é‡Œçš„å­˜å…¥é€»è¾‘ç°å¸¸çš„ç®€å•, è®¡ç®—å®Œç»“æœä¹‹åå°±ä¼ å…¥è¿›å»:</p>

<pre><code class="language-objectivec">- (void)setMoneyInTheBank {
    
    NSString *amount = [NSString stringWithFormat:@&quot;æ€»é¢: Â¥%ld&quot;, self.bankView.amount + 10];
    
    [self.bankView changeLabelContentWithString:amount];
}
</code></pre>

<p>æœ¬æ¥æ¥ç€è¦å»å†™å–å¾—é€»è¾‘, ä½†è¿™é‡Œæƒ³åˆ°ä¸€ä¸ªæƒ…å†µ, å¿«é€Ÿçš„æŒ‰å­˜å’Œå–, é‚£å°±ä¼šå‘ç”Ÿåˆšåˆšåœ¨æ–‡ç« å¼€å¤´æ‰€è¯´çš„æ•°æ®ç«äº‰é—®é¢˜, è¿™é‡Œç»è¿‡æ€è€ƒå, å‘ç°è¦ä½¿ç”¨ä¸€ä¸¢ä¸¢å¤šçº¿ç¨‹çš„æŠ€å·§.</p>

<pre><code class="language-objectivec">- (void)getMoneyOfBanek {
    
    dispatch_async(dispatch_queue_create(&quot;com.threadsanitizer.ThreadSanitizer&quot;, nil), ^{
        
        if (self.amount &lt;= 0) {
            NSLog(@&quot;ä½ éƒ½æ²¡é’±å•¦, æ€ä¹ˆå–?&quot;);
            
            return;
        }
        
        // è¿™æ˜¯è®©çº¿ç¨‹å…ˆä¼‘æ¯ä¸€ç§’å…ˆ~
        sleep(1);
        
        dispatch_async(dispatch_get_main_queue(), ^{
            
            NSString *amount = [NSString stringWithFormat:@&quot;æ€»é¢: Â¥%ld&quot;, self.amount -= 10];

            [self.bankView changeLabelContentWithString:amount];
        });
    });
}
</code></pre>

<p>å†™å®Œä¹‹å, ç„¶åè¿è¡Œ, ç‹‚ç‚¹å­˜å’Œå–, ç„¶åå°±ä¼šå‡ºç°ä¸‹é¢é…±ç´«çš„ç”»é¢:</p>

<p><img src="https://raw.githubusercontent.com/CainRun/iOS-10-Characteristic/master/2.Thread%20Sanitizer/Images/3.png" alt="3"/></p>

<p>æ˜¯ä¸æ˜¯å¾ˆå®¹æ˜“å°±æ‰¾å‡ºé—®é¢˜çš„æ‰€åœ¨å‘¢?</p>

<blockquote>
<p>åŸç†çš„è¯, å¤§æ¦‚å°±å’Œä½ åƒé¥­ä¸€æ ·, å…ˆå’½ä¸‹ç¬¬ä¸€å£å†å’½ä¸‹ç¬¬äºŒå£, ä¸ç„¶ä¸€èµ·å’½ä¸‹, å°±ä¼šå‘›ç€äº†.</p>
</blockquote>

<p>é¡ºä¾¿è¯´è¯´: </p>

<ul>
<li>TSan æ˜¯ä¸€ä¸ªæ£€æŸ¥ Runtime Issues çš„å·¥å…· (ä¸æ”¯æŒé™æ€æ£€æŸ¥)</li>
<li>åªèƒ½è¿è¡Œåœ¨è¯­è¨€ç‰ˆæœ¬3ç¼–å†™çš„Swiftä»£ç ä¸Š (Objective-Cä¹Ÿå¯å…¼å®¹)ï¼Œ</li>
<li>åªèƒ½åœ¨64ä½macOS æˆ– 64ä½æ¨¡æ‹Ÿå™¨ä¸Šè¿è¡Œ (æ‰€æœ‰çœŸæœºè®¾å¤‡éƒ½ä¸å¯ä»¥ç”¨æ¥è°ƒè¯•)ã€‚</li>
</ul>

<hr/>

<h3 id="toc_6">æ€»ç»“</h3>

<p>æ–‡ç« é‡Œåªæ˜¯ç®€å•çš„è®²è§£, å¦‚æœè¿˜æƒ³äº†è§£æ›´å¤šçš„è¯, å¯ä»¥è‡ªè¡Œå»æŸ¥çœ‹<a href="https://developer.apple.com/videos/play/wwdc2016/412/">WWDC 2016</a>çš„è§†é¢‘è®²è§£.</p>

<hr/>

<h3 id="toc_7">å·¥ç¨‹åœ°å€</h3>

<p>é¡¹ç›®åœ°å€: <a href="https://github.com/CainRun/iOS-10-Characteristic/tree/master/2.Thread%20Sanitizer">https://github.com/CainRun/iOS-10-Characteristic/tree/master/2.Thread%20Sanitizer</a></p>

<hr/>

<h3 id="toc_8">æœ€å</h3>

<p><center>ç å­—å¾ˆè´¹è„‘, çœ‹å®˜èµç‚¹é¥­é’±å¯å¥½</center></p>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/WeChatPay-Objective-C/Images/%E5%BE%AE%E4%BF%A1QRC.jpg" alt="å¾®ä¿¡"/></p>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/WeChatPay-Objective-C/Images/%E6%94%AF%E4%BB%98%E5%AE%9DQRC.jpg" alt="æ”¯ä»˜å®"/></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ç©è½¬iOSå¼€å‘ï¼šiOS 10 æ–°ç‰¹æ€§ã€ŠMessage Extensionã€‹]]></title>
    <link href="https://cainrun.github.io/14969899245168.html"/>
    <updated>2017-06-09T14:32:04+08:00</updated>
    <id>https://cainrun.github.io/14969899245168.html</id>
    <content type="html"><![CDATA[
<h3 id="toc_0">è¯´ç‚¹åºŸè¯</h3>

<blockquote>
<p>ä¸­é€”å› ä¸ºå‘ç”Ÿäº†ç‚¹äº‹, æ‰€ä»¥æœ‰ä¸€æ®µæ—¶é—´æ²¡æœ‰å†™åšæ–‡äº†, ç°åœ¨å¼€å§‹å¼€å§‹æ…¢æ…¢å†™å›, å†™çš„é£æ ¼ä¹Ÿæ”¹äº†ä¸€äº›, å¤§å®¶ä¸æ‡‚å¾—å¯ä»¥å»å„å¤§åšå®¢, è®ºå›, ç­‰ç­‰åœ°æ–¹ç¿»ç¿»èµ„æ–™, å¦‚æœä¸€å®šè¦æ‰¾æˆ‘é—®é—®é¢˜çš„è¯, éº»çƒ¦å…ˆç”¨çº¢åŒ…æ¥æ‰“ä¸€ä¸‹æˆ‘, ç¥å¤§å®¶å­¦ä¹ æ„‰å¿«.</p>
</blockquote>

<span id="more"></span><!-- more -->

<hr/>

<h3 id="toc_1">Message</h3>

<p><code>Message</code>æ˜¯è‹¹æœçˆ¸çˆ¸åœ¨<code>iOS 10</code>å¼€æ”¾ç»™å¼€å‘è€…çš„åº“, è™½ç„¶è¯´æ˜¯æ–°çš„åº“, ä½†å’Œåœ¨<code>iOS 8</code>æ‰€ä½¿ç”¨çš„æ–¹å¼å·®ä¸å¤š, å°±æ˜¯<code>Extension</code>, æˆ‘ä»¬éƒ½çŸ¥é“<code>iOS</code>æ˜¯å°é—­ç³»ç»Ÿ, æ‰€ä»¥å°±ä¸ç”¨æŠ±ç€ä¼šå’Œ<code>Android</code>é‚£æ ·çš„å¼€å‘.</p>

<p>ä½œä¸º<code>Extension</code>æœ‰ä»€ä¹ˆå¥½å¤„å’§, æŒ‰ç…§å®˜æ–¹çš„è¯´æ³•å°±æ˜¯, æ—¢å¯ä»¥ä¿è¯ç³»ç»Ÿçš„å®‰å…¨, åˆå¯ä»¥ç‹¬ç«‹äº<code>App</code>ä¹‹å¤–, ä¸å¿…ç»‘å®šçˆ¶åº”ç”¨ç¨‹åºçš„ä¸€éƒ¨åˆ†.</p>

<p>è¿™é‡Œæ³¨æ˜ä¸€ä¸‹, æˆ‘è¿™ä¸ªæ˜¯<code>Objective-C</code>ç‰ˆæœ¬çš„, å¦‚æœè¦æ‰¾<code>Swift</code>ç‰ˆæœ¬çš„è¯, å¯ä»¥åˆ°è¿™é‡Œå»<a href="https://github.com/shinobicontrols/iOS10-day-by-day/tree/master/01%20-%20Messages">Swift-Message</a>.</p>

<hr/>

<h3 id="toc_2">åˆ›å»ºé¡¹ç›®</h3>

<p>åˆ›å»º<code>Message</code>å¾ˆç®€å•, æ‰“å¼€<code>Xcode -&gt; New Project -&gt; iMessage Application</code>å°±æå®šäº†.</p>

<p><img src="https://raw.githubusercontent.com/CainRun/iOS-10-Characteristic/master/1.Message/Images/1.png" alt="1"/></p>

<p>åˆ›å»ºå®Œä¹‹å, æˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°ä¸€ä¸ª<code>MessageViewController</code>, è¿™ä¸ªæ˜¯è‹¹æœçˆ¸çˆ¸ä¸€å¼€å§‹å°±ç»™æˆ‘ä»¬å¼„å¥½çš„æ§åˆ¶å™¨, æˆ‘ä»¬åªéœ€è¦åœ¨ä¸Šé¢å¼„æˆ‘ä»¬æ‰€éœ€è¦çš„ä¸œè¥¿å°±å¥½.</p>

<p><img src="https://raw.githubusercontent.com/CainRun/iOS-10-Characteristic/master/1.Message/Images/2.png" alt="2"/></p>

<hr/>

<h3 id="toc_3">ä¸¤ä¸ªé‡è¦çš„æ–¹æ³•</h3>

<p>è¿™é‡Œæœ‰ä¸¤ä¸ªé‡è¦çš„æ–¹æ³•æ˜¯æˆ‘ä»¬å¿…é¡»çŸ¥é“çš„</p>

<pre><code class="language-objectivec">// å½“æˆ‘ä»¬å³å°†æ‰“å¼€Message Extensionçš„æ—¶å€™, å°±ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•
- (void)willBecomeActiveWithConversation:(MSConversation *)conversation;
</code></pre>

<pre><code class="language-objectivec">// å½“æˆ‘ä»¬å³å°†æ“ä½œMessage Extensionçš„æ—¶å€™, å°±ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•, å¯ä»¥é€‰æ‹©ä¸åŒçš„æ ·å¼, ç„¶åå†³å®šä½ çš„Message Extensionçš„æ˜¾ç¤ºæ–¹å¼
-
(void)willTransitionToPresentationStyle:(MSMessagesAppPresentationStyle)presentationStyle;
</code></pre>

<hr/>

<h3 id="toc_4">æ·»åŠ æ–°çš„æ§åˆ¶å™¨</h3>

<p>ä¸ºäº†å¯æ‰©å±•æ€§å’Œä½è€¦åˆ, æˆ‘æ‰“ç®—æŠŠæ•´ä¸ª<code>Message Extension</code>æ‹†çš„éå¸¸é›¶æ•£, è¿™ä¸ªæ—¶å€™å°±éœ€è¦å¥½å‡ ä¸ª<code>Controller</code>å»åˆ†åˆ«ç®¡ç†å®ƒä»¬è‡ªå·±çš„ä¸šåŠ¡é€»è¾‘äº†.</p>

<p>è¿™é‡Œé¡ºä¾¿åŠ ä¸€ä¸ªç¬¬ä¸‰æ–¹çš„åº“<code>Masonry</code>, æ„Ÿè°¢<code>Masonry</code>ä½œè€…çš„æ— ç§å¥‰çŒ®~~</p>

<p>æˆ‘è¿™ä¸ª<code>Demo</code>é‡Œä¸€å…±æœ‰ä¸‰ä¸ªè‡ªå·±åˆ›å»ºçš„æ§åˆ¶å™¨, åˆ†åˆ«æ˜¯<code>MessageStartController</code>, <code>MessageFinishController</code>, <code>MessageChangeController</code></p>

<p>ç”±äºåªæ˜¯ç®€å•çš„æ¼”ç¤º, æ‰€ä»¥è¿™è¾¹å°±ä¸å¼„çš„é‚£ä¹ˆå¤æ‚äº†, è¯¦ç»†çš„ä»£ç è‡ªå·±å¯ä»¥å»çœ‹çœ‹, ä¹Ÿå¾ˆç®€å•.</p>

<hr/>

<h3 id="toc_5">MessagesViewController</h3>

<p>å›åˆ°æˆ‘ä»¬çš„<code>MessagesViewController</code>, è¿™é‡Œä¸»è¦è®²è®²æˆ‘çš„ä»£ç :</p>

<pre><code class="language-objectivec">/**
 Configure ChildController

 @param presentationStyle MSMessagesAppPresentationStyle
 @param conversation MSConversation
 */
- (void)configureChildViewControllerWithPresentationStyle:(MSMessagesAppPresentationStyle)presentationStyle
                                             conversation:(MSConversation *)conversation {
    
    // æ¸…é™¤æ‰€æœ‰çš„è‡ªæ§åˆ¶å™¨
    for (UIViewController *childController in self.childViewControllers) {
        
        [childController willMoveToParentViewController:nil];
        [childController.view removeFromSuperview];
        [childController removeFromParentViewController];
    }
    
    switch (presentationStyle) {
        case MSMessagesAppPresentationStyleCompact:
            
            self.childViewController = [self createMessageStartController];
            
            break;
        case MSMessagesAppPresentationStyleExpanded:{
            
            MSMessage *message = conversation.selectedMessage;
            
            if (message) {
                
                self.childViewController = [self createChangeControllerWithConversation:conversation];

            } else {
                self.childViewController = [self createFinishControllerWithConversation:conversation];
            }
        }
            break;
        default:
            break;
    }
    
    // æ·»åŠ å­æ§åˆ¶å™¨
    [self addChildViewController:self.childViewController];
    
    [self.view addSubview:self.childViewController.view];
    
    [self.childViewController.view mas_makeConstraints:^(MASConstraintMaker *make) {
        (void)make.edges;
    }];
    
    [self.childViewController didMoveToParentViewController:self];
}
</code></pre>

<p>ä¹‹å‰ä¹Ÿè¯´è¿‡, ä¸ºäº†çµæ´»æ€§å’Œä½è€¦åˆ, ä¸Šé¢é‚£ä¸ªæ–¹æ³•å°±æ˜¯ç”¨æ¥æ·»åŠ å’Œåˆ é™¤å­æ§åˆ¶å™¨çš„.</p>

<pre><code class="language-objectivec">- (void)willBecomeActiveWithConversation:(MSConversation *)conversation {
    
    [self configureChildViewControllerWithPresentationStyle:self.presentationStyle
                                               conversation:conversation];
}

-(void)willTransitionToPresentationStyle:(MSMessagesAppPresentationStyle)presentationStyle {

    [self configureChildViewControllerWithPresentationStyle:presentationStyle
                                               conversation:self.activeConversation];
}
</code></pre>

<p>ä¸Šé¢è¿™ä¸¤ä¸ªæ–¹æ³•å°±æ˜¯åœ¨<code>Message Extension</code>åœ¨åˆ‡æ¢ä¸åŒæ ·å¼çš„æ—¶å€™, å»è°ƒç”¨<code>configureChildViewControllerWithPresentationStyle:</code>æ–¹æ³•, æ¥è¾¾åˆ°åœ¨ä¸åŒæ ·å¼ä¸‹å¯ä»¥åˆ‡æ¢ä¸åŒçš„å­æ§åˆ¶å™¨.</p>

<pre><code class="language-objectivec">/**
 Configure Message Start Controller

 @return UIViewController
 */
- (UIViewController *)createMessageStartController {
    
    MessageStartController *childController = [[MessageStartController alloc] init];
    
    [childController setMessageStartBloack:^(UIButton *sender){
        
        [self requestPresentationStyle:MSMessagesAppPresentationStyleExpanded];
    }];
    
    return childController;
}

/**
 Configure Message Finish Controller
 
 @return UIViewController
 */
- (UIViewController *)createFinishControllerWithConversation:(MSConversation *)conversation {
    
    MessageFinishController *finishController = [[MessageFinishController alloc] init];
    
    [finishController setMessageFinishBloack:^(UIButton *sender){
        
        MSSession *session = [[MSSession alloc] init];
        
        NSString *player = [NSString stringWithFormat:@&quot;%@ - æ˜¯å¦è¦å‘é€è¿™æ¡å†…å®¹?&quot;, conversation.localParticipantIdentifier];
        
        [self insertMessageWithCaption:player
                               session:session
                                 image:[UIImage ms_getImageForView:self.view]
                          conversation:conversation];
        
        [self dismiss];
    }];
    
    return finishController;
}

/**
 Configure Message Change Controller
 
 @return UIViewController
 */
- (UIViewController *)createChangeControllerWithConversation:(MSConversation *)conversation {
    
    MessageChangeController *changeViewController = [[MessageChangeController alloc] init];
    
    [changeViewController setMessageChangeBloack:^(UIButton *sender){
        
        MSMessage *message = conversation.selectedMessage;
        
        if (message) {
            
            MSSession *session = [message session];
            
            NSString *player = [NSString stringWithFormat:@&quot;%@ - æ˜¯å¦è¦å‘é€æ›´æ”¹åçš„å†…å®¹?&quot;, conversation.localParticipantIdentifier];
            
            [self insertMessageWithCaption:player
                                   session:session
                                     image:[UIImage ms_getImageForView:self.view]
                              conversation:conversation];
        }
        
        [self dismiss];
    }];
    
    return changeViewController;
}
</code></pre>

<p>ä¸Šé¢è¿™ä¸‰ä¸ªæ–¹æ³•å°±æ˜¯ç”¨æ¥é…ç½®<code>MessageStartController</code>, <code>MessageFinishController</code>, <code>MessageChangeController</code>ä¸‰ä¸ªæ§åˆ¶å™¨.</p>

<hr/>

<h3 id="toc_6">é‡ç‚¹</h3>

<p>è¿™é‡Œéœ€è¦é‡ç‚¹è®²ä¸€ä¸ªæ–¹æ³•:</p>

<pre><code class="language-objectivec">/**
 æŠŠå†…å®¹æ’å…¥åˆ°Messageä¸­

 @param caption NSString
 @param session MSSession
 @param image UIImage
 @param conversation MSConversation
 */
- (void)insertMessageWithCaption:(NSString *)caption
                         session:(MSSession *)session
                           image:(UIImage *)image
                    conversation:(MSConversation *)conversation {
    
    MSMessage *message = [[MSMessage alloc] initWithSession:session];
    MSMessageTemplateLayout *templateLayout = [[MSMessageTemplateLayout alloc] init];
    
    templateLayout.caption = caption;
    templateLayout.image = image;
    
    message.layout = templateLayout;
    message.URL = [NSURL URLWithString:@&quot;http://www.baidu.com&quot;];
    
    [conversation insertMessage:message
              completionHandler:nil];
}

</code></pre>

<p>è¿™ä¸ªæ–¹æ³•, å¯ä»¥æŠŠæˆ‘ä»¬æƒ³è¦å†…å®¹æ’å…¥åˆ°<code>Message Extension</code>ä¸­, ç„¶åå‘é€å‡ºå».</p>

<hr/>

<h3 id="toc_7">æœ€ç»ˆæ•ˆæœ</h3>

<p><img src="https://raw.githubusercontent.com/CainRun/iOS-10-Characteristic/master/1.Message/Images/3.gif" alt="3"/></p>

<hr/>

<h3 id="toc_8">æ€»ç»“</h3>

<p>æ–‡ç« é‡Œåªæ˜¯ç®€å•çš„è®²è§£, å¦‚æœè¿˜æƒ³äº†è§£æ›´å¤šçš„è¯, å¯ä»¥è‡ªè¡Œå»æŸ¥çœ‹<a href="https://developer.apple.com/videos/play/wwdc2016/224/">WWDC 2016</a>çš„è§†é¢‘è®²è§£.</p>

<hr/>

<h3 id="toc_9">å·¥ç¨‹åœ°å€</h3>

<p>é¡¹ç›®åœ°å€: <a href="https://github.com/CainRun/iOS-10-Characteristic/tree/master/1.Message">https://github.com/CainRun/iOS-10-Characteristic/tree/master/1.Message</a></p>

<hr/>

<h3 id="toc_10">æœ€å</h3>

<p><center>ç å­—å¾ˆè´¹è„‘, çœ‹å®˜èµç‚¹é¥­é’±å¯å¥½</center></p>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/WeChatPay-Objective-C/Images/%E5%BE%AE%E4%BF%A1QRC.jpg" alt="å¾®ä¿¡"/></p>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/WeChatPay-Objective-C/Images/%E6%94%AF%E4%BB%98%E5%AE%9DQRC.jpg" alt="æ”¯ä»˜å®"/></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ç©è½¬iOSå¼€å‘ï¼š7.ã€ŠCore Animationã€‹Implicit Animations]]></title>
    <link href="https://cainrun.github.io/14807833712288.html"/>
    <updated>2016-12-04T00:42:51+08:00</updated>
    <id>https://cainrun.github.io/14807833712288.html</id>
    <content type="html"><![CDATA[
<h3 id="toc_0">ä½œè€…æ„Ÿè¨€</h3>

<blockquote>
<p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« <a href="https://cainrun.github.io/14790557329421.html">ã€ŠCore Animationã€‹CALayerçš„Specialized Layers</a>ä¸­, æˆ‘ä»¬äº†è§£äº†<strong>CALayer</strong>çš„è®¸å¤šå­ç±»ç‰¹æ€§, å¯ä»¥ä¸ºæˆ‘ä»¬åœ¨é‡åˆ°ä¸€äº›ç‰¹æ®Šçš„å¼€å‘éœ€æ±‚ä¸­æä¾›ä¸€å®šçš„å¸®åŠ©, æ—¢ç„¶æˆ‘ä»¬è¿™æ¬¡å­¦çš„çš„<strong>Core Animation</strong>, é‚£æ€ä¹ˆä¼šå’ŒåŠ¨ç”»ä¸æŒ‚é’©å‘¢? è¿™æ¬¡è®©æˆ‘ä»¬æ¥åˆä½“éªŒä¸€ä¸‹.</p>

<p><dr/><br/>
<strong><font color=purple>æœ€å:</font></strong><br/>
<strong><font color=purple>å¦‚æœä½ æœ‰æ›´å¥½çš„å»ºè®®æˆ–è€…å¯¹è¿™ç¯‡æ–‡ç« æœ‰ä¸æ»¡çš„åœ°æ–¹, è¯·è”ç³»æˆ‘, æˆ‘ä¼šå‚è€ƒä½ ä»¬çš„æ„è§å†è¿›è¡Œä¿®æ”¹, è”ç³»æˆ‘æ—¶, è¯·å¤‡æ³¨</strong><code>Core Animation</code><strong>å¦‚æœè§‰å¾—å¥½çš„è¯, å¸Œæœ›å¤§å®¶ä¹Ÿå¯ä»¥æ‰“èµä¸€ä¸‹~å˜»å˜»~ç¥å¤§å®¶å­¦ä¹ æ„‰å¿«~è°¢è°¢~</font></strong></p>
</blockquote>

<span id="more"></span><!-- more -->

<hr/>

<h3 id="toc_1">ç®€ä»‹</h3>

<blockquote>
<p><strong>Implicit Animations</strong>ä¹Ÿç§°ä¸ºéšå¼åŠ¨ç”», å•¥? ä»€ä¹ˆå«åšéšå¼åŠ¨ç”»? ç™¾åº¦å»å§~~å“ˆå“ˆå“ˆ(åé¢ä¼šè®²è§£çš„), è¿™äº›é—®é¢˜å°±ä¸åœ¨è¿™é‡Œåšè§£é‡Šäº†, è¿˜æ˜¯è¿›å…¥ä¸»é¢˜æ‰æ¯”è¾ƒé‡è¦.</p>
</blockquote>

<hr/>

<h3 id="toc_2">Transactions</h3>

<blockquote>
<p>å…¶å®åœ¨<strong>Core Animation</strong>ä¸­, åŠ¨ç”»æ•ˆæœå¹¶ä¸éœ€è¦æˆ‘ä»¬å»æ‰‹åŠ¨æ‰“å¼€, å› ä¸ºç³»ç»Ÿé»˜è®¤å°±æ˜¯<strong>Open</strong>çŠ¶æ€, ç›¸åè¿‡æ¥, å¦‚æœæˆ‘ä»¬ä¸éœ€è¦åŠ¨ç”»çš„è¯, æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨çš„å»å…³é—­.<br/>
<dr/><br/>
å¦‚æœæˆ‘ä»¬ç”¨ä¸€ä¸ª<strong>CALayer</strong>çš„ä¸€ä¸ªåŠ¨ç”»å±æ€§, å¹¶ä¸”å°è¯•å»æ”¹å˜å®ƒ, è¿™ä¸ªæ•ˆæœå¹¶ä¸ä¼šé©¬ä¸Šå°±æ˜¾ç¤ºå‡ºæ¥, å› ä¸ºå®ƒè¦ä»ä¸€ä¸ªé»˜è®¤å€¼å¹³æ»‘çš„è¿‡åº¦åˆ°ä¸€ä¸ªæ–°çš„å€¼, è€Œè¿™äº›æ‰€æœ‰çš„å†…éƒ¨æ“ä½œæˆ‘ä»¬éƒ½ä¸éœ€è¦å»ç†ä¼š, å› ä¸ºç³»ç»Ÿé»˜è®¤å°±æ˜¯è¿™ä¹ˆåšçš„.<br/>
<dr/><br/>
æˆ‘ä»¬å¯ä»¥å…ˆæ¥çœ‹ä¸ª<strong>Demo</strong>:</p>
</blockquote>

<pre><code class="language-objectivec">- (void)transactionsColor {
    
    UIView *view = [[UIView alloc] initWithFrame:CGRectMake(0,
                                                            100,
                                                            self.view.frame.size.width,
                                                            self.view.frame.size.width)];
    
    view.backgroundColor = [UIColor grayColor];
    
    [self.view addSubview:view];
    
    UIButton *button = [[UIButton alloc] init];
    
    button.center = CGPointMake(self.view.frame.size.width / 2, 50);
    button.bounds = CGRectMake(0, 0, 100, 50);
    button.backgroundColor = [UIColor blueColor];
    
    [button setTitle:@&quot;æ”¹å˜é¢œè‰²&quot;
            forState:UIControlStateNormal];
    [button addTarget:self
               action:@selector(changeLayerColor)
     forControlEvents:UIControlEventTouchUpInside];
    
    [view addSubview:button];
    
    self.colorLayer  = [CALayer layer];
    self.colorLayer.position = CGPointMake(view.frame.size.width / 2, view.frame.size.height / 2);
    self.colorLayer.bounds = CGRectMake(0, 0, 150, 150);
    self.colorLayer.backgroundColor = [UIColor redColor].CGColor;
    
    [view.layer addSublayer:self.colorLayer];
}

- (void)changeLayerColor {
    
    CGFloat redColor = arc4random() / (CGFloat)INT_MAX;
    CGFloat greenColor = arc4random() / (CGFloat)INT_MAX;
    CGFloat blueColor = arc4random() / (CGFloat)INT_MAX;
    
    self.colorLayer.backgroundColor = [UIColor colorWithRed:redColor
                                                      green:greenColor
                                                       blue:blueColor
                                                      alpha:1.0f].CGColor;
}
</code></pre>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/7.ImplicitAnimations/Images/1.gif" alt="1"/></p>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/7.ImplicitAnimations/Images/2.png" alt="2"/></p>

<blockquote>
<p>çœ‹å®Œè¿™ä¸ª<strong>Demo</strong>å…¶å®å°±å·²ç»çŸ¥é“ç¥é©¬å«åšéšå¼åŠ¨ç”»äº†, æ‰€è°“çš„éšå¼åŠ¨ç”»å°±æ˜¯æˆ‘ä»¬æ²¡æœ‰ç»™å®ƒæŒ‡å®šä»»ä½•çš„åŠ¨ç”»ç±»å‹, ä»…ä»…åªæ˜¯æ”¹å˜æŸä¸ªå±æ€§, å½“ç„¶<strong>Core Animation</strong>ä¹Ÿæ˜¯æ”¯æŒæ˜¾ç¤ºåŠ¨ç”», ä¸ç„¶æˆ‘ä»¬å°±æ²¡é‚£ä¹ˆå¤šçš„å…´è¶£æ¥å­¦ä¹ <strong>Core Animation</strong>äº†~<br/>
<dr/><br/>
é‚£ä¹ˆå½“æˆ‘ä»¬å»æ”¹å˜ä¸€ä¸ªå±æ€§çš„æ—¶å€™, <strong>Core Animation</strong>æ˜¯å¦‚ä½•å»åˆ¤æ–­åŠ¨ç”»ç±»å‹è¿˜æœ‰åŠ¨ç”»çš„æŒç»­æ—¶é—´å‘¢? è¿™ä¸ªé—®é¢˜å…¶å®ä¹Ÿå¾ˆç®€å•, åŠ¨ç”»çš„æ‰§è¡Œæ—¶é—´å–å†³äº<strong>Transactions</strong>çš„è®¾ç½®, è€ŒåŠ¨ç”»ç±»å‹æ˜¯å–å†³äº<strong>CALayer</strong>çš„è¡Œä¸º.<br/>
<dr/><br/>
å…¶å®<strong>Transactions</strong>å®é™…ä¸Šæ˜¯<strong>Core Animation</strong>ç”¨æ¥åŒ…å«ä¸€å †å±æ€§åŠ¨ç”»é›†åˆçš„æœºåˆ¶, ä»»ä½•ç”¨æŒ‡å®š<strong>Transactions</strong>å»æ”¹å˜å¯ä»¥åšåŠ¨ç”»æ•ˆæœçš„å›¾å±‚å±æ€§éƒ½ä¸ä¼šé©¬ä¸Šå‘ç”Ÿå˜åŒ–, è€Œæ˜¯éœ€è¦<strong>Transactions</strong>åœ¨æäº¤çš„ä¸€ç¬é—´, æ‰ä¼šå¼€å§‹ç”¨ä¸€ä¸ªåŠ¨ç”»æ•ˆæœè¿‡æ¸¡åˆ°æ–°è®¾ç½®çš„å€¼.<br/>
<dr/><br/>
è€Œ<strong>Transactions</strong>æ˜¯éœ€è¦é€šè¿‡<strong>CATransaction</strong>è¿™ä¸ªç±»æ¥è¿›è¡Œç®¡ç†çš„, å¥‡æ€ªçš„æ˜¯, <strong>CATransaction</strong>è¿™ä¸ªç±»å¹¶ä¸æ˜¯ç®¡ç†ä¸€ä¸ªç®€å•çš„<strong>Transactions</strong>, è€Œæ˜¯ç®¡ç†äº†ä¸€å †æˆ‘ä»¬ä¸èƒ½è®¿é—®çš„<strong>Transactions</strong>, ç”±äº<strong>CATransaction</strong>å¹¶æ²¡æœ‰å±æ€§å’Œå®ä¾‹åŒ–æ–¹æ³•, ä¹Ÿä¸èƒ½ç”¨<strong>+ (instancetype)alloc;</strong>å’Œ<strong>- (instancetype)init;</strong>æ–¹æ³•æ¥åˆ›å»ºå®ƒ, åªæœ‰å®ƒæ‰€æä¾›çš„<strong>+ (void)begin;</strong>å’Œ<strong>+ (void)commit;</strong>æ¥æ§åˆ¶.<br/>
<dr/><br/>
è™½ç„¶æˆ‘ä»¬å†ä¸Šé¢çš„<strong>Demo</strong>é‡Œæ²¡æœ‰è®¾ç½®åŠ¨ç”»æ—¶é—´, ä½†<strong>Core Animation</strong>ä¼šåœ¨æ¯ä¸€ä¸ª<strong>run looop</strong>å‘¨æœŸä¸­è‡ªåŠ¨å¼€å§‹ä¸€æ¬¡æ–°çš„<strong>Transactions</strong>, å³ä½¿æˆ‘ä»¬ä¸æ‰‹åŠ¨çš„å»è°ƒç”¨<strong>[CATransaction begin];</strong>, ä½†åœ¨æ¯ä¸€æ¬¡<strong>run loop</strong>çš„å¾ªç¯ä¸­, è¢«ä¿®æ”¹çš„å±æ€§éƒ½ä¼šé›†ä¸­èµ·æ¥, ç„¶åç»Ÿä¸€åšä¸€æ¬¡0.25ç§’çš„åŠ¨ç”», è¿™ä¸ªæ˜¯ç³»ç»Ÿé»˜è®¤çš„.<br/>
<dr/><br/>
è¯´äº†é‚£ä¹ˆå¤š, æˆ‘ä»¬å®é™…ä¸Šæ¥æ”¹æ”¹ä¿®æ”¹é¢œè‰²çš„é‚£ä¸ªä»£ç å—, è®©å®ƒæœ‰ä¸€ä¸ªæ˜¾ç¤ºåŠ¨ç”»çš„æ•ˆæœ:</p>
</blockquote>

<pre><code class="language-objectivec">- (void)changeLayerColorAgain {
    
    [CATransaction begin];
    [CATransaction setAnimationDuration:2.0f];
    
    CGFloat redColor = arc4random() / (CGFloat)INT_MAX;
    CGFloat greenColor = arc4random() / (CGFloat)INT_MAX;
    CGFloat blueColor = arc4random() / (CGFloat)INT_MAX;
    
    self.colorLayer.backgroundColor = [UIColor colorWithRed:redColor
                                                      green:greenColor
                                                       blue:blueColor
                                                      alpha:1.0f].CGColor;
    
    [CATransaction commit];
}
</code></pre>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/7.ImplicitAnimations/Images/3.gif" alt="3"/></p>

<blockquote>
<p>çœ‹èµ·æ¥çš„æ•ˆæœè®©äººè§‰å¾—æ˜¯çœŸçš„æœ‰åŠ¨ç”»æ•ˆæœäº†, å¦‚æœå¤§å®¶åœ¨ä¹‹å‰å°±å·²ç»ç”¨è¿‡<strong>UIView</strong>æ¥åšè¿‡åŠ¨ç”»çš„è¯, é‚£ä¹ˆå¤§å®¶åº”è¯¥å¯¹è¿™ä¸ªåŠ¨ç”»æ¨¡å¼ä¸ä¼šæ„Ÿè§‰åˆ°é™Œç”Ÿ, å› ä¸º<strong>UIView</strong>å°±æœ‰ä¸¤ä¸ªç±»ä¼¼çš„æ–¹æ³•, <strong>+ (void)beginAnimations:(nullable NSString *)animationID context:(nullable void *)context;</strong>å’Œ<strong>+ (void)commitAnimations;</strong>, å…¶å®è¿™ä¸¤ä¸ªè¿™ä¸¤ä¸ªæ–¹æ³•ä¹Ÿæ˜¯å› ä¸ºåœ¨å†…éƒ¨è®¾ç½®äº†<strong>CATransaction</strong>çš„åŸå› .<br/>
<dr/><br/>
åœ¨<strong>iOS 4</strong>çš„æ—¶å€™, è‹¹æœå°±å·²ç»å¯¹<strong>UIView</strong>æ·»åŠ äº†ä¸€ç§åŸºäº<strong>Block</strong>çš„åŠ¨ç”»æ–¹æ³•, <strong>+ (void)animateWithDuration:(NSTimeInterval)duration animations:(void (<sup>)(void))animations</sup> NS_AVAILABLE_IOS(4_0);</strong>, ç”¨èµ·æ¥æ›´åŠ çš„æ–¹ä¾¿, ä½†å®é™…ä¸Šæ˜¯åšåŒæ ·çš„äº‹æƒ…, ä½†ä½¿ç”¨è¿™ç§æ–¹æ³•å°±å¯ä»¥é¿å…<strong>+ (void)begin;</strong>å’Œ<strong>+ (void)commit;</strong>åŒ¹é…çš„é—®é¢˜é€ æˆä¸€äº›è›‹ç–¼çš„äº‹æƒ….</p>
</blockquote>

<hr/>

<h3 id="toc_3">Completion Blocks</h3>

<blockquote>
<p>è¿™é‡Œæˆ‘ä»¬å°±ä½¿ç”¨ä¸€ä¸‹åŸºäº<strong>UIView</strong>çš„<strong>Block</strong>åŠ¨ç”»æ–¹æ³•, æˆ‘ä»¬å¯ä»¥åœ¨åŠ¨ç”»ç»“æŸä¹‹åå†å¯¹è¿™ä¸ªå›¾å±‚è¿›è¡Œä¸€äº›æ“ä½œ, å½“ç„¶è¿™é‡Œè¿˜æ˜¯åŸºäºä¸Šé¢çš„<strong>Demo</strong>æ¥åšæ¼”ç¤º:</p>
</blockquote>

<pre><code class="language-objectivec">- (void)changeLayerColorWithCompletion {
    
    [CATransaction begin];
    [CATransaction setAnimationDuration:2.0f];
    
    [CATransaction setCompletionBlock:^{
        CGAffineTransform transform = self.colorLayer.affineTransform;
        
        transform = CGAffineTransformRotate(transform, M_PI_4);
        
        self.colorLayer.affineTransform = transform;
    }];
    
    CGFloat redColor = arc4random() / (CGFloat)INT_MAX;
    CGFloat greenColor = arc4random() / (CGFloat)INT_MAX;
    CGFloat blueColor = arc4random() / (CGFloat)INT_MAX;
    
    self.colorLayer.backgroundColor = [UIColor colorWithRed:redColor
                                                      green:greenColor
                                                       blue:blueColor
                                                      alpha:1.0f].CGColor;
    
    [CATransaction commit];
}
</code></pre>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/7.ImplicitAnimations/Images/4.gif" alt="4"/></p>

<hr/>

<h3 id="toc_4">Layer Actions</h3>

<blockquote>
<p>å¼€å§‹çš„æ—¶å€™æˆ‘ä»¬å°±ç”¨ä¸€ä¸ª<strong>Demo</strong>æ¥è¿›è¡Œæ¼”ç¤º:</p>
</blockquote>

<pre><code class="language-objectivec">- (void)addLayerView {
    
    self.layerView = [[UIView alloc] init];
    self.layerView.center = CGPointMake(self.view.frame.size.width / 2, self.view.frame.size.height / 2);
    self.layerView.bounds = CGRectMake(0, 0, 150, 150);
    self.layerView.backgroundColor = [UIColor redColor];
    
    [self.view addSubview:self.layerView];
    
    UIButton *button = [[UIButton alloc] init];
    
    button.center = CGPointMake(self.view.frame.size.width / 2, 200);
    button.bounds = CGRectMake(0, 0, 100, 50);
    button.backgroundColor = [UIColor blueColor];
    
    [button setTitle:@&quot;æ”¹å˜é¢œè‰²&quot;
            forState:UIControlStateNormal];
    
    [button addTarget:self
               action:@selector(changeLayerViewColor)
     forControlEvents:UIControlEventTouchUpInside];
    
    [self.view addSubview:button];
}

- (void)changeLayerViewColor {
    
    [CATransaction begin];
    [CATransaction setAnimationDuration:2.0f];
    
    CGFloat redColor = arc4random() / (CGFloat)INT_MAX;
    CGFloat greenColor = arc4random() / (CGFloat)INT_MAX;
    CGFloat blueColor = arc4random() / (CGFloat)INT_MAX;
    
    self.layerView.layer.backgroundColor = [UIColor colorWithRed:redColor
                                                           green:greenColor
                                                            blue:blueColor
                                                           alpha:1.0f].CGColor;
    
    [CATransaction commit];
}
</code></pre>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/7.ImplicitAnimations/Images/5.gif" alt="5"/></p>

<blockquote>
<p>çœ‹å®Œè¿™ä¸ª<strong>Demo</strong>, æœ‰å¾ˆå¤šäººè‚¯å®šä¼šæœ‰ç–‘é—®, ä¸ºå•¥æ²¡æœ‰äº†ä¹‹å‰çš„é‚£ä¸ªå¹³æ»‘è¿‡æ¸¡æ•ˆæœå‘¢? å¥½åƒæ˜¯è¢«å¹²æ‰äº†, è¿™æ˜¯å•¥å›äº‹?<br/>
<dr/><br/>
å…¶å®æˆ‘ä»¬å¯ä»¥ä»”ç»†æƒ³ä¸€æƒ³, å¦‚æœ<strong>UIView</strong>é‡Œçš„å±æ€§éƒ½æœ‰åŠ¨ç”»ç‰¹æ€§çš„è¯, é‚£æˆ‘ä»¬å»ä¿®æ”¹è¿™äº›å±æ€§æ—¶, è‚¯å®šä¼šæ³¨æ„åˆ°çš„, å¯ä¸ºå•¥<strong>UIKit</strong>è¦æŠŠè¿™ä¸ªéšå¼åŠ¨ç”»ç»™ç¦æ­¢å‘¢?<br/>
<dr/><br/>
æˆ‘ä»¬éƒ½çŸ¥é“<strong>Core Animation</strong>é€šå¸¸ä¼šå¯¹<strong>CALayer</strong>æ‰€æœ‰çš„å¯åšåŠ¨ç”»çš„å±æ€§éƒ½èµ‹äºˆäº†åŠ¨ç”»ç‰¹æ€§, ä½†åœ¨<strong>UIView</strong>ä¸­å°±ä¸ä¸€æ ·äº†, å®ƒä¼šé»˜è®¤æŠŠæ‰€å…³è”åœ¨ä¸€èµ·çš„<strong>CALayer</strong>çš„è¿™ä¸ªç‰¹æ€§ç»™å…³é—­æ‰, è¿™é‡Œå°±è¦äº†è§£ä¸€ä¸‹éšå¼åŠ¨ç”»æ˜¯å¦‚ä½•å®ç°çš„.<br/>
<dr/><br/>
å½“æˆ‘ä»¬æ”¹å˜<strong>CALayer</strong>å±æ€§æ—¶, <strong>CALayer</strong>è‡ªåŠ¨åº”ç”¨çš„åŠ¨ç”», æˆ‘ä»¬å¯ä»¥æˆä¸º<strong>CALayer</strong>çš„è¡Œä¸º, æ¯å½“<strong>CALayer</strong>çš„å±æ€§è¢«ä¿®æ”¹çš„æ—¶å€™, å®ƒä¼šå»è°ƒç”¨<strong>- (nullable id<CAAction>)actionForKey:(NSString *)event;</strong>è¿™ä¸ªæ–¹æ³•å»ä¼ é€’å±æ€§çš„åç§°, ç„¶åå°±ä¼šå»æ‰§è¡Œå¦‚ä¸‹å‡ æ­¥:</p>

<ul>
<li>é¦–å…ˆ<strong>CALayer</strong>ä¼šå»æ£€æµ‹å®ƒæ˜¯å¦æœ‰<strong>Delegate</strong>, å¹¶ä¸”çœ‹çœ‹è¿™ä¸ª<strong>Delegate</strong>æœ‰æ²¡æœ‰å®ç°<strong>CALayerDelegate</strong>åè®®é‡Œçš„<strong>- (nullable id<CAAction>)actionForLayer:(CALayer *)layer forKey:(NSString *)event;</strong>æ–¹æ³•, å¦‚æœæœ‰, å°±ç›´æ¥è°ƒç”¨å¹¶è¿”å›ç»“æœ.</li>
<li>å¦‚æœ<strong>CALayer</strong>æ²¡æœ‰<strong>Delegate</strong>çš„è¯, æˆ–è€…<strong>Delegate</strong>æ²¡æœ‰å®ç°<strong>- (nullable id<CAAction>)actionForLayer:(CALayer *)layer forKey:(NSString *)event;</strong>æ–¹æ³•, é‚£ä¹ˆå›¾å±‚å°±ä¼šæ¥ç€å»æ£€æŸ¥åŒ…å«å±æ€§åç§°å¯¹åº”çš„<strong>CALayer</strong>è¡Œä¸ºæ‰€æ˜ å°„çš„<strong>Actions</strong>å­—å…¸.</li>
<li>å¦‚æœ<strong>Actions</strong>å­—å…¸æ²¡æœ‰åŒ…å«å¯¹åº”çš„å±æ€§, é‚£ä¹ˆå›¾å±‚æ¥ç€ä¼šåœ¨å®ƒçš„<strong>style</strong>å­—å…¸é‡Œæ¥ç€æœç´¢å±æ€§å.</li>
<li><p>æœ€å, åœ¨<strong>style</strong>é‡Œä¹Ÿæ‰¾ä¸åˆ°å¯¹åº”çš„è¡Œä¸º, é‚£ä¹ˆå›¾å±‚å°±ä¼šç›´æ¥è°ƒç”¨<strong>+ (nullable id<CAAction>)defaultActionForKey:(NSString *)event;</strong>å®ç°ç³»ç»Ÿæ‰€æä¾›çš„æ¯ä¸ªå±æ€§çš„é»˜è®¤è¡Œä¸º.<br/>
<dr/><br/>
å¦‚æœä¸€è½®å®Œæ•´çš„æœç´¢ç»“æŸä¹‹å, <strong>- (nullable id<CAAction>)actionForKey:(NSString *)event;</strong>è¿”å›ä¸ºç©ºçš„è¯, é‚£ä¹ˆè‚¯å®šä¸ä¼šæœ‰åŠ¨ç”»æ•ˆæœ, å¦‚æœè¿”å›<strong>CAAction</strong>åè®®å¯¹åº”çš„å¯¹è±¡, <strong>CALayer</strong>ä¼šæ‹¿è¿™ä¸ªç»“æœå»å¯¹æ¯”å…ˆå‰å’Œå½“å‰çš„å€¼, å¹¶ä¸”åšä¸€ä¸ªåŠ¨ç”»æ•ˆæœ.<br/>
<dr/><br/>
çŸ¥é“è¿™ä¸ªåŸç†ä¹‹å, æˆ‘ä»¬å°±çŸ¥é“<strong>UIKit</strong>æ˜¯è‚¿ä¹ˆæŠŠéšå¼åŠ¨ç”»ç»™ç¦æ­¢æ‰äº†:</p></li>
<li><p>æ¯ä¸€ä¸ª<strong>UIView</strong>å¯¹å®ƒæ‰€å…³è”çš„å›¾å±‚éƒ½æ˜¯å……å½“ä¸€ä¸ª<strong>Delegate</strong>å¯¹è±¡, å¹¶ä¸”æä¾›äº†<strong>- (nullable id<CAAction>)actionForKey:(NSString *)event;</strong>çš„å®ç°æ–¹æ³•.</p></li>
<li><p>å½“ä¸åœ¨ä¸€ä¸ªåŠ¨ç”»å—çš„å®ç°ä¸­, é‚£ä¹ˆ<strong>UIView</strong>å°±ä¼šå¯¹æ‰€æœ‰<strong>CALayer</strong>çš„è¡Œä¸ºè¿”å›<strong>nil</strong>, å¦‚æœåœ¨åŠ¨ç”»çš„<strong>Block</strong>èŒƒå›´ä¹‹å†…, <strong>UIView</strong>å°±ä¼šè¿”å›ä¸€ä¸ªéç©ºçš„å€¼.<br/>
<dr/><br/>
è¿™é‡Œæˆ‘ä»¬ç®€å•çš„<strong>Log</strong>ä¸€ä¸‹ç»“æœ:</p></li>
</ul>
</blockquote>

<pre><code class="language-objectivec">- (void)checkViewAction {
    
    UIView *layerView = [[UIView alloc] init];
    
    layerView.center = CGPointMake(self.view.frame.size.width / 2, self.view.frame.size.height / 2);
    layerView.bounds = CGRectMake(0, 0, 150, 150);
    layerView.backgroundColor = [UIColor redColor];
    
    [self.view addSubview:layerView];
    
    NSLog(@&quot;Before: %@&quot;, [layerView actionForLayer:layerView.layer
                                            forKey:@&quot;backgroundColor&quot;]);
    
    [UIView beginAnimations:nil
                    context:nil];
    
    NSLog(@&quot;After: %@&quot;, [layerView actionForLayer:layerView.layer
                                           forKey:@&quot;backgroundColor&quot;]);
    
    [UIView commitAnimations];
}
</code></pre>

<pre><code class="language-vim">2016-12-04 12:45:28.178 7.ImplicitAnimations[57079:2126402] Before: &lt;null&gt;
2016-12-04 12:45:28.179 7.ImplicitAnimations[57079:2126402] After: &lt;CABasicAnimation: 0x6000000327c0&gt;
</code></pre>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/7.ImplicitAnimations/Images/6.png" alt="6"/></p>

<blockquote>
<p>è¿™æ ·å­æˆ‘ä»¬å°±å¯ä»¥çŸ¥é“, å½“å±æ€§åœ¨<strong>Block</strong>ä¹‹å¤–å‘ç”Ÿæ”¹å˜, <strong>UIView</strong>ä¼šç›´æ¥é€šè¿‡è¿”å›<strong>nil</strong>æ¥ç¦ç”¨éšå¼åŠ¨ç”», ä½†å¦‚æœåœ¨åŠ¨ç”»å—çš„èŒƒå›´ä¹‹å†…, å°±ä¼šæ ¹æ®åŠ¨ç”»çš„å…·ä½“ç±»å‹æ¥è¿”å›ç›¸åº”çš„å±æ€§, è¿™ä¸ªåç»­ä¼šè®²åˆ°.<br/>
<dr/><br/>
å…¶å®é™¤äº†é€šè¿‡è¿”å›<strong>nil</strong>å¹¶ä¸æ˜¯å”¯ä¸€ç¦æ­¢éšå¼åŠ¨ç”»çš„æ–¹æ³•, æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡<strong>CATransacition</strong>çš„<strong>+ (void)setDisableActions:(BOOL)flag;</strong>æ–¹æ³•, é€šè¿‡<strong>flag</strong>æ¥å¯¹æ‰€æœ‰å±æ€§æ‰“å¼€æˆ–è€…å…³é—­éšå¼åŠ¨ç”», å“ªæ€•ä½ æ˜¯åœ¨<strong>[CATransaction begin];</strong>ä¹‹åæ¥æ·»åŠ , ä¹Ÿæ˜¯ä¸€æ ·å¯ä»¥å…³é—­çš„.<br/>
<dr/><br/>
è¿™é‡Œè¿˜æœ‰ä¸€ä¸ª<strong>Demo</strong>, ä½¿ç”¨<strong>CATransaction</strong>æ¥å®ç°çš„ä¸€ä¸ªå«åš<strong>æ¨è¿›è¿‡æ¸¡</strong>åŠ¨ç”», å…¶å®è¯´ç™½ä¹Ÿå°±æ˜¯ä¸€ä¸ª<strong>Push</strong>åŠ¨ç”»:</p>
</blockquote>

<pre><code class="language-objectivec">- (void)pushAnimation {
    
    UIView *view = [[UIView alloc] initWithFrame:CGRectMake(0,
                                                            100,
                                                            self.view.frame.size.width,
                                                            self.view.frame.size.width)];
    
    view.backgroundColor = [UIColor grayColor];
    
    [self.view addSubview:view];
    
    UIButton *button = [[UIButton alloc] init];
    
    button.center = CGPointMake(self.view.frame.size.width / 2, 50);
    button.bounds = CGRectMake(0, 0, 100, 50);
    button.backgroundColor = [UIColor blueColor];
    
    [button setTitle:@&quot;æ”¹å˜é¢œè‰²&quot;
            forState:UIControlStateNormal];
    
    [button addTarget:self
               action:@selector(pushChangeColor)
     forControlEvents:UIControlEventTouchUpInside];
    
    [view addSubview:button];
    
    self.colorLayer  = [CALayer layer];
    self.colorLayer.position = CGPointMake(view.frame.size.width / 2, view.frame.size.height / 2);
    self.colorLayer.bounds = CGRectMake(0, 0, 150, 150);
    self.colorLayer.backgroundColor = [UIColor redColor].CGColor;
    
    CATransition *transition = [CATransition animation];
    
    transition.type = kCATransitionPush;
    transition.subtype = kCATransitionFromLeft;
    
    self.colorLayer.actions = @{@&quot;backgroundColor&quot;: transition};
    
    [view.layer addSublayer:self.colorLayer];
}

- (void)pushChangeColor {
    
    [CATransaction begin];
    [CATransaction setAnimationDuration:2.0f];

    CGFloat redColor = arc4random() / (CGFloat)INT_MAX;
    CGFloat greenColor = arc4random() / (CGFloat)INT_MAX;
    CGFloat blueColor = arc4random() / (CGFloat)INT_MAX;
    
    self.colorLayer.backgroundColor = [UIColor colorWithRed:redColor
                                                      green:greenColor
                                                       blue:blueColor
                                                      alpha:1.0f].CGColor;
    [CATransaction commit];
}
</code></pre>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/7.ImplicitAnimations/Images/7.gif" alt="7"/></p>

<hr/>

<h3 id="toc_5">Presentation Versus Model</h3>

<blockquote>
<p>å…¶å®ä»”ç»†æƒ³æƒ³, <strong>CALayer</strong>çš„å±æ€§è¡Œä¸ºå¹¶ä¸å¤ªæ­£å¸¸, ä¸ºä½•è¿™ä¹ˆè¯´å‘¢, å› ä¸ºå½“æˆ‘ä»¬å»æ”¹å˜ä¸€ä¸ªå›¾å±‚çš„å±æ€§æ—¶, æˆ‘ä»¬ä¼šå‘ç°, è¿™ä¸ªå€¼çš„ç¡®æ˜¯ç«‹å³å‘ç”Ÿäº†æ”¹å˜, ä½†åœ¨å±å¹•ä¸Šå¹¶æ²¡æœ‰é©¬ä¸Šç”Ÿæ•ˆ, ä¸ºä½•å‘¢? å› ä¸ºæˆ‘ä»¬åœ¨è®¾ç½®å±æ€§çš„æ—¶å€™, å¹¶æ²¡æœ‰ç›´æ¥å»è°ƒæ•´å›¾å±‚çš„æ˜¾ç¤ºå¤–è§‚, ä»…ä»…åªæ˜¯å®šä¹‰äº†å›¾å±‚åŠ¨ç”»ç»“æŸä¹‹åå³å°†è¦å‘ç”Ÿæ”¹å˜çš„å¤–è§‚.<br/>
<dr/><br/>
<strong>Core Animation</strong>åœ¨è¿™é‡Œå……å½“äº†ä¸€ä¸ªæ§åˆ¶å™¨çš„è§’è‰², å¹¶ä¸”æ ¹æ®<strong>Layer Actions</strong>å’Œ<strong>Transactions</strong>æ¥æ›´æ–°è§†å›¾åœ¨å±å¹•ä¸Šæ˜¾ç¤ºçš„çŠ¶æ€.<br/>
<dr/><br/>
åœ¨äºç”¨æˆ·äº¤äº’çš„ç•Œé¢ä¸­, <strong>CALayer</strong>çš„è¡Œä¸ºæ›´åƒæ˜¯ä¿å­˜ç€è§†å›¾å¦‚ä½•å»æ˜¾ç¤ºå’ŒåŠ¨ç”»çš„æ‰§è¡Œæ•°æ®æ¨¡å‹.<br/>
<dr/><br/>
åœ¨<strong>iOS</strong>ä¸­, å±å¹•ä¼šä»¥æ¯ç§’é’Ÿé‡ç»˜60æ¬¡, å¦‚æœåŠ¨ç”»å¸‚åœºæ¯”60åˆ†ä¹‹ä¸€ç§’è¿˜è¦é•¿, é‚£ä¹ˆåœ¨è¿™æ®µæ—¶é—´é‡Œ, <strong>Core Animation</strong>å°±ä¼šå¯¹å±å¹•ä¸Šçš„å›¾å±‚è¿›è¡Œé‡æ–°çš„ç»„åˆ, è¿™å°±æ„å‘³ç€<strong>CALayer</strong>é™¤äº†æˆ‘ä»¬ç»™äºˆçš„å€¼ä¹‹å¤–, è¿˜å¿…é¡»è¦çŸ¥é“å½“å‰æ˜¾ç¤ºåœ¨å±å¹•ä¸Šçš„å±æ€§å€¼çš„è®°å½•.<br/>
<dr/><br/>
è€Œæ¯ä¸ªå›¾å±‚å±æ€§çš„æ˜¾ç¤ºå€¼éƒ½ä¼šè¢«å­˜å‚¨åœ¨ä¸€ä¸ªå«åš<strong>å‘ˆç°å›¾å±‚</strong>çš„ç‹¬ç«‹å›¾å±‚å½“ä¸­, æˆ‘ä»¬å¯ä»¥é€šè¿‡<strong>- (nullable instancetype)presentationLayer;</strong>æ–¹æ³•æ¥è®¿é—®, è€Œè¿™ä¸ªæ‰€è°“çš„<strong>å‘ˆç°å›¾å±‚</strong>, å®é™…ä¸Šå°±æ˜¯æ¨¡å‹å›¾å±‚çš„å¤åˆ¶, ä½†å®ƒçš„å¥½å¤„æ˜¯å®ƒçš„å±æ€§å€¼ä»£è¡¨äº†åœ¨ä»»ä½•æŒ‡å®šæ—¶é—´å½“å‰æ‰€æ˜¾ç¤ºçš„å¤–è§‚æ•ˆæœ, é€šä¿—ç‚¹æ¥è®², å°±æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡è·å–<strong>å‘ˆç°å›¾å±‚</strong>çš„å€¼æ¥è·å–å½“å‰å±å¹•ä¸ŠçœŸæ­£æ˜¾ç¤ºå‡ºæ¥çš„å€¼.<br/>
<dr/><br/>
è¿™é‡Œéœ€è¦æ³¨æ„çš„ä¸€ç‚¹å°±æ˜¯, å¦‚æœåœ¨<strong>å‘ˆç°å›¾å±‚</strong>ä»…ä»…å½“<strong>CALayer</strong>é¦–æ¬¡è¢«æäº¤çš„æ—¶å€™åˆ›å»º, é‚£ä¹ˆå»è°ƒç”¨<strong>- (nullable instancetype)presentationLayer;</strong>æ–¹æ³•å°±ä¼šè¿”å›<strong>nil</strong>.<br/>
<dr/><br/>
è¿™é‡Œæˆ‘ä»¬æˆ–è®¸è¿˜ä¼šæ³¨æ„åˆ°å¦ä¸€ä¸ªæ–¹æ³•<strong>- (instancetype)modelLayer;</strong>, å¦‚æœæˆ‘ä»¬åœ¨å‘ˆç°å›¾å±‚ä¸Šè°ƒç”¨è¿™ä¸ªæ–¹æ³•, é‚£ä¹ˆå°±ä¼šè¿”å›ä¸€ä¸ªå®ƒæ­£åœ¨å‘ˆç°æ‰€ä»¥æ¥çš„<strong>CALayer</strong>, è€Œé€šå¸¸åœ¨ä¸€ä¸ªå›¾å±‚ä¸Šè°ƒç”¨è¿™ä¸ªæ–¹æ³•, å°±ä¼šè¿”å›<strong>self</strong>.<br/>
<dr/><br/>
åœ¨å¤§å¤šæ•°å¼€å‘çš„åœºæ™¯ä¸‹, æˆ‘ä»¬éƒ½ä¸éœ€è¦ç›´æ¥è®¿é—®å‘ˆç°å›¾å±‚, æˆ‘ä»¬å¯ä»¥é€šè¿‡å’Œæ¨¡å‹å›¾å±‚çš„äº¤äº’, æ¥è®©<strong>Core Animation</strong>æ›´æ–°å¹¶ä¸”æ˜¾ç¤º, ä½†åœ¨ä»¥ä¸‹ä¸¤ç§åœºæ™¯ä¸‹<strong>å‘ˆç°å›¾å±‚</strong>å°±éå¸¸æœ‰ç”¨äº†, ä¸€ä¸ªæ˜¯åœ¨åŒæ­¥åŠ¨ç”»é‡Œ, ä¸€ä¸ªæ˜¯åœ¨å¤„ç†ç”¨æˆ·äº¤äº’çš„æ—¶å€™:</p>

<ul>
<li>å¦‚æœæˆ‘ä»¬åœ¨å®ç°ä¸€ä¸ªåŸºäºå®šæ—¶å™¨çš„åŠ¨ç”», è€Œä¸ä»…ä»…æ˜¯åŸºäº<strong>Transactions</strong>çš„åŠ¨ç”», è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±è¦å‡†ç¡®çš„çŸ¥é“åœ¨æŸä¸€æ—¶åˆ»å›¾å±‚æ˜¾ç¤ºåœ¨ä»€ä¹ˆä½ç½®, è¿™å°±ä¼šå¯¹æ­£ç¡®çš„å¸ƒå±€èµ·éå¸¸å¤§çš„ä½œç”¨äº†.</li>
<li>å¦‚æœæˆ‘ä»¬æƒ³è®©åšåŠ¨ç”»çš„å›¾å±‚å¯¹äºç”¨æˆ·æœ‰äº¤äº’, æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<strong>- (nullable CALayer *)hitTest:(CGPoint)p;</strong>æ–¹æ³•æ¥åˆ¤æ–­æŒ‡å®šçš„å›¾å±‚æ˜¯å¦è¢«ç‚¹å‡»äº†, è¿™ä¸ªæ—¶å€™å°±ä¼šæ˜¾ç¤ºæ›´åŠ çš„å‹å¥½, å› ä¸º<strong>å‘ˆç°å›¾å±‚</strong>ä»£è¡¨äº†ç”¨æˆ·å½“å‰çœ‹åˆ°çš„å›¾å±‚ä½ç½®, è€Œä¸æ˜¯å½“åŠ¨ç”»æ•ˆæœç»“æŸä¹‹åçš„ä½ç½®.
<dr/>
è¯´äº†é‚£ä¹ˆå¤š, è¿˜æ˜¯ç›´æ¥ä¸Š<strong>Demo</strong>æ¯”è¾ƒç›´æ¥:</li>
</ul>
</blockquote>

<pre><code class="language-objectivec">- (void)presentationVersusModel {
    
    self.colorLayer  = [CALayer layer];
    self.colorLayer.position = CGPointMake(self.view.frame.size.width / 2, self.view.frame.size.height / 2);
    self.colorLayer.bounds = CGRectMake(0, 0, 150, 150);
    self.colorLayer.backgroundColor = [UIColor redColor].CGColor;
    
    [self.view.layer addSublayer:self.colorLayer];
}

- (void)touchesBegan:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event {
    
    CGPoint point = [[touches anyObject] locationInView:self.view];
    
    if ([self.colorLayer.presentationLayer hitTest:point]) {
        
        CGFloat redColor = arc4random() / (CGFloat)INT_MAX;
        CGFloat greenColor = arc4random() / (CGFloat)INT_MAX;
        CGFloat blueColor = arc4random() / (CGFloat)INT_MAX;
        
        self.colorLayer.backgroundColor = [UIColor colorWithRed:redColor
                                                          green:greenColor
                                                           blue:blueColor
                                                          alpha:1.0f].CGColor;
    } else {
        [CATransaction begin];
        [CATransaction setAnimationDuration:4.0f];
        
        self.colorLayer.position = point;
        
        [CATransaction commit];
    }
}
</code></pre>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/7.ImplicitAnimations/Images/8.gif" alt="8"/></p>

<hr/>

<h3 id="toc_6">æ€»ç»“</h3>

<blockquote>
<p>æ€»ç»“ä¸€ä¸‹:</p>

<ul>
<li><strong>Core Animation</strong>é»˜è®¤æ˜¯æ‰“å¼€åŠ¨ç”»æ•ˆæœçš„, å¹¶ä¸”é»˜è®¤çš„åŠ¨ç”»æ•ˆæœæ˜¯å¹³æ»‘è¿‡æ¸¡æ»´.</li>
<li>æˆ‘ä»¬çŸ¥é“äº†éšå¼åŠ¨ç”»çš„å®ç°æ–¹å¼.</li>
<li><strong>UIView</strong>å…³è”çš„å›¾å±‚é»˜è®¤éƒ½ç¦ç”¨äº†éšå¼åŠ¨ç”», å¯¹è¿™ç§å›¾å±‚åšåŠ¨ç”»çš„å”¯ä¸€åŠæ³•å°±æ˜¯ä½¿ç”¨<strong>UIView</strong>çš„åŠ¨ç”»å‡½æ•°, æˆ–è€…æ˜¯ç»§æ‰¿ä¸<strong>UIView</strong>å¹¶ä¸”é‡å†™<strong>- (nullable id<CAAction>)actionForLayer:(CALayer *)layer forKey:(NSString *)event;</strong>æ–¹æ³•, æœ€ç›´æ¥çš„æ–¹æ³•å°±æ˜¯ç›´æ¥åˆ›å»ºä¸€ä¸ªæ˜¾ç¤ºåŠ¨ç”».</li>
<li>å¯¹äºä¸€ä¸ªå•ç‹¬å­˜åœ¨çš„å›¾å±‚æ¥è®², æˆ‘ä»¬å¯ä»¥é€šè¿‡å®ç°å›¾å±‚çš„<strong>- (nullable id<CAAction>)actionForLayer:(CALayer *)layer forKey:(NSString *)event;</strong>æ–¹æ³•, æˆ–è€…æ˜¯æä¾›ä¸€ä¸ª<strong>Actions</strong>çš„å­—å…¸æ¥æ§åˆ¶éšå¼åŠ¨ç”».</li>
<li>é™¤æ­¤ä¹‹å¤–, æˆ‘ä»¬æ¥äº†è§£äº†<strong>å‘ˆç°å›¾å±‚</strong>å’Œ<strong>æ¨¡å‹å›¾å±‚</strong>, çŸ¥é“äº†è¿™ä¸¤ä¸ªå®¶ä¼™çš„ä¸€äº›çš®æ¯›.
<dr/>
å¥½äº†, è¿™æ¬¡å°±åˆ°è¿™é‡Œäº†, è°¢è°¢å¤§å®¶~</li>
</ul>
</blockquote>

<hr/>

<h3 id="toc_7">å·¥ç¨‹åœ°å€</h3>

<p>é¡¹ç›®åœ°å€: <a href="https://github.com/CainRun/CoreAnimation">https://github.com/CainRun/CoreAnimation</a></p>

<hr/>

<h3 id="toc_8">æœ€å</h3>

<p><center>ç å­—å¾ˆè´¹è„‘, çœ‹å®˜èµç‚¹é¥­é’±å¯å¥½</center></p>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/WeChatPay-Objective-C/Images/%E5%BE%AE%E4%BF%A1QRC.jpg" alt="å¾®ä¿¡"/></p>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/WeChatPay-Objective-C/Images/%E6%94%AF%E4%BB%98%E5%AE%9DQRC.jpg" alt="æ”¯ä»˜å®"/></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ç©è½¬iOSå¼€å‘ï¼š6.ã€ŠCore Animationã€‹CALayerçš„Specialized Layers]]></title>
    <link href="https://cainrun.github.io/14790557329421.html"/>
    <updated>2016-11-14T00:48:52+08:00</updated>
    <id>https://cainrun.github.io/14790557329421.html</id>
    <content type="html"><![CDATA[
<h3 id="toc_0">ä½œè€…æ„Ÿè¨€</h3>

<blockquote>
<p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« <a href="https://cainrun.github.io/14777052484078.html">ã€ŠCore Animationã€‹CALayerçš„Transforms</a>ä¸­, æˆ‘ä»¬äº†è§£äº†äºŒç»´ç©ºé—´å’Œä¸‰ç»´ç©ºé—´çš„ä¸€äº›å¸ƒå±€, è¿˜æœ‰å°±æ˜¯æœ€ç®€å•çš„æ—‹è½¬, å¹³ç§»ä¹‹ç±»çš„, å†æ¥ä¸€äº›å°±æ˜¯æ··åˆä½¿ç”¨çš„, è¿™æ¬¡æˆ‘ä»¬æ¥æ¢ä¸ªè¯é¢˜.</p>

<p><dr/><br/>
<strong><font color=purple>æœ€å:</font></strong><br/>
<strong><font color=purple>å¦‚æœä½ æœ‰æ›´å¥½çš„å»ºè®®æˆ–è€…å¯¹è¿™ç¯‡æ–‡ç« æœ‰ä¸æ»¡çš„åœ°æ–¹, è¯·è”ç³»æˆ‘, æˆ‘ä¼šå‚è€ƒä½ ä»¬çš„æ„è§å†è¿›è¡Œä¿®æ”¹, è”ç³»æˆ‘æ—¶, è¯·å¤‡æ³¨</strong><code>Core Animation</code><strong>å¦‚æœè§‰å¾—å¥½çš„è¯, å¸Œæœ›å¤§å®¶ä¹Ÿå¯ä»¥æ‰“èµä¸€ä¸‹~å˜»å˜»~ç¥å¤§å®¶å­¦ä¹ æ„‰å¿«~è°¢è°¢~</font></strong></p>
</blockquote>

<span id="more"></span><!-- more -->

<hr/>

<h3 id="toc_1">ç®€ä»‹</h3>

<blockquote>
<p><strong>Specialized Layers</strong>è®²å¾—æ˜¯ä¸€äº›ä¸“ç”¨çš„ä¸€äº›å›¾å±‚ç±», è€Œä¸æ˜¯ä¹‹å‰æ‰€è¯´çš„ä¸€äº›ç”¨äºå›¾ç‰‡, é¢œè‰²ä¹‹ç±»çš„, ä¸‹é¢è®©æˆ‘ä»¬æ¥çœ‹çœ‹å§~</p>
</blockquote>

<hr/>

<h3 id="toc_2">CAShapeLayer</h3>

<blockquote>
<p>åœ¨ä¹‹å‰çš„æ–‡ç« é‡Œ, æˆ‘ä»¬ä½¿ç”¨è¿‡é˜´å½±æ•ˆæœ, å¹¶ä¸”æ˜¯ä¸ä½¿ç”¨<strong>CGPath</strong>æƒ…å†µä¸‹å»æ„å»ºå½¢çŠ¶ä¸åŒçš„é˜´å½±, åœ¨<strong>CALayer</strong>ä¸­, æœ‰ä¸€ä¸ªå­ç±»å«åš<strong>CAShapeLayer</strong>, å®ƒä¹Ÿæ˜¯å¯ä»¥åšåˆ°å¯¹åº”çš„æ•ˆæœ.<br/>
<dr/><br/>
<strong>CAShapeLayer</strong>æ˜¯ä¸€ä¸ªé€šè¿‡çŸ¢é‡å›¾å½¢æ¥è¿›è¡Œç»˜åˆ¶çš„å›¾å±‚å­ç±», è€Œå¹¶ä¸æ˜¯ä½¿ç”¨<strong>Bitmap</strong>, å½“æˆ‘ä»¬æŒ‡å®šå¯¹åº”çš„é¢œè‰², çº¿å®½ç­‰å±æ€§, å°±å¯ä»¥ä½¿ç”¨<strong>CGPath</strong>æ¥ç»˜åˆ¶æˆ‘ä»¬æƒ³è¦çš„å½¢çŠ¶, æœ€å<strong>CAShapeLayer</strong>å°±è‡ªåŠ¨æ¸²æŸ“å‡ºæ¥äº†, å½“ç„¶ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨<strong>Core Graphics</strong>ç›´æ¥å¯¹ä¸€ä¸ª<strong>CALayer</strong>è¿›è¡Œç»˜åˆ¶, ä½†<strong>CAShapeLayer</strong>è¦æ¯”<strong>Core Graphics</strong>ç›´æ¥æ“ä½œ<strong>CALayer</strong>è¦å¥½ä¸€äº›, æ¯”å¦‚:</p>

<ul>
<li><strong>CAShapeLayer</strong>ä½¿ç”¨äº†ç¡¬ä»¶åŠ é€Ÿ, ç»˜åˆ¶åŒä¸€å›¾å½¢æ—¶ä¼šæ¯”<strong>Core Graphics</strong>æ¸²æŸ“çš„å¿«.</li>
<li><strong>CAShapeLayer</strong>ä¸éœ€è¦åƒæ™®é€š<strong>CALayer</strong>ä¸€æ ·åˆ›å»ºä¸€ä¸ªå¯„å®¿å›¾å½¢, æ‰€ä»¥æ— è®ºæœ‰å¤šå¤§, éƒ½ä¸ä¼šå ç”¨å¤ªå¤šçš„å†…å­˜.</li>
<li><strong>CAShapeLayer</strong>å’Œ<strong>Core Graphics</strong>ä¸ä¸€æ ·, å®ƒå¹¶ä¸ä¼šè¢«å›¾å±‚è¾¹ç•Œç»™è£å‰ªæ‰.</li>
<li><strong>CAShapeLayer</strong>ä¸ä¼šå‡ºç°åƒç´ åŒ–, è¿™å¯ä»¥æç°åœ¨, ç”¨<strong>CAShapeLayer</strong>åš3Då˜æ¢çš„æ—¶å€™, ä¸ä¼šå’Œæ™®é€šçš„å›¾å±‚ä¸€æ ·å‡ºç°åƒç´ åŒ–.</li>
</ul>
</blockquote>

<h4 id="toc_3">åˆ›å»ºä¸€ä¸ªCGPath</h4>

<blockquote>
<p>åˆšåˆšè¯´äº†, <strong>CAShapeLayer</strong>å¯ä»¥é€šè¿‡<strong>CGPath</strong>æ¥ç»˜åˆ¶ä»»æ„å›¾å½¢, å¹¶ä¸”å¯ä»¥è®¾ç½®ä¸€äº›å±æ€§, æ¯”å¦‚<strong>lineWith</strong>, <strong>lineCap</strong>, <strong>lineJoin</strong>.<br/>
<dr/><br/>
æˆ‘ä»¬ç»˜åˆ¶è¿™ä¸ªå›¾å½¢çš„æ—¶å€™, ä¸ä¸€å®šè¦é—­åˆ, å›¾å±‚è·¯å¾„ä¹Ÿä¸æ˜¯ç»å¯¹, å¯ä»¥åœ¨ä¸€ä¸ªå›¾å±‚ä¸Šç»˜åˆ¶å¤šä¸ªä¸åŒçš„å›¾å½¢, å½“ç„¶, å¦‚æœä½ è¦æƒ³ç”¨ä¸åŒçš„é¢œè‰²é£æ ¼æ¥ç»˜åˆ¶Nä¸ªå›¾å½¢, é‚£ä½ å°±è¦å‡†å¤‡å¥½å¤šä¸ª<strong>Layer</strong>äº†.<br/>
<dr/><br/>
<strong>CAShapeLayer</strong>æ˜¯å±äº<strong>CGPathRef</strong>ç±»å‹, ä½†åœ¨å®é™…å¼€å‘ä¸­, æˆ‘ä»¬æ˜¯ç”¨<strong>UIBezierPath</strong>æ¥åˆ›å»ºå›¾å±‚è·¯å¾„çš„, è¿™æ ·å­æˆ‘ä»¬å°±ä¸ç”¨è€ƒè™‘äººå·¥é‡Šæ”¾<strong>CGPath</strong>äº†, ä¸‹é¢è®©æˆ‘ä»¬æ¥çœ‹Demoå§:</p>
</blockquote>

<pre><code class="language-objectivec">- (void)createPath {
    
    UIBezierPath *path = [[UIBezierPath alloc] init];
    
    [path moveToPoint:CGPointMake(175, 100)];
    [path addQuadCurveToPoint:CGPointMake(100, 500)
                 controlPoint:CGPointMake(250, 600)];
    
    CAShapeLayer *shapeLayer = [CAShapeLayer layer];
    shapeLayer.strokeColor = [UIColor blueColor].CGColor;
    shapeLayer.fillColor = [UIColor clearColor].CGColor;
    shapeLayer.lineWidth = 10;
    shapeLayer.lineJoin = kCALineJoinRound;
    shapeLayer.lineCap = kCALineCapRound;
    shapeLayer.path = path.CGPath;
    
    [self.view.layer addSublayer:shapeLayer];
}
</code></pre>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/6.SpecializedLayers/images/1.png" alt="1"/><br/>
<img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/6.SpecializedLayers/images/2.png" alt="2"/></p>

<h4 id="toc_4">åœ†è§’</h4>

<blockquote>
<p>ä¹‹å‰æˆ‘ä»¬åœ¨ä¹‹å‰çš„æ–‡ç« é‡Œ, æœ‰æåˆ°è¿‡æŠŠä¸€ä¸ªè§†å›¾å‰ªåˆ‡æˆåœ†è§’, ç”¨çš„å°±æ˜¯<strong>CALayer</strong>çš„<strong>cornerRadius</strong>å±æ€§, è€Œ<strong>CAShapeLayer</strong>ç±»ä¹Ÿå¯ä»¥æä¾›åŒæ ·çš„åŠŸèƒ½, è™½ç„¶ä»£ç å¤šäº†ä¸€äº›, ä½†ä¹Ÿå¤šäº†ä¸€äº›çµæ´», å®ƒå¯ä»¥æŒ‡å®šå•ç‹¬çš„æŒ‡å®šæ¯ä¸ªè§’.<br/>
<dr/><br/>
æˆ‘ä»¬åˆ›å»ºåœ†è§’çŸ©å½¢å…¶å®å°±æ˜¯äººå·¥ç»˜åˆ¶å•ç‹¬çš„ç›´çº¿å’Œå¼§åº¦, ä½†åœ¨<strong>UIBezierPath</strong>ä¸­æœ‰æä¾›è‡ªåŠ¨ç»˜åˆ¶åœ†è§’çŸ©å½¢çš„æ–¹æ³•, ç›´æ¥çœ‹ä»£ç :</p>
</blockquote>

<pre><code class="language-objectivec">- (void)viewRoundedCorners {
    
    CGRect rect = CGRectMake(130, 130, 100, 100);
    CGSize radii = CGSizeMake(10, 10);
    
    UIRectCorner corners = UIRectCornerTopRight | UIRectCornerBottomRight | UIRectCornerBottomLeft | UIRectCornerTopLeft;
    
    UIBezierPath *path = [UIBezierPath bezierPathWithRoundedRect:rect
                                               byRoundingCorners:corners
                                                     cornerRadii:radii];
    
    CAShapeLayer *shapeLayer = [CAShapeLayer layer];
    
    shapeLayer.path = path.CGPath;
    
    [self.view.layer addSublayer:shapeLayer];
}
</code></pre>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/6.SpecializedLayers/images/3.png" alt="3"/><br/>
<img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/6.SpecializedLayers/images/4.png" alt="4"/></p>

<hr/>

<h3 id="toc_5">CATextLayer</h3>

<blockquote>
<p>å¦‚æœæˆ‘ä»¬æƒ³åœ¨ä¸€ä¸ªå›¾å±‚é‡Œæ˜¾ç¤ºæ–‡å­—, æˆ‘ä»¬å¯ä»¥å€ŸåŠ©å’Œ<strong>UILabel</strong>ä¸€æ ·çš„æ–¹å¼, ä½¿ç”¨<strong>Core Graphics</strong>åœ¨å›¾å±‚ä¸Šå†™å…¥å†…å®¹, ä½†å¦‚æœè¦è¶Šè¿‡<strong>UILabel</strong>è¿™äº›æ§ä»¶, ç›´æ¥åœ¨å›¾å±‚ä¸Šæ˜¾ç¤ºæ–‡å­—çš„è¯, æˆ‘ä»¬å°±è¦ä¸ºæ¯ä¸ªæ˜¾ç¤ºæ–‡å­—çš„å›¾å±‚åˆ›å»ºä¸€ä¸ªå›¾å±‚ä»£ç†çš„ç±», å¹¶ä¸”åˆ¤æ–­å“ªä¸ªå›¾å±‚éœ€è¦æ˜¾ç¤ºå“ªä¸ªå­—ç¬¦ä¸², å¦‚æœå†åŠ ä¸€äº›å­—ä½“, é¢œè‰²ä¸€äº›ä¹±ä¸ƒå…«ç³Ÿçš„ä¸œè¥¿, é‚£å°±è›‹ç–¼çš„ä¸è¦ä¸è¦çš„.<br/>
<dr/><br/>
å¥½åœ¨<strong>CALayer</strong>é‡Œæœ‰ä¸€ä¸ªå­ç±», å«åš<strong>CATextLayer</strong>, å®ƒå‡ ä¹éƒ½åŒ…å«äº†<strong>UILabel</strong>çš„æ‰€æœ‰ç»˜åˆ¶ç‰¹æ€§, è€Œä¸”è¿˜é¢å¤–æä¾›äº†ä¸€äº›æ–°ç‰¹æ€§, å¹¶ä¸”åœ¨æ¸²æŸ“çš„é€Ÿåº¦ä¸Š, è¦æ¯”<strong>UILabel</strong>å¿«çš„å¤š, å·å·è¯´ä¸ªäº‹, åœ¨<strong>iOS 6</strong>ä¹‹å‰, <strong>UILabel</strong>å…¶å®æ˜¯é€šè¿‡<strong>WebKit</strong>æ¥å®ç°ç»˜åˆ¶çš„, æ‰€ä»¥é‚£æ—¶å€™<strong>iOS</strong>åœ¨æ¸²æŸ“æ–‡å­—çš„æ—¶å€™ä¼šæœ‰éå¸¸å¤§çš„æ€§èƒ½é—®é¢˜, ä½†<strong>CATextLayer</strong>ä½¿ç”¨çš„æ˜¯<strong>Core Text</strong>, ä¸¤è€…ä¹‹å‰å®Œå…¨ä¸åŒä¸€ä¸ªæ¦‚å¿µ.<br/>
<dr/><br/>
è¯´é‚£ä¹ˆå¤šåºŸè¯, ç›´æ¥ä¸Šä»£ç å§:</p>
</blockquote>

<pre><code class="language-objectivec">- (void)catextLayer {
    
    UIView *labelView = [[UIView alloc] initWithFrame:CGRectMake(30, 100, 300, 300)];
    
    labelView.backgroundColor = [UIColor redColor];
    
    [self.view addSubview:labelView];
    
    CATextLayer *textLayer = [CATextLayer layer];
    textLayer.frame = labelView.bounds;
    
    [labelView.layer addSublayer:textLayer];
    
    textLayer.foregroundColor = [UIColor blackColor].CGColor;
    textLayer.alignmentMode = kCAAlignmentJustified;
    textLayer.wrapped = YES;
    
    UIFont *font = [UIFont systemFontOfSize:15];
    
    CFStringRef fontName = (__bridge CFStringRef)font.fontName;
    CGFontRef fontRef = CGFontCreateWithFontName(fontName);
    
    textLayer.font = fontRef;
    textLayer.fontSize = font.pointSize;
    
    CGFontRelease(fontRef);
    
    NSString *text = @&quot;è¿™æ˜¯ä¸€æ®µæµ‹è¯•çš„æ–‡å­—, è¿™æ˜¯ä¸€æ®µæµ‹è¯•çš„æ–‡å­—, è¿™æ˜¯ä¸€æ®µæµ‹è¯•çš„æ–‡å­—, è¿™æ˜¯ä¸€æ®µæµ‹è¯•çš„æ–‡å­—, è¿™æ˜¯ä¸€æ®µæµ‹è¯•çš„æ–‡å­—, è¿™æ˜¯ä¸€æ®µæµ‹è¯•çš„æ–‡å­—, è¿™æ˜¯ä¸€æ®µæµ‹è¯•çš„æ–‡å­—, è¿™æ˜¯ä¸€æ®µæµ‹è¯•çš„æ–‡å­—, è¿™æ˜¯ä¸€æ®µæµ‹è¯•çš„æ–‡å­—, è¿™æ˜¯ä¸€æ®µæµ‹è¯•çš„æ–‡å­—, è¿™æ˜¯ä¸€æ®µæµ‹è¯•çš„æ–‡å­—, è¿™æ˜¯ä¸€æ®µæµ‹è¯•çš„æ–‡å­—, è¿™æ˜¯ä¸€æ®µæµ‹è¯•çš„æ–‡å­—, è¿™æ˜¯ä¸€æ®µæµ‹è¯•çš„æ–‡å­—, è¿™æ˜¯ä¸€æ®µæµ‹è¯•çš„æ–‡å­—, è¿™æ˜¯ä¸€æ®µæµ‹è¯•çš„æ–‡å­—, è¿™æ˜¯ä¸€æ®µæµ‹è¯•çš„æ–‡å­—, è¿™æ˜¯ä¸€æ®µæµ‹è¯•çš„æ–‡å­—, è¿™æ˜¯ä¸€æ®µæµ‹è¯•çš„æ–‡å­—, è¿™æ˜¯ä¸€æ®µæµ‹è¯•çš„æ–‡å­—, è¿™æ˜¯ä¸€æ®µæµ‹è¯•çš„æ–‡å­—, è¿™æ˜¯ä¸€æ®µæµ‹è¯•çš„æ–‡å­—, è¿™æ˜¯ä¸€æ®µæµ‹è¯•çš„æ–‡å­—, è¿™æ˜¯ä¸€æ®µæµ‹è¯•çš„æ–‡å­—&quot;;
    
    textLayer.string = text;
}
</code></pre>

<blockquote>
<p>è¿™é‡Œè¿˜è¦å¤šè¯´ä¸€å¥, å¦‚æœä½ å‘ç°æ–‡æœ¬æ˜¾ç¤ºçš„æ—¶å€™å‡ºç°åƒç´ åŒ–çš„æ—¶å€™, åªè¦åŠ ä¸Šä»¥ä¸‹è¿™æ®µä»£ç , å°±å“¦äº†, å®ƒä¼šä»¥<strong>Retina</strong>æ¨¡å¼æ¥æ¸²æŸ“:</p>
</blockquote>

<pre><code class="language-objectivec">    textLayer.contentsScale = [UIScreen mainScreen].scale;
</code></pre>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/6.SpecializedLayers/images/5.png" alt="5"/><br/>
<img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/6.SpecializedLayers/images/6.png" alt="6"/></p>

<blockquote>
<p><strong>contentsScale</strong>å¹¶ä¸”å¹¶ä¸å…³å¿ƒå±å¹•çš„æ‹‰ä¼¸, å› ä¸ºé»˜è®¤éƒ½æ˜¯<strong>1.0f</strong>, æ‰€ä»¥æˆ‘ä»¬è¦é«˜æ¸…, é‚£å°±è®¾ç½®å®ƒå§.<br/>
<dr/><br/>
<strong>CATextLayer</strong>é‡Œçš„<strong>font</strong>å±æ€§, å…¶å®å¹¶ä¸æ˜¯ä¸€ä¸ªçœŸæ­£çš„<strong>UIFont</strong>ç±»å‹, è€Œæ˜¯ä¸€ä¸ª<strong>CFTypeRef</strong>ç±»å‹, è¿™æ ·å­å°±å¯ä»¥æ ¹æ®æˆ‘ä»¬çš„éœ€æ±‚æ¥å†³å®šå­—ä½“çš„å±æ€§åˆ°åº•æ˜¯ç”¨<strong>CGFontRef</strong>ç±»å‹è¿˜æ˜¯ç”¨<strong>Core Text</strong>é‡Œçš„<strong>CTFontRef</strong>ç±»å‹äº†, åŒæ—¶å­—ä½“å¤§å°ä¹Ÿæ˜¯ç”¨<strong>fontSize</strong>å±æ€§å•ç‹¬è®¾ç½®çš„, å› ä¸º<strong>CTFontRef</strong>å’Œ<strong>CGFontRef</strong>å’Œ<strong>UIFont</strong>å®Œå…¨æ˜¯ä¸¤å›äº‹, åœ¨ä»£ç ä¸­æˆ‘ä»¬ä¹ŸçŸ¥é“äº†å¦‚ä½•å°†<strong>UIFont</strong>è½¬æˆ<strong>CGFontRef</strong>.<br/>
<dr/><br/>
å½“ç„¶<strong>CATextLayer</strong>é‡Œçš„<strong>string</strong>å±æ€§æ˜¯<strong>id</strong>ç±»å‹, å¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è±¡ä¸­çš„<strong>NSString</strong>ç±»å‹, å› ä¸ºè¿™æ ·å­æˆ‘ä»¬å°±å¯ä»¥ç”¨<strong>NSString</strong>ä¹Ÿå¯ä»¥ç”¨<strong>NSAttributedString</strong>æ¥æŒ‡å®šè¦æ˜¾ç¤ºçš„æ–‡æœ¬, æ¯”å¦‚æŒ‡å®šæŸæ®µæ–‡å­—çš„å­—ä½“, é¢œè‰², å­—é‡, æ–œä½“ç­‰ç­‰.</p>
</blockquote>

<h4 id="toc_6">Rich Text</h4>

<blockquote>
<p>å…¶å®åœ¨<strong>iOS 6</strong>çš„æ—¶å€™, <strong>Apple</strong>å°±å·²ç»ç»™äº†<strong>UILabel</strong>å’Œå…¶ä»–çš„<strong>UIKit</strong>æ–‡æœ¬è§†å›¾æ·»åŠ ç›´æ¥çš„å±æ€§, ä½†äº‹å®ä¸Š, åœ¨<strong>iOS 3.2</strong>çš„æ—¶å€™, <strong>CATextLayer</strong>å°±å·²ç»æ”¯æŒå±æ€§åŒ–å­—ç¬¦ä¸²äº†, å¦‚æœä½ æƒ³æ”¯æŒæ›´ä½ç‰ˆæœ¬çš„<strong>iOS</strong>é‚£ä¹ˆä½ å¯ä»¥ä½¿ç”¨<strong>CATextLayer</strong>, ä¸éœ€è¦å’Œæ›´å¤æ‚çš„<strong>Core Text</strong>æ‰“äº¤é“, ä¹Ÿçœç•¥äº†ä½¿ç”¨å…¶ä»–çš„æ–¹æ³•, ä½†ç°åœ¨åˆä¼šæœ‰å“ªå®¶å…¬å¸æ”¯æŒä½ç‰ˆæœ¬çš„<strong>iOS</strong>å‘¢? ä½†ä¸èƒ½å¤Ÿè¯´åœ¨æ–°ç‰ˆæœ¬çš„<strong>iOS</strong>Dæ˜‚ä¸­<strong>CATextLayer</strong>å°±æ— ç”¨åŠŸäº†, è¿™ä¸ªå¾—çœ‹æˆ‘ä»¬çš„éœ€æ±‚æ¥ç¡®å®šäº†.<br/>
<dr/> <br/>
è¿™æ¬¡æˆ‘ä»¬æŠŠ<strong>Core Text</strong>, <strong>CATextLayer</strong>, <strong>NSAttributedString</strong>ä¸‰è€…æ··åœ¨ä¸€èµ·ä½¿ç”¨ä¸€ä¸‹~</p>
</blockquote>

<pre><code class="language-objectivec">- (void)attributedString {
    
    UIView *labelView = [[UIView alloc] initWithFrame:CGRectMake(0, 200, self.view.frame.size.width, 400)];
    
    [self.view addSubview:labelView];
    
    CATextLayer *textLayer = [CATextLayer layer];
    
    textLayer.frame = labelView.bounds;
    textLayer.contentsScale = [UIScreen mainScreen].scale;
    
    [labelView.layer addSublayer:textLayer];
    
    textLayer.alignmentMode = kCAAlignmentJustified; textLayer.wrapped = YES;
    
    UIFont *font = [UIFont systemFontOfSize:15];

    NSString *text = @&quot;è¿™æ˜¯ä¸€æ®µæµ‹è¯•çš„æ–‡å­—, è¿™æ˜¯ä¸€æ®µæµ‹è¯•çš„æ–‡å­—, è¿™æ˜¯ä¸€æ®µæµ‹è¯•çš„æ–‡å­—, è¿™æ˜¯ä¸€æ®µæµ‹è¯•çš„æ–‡å­—, è¿™æ˜¯ä¸€æ®µæµ‹è¯•çš„æ–‡å­—, è¿™æ˜¯ä¸€æ®µæµ‹è¯•çš„æ–‡å­—, è¿™æ˜¯ä¸€æ®µæµ‹è¯•çš„æ–‡å­—, è¿™æ˜¯ä¸€æ®µæµ‹è¯•çš„æ–‡å­—, è¿™æ˜¯ä¸€æ®µæµ‹è¯•çš„æ–‡å­—, è¿™æ˜¯ä¸€æ®µæµ‹è¯•çš„æ–‡å­—, è¿™æ˜¯ä¸€æ®µæµ‹è¯•çš„æ–‡å­—, è¿™æ˜¯ä¸€æ®µæµ‹è¯•çš„æ–‡å­—, è¿™æ˜¯ä¸€æ®µæµ‹è¯•çš„æ–‡å­—, è¿™æ˜¯ä¸€æ®µæµ‹è¯•çš„æ–‡å­—, è¿™æ˜¯ä¸€æ®µæµ‹è¯•çš„æ–‡å­—, è¿™æ˜¯ä¸€æ®µæµ‹è¯•çš„æ–‡å­—, è¿™æ˜¯ä¸€æ®µæµ‹è¯•çš„æ–‡å­—, è¿™æ˜¯ä¸€æ®µæµ‹è¯•çš„æ–‡å­—, è¿™æ˜¯ä¸€æ®µæµ‹è¯•çš„æ–‡å­—, è¿™æ˜¯ä¸€æ®µæµ‹è¯•çš„æ–‡å­—, è¿™æ˜¯ä¸€æ®µæµ‹è¯•çš„æ–‡å­—, è¿™æ˜¯ä¸€æ®µæµ‹è¯•çš„æ–‡å­—, è¿™æ˜¯ä¸€æ®µæµ‹è¯•çš„æ–‡å­—, è¿™æ˜¯ä¸€æ®µæµ‹è¯•çš„æ–‡å­—&quot;;
    
    NSMutableAttributedString *string = nil;
    string = [[NSMutableAttributedString alloc] initWithString:text];
    
    CFStringRef fontName = (__bridge CFStringRef)font.fontName; CGFloat fontSize = font.pointSize;
    CTFontRef fontRef = CTFontCreateWithName(fontName, fontSize, NULL);
    
    NSDictionary *attribs = @{(__bridge id)kCTForegroundColorAttributeName : (__bridge id)[UIColor blackColor].CGColor,
                              (__bridge id)kCTFontAttributeName: (__bridge id)fontRef};
    
    [string setAttributes:attribs range:NSMakeRange(0, [text length])];
    
    attribs = @{(__bridge id)kCTForegroundColorAttributeName: (__bridge id)[UIColor redColor].CGColor,
                (__bridge id)kCTUnderlineStyleAttributeName: @(kCTUnderlineStyleSingle),
                (__bridge id)kCTFontAttributeName: (__bridge id)fontRef};
    
    [string setAttributes:attribs range:NSMakeRange(6, 20)];
    
    CFRelease(fontRef);
    
    textLayer.string = string;
}
</code></pre>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/6.SpecializedLayers/images/7.png" alt="7"/><br/>
<img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/6.SpecializedLayers/images/8.png" alt="8"/></p>

<h4 id="toc_7">Leading and Kerning</h4>

<blockquote>
<p>è¿™é‡Œæœ‰ä¸ªç‚¹, ç”±äº<strong>Core Text</strong>å’Œ<strong>WebKit</strong>çš„å†…éƒ¨å®ç°æœºåˆ¶ä¸åŒ, ç”¨<strong>CATextLayer</strong>æ¸²æŸ“æˆ–è€…æ˜¯ç”¨<strong>UILabel</strong>æ¸²æŸ“æ–‡æœ¬è¡Œè·å’Œå­—è·ä¹Ÿæ˜¯ä¸ä¸€æ ·çš„, è¿™ä¸ªæ˜¯ç”±ä½¿ç”¨å­—ä½“å’Œå­—ç¬¦æ¥å†³å®šçš„, æ‰€ä»¥å¤§å®¶å¦‚æœè¦ä½¿ç”¨æ™®é€šçš„<strong>UILabel</strong>å’Œ<strong>CATextLayer</strong>, å°±è¦å¥½å¥½æ³¨æ„ä¸€ä¸‹äº†.</p>
</blockquote>

<h4 id="toc_8">A UILabel Replacement</h4>

<blockquote>
<p>è¿™æ¬¡æˆ‘ä»¬å°±è‡ªå·±åˆ›å»ºä¸€ä¸ªå±äºæˆ‘ä»¬è‡ªå·±çš„<strong>UILabel</strong>, ä»£æ›¿ç³»ç»Ÿçš„<strong>UILabel</strong>, è™½ç„¶è¿™ä¸ªç±»ä¹Ÿæ˜¯ç»§æ‰¿äº<strong>UILabel</strong>, ä½†æ¯”ç³»ç»Ÿçš„<strong>UILabel</strong>çš„<strong>-drawRect:</strong>æ–¹æ³•è¦å¿«, æ¥çœ‹çœ‹ä»£ç å§~</p>
</blockquote>

<pre><code class="language-objectivec">#import &quot;CLLabel.h&quot;
#import &lt;QuartzCore/QuartzCore.h&gt;

@implementation CLLabel

+ (Class)layerClass {
    
    return [CATextLayer class];
}

- (CATextLayer *)textLayer {
    
    return (CATextLayer *)self.layer;
}

- (void)setUp {
    
    self.text = self.text;
    self.textColor = self.textColor;
    self.font = self.font;
    
    [self textLayer].wrapped = YES;
    [self.layer display];
}

- (id)initWithFrame:(CGRect)frame {
    
    if (self = [super initWithFrame:frame]) {
        
        [self setUp];
    }
    
    return self;
}

- (void)awakeFromNib {
    
    [self setUp];
}

- (void)setText:(NSString *)text {
    super.text = text;
    
    [self textLayer].string = text;
}

- (void)setTextColor:(UIColor *)textColor {
    super.textColor = textColor;
    
    [self textLayer].foregroundColor = textColor.CGColor;
}

- (void)setFont:(UIFont *)font {
    super.font = font;
    
    CFStringRef fontName = (__bridge CFStringRef)font.fontName;
    CGFontRef fontRef = CGFontCreateWithFontName(fontName);
    
    [self textLayer].font = fontRef;
    [self textLayer].fontSize = font.pointSize;
    
    CGFontRelease(fontRef);
}

@end
</code></pre>

<blockquote>
<p>ä½¿ç”¨è¿™ä¸ªè‡ªå®šä¹‰çš„<strong>CLLabel</strong>, æˆ‘ä»¬çœ‹çœ‹æ•ˆæœ</p>
</blockquote>

<pre><code class="language-objectivec">- (void)createCLLabel {
    
    CLLabel *label = [[CLLabel alloc] initWithFrame:CGRectMake(20, 50, 200, 200)];
    
    label.text = @&quot;è¿™æ˜¯ä¸€æ®µå¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿çš„æµ‹è¯•æ–‡å­—&quot;;
    label.textColor = [UIColor blackColor];
    
    [self.view addSubview:label];
}
</code></pre>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/6.SpecializedLayers/images/9.png" alt="9"/><br/>
<img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/6.SpecializedLayers/images/10.png" alt="10"/><br/>
<img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/6.SpecializedLayers/images/11.png" alt="11"/></p>

<hr/>

<h3 id="toc_9">CATransformLayer</h3>

<blockquote>
<p>åœ¨æˆ‘ä»¬æ—¥å¸¸å¼€å‘å½“ä¸­, å¦‚æœéœ€è¦ç”¨åˆ°<strong>3D Layer</strong>, å¯ä»¥ç”¨åˆ°ä¹‹å‰æˆ‘ä»¬è¯´åˆ°çš„<strong>3D Transforms</strong>, ä½†æ˜¯é‚£æ ·å­å¤ªéº»çƒ¦äº†, è¦ç®—ä¸€å †ä¸œè¥¿, å¦‚æœæœ‰ä¸€ç§<strong>Layer</strong>å¯ä»¥åƒç©ç§¯æœ¨ä¸€æ ·, ä¸€ä¸ªä¸€ä¸ªçš„ç»„åˆæˆä¸€ä¸ª<strong>3D</strong>å½¢çŠ¶çš„è¯, é‚£è¯¥å¤šå¥½~<br/>
<dr/><br/>
å…¶å®<strong>Apple</strong>æ—©å°±æƒ³åˆ°äº†è¿™ä¸ªé—®é¢˜, å®ƒä»¬æä¾›äº†<strong>CATransformLayer</strong>, å°±æ˜¯ä¸“é—¨ç”¨æ¥ç»™<strong>Layer</strong>åšä¸€ä¸ªå®¹å™¨, ç„¶åè®©æ‹¼æ¥æˆä¸€ä¸ªçœ‹èµ·æ¥åƒ<strong>3D</strong>çš„ä¸€æ ·å›¾å½¢.<br/>
<dr/><br/>
æˆ‘ä»¬æ¥çœ‹ä»£ç : </p>
</blockquote>

<pre><code class="language-objectivec">- (void)transformLayer {
    
    self.view.backgroundColor = [UIColor grayColor];
    
    CATransform3D transform3DOne = CATransform3DIdentity;
    
    transform3DOne.m34 = -1.0 / 500.0;
    
    self.view.layer.sublayerTransform = transform3DOne;
    
    CATransform3D transform3DTwo = CATransform3DIdentity;
    
    transform3DTwo = CATransform3DTranslate(transform3DTwo, -100, 0, 0);
    
    CALayer *cubeOne = [self cubeWithTransform:transform3DTwo];
    
    [self.view.layer addSublayer:cubeOne];
    
    CATransform3D transform3DThree = CATransform3DIdentity;
    
    transform3DThree = CATransform3DTranslate(transform3DThree, 100, 0, 0);
    transform3DThree = CATransform3DRotate(transform3DThree, -M_PI_4, 1, 0, 0);
    transform3DThree = CATransform3DRotate(transform3DThree, -M_PI_4, 0, 1, 0);
    
    CALayer *cubeTwo = [self cubeWithTransform:transform3DThree];
    
    [self.view.layer addSublayer:cubeTwo];
}

- (CALayer *)layerWithTransform:(CATransform3D)transform {
    
    CALayer *layer = [CALayer layer];
    
    layer.frame = CGRectMake(-50, -50, 100, 100);
    
    CGFloat red = (rand() / (double)INT_MAX);
    CGFloat green = (100000 / (double)INT_MAX);
    CGFloat blue = (rand() / (double)INT_MAX);
    
    layer.backgroundColor = [UIColor colorWithRed:red
                                            green:green
                                             blue:blue
                                            alpha:1.0f].CGColor;
    layer.transform = transform;
    
    return layer;
}

- (CALayer *)cubeWithTransform:(CATransform3D)transform {
    
    // cube
    CATransformLayer *cube = [CATransformLayer layer];
    
    // layer one
    CATransform3D transform3D = CATransform3DMakeTranslation(0, 0, 50);
    [cube addSublayer:[self layerWithTransform:transform3D]];
    
    // layer two
    transform3D = CATransform3DMakeTranslation(50, 0, 0);
    transform3D = CATransform3DRotate(transform3D, M_PI_2, 0, 1, 0);
    [cube addSublayer:[self layerWithTransform:transform3D]];
    
    // layer three
    transform3D = CATransform3DMakeTranslation(0, -50, 0);
    transform3D = CATransform3DRotate(transform3D, M_PI_2, 1, 0, 0);
    [cube addSublayer:[self layerWithTransform:transform3D]];

    // layer five
    transform3D = CATransform3DMakeTranslation(-50, 0, 0);
    transform3D = CATransform3DRotate(transform3D, -M_PI_2, 0, 1, 0);
    [cube addSublayer:[self layerWithTransform:transform3D]];

    // layer six
    transform3D = CATransform3DMakeTranslation(0, 0, -50);
    transform3D = CATransform3DRotate(transform3D, M_PI, 0, 1, 0);
    [cube addSublayer:[self layerWithTransform:transform3D]];

    CGSize containerSize = self.view.bounds.size;
    
    cube.position = CGPointMake(containerSize.width / 2.0,
                                containerSize.height / 2.0);
    
    cube.transform = transform;
    
    return cube;
}
</code></pre>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/6.SpecializedLayers/images/12.png" alt="12"/><br/>
<img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/6.SpecializedLayers/images/13.png" alt="13"/><br/>
<img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/6.SpecializedLayers/images/14.png" alt="14"/></p>

<hr/>

<h3 id="toc_10">CAGradientLayer</h3>

<blockquote>
<p>åœ¨<strong>Layer</strong>ä¸­, æœ‰ä¸€ç§é¢œè‰²å¹³æ»‘æ¸å˜çš„å­ç±», å«åš<strong>CAGradientLayer</strong>, è™½ç„¶ç”¨<strong>Core Graphics</strong>ä¹Ÿå¯ä»¥é€šè¿‡ä¸€äº›æŠ€å·§åšåˆ°å’Œ<strong>CAGradientLayer</strong>ä¸€æ ·çš„æ•ˆæœ, ä½†<strong>CAGradieLayer</strong>çœŸæ­£å¥½, æ˜¯å¥½åœ¨å®ƒæ˜¯ç”¨ç¡¬ä»¶åŠ é€Ÿæ¥ç»˜åˆ¶çš„, ç›´æ¥æ¥çœ‹ä»£ç å§:</p>
</blockquote>

<pre><code class="language-objectivec">- (void)gradientLayer {
    
    UIView *view = [[UIView alloc] init];
    
    view.bounds = CGRectMake(0, 0, 200, 200);
    view.center = CGPointMake(self.view.frame.size.width / 2, self.view.frame.size.height / 2);
    
    CAGradientLayer *gradientLayer = [CAGradientLayer layer];
    gradientLayer.frame = view.bounds;
    
    // è®¾ç½®æ¸å˜çš„é¢œè‰², ç†è®ºä¸Šæ¥è®²æ˜¯æ— é™æ·»åŠ çš„
    gradientLayer.colors = @[(__bridge id)[UIColor redColor].CGColor,
                             (__bridge id)[UIColor greenColor].CGColor];
    
    gradientLayer.startPoint = CGPointMake(0, 0); // å¼€å§‹æ¸å˜çš„ç‚¹
    gradientLayer.endPoint = CGPointMake(1, 1); // ç»“æŸæ¸å˜çš„ç‚¹
    
    gradientLayer.locations = @[@0.0, @0.2]; // è®¾ç½®æ¸å˜çš„åŒºåŸŸ
    
    [view.layer addSublayer:gradientLayer];
    
    [self.view addSubview:view];
}
</code></pre>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/6.SpecializedLayers/images/15.png" alt="15"/><br/>
<img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/6.SpecializedLayers/images/16.png" alt="16"/></p>

<hr/>

<h3 id="toc_11">CAReplicatorLayer</h3>

<blockquote>
<p>åœ¨<strong>CALayer</strong>çš„å­ç±»å½“ä¸­è¿˜æœ‰ä¸€ä¸ªå«åš<strong>CAReplicatorLayer</strong>, å®ƒæ˜¯ç”¨æ¥å¤åˆ¶é‡å¤çš„å›¾å±‚, å¹¶ä¸”, ä½ å¯ä»¥ç»™è¿™äº›å¤åˆ¶çš„å›¾å±‚è¿›è¡Œä¸€äº›å±æ€§ä¸Šçš„æ“ä½œ, æ¯”å¦‚æ¸å˜è‰², æ¸å˜é€æ˜, å½¢çŠ¶, è¿˜å¯ä»¥åŠ åŠ¨ç”»æ•ˆæœ, æ¥çœ‹çœ‹ä»£ç å§:</p>
</blockquote>

<pre><code class="language-objectivec">#pragma mark - CAReplicatorLayer
- (void)replicatorLayer {
    
    UIView *view = [[UIView alloc] init];
    
    view.bounds = CGRectMake(0, 0, 100, 100);
    view.center = CGPointMake(self.view.frame.size.width / 2, self.view.frame.size.height / 4.5);
    
    CATransform3D transform = CATransform3DIdentity;
    
    transform = CATransform3DTranslate(transform, 0, 200, 0);
    transform = CATransform3DRotate(transform, M_PI / 5.0, 0, 0, 1);
    transform = CATransform3DTranslate(transform, 0, -200, 0);

    CAReplicatorLayer *replicatorLayer = [CAReplicatorLayer layer];
    
    replicatorLayer.frame = view.bounds;
    replicatorLayer.instanceCount = 10;  // å¤åˆ¶å›¾å±‚ä¸ªæ•°
    replicatorLayer.instanceBlueOffset = -1.0f; // è®¾ç½®æ¯ä¸€ä¸ªå›¾å±‚çš„é€æ¸è“è‰²åç§»
    replicatorLayer.instanceRedOffset = -1.0f;  // è®¾ç½®æ¯ä¸€ä¸ªå›¾å±‚çš„é€æ¸çº¢è‰²åç§»
    replicatorLayer.instanceAlphaOffset = -0.1f;
    replicatorLayer.instanceDelay = 0.33f;  // è®¾ç½®æ¯ä¸ªå›¾å±‚å»¶è¿Ÿ0.33f
    replicatorLayer.instanceTransform = transform;
    
    CALayer *layer = [CALayer layer];
    
    layer.frame = CGRectMake(0, 0, 100, 100);
    layer.backgroundColor = [UIColor whiteColor].CGColor;
    
    [replicatorLayer addSublayer:layer];
    
    self.view.backgroundColor = [UIColor grayColor];
    
    [view.layer addSublayer:replicatorLayer];
    
    [self addLayerAnimation:layer];
    
    [self.view addSubview:view];
}

- (void)addLayerAnimation:(CALayer *)layer {
    
    CABasicAnimation *animation = [CABasicAnimation animationWithKeyPath:@&quot;position.y&quot;];
    
    animation.toValue =  @(layer.position.y - 25.0);
    animation.duration = 0.5;
    animation.autoreverses = true;
    animation.repeatCount = CGFLOAT_MAX;
    
    [layer addAnimation:animation forKey:nil];
}
</code></pre>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/6.SpecializedLayers/images/17.png" alt="17"/><br/>
<img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/6.SpecializedLayers/images/18.gif" alt="18"/></p>

<h4 id="toc_12">Reflections</h4>

<blockquote>
<p><strong>CAReplicatorLayer</strong>å…¶å®è¿˜æœ‰ä¸€ä¸ªæ›´åŠ å®ç”¨çš„åŠŸèƒ½, å°±æ˜¯åšä¸€ä¸ªé•œé¢åå°„çš„æ•ˆæœ, æˆ‘ä»¬å¯ä»¥è‡ªå·±å°è£…ä¸€ä¸ª<strong>UIView</strong>çš„ç±», ä¹Ÿå¯ä»¥è‡ªå·±å†™ä¸€ä¸ªç®€å•çš„, è¿™é‡Œæˆ‘å°±å†™ä¸ªç®€å•ç‚¹çš„å§, å¤§å®¶ä¹Ÿå¯ä»¥å»<strong>GitHub</strong>é‡Œé¢æœæœ, æˆ‘åœ¨ç½‘ä¸Šæœåˆ°ä¸€ä¸ª, è™½ç„¶è¿™ä¸ªåº“å·²ç»2å¹´å¤šæ²¡æ›´æ–°äº†, ä½†è¿˜æ˜¯å€¼å¾—çœ‹çœ‹çš„<a href="https://github.com/nicklockwood/ReflectionView">ReflectionView</a>.</p>
</blockquote>

<pre><code class="language-objectivec">- (void)reflectionsLayer {
    
    CAReplicatorLayer *replicatorLayer = [CAReplicatorLayer layer];
    
    replicatorLayer.instanceCount = 2;
    replicatorLayer.frame = CGRectMake(50, 100, 100, 100);

    CALayer *layer = [CALayer layer];
    
    layer.contents = (__bridge id _Nullable)([UIImage imageNamed:@&quot;github&quot;].CGImage);
    layer.frame = replicatorLayer.bounds;

    CATransform3D transform = CATransform3DIdentity;
    
    transform = CATransform3DTranslate(transform, 0, layer.bounds.size.height, 0);
    transform = CATransform3DScale(transform, 1, -1, 0);
    
    replicatorLayer.instanceTransform = transform;
    replicatorLayer.instanceAlphaOffset = -0.6;
    
    [replicatorLayer addSublayer:layer];
    
    [self.view.layer addSublayer:replicatorLayer];
    self.view.backgroundColor = [UIColor grayColor];
}
</code></pre>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/6.SpecializedLayers/images/19.png" alt="19"/><br/>
<img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/6.SpecializedLayers/images/20.png" alt="20"/></p>

<hr/>

<h3 id="toc_13">CAScrollLayer</h3>

<blockquote>
<p>åœ¨<strong>CALayer</strong>çš„å­ç±»å½“ä¸­, è¿˜æœ‰ä¸€ä¸ª<strong>CAScrollLayer</strong>, å®ƒå¯ä»¥è¢«ç§°ä¸º<strong>UIScrollView</strong>çš„ä»£æ›¿å“, ä½†æœ‰ä¸€ä¸ªé—®é¢˜, æˆ‘ä»¬éƒ½çŸ¥é“<strong>Core Animation</strong>æ˜¯ä¸èƒ½å¤„ç†ç”¨æˆ·è¾“å…¥, æ‰€ä»¥<strong>CAScrollLayer</strong>ä¹Ÿä¸èƒ½å¤„ç†æ»‘åŠ¨äº‹ä»¶, ä¹Ÿä¸èƒ½å®ç°<strong>UIScrollView</strong>é‚£ç§æ»‘åŠ¨åå¼¹æ•ˆæœ, ä½†è¿™é‡ŒåŠ äº†ä¸€ä¸ªæ»‘åŠ¨æ‰‹åŠ¿å°±å¯ä»¥å®ç°äº†æ»‘åŠ¨æ•ˆæœäº†.</p>
</blockquote>

<pre><code class="language-objectivec">@interface ViewController ()

@property (nonatomic, strong) CAScrollLayer *scrollLayer;

@end

#pragma mark - CAScrollLayer
- (void)addScrollLayer {
    
    CALayer *layer = [CALayer layer];
    
    layer.contents = (__bridge id _Nullable)([UIImage imageNamed:@&quot;github&quot;].CGImage);
    layer.frame = CGRectMake(0, 0, 300, 300);
    
    self.scrollLayer = [CAScrollLayer layer];
    self.scrollLayer.frame = CGRectMake(50, 100, 150, 150);
    self.scrollLayer.scrollMode = kCAScrollBoth;
    self.scrollLayer.backgroundColor = [UIColor grayColor].CGColor;
    
    [self.scrollLayer addSublayer:layer];
    
    [self.view.layer addSublayer:self.scrollLayer];
    
    UIPanGestureRecognizer *pan = [[UIPanGestureRecognizer alloc] initWithTarget:self action:@selector(panGesture:)];
    
    [self.view addGestureRecognizer:pan];
}

- (void)panGesture:(UIPanGestureRecognizer *)pan {
    
    CGPoint translocation = [pan translationInView:self.view];
    CGPoint origin = self.scrollLayer.bounds.origin;
    
    origin = CGPointMake(origin.x - translocation.x, origin.y - translocation.y);
    
    [self.scrollLayer scrollToPoint:origin];
    
    [pan setTranslation:CGPointZero inView:self.view];
}
</code></pre>

<hr/>

<h3 id="toc_14">CATiledLayer</h3>

<blockquote>
<p>åœ¨æˆ‘ä»¬å¼€å‘å½“ä¸­, æœ‰æ—¶å€™æˆ‘ä»¬ä¼šéœ€è¦åŠ è½½ä¸€å¼ è¶…å¤§çš„å›¾ç‰‡, æ¯”å¦‚ç¥é©¬4Ké«˜æ¸…å›¾, æˆ–è€…æ˜¯ä¸–ç•Œåœ°å›¾ç­‰ç­‰ä¹‹ç±»çš„, ä½†æ˜¯åœ¨<strong>iOS</strong>å½“ä¸­æ˜¯æœ‰å†…å­˜é™åˆ¶çš„, å¹¶ä¸åƒå…¶ä»–ç³»ç»Ÿä¸€æ ·<strong>4G</strong>, <strong>6G</strong>æœ‰è¶…å¤§å†…å­˜, å¦‚æœæˆ‘ä»¬è¦æŠŠè¶…å¤§çš„å›¾ç‰‡åŠ è½½åˆ°å†…å­˜å½“ä¸­, é‚£å¾ˆæ˜æ˜¾, ç›´æ¥ä¼šæ’‘çˆ†, æˆ–è€…æ˜¯åŠ é€Ÿé€Ÿåº¦æ…¢å¾—æ„Ÿäºº, å¦‚æœä½ æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­ä½¿ç”¨<strong>UIImage</strong>çš„<strong>+ (nullable UIImage *)imageNamed:(NSString *)name;</strong>æˆ–è€…æ˜¯<strong>- (nullable instancetype)initWithContentsOfFile:(NSString *)path</strong>æ–¹æ³•æ¥åŠ è½½å›¾ç‰‡çš„è¯, é‚£ä½ ä¼šæƒŠå–œçš„å‘ç°, å¡çº¿ç¨‹äº†~~<br/>
<dr/><br/>
åœ¨<strong>iOS</strong>å½“ä¸­, èƒ½å¤Ÿé«˜æ•ˆçš„ç»˜åˆ¶å¹¶ä¸”åŠ è½½åˆ°ç•Œé¢çš„å›¾ç‰‡æ˜¯æœ‰ä¸€ä¸ªå¤§å°é™åˆ¶çš„, å› ä¸ºåœ¨<strong>iOS</strong>å½“ä¸­æ‰€æœ‰æ˜¾ç¤ºåœ¨å±å¹•ä¸Šçš„å›¾ç‰‡æœ€ç»ˆéƒ½ä¼šè¢«è½¬åŒ–ä¸º<strong>OpenGL</strong>çš„çº¹ç†, åŒæ—¶<strong>OpenGL</strong>æ˜¯æœ‰ä¸€ä¸ªæœ€å¤§çº¹ç†å°ºå¯¸çš„é™åˆ¶, æ ¹æ®è®¾å¤‡çš„å‹å·æ¥å†³å®š, é€šå¸¸æ˜¯<strong>2048*2048</strong>æˆ–è€…<strong>4096*4096</strong>, å¦‚æœæˆ‘ä»¬æƒ³åœ¨å•ä¸ªçº¹ç†ä¸­æ˜¾ç¤ºä¸€ä¸ªæ¯”è¿™ä¸ªé™åˆ¶å°ºå¯¸è¿˜è¦å¤§çš„å›¾, å“ªæ€•å›¾ç‰‡å·²ç»å­˜åœ¨äºå†…å­˜å½“ä¸­, æˆ‘ä»¬ä¹Ÿä¼šé‡åˆ°éå¸¸å¤§çš„æ€§èƒ½é—®é¢˜, å› ä¸º<strong>Core Animation</strong>æ˜¯å¼ºåˆ¶ç”¨<strong>CPU</strong>å¤„ç†å›¾ç‰‡, è€Œä¸æ˜¯<strong>GPU</strong>, è‹¹æœä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜, äºæ˜¯ä¹æœ‰äº†<strong>CATiledLayer</strong>, ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹<strong>Demo</strong>:<br/>
<dr/><br/>
ç”±äºæˆ‘ä¸æ‡‚æ€ä¹ˆæŠŠå¤§å›¾åˆ†è§£æˆå°å›¾, è¿™é‡Œå°±æ‰¾å¼ å°ä¸€ç‚¹çš„å›¾ç”¨ç”¨</p>
</blockquote>

<pre><code class="language-objectivec">- (void)addCATileLayer {
    
    UIScrollView *scrollView = [[UIScrollView alloc] initWithFrame:CGRectMake(0, 100, self.view.frame.size.width, self.view.frame.size.width)];
    
    [self.view addSubview:scrollView];
    
    CATiledLayer *tiledLayer = [CATiledLayer layer];
    
    tiledLayer.frame = CGRectMake(0, 0, 2048, 2048);
    tiledLayer.delegate = self;
    tiledLayer.contentsScale = [UIScreen mainScreen].scale;
    
    [scrollView.layer addSublayer:tiledLayer];
    
    scrollView.contentSize = tiledLayer.frame.size;
    
    [tiledLayer setNeedsDisplay];
}

- (void)drawLayer:(CATiledLayer *)layer inContext:(CGContextRef)ctx {
    
    CGRect bounds = CGContextGetClipBoundingBox(ctx);
    
    NSInteger x = floor(bounds.origin.x / layer.tileSize.width);
    NSInteger y = floor(bounds.origin.y / layer.tileSize.height);
    
    NSString *imageName = [NSString stringWithFormat:@&quot;image%02zd_%02zd&quot;, x, y];
    
    UIImage *tileImage = [UIImage imageNamed:imageName];
    
    UIGraphicsPushContext(ctx);
    
    [tileImage drawInRect:bounds];
    
    UIGraphicsPopContext();
}
</code></pre>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/6.SpecializedLayers/images/21.gif" alt="21"/></p>

<blockquote>
<p>è¿™é‡Œæˆ‘ä»¬æ³¨æ„åˆ°, æˆ‘é»˜è®¤æ˜¯ç”¨<strong>Retina</strong>æ¨¡å¼å»æ˜¾ç¤ºå›¾ç‰‡çš„, æ‰€ä»¥æˆ‘ä»¬çœ‹èµ·æ¥è¿™äº›å›¾ç‰‡ä¼šæ¯”è¾ƒå°, å¦‚æœä½ ä¸æƒ³ç”¨<strong>Retina</strong>æ¨¡å¼å»æ˜¾ç¤º, ä½ å¯ä»¥æŠŠä»£ç ä¸­çš„ä¸€å¥ä»£ç åˆ é™¤å³å¯:</p>
</blockquote>

<pre><code class="language-objectivec">    tiledLayer.contentsScale = [UIScreen mainScreen].scale;
</code></pre>

<blockquote>
<p>å¦‚æœæˆ‘ä»¬è¦åšåˆ°åƒåœ°å›¾é‚£æ ·å­æ”¾å¤§ç¼©å°çš„è¯, é‚£å°±è¦è‡ªå·±å¤´è„‘é£æš´ä¸€ä¸‹, ç„¶åæƒ³ç€å¦‚ä½•å»å®ç°äº†~~</p>
</blockquote>

<hr/>

<h3 id="toc_15">CAEmitterLayer</h3>

<blockquote>
<p>åœ¨<strong>iOS 5</strong>ç‰ˆæœ¬ä¸­, è‹¹æœåŠ å…¥äº†ä¸€ä¸ªæ–°çš„<strong>CALayer</strong>å­ç±», å«åš<strong>CAEmitterLayer</strong>, å®ƒæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ç²’å­å¼•æ“, å¸¸ç”¨äºåˆ¶ä½œå®æ—¶æ•ˆæœçš„åŠ¨ç”», æ¯”å¦‚çƒŸé›¾, ç«, é›¨ç­‰ç­‰ä¹‹ç±»çš„.<br/>
<dr/><br/>
å…¶å®ä»”ç»†æƒ³æƒ³, <strong>CAEmitterLayer</strong>çœ‹èµ·æ¥æ›´åƒæ˜¯ä¸€ä¸ªå®¹å™¨, é‡Œé¢è£…è½½ç€å¾ˆå¤šçš„<strong>CAEmitterCell</strong>, è¿™äº›<strong>CAEmitterCell</strong>å®šä¹‰äº†ä¸€ä¸ªç²’å­æ•ˆæœ, ç„¶ååœ¨<strong>CAEmitterLayer</strong>çš„è£…è½½ä¸­æ˜¾ç¤ºå‡ºæ¥.<br/>
<dr/><br/>
<strong>CAEmitterCell</strong>ç±»ä¼¼äºä¸€ä¸ªæ™®é€šçš„<strong>CALayer</strong>, å®ƒæœ‰ä¸€ä¸ª<strong>contents</strong>çš„å±æ€§, å¯ä»¥å®šä¹‰ä¸ºä¸€ä¸ª<strong>CGImage</strong>, ä½†ä¸åŒäºæ™®é€šçš„<strong>CALayer</strong>çš„æ˜¯å®ƒæœ‰ä¸€äº›è¯¾è®¾ç½®å±æ€§æ§åˆ¶ç€è¡¨ç°å’Œè¡Œä¸º, æƒ³äº†è§£æ›´å¤šçš„è¯, å¤§å®¶å¯ä»¥è‡ªè¡Œå»<strong>CAEmitterCell</strong>çš„å¤´æ–‡ä»¶æ‰¾æ‰¾, ç°åœ¨æˆ‘ä»¬æ¥çœ‹çœ‹<strong>Demo</strong>:</p>
</blockquote>

<pre><code class="language-objectivec">- (void)addCAEmitterLayer {
    
    UIView *contentView = [[UIView alloc] initWithFrame:CGRectMake(0, 100,
                                                                   self.view.frame.size.width,
                                                                   self.view.frame.size.width)];
    
    [self.view addSubview:contentView];
    
    CAEmitterLayer *emitterLayer = [CAEmitterLayer layer];
    
    emitterLayer.frame = contentView.bounds;
    emitterLayer.renderMode = kCAEmitterLayerAdditive;
    emitterLayer.emitterPosition = CGPointMake(emitterLayer.frame.size.width / 2,
                                               emitterLayer.frame.size.height / 2);
    
    [contentView.layer addSublayer:emitterLayer];
    
    CAEmitterCell *cell = [[CAEmitterCell alloc] init];
    
    cell.contents = (__bridge id _Nullable)([UIImage imageNamed:@&quot;fire&quot;].CGImage);
    cell.birthRate = 150;
    cell.lifetime = 5.0;
    cell.color = [UIColor colorWithRed:1.f
                                 green:0.5f
                                  blue:0.1f
                                 alpha:1.0f].CGColor;
    cell.alphaSpeed = -0.4f;
    cell.velocity = 50.f;
    cell.velocityRange = 50.f;
    cell.emissionRange = M_PI * 2.0f;
    
    emitterLayer.emitterCells = @[cell];
}
</code></pre>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/6.SpecializedLayers/images/22.gif" alt="22"/></p>

<blockquote>
<p>è¿™é‡Œè¡¥å……ä¸€ä¸‹çŸ¥è¯†ç‚¹, <strong>CAEMitterCell</strong>åŸºæœ¬ä¸Šå¯ä»¥åˆ†ä¸ºä¸‰ç§:</p>

<ul>
<li>ç²’å­çš„æŸä¸€å±æ€§çš„åˆå§‹å€¼, æ¯”å¦‚:<strong>color</strong>å±æ€§æŒ‡å®šäº†ä¸€ä¸ªå›¾ç‰‡çš„æ··åˆè‰², åœ¨<strong>Demo</strong>å½“ä¸­æˆ‘ä»¬å°±è®¾ç½®äº†æŸä¸ªé¢œè‰².</li>
<li>ç²’å­æŸä¸€å±æ€§çš„å˜åŒ–èŒƒå›´, æ¯”å¦‚:<strong>emissionRange</strong>, åœ¨<strong>Demo</strong>å½“ä¸­, æˆ‘ä»¬è®¾ç½®ä¸º<strong>M_PI * 2.0f</strong>, è¿™æ„å‘³ç€ç²’å­å¯ä»¥ä»<strong>360Â°</strong>çš„ä»»æ„ä½ç½®åå°„å‡ºæ¥.</li>
<li><p>ç²’å­åœ¨æŒ‡å®šå€¼çš„æ—¶é—´çº¿ä¸Šçš„å˜åŒ–, æ¯”å¦‚: <strong>alphaSpeed</strong>, å­å•Š<strong>Demo</strong>ä¸­, æˆ‘ä»¬è®¾ç½®ä¸º<strong>-0.4f</strong>, è¿™æ„å‘³ç€, æ¯è¿‡ä¸€ç§’, ç²’å­çš„é€æ˜åº¦å°±å‡å°‘<strong>0.4</strong>, è¿™æ ·å­å°±æœ‰æ¸æ¸æ¶ˆå¤±çš„æ•ˆæœå•¦.<br/>
<dr/><br/>
è€Œ<strong>CAEmitterLayer</strong>å®ƒæ˜¯æ§åˆ¶ç€æ•´ä¸ªç²’å­ç³»ç»Ÿçš„ä½ç½®å’Œå½¢çŠ¶, æ¯”å¦‚<strong>birthRate</strong>, <strong>lifetime</strong>å’Œ<strong>celocity</strong>, å½“ç„¶, <strong>CAEMitterCell</strong>ä¹Ÿæœ‰è¿™äº›å±æ€§, æ•´ä¸ªç²’å­ç³»ç»Ÿéƒ½æ˜¯è¿™äº›å±æ€§ä»¥ç›¸ä¹˜çš„æ–¹å¼ä½œç”¨åœ¨ä¸€èµ·, è¿™æ ·å­æˆ‘ä»¬å°±å¯ä»¥ç”¨ä¸€ä¸ªå€¼æ¥åŠ é€Ÿæˆ–è€…æ‰©å¤§æ•´ä¸ªç²’å­ç³»ç»Ÿ.<br/>
<dr/><br/>
æˆ‘ä»¬è¿˜éœ€è¦çŸ¥é“å¦å¤–ä¸¤ä¸ªæ¯”è¾ƒé‡è¦çš„å±æ€§:</p></li>
<li><p><strong>preservesDepth</strong>: æ˜¯å¦å°†ä¸€ä¸ª<strong>3D</strong>çš„ç²’å­ç³»ç»Ÿå¹³é¢åŒ–åˆ°ä¸€ä¸ªå›¾å±‚, æˆ–è€…å¯ä»¥åœ¨<strong>3D</strong>ç©ºé—´ä¸­æ··åˆå…¶ä»–å›¾å±‚.</p></li>
<li><p><strong>renderMode</strong>: æ§åˆ¶ç€ç²’å­å›¾ç‰‡åœ¨è§†è§‰ä¸Šæ˜¯å¦‚ä½•æ··åˆçš„, åœ¨<strong>Demo</strong>å½“ä¸­, æˆ‘ä»¬è®¾ç½®ä¸º<strong>kCAEmitterLayerAdditive</strong>æ•ˆæœ, é»˜è®¤å€¼ä¸º<strong>kCAEmitterLayerUnordered</strong>, åœ¨å¼€å‘å½“ä¸­éœ€è¦ä»€ä¹ˆæ ·çš„æ•ˆæœ, è¿˜æ˜¯å¾—æ ¹æ®éœ€æ±‚çš„æ¥~</p></li>
</ul>
</blockquote>

<hr/>

<h3 id="toc_16">CAEAGLLayer</h3>

<blockquote>
<p>åœ¨<strong>iOS</strong>å½“ä¸­, å¦‚æœæˆ‘ä»¬éœ€è¦é«˜æ€§èƒ½çš„å›¾å½¢ç»˜åˆ¶, é‚£è‚¯å®šæ˜¯å°‘ä¸äº†å»äº†è§£<strong>OpenGL</strong>, è¿™é‡Œè¯´çš„æ˜¯éæ¸¸æˆç±»çš„åº”ç”¨å“ˆ, æ¯•ç«Ÿæ¸¸æˆæœ‰å±äºè‡ªå·±çš„ä¸€å¥—æ¸²æŸ“åº“, è¯´èµ·<strong>OpenGL</strong>, è‚¯å®šæœ‰å¾ˆå¤šäººè§‰å¾—è¿™ä¸ªæ¡†æ¶å¾ˆå‰å®³, çš„ç¡®æ˜¯çš„, å› ä¸º<strong>OpenGL</strong>æ˜¯ç”¨<strong>C</strong>æ¥å†™çš„, ç›´æ¥å’Œç¡¬ä»¶è¿›è¡Œé€šä¿¡, ä½†æ˜¯å‘¢, ä¹Ÿå› ä¸ºæ˜¯ç”¨<strong>C</strong>æ‰€å†™çš„, å‡ ä¹æœ‰æ²¡æœ‰æŠ½è±¡å‡ºæ¥çš„æ¥å£, å¦‚æœä½ è¦ç›´æ¥ä½¿ç”¨<strong>OpenGL</strong>æ¥æŠŠå›¾å½¢æ˜¾ç¤ºåœ¨å±å¹•ä¸Š, é‚£ä½ å°±éœ€è¦å†™éå¸¸å¤šçš„å¤æ‚ä»£ç , è™½ç„¶<strong>OpenGL</strong>æ˜¯éå¸¸å¼ºå¤§çš„ç¥å™¨, å› ä¸º<strong>OpenGL</strong>æ˜¯<strong>Core Animation</strong>å’Œ<strong>UIKit</strong>çš„åŸºç¡€.<br/>
<dr/><br/>
åœ¨<strong>OpenGL</strong>ä¸­, æ˜¯æ²¡æœ‰å¯¹è±¡å’Œå›¾å±‚ç»§æ‰¿çš„æ¦‚å¿µ, å®ƒåªæ˜¯éå¸¸ç®€å•çš„å»å¤„ç†ä¸‰è§’å½¢, åœ¨<strong>OpenGL</strong>ä¸­, æ‰€æœ‰ä¸œè¥¿éƒ½æ˜¯<strong>3D</strong>ç©ºé—´ä¸­æœ‰é¢œè‰²å’Œçº¹ç†çš„ä¸‰è§’å½¢, æ„Ÿè§‰ç°å¸¸çš„ç‰›é€¼~<br/>
<dr/><br/>
å¦‚æœæˆ‘ä»¬è¦é«˜æ•ˆçš„æ—¶å€™<strong>Core Animation</strong>, é‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦åˆ¤æ–­æˆ‘ä»¬éœ€è¦ç»˜åˆ¶å“ªäº›å†…å®¹, æ¯”å¦‚(çŸ¢é‡å›¾å½¢, ç²’å­, æ–‡æœ¬ç­‰ç­‰), ä½†å³ä½¿æ˜¯æˆ‘ä»¬é€‰æ‹©äº†åˆé€‚çš„å›¾å±‚å»å‘ˆç°è¿™äº›å†…å®¹, <strong>Core Animation</strong>ä¸­ä¹Ÿä¸æ˜¯æ¯ä¸ªç±»å‹çš„å†…å®¹éƒ½è¢«é«˜åº¦ä¼˜åŒ–è¿‡, æ‰€ä»¥è¦æƒ³å¾—åˆ°é«˜æ€§èƒ½çš„å»ç»˜åˆ¶, é‚£å°±æ¯”è¾ƒè›‹ç–¼äº†.<br/>
<dr/><br/>
åœ¨<strong>iOS 5</strong>ä¸­, è‹¹æœä¸ºäº†è§£å†³è¿™äº›è›‹ç–¼çš„é—®é¢˜, åŠ å…¥äº†ä¸€ä¸ªå«åš<strong>GLKit</strong>çš„åº“, å®ƒåœ¨ä¸€å®šå±‚åº¦ä¸Šå‡å°‘äº†ä½¿ç”¨<strong>OpenGL</strong>çš„å¤æ‚åº¦, æä¾›äº†ä¸€ä¸ªå«åš<strong>GLKView</strong>çš„<strong>UIView</strong>å­ç±», å¸®æˆ‘ä»¬å¤„ç†å¤§éƒ¨åˆ†çš„è®¾ç½®å†…å®¹å’Œç»˜åˆ¶å·¥ä½œ, æœ‰éœ€è¦äº†è§£<strong>GLKit</strong>çš„æœ‹å‹ä»¬å¯ä»¥å»ç¿»ç¿»å®˜æ–¹æ–‡æ¡£.<br/>
<dr/><br/>
å³ä½¿æ˜¯å¦‚æ­¤, æˆ‘ä»¬è¿˜æ˜¯éœ€è¦ä½¿ç”¨åˆ°ä¸€ä¸ªå«åš<strong>CAEAGLLayer</strong>çš„<strong>CALayer</strong>å­ç±», é…±ç´«æˆ‘ä»¬æ‰å¯ä»¥ç”¨æ¥æ˜¾ç¤º<strong>OpenGL</strong>çš„å›¾å½¢.<br/>
<dr/><br/>
è¿™é‡Œè¿˜éœ€è¦æåˆ°ä¸€ç‚¹, è™½ç„¶åœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹, æˆ‘ä»¬ä¸éœ€è¦æ‰‹åŠ¨è®¾ç½®<strong>CAEAGLLayer</strong>(å¦‚æœæ˜¯ç”¨<strong>GLKView</strong>çš„è¯), æˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸€ä¸ª<strong>OpenGL ES 2.0</strong>çš„ä¸Šä¸‹æ–‡, è¿™æ˜¯å¤§å¤šæ•°çš„ç”¨æ³•, <strong>GLKit</strong>ä¸ºæˆ‘ä»¬æä¾›è®¸å¤šä¾¿æ·çš„æ–¹æ³•, æ¯”å¦‚è®¾ç½®é¡¶ç‚¹å’Œç‰‡æ®µçš„ç€è‰²å™¨ä¹‹ç±»çš„, è¿™äº›éƒ½æ˜¯ä»¥ç±»<strong>C</strong>è¯­è¨€å«åš<strong>GLSL</strong>è‡ªåŒ…å«åœ¨ç¨‹åºä¸­, åŒäº‹åœ¨è¿è¡Œæ—¶è½½å…¥åˆ°å›¾å½¢ç¡¬ä»¶ä¸­, å½“ç„¶, <strong>GLSL</strong>çš„ä»£ç å’Œè®¾ç½®<strong>CAEAGLLayer</strong>æ˜¯ä¸€æ¯›é’±å…³ç³»éƒ½æ²¡, æ‰€ä»¥æˆ‘ä»¬ä¼šç”¨<strong>GLKBaseEffect</strong>ç±», å°†ç€è‰²çš„é€»è¾‘æŠ½è±¡å‡ºæ¥å°±å®Œäº‹, å…¶ä»–çš„äº‹æƒ…, è¿˜æ˜¯å’Œå¹³å¸¸ä½¿ç”¨ä¸€æ ·å°±å“¦äº†, ä¸‹é¢è®©æˆ‘ä»¬æ¥çœ‹çœ‹<strong>Demo</strong>:</p>
</blockquote>

<pre><code class="language-objectivec">- (void)addCAEAGLLayer {
    
    UIView *glView = [[UIView alloc] initWithFrame:CGRectMake(0, 100, self.view.frame.size.width, self.view.frame.size.width)];
    
    [self.view addSubview:glView];
    
    // è®¾ç½®Context
    self.glContext = [[EAGLContext alloc] initWithAPI:kEAGLRenderingAPIOpenGLES2];
    
    [EAGLContext setCurrentContext:self.glContext];
    
    // è®¾ç½®æ˜¾ç¤ºçš„Layer
    self.glLayer = [CAEAGLLayer layer];
    self.glLayer.frame = glView.bounds;
    [glView.layer addSublayer:self.glLayer];
    self.glLayer.drawableProperties = @{kEAGLDrawablePropertyRetainedBacking : @NO,
                                        kEAGLDrawablePropertyColorFormat : kEAGLColorFormatRGBA8};
    
    self.effect = [[GLKBaseEffect alloc] init];
    
    [self setUpBuffers];
    [self drawFrame];
}

- (void)setUpBuffers {
    
    // è®¾ç½®Frame
    glGenFramebuffers(1, &amp;_framebuffer);
    glBindFramebuffer(GL_FRAMEBUFFER, _framebuffer);
    
    // è®¾ç½®é¢œè‰²
    glGenRenderbuffers(1, &amp;_colorRenderbuffer);
    glBindRenderbuffer(GL_RENDERBUFFER, _colorRenderbuffer);
    glFramebufferRenderbuffer(GL_FRAMEBUFFER, GL_COLOR_ATTACHMENT0,
                              GL_RENDERBUFFER, _colorRenderbuffer);
    
    [self.glContext renderbufferStorage:GL_RENDERBUFFER
                           fromDrawable:self.glLayer];
    glGetRenderbufferParameteriv(GL_RENDERBUFFER, GL_RENDERBUFFER_WIDTH,
                                 &amp;_framebufferWidth);
    glGetRenderbufferParameteriv(GL_RENDERBUFFER, GL_RENDERBUFFER_HEIGHT,
                                 &amp;_framebufferHeight);
    
    // æ£€æŸ¥æ˜¯å¦æˆåŠŸ
    if (glCheckFramebufferStatus(GL_FRAMEBUFFER) != GL_FRAMEBUFFER_COMPLETE) {
        
        NSLog(@&quot;%i&quot;, glCheckFramebufferStatus(GL_FRAMEBUFFER));
    }
}

- (void)tearDownBuffers {
    
    if (_framebuffer) {
        
        glDeleteFramebuffers(1, &amp;_framebuffer);
        _framebuffer = 0;
    }
    
    if (_colorRenderbuffer) {
        
        glDeleteRenderbuffers(1, &amp;_colorRenderbuffer);
        _colorRenderbuffer = 0;
    }
}

- (void)drawFrame {
    
    // ç»‘å®šç¼“å†²åŒº
    glBindFramebuffer(GL_FRAMEBUFFER, _framebuffer);
    glViewport(0, 0, _framebufferWidth, _framebufferHeight);
    
    [self.effect prepareToDraw];
    
    // æ¸…ç©ºå±å¹•
    glClear(GL_COLOR_BUFFER_BIT);
    glClearColor(0.0, 0.0, 0.0, 1.0);
    
    // è®¾ç½®é¡¶ç‚¹
    GLfloat vertices[] = {
        -0.5f, -0.5f, -1.0f,
        0.0f, 0.5f, -1.0f,
        0.5f, -0.5f, -1.0f};
    
    // è®¾ç½®é¢œè‰²å€¼
    GLfloat colors[] = {
        0.0f, 0.0f, 1.0f, 1.0f,
        0.0f, 1.0f, 0.0f, 1.0f,
        1.0f, 0.0f, 0.0f, 1.0f};
    
    // å¼€å§‹ç”»ä¸‰è§’å½¢
    glEnableVertexAttribArray(GLKVertexAttribPosition);
    glEnableVertexAttribArray(GLKVertexAttribColor);
    glVertexAttribPointer(GLKVertexAttribPosition,
                          3, GL_FLOAT, GL_FALSE, 0, vertices);
    glVertexAttribPointer(GLKVertexAttribColor,
                          4, GL_FLOAT, GL_FALSE, 0, colors);
    glDrawArrays(GL_TRIANGLES, 0, 3);
    
    // æ¸²æŸ“
    glBindRenderbuffer(GL_RENDERBUFFER, _colorRenderbuffer);
    [self.glContext presentRenderbuffer:GL_RENDERBUFFER];
}

- (void)dealloc {
    [self tearDownBuffers];
    
    [EAGLContext setCurrentContext:nil];
}
</code></pre>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/6.SpecializedLayers/images/23.png" alt="23"/></p>

<blockquote>
<p>å¦‚æœæˆ‘ä»¬è¦åšä¸€ä¸ªçœŸæ­£çš„<strong>OpenGL</strong>åº”ç”¨, </p>
</blockquote>

<hr/>

<h3 id="toc_17">AVPlayerLayer</h3>

<blockquote>
<p>æœ€åä¸€ä¸ªå›¾å±‚ç±»å‹å«åš<strong>AVPlayerLayer</strong>, çœ‹åå­—å°±çŸ¥é“å®ƒå¹¶ä¸å±äº<strong>Core Animation</strong>é‡Œçš„ä¸€ä¸ªéƒ¨åˆ†, å®ƒæ˜¯ç”±<strong>AVFoundation</strong>æ‰€æä¾›, ä½†å®ƒå’Œ<strong>Core Animation</strong>ç´§å¯†çš„ç»“åˆåœ¨ä¸€èµ·, å¹¶ä¸”æ˜¯<strong>CALayer</strong>çš„å­ç±», å¯ä»¥ç”¨æ¥æ˜¾ç¤ºè‡ªå®šä¹‰å†…å®¹.<br/>
<dr/><br/>
å®é™…ä¸Š<strong>AVPlayerLayer</strong>æ˜¯ç”¨æ¥åœ¨<strong>iOS</strong>ä¸Šæ’­æ”¾è§†é¢‘çš„, æ˜¯å±äº<strong>MPMoivePlayer</strong>çš„åº•å±‚å®ç°, æä¾›äº†æ˜¾ç¤ºè§†é¢‘çš„åº•å±‚æ”¯æŒ.<br/>
<dr/><br/>
<strong>AVPlayerLayer</strong>ä½¿ç”¨èµ·æ¥æ¯”è¾ƒç®€å•, æˆ‘ä»¬å¯ä»¥ç›´æ¥æ¥çœ‹çœ‹<strong>Demo</strong>:</p>
</blockquote>

<pre><code class="language-objectivec">- (void)addAVPlayerLayer {
    
    NSURL *url = [[NSBundle mainBundle] URLForResource:@&quot;demo0&quot;
                                         withExtension:@&quot;m4v&quot;];
    
    AVPlayer *player = [AVPlayer playerWithURL:url];
    AVPlayerLayer *playerLayer = [AVPlayerLayer playerLayerWithPlayer:player];
    
    playerLayer.frame = CGRectMake(0, 0, self.view.frame.size.width, self.view.frame.size.height);
    
    [self.view.layer addSublayer:playerLayer];
    
    [player play];
}
</code></pre>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/6.SpecializedLayers/images/24.gif" alt="24"/></p>

<blockquote>
<p>æˆ‘ä»¬çŸ¥é“äº†<strong>AVPlayerLayer</strong>æ˜¯<strong>CALayer</strong>çš„å­ç±», é‚£ä¹ˆå®ƒåº”å½“ä¹Ÿæœ‰çˆ¶ç±»çš„æ‰€æœ‰ç‰¹æ€§, æ¯”å¦‚3D, åœ†è§’, æœ‰è‰²è¾¹æ¡†, è’™ç‰ˆ, é˜´å½±ç­‰ç­‰æ•ˆæœéƒ½æœ‰, æˆ‘ä»¬å†åŸæ¥çš„åŸºç¡€ä¸Šå†æ”¹æ”¹~</p>
</blockquote>

<pre><code class="language-objectivec">- (void)addAVPlayerLayerTwo {
    
    NSURL *url = [[NSBundle mainBundle] URLForResource:@&quot;demo0&quot;
                                         withExtension:@&quot;m4v&quot;];
    
    AVPlayer *player = [AVPlayer playerWithURL:url];
    AVPlayerLayer *playerLayer = [AVPlayerLayer playerLayerWithPlayer:player];
    
    playerLayer.frame = CGRectMake(0, 0, self.view.frame.size.width, self.view.frame.size.height);
    
    [self.view.layer addSublayer:playerLayer];
    
    CATransform3D transform = CATransform3DIdentity;
    transform.m34 = -1.0 / 500.0;
    transform = CATransform3DRotate(transform, M_PI_4, 1, 1, 0);
    
    playerLayer.transform = transform;
    playerLayer.masksToBounds = YES;
    playerLayer.cornerRadius = 30.f;
    playerLayer.borderColor = [UIColor blueColor].CGColor;
    playerLayer.borderWidth = 10.f;
    
    [player play];
}
</code></pre>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/6.SpecializedLayers/images/25.gif" alt="25"/></p>

<hr/>

<h3 id="toc_18">æ€»ç»“</h3>

<blockquote>
<p>å¥½äº†, è¿™æ¬¡æˆ‘ä»¬è®²åˆ°è¿™é‡Œäº†, åœ¨è¿™ç« é‡Œ, æˆ‘ä»¬è®¤è¯†<strong>CALayer</strong>çš„ä¸€äº›å­ç±», ä»¥åŠå®ƒä»¬çš„ä¸€äº›ç‰¹æ€§, æ–¹ä¾¿æˆ‘ä»¬åœ¨å¼€å‘å½“ä¸­å®ç°æˆ‘ä»¬æƒ³è¦çš„æ•ˆæœæ—¶æä¾›äº†å¤šä¸€äº›çš„å‚è€ƒ, ä½†æ˜¯å‘¢, è¿™è¿˜è¿œè¿œä¸å¤Ÿ, æˆ‘ä»¬åªæ˜¯åˆæ­¥çš„å»äº†è§£è¿™äº›<strong>CALayer</strong>å­ç±»çš„çš®æ¯›, å•å•<strong>CATiledLayer</strong>å’Œ<strong>CAEMitterLayer</strong>ä¸¤ä¸ªå­ç±»æˆ‘ä»¬éƒ½å¯ä»¥å•ç‹¬æŠ½å‡ºæ¥å†™ä¸€é•¿ä¸²çš„ä¸œä¸œ, è¿™ä¸ªè¿˜æ˜¯åé¢å†è¯´å§, é‡ç‚¹æ˜¯, æˆ‘ä»¬è¦è®°ä½, <strong>CALayer</strong>çš„ç”¨å¤„éå¸¸ä¹‹å¤§, è™½ç„¶æœ‰ä¸€äº›<strong>CALayer</strong>çš„å­ç±»å¹¶æ²¡æœ‰ä¸ºæ‰€æœ‰å¯èƒ½å‡ºç°çš„åœºæ™¯è¿›è¡Œä¼˜åŒ–, è¿™ä¸ªå°±è¦é æˆ‘ä»¬è‡ªå·±çš„å¤´è„‘é£æš´å»æ€è€ƒå¦‚ä½•æ‰èƒ½æ›´å¥½çš„å»ä¼˜åŒ–äº†.</p>
</blockquote>

<hr/>

<h3 id="toc_19">å·¥ç¨‹åœ°å€</h3>

<p>é¡¹ç›®åœ°å€: <a href="https://github.com/CainRun/CoreAnimation">https://github.com/CainRun/CoreAnimation</a></p>

<hr/>

<h3 id="toc_20">æœ€å</h3>

<p><center>ç å­—å¾ˆè´¹è„‘, çœ‹å®˜èµç‚¹é¥­é’±å¯å¥½</center></p>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/WeChatPay-Objective-C/Images/%E5%BE%AE%E4%BF%A1QRC.jpg" alt="å¾®ä¿¡"/></p>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/WeChatPay-Objective-C/Images/%E6%94%AF%E4%BB%98%E5%AE%9DQRC.jpg" alt="æ”¯ä»˜å®"/></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ç©è½¬iOSå¼€å‘ï¼šæ­å»ºMac OSæœ¬åœ°SVNæœåŠ¡å™¨]]></title>
    <link href="https://cainrun.github.io/14785314208383.html"/>
    <updated>2016-11-07T23:10:20+08:00</updated>
    <id>https://cainrun.github.io/14785314208383.html</id>
    <content type="html"><![CDATA[
<h3 id="toc_0">ä½œè€…æ„Ÿè¨€</h3>

<blockquote>
<p>åœ¨å‰ä¸€æ®µæ—¶é—´, æ²¡ç½‘çš„æƒ…å†µä¸‹å†™é¡¹ç›®, å‘ç°ä¸€ä»¶å¾ˆè›‹ç–¼çš„äº‹, å±…ç„¶ä¸çŸ¥é“æ€ä¹ˆç‰ˆæœ¬ç®¡ç†äº†, çµå…‰ä¸€é—ª, è‡ªå·±æ­å»ºä¸ªæœ¬åœ°SVNæœåŠ¡å™¨å§, äºæ˜¯ä¹è¿™æ–‡ç« å°±å‡ºæ¥äº†</p>

<p><dr/><br/>
<strong><font color=purple>æœ€å:</font></strong><br/>
<strong><font color=purple>å¦‚æœä½ æœ‰æ›´å¥½çš„å»ºè®®æˆ–è€…å¯¹è¿™ç¯‡æ–‡ç« æœ‰ä¸æ»¡çš„åœ°æ–¹, è¯·è”ç³»æˆ‘, æˆ‘ä¼šå‚è€ƒä½ ä»¬çš„æ„è§å†è¿›è¡Œä¿®æ”¹, è”ç³»æˆ‘æ—¶, è¯·å¤‡æ³¨</strong><code>æ­å»ºMac OSæœ¬åœ°SVNæœåŠ¡å™¨</code><strong>å¦‚æœè§‰å¾—å¥½çš„è¯, å¸Œæœ›å¤§å®¶ä¹Ÿå¯ä»¥æ‰“èµä¸€ä¸‹~å˜»å˜»~ç¥å¤§å®¶å­¦ä¹ æ„‰å¿«~è°¢è°¢~</font></strong></p>
</blockquote>

<span id="more"></span><!-- more -->

<hr/>

<h3 id="toc_1">åˆ›å»ºSVNæœåŠ¡å™¨</h3>

<blockquote>
<p>é¦–å…ˆæˆ‘ä»¬è¦åˆ›å»ºä¸€ä¸ª<strong>SVN</strong>æœåŠ¡å™¨å­˜æ”¾å¤¹, è¿™é‡Œæˆ‘çš„åœ°å€æ˜¯å¦‚ä¸‹:</p>
</blockquote>

<pre><code class="language-vim">    sudo svnadmin create /Users/imac/Documents/svn/MyCode
</code></pre>

<p><img src="https://raw.githubusercontent.com/CainRun/DeveloperDocument/master/%E7%8E%A9%E8%BD%ACiOS%E5%BC%80%E5%8F%91%EF%BC%9A%E6%90%AD%E5%BB%BAMac%20OS%E6%9C%AC%E5%9C%B0SVN%E6%9C%8D%E5%8A%A1%E5%99%A8/1.png" alt="1"/></p>

<hr/>

<h3 id="toc_2">é…ç½®SVNServe.confæ–‡ä»¶</h3>

<blockquote>
<p>åˆ›å»ºå®Œä¹‹å, å°±éœ€è¦é…ç½®ä¸€ä¸‹<strong>SVN</strong>, æˆ‘è¿™é‡Œæ¯”è¾ƒä¹ æƒ¯ä½¿ç”¨<strong>Vim</strong>.<br/>
åœ¨æˆ‘æœºå­ä¸Šçš„ç›®å½•æ˜¯å¦‚ä¸‹: </p>
</blockquote>

<pre><code class="language-vim">sudo vim /Users/imac/Documents/svn/MyCode/conf/svnserve.conf 
</code></pre>

<blockquote>
<p>è¾“å…¥å®Œä¹‹å, éœ€è¦å¼€æ”¾å‡ ä¸ªå‚æ•°, ä¸€å®šè¦æŠŠä»–ä»¬å‰é¢çš„<strong>#</strong>å·å’Œ<strong>ç©ºæ ¼</strong>éƒ½åˆ æ‰.</p>

<ul>
<li>anon-access = none(é»˜è®¤ä¸ºread, ä¿®æ”¹æ”¹æˆnone)</li>
<li>auth-access = write</li>
<li>password-db = passwd</li>
<li>authz-db = authz</li>
</ul>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/DeveloperDocument/master/%E7%8E%A9%E8%BD%ACiOS%E5%BC%80%E5%8F%91%EF%BC%9A%E6%90%AD%E5%BB%BAMac%20OS%E6%9C%AC%E5%9C%B0SVN%E6%9C%8D%E5%8A%A1%E5%99%A8/2.png" alt="2"/></p>

<hr/>

<h3 id="toc_3">é…ç½®Passwdæ–‡ä»¶</h3>

<blockquote>
<p>é…ç½®å®Œ<strong>svnserve.conf</strong>æ–‡ä»¶ä¹‹å, å°±ç»§ç»­æ¥é…ç½®<strong>passwd</strong>æ–‡ä»¶:</p>
</blockquote>

<pre><code class="language-vim">    sudo vim /Users/imac/Documents/svn/MyCode/conf/passwd 
</code></pre>

<blockquote>
<p>è¿™é‡Œæˆ‘ä»¬åªéœ€è¦æ·»åŠ ä¸€ä¸ªç”¨æˆ·åå’Œå¯†ç å°±å¯ä»¥äº†, æ¯•ç«Ÿå°±åªæœ‰è‡ªå·±åœ¨ç”¨è€Œå·².</p>
</blockquote>

<pre><code class="language-vim">    admin=123456
</code></pre>

<p><img src="https://raw.githubusercontent.com/CainRun/DeveloperDocument/master/%E7%8E%A9%E8%BD%ACiOS%E5%BC%80%E5%8F%91%EF%BC%9A%E6%90%AD%E5%BB%BAMac%20OS%E6%9C%AC%E5%9C%B0SVN%E6%9C%8D%E5%8A%A1%E5%99%A8/3.png" alt="3"/></p>

<hr/>

<h3 id="toc_4">é…ç½®Authzæ–‡ä»¶</h3>

<blockquote>
<p>é…ç½®å®Œå‰é¢ä¸¤ä¸ªæ–‡ä»¶, ä¸‹é¢è¿™ä¸ªæ–‡ä»¶é…ç½®å®Œå°±æå®šäº†</p>
</blockquote>

<pre><code class="language-vim">    sudo vim /Users/imac/Documents/svn/MyCode/conf/authz
</code></pre>

<pre><code class="language-vim">[groups]

admins=admin

[/]
@admins=rw
</code></pre>

<p><img src="https://raw.githubusercontent.com/CainRun/DeveloperDocument/master/%E7%8E%A9%E8%BD%ACiOS%E5%BC%80%E5%8F%91%EF%BC%9A%E6%90%AD%E5%BB%BAMac%20OS%E6%9C%AC%E5%9C%B0SVN%E6%9C%8D%E5%8A%A1%E5%99%A8/4.png" alt="4"/></p>

<hr/>

<h3 id="toc_5">å¯åŠ¨SVNæœåŠ¡å™¨</h3>

<blockquote>
<p>é…ç½®äº†é‚£ä¹ˆå¤š, æœ€é‡è¦çš„é‡å¤´æˆæ¥äº†, å°±æ˜¯å¯åŠ¨æˆ‘ä»¬çš„<strong>SVN</strong>æœåŠ¡å™¨</p>
</blockquote>

<pre><code class="language-vim">    svnserve -d -r /Users/imac/svn/MyCode
</code></pre>

<blockquote>
<p>å¦‚æœè¾“å…¥ä¹‹å, ç»ˆç«¯ä¸€ç‚¹æç¤ºéƒ½æ²¡æœ‰, é‚£å°±ä»£è¡¨<strong>SVN</strong>æœåŠ¡å™¨å·²ç»å¯åŠ¨æˆåŠŸäº†.</p>
</blockquote>

<hr/>

<h3 id="toc_6">å…³é—­SVNæœåŠ¡å™¨</h3>

<blockquote>
<p>æœ‰å¯åŠ¨, å½“ç„¶ä¹Ÿæœ‰å…³é—­</p>
</blockquote>

<pre><code class="language-vim">    sudo killall svnserve
</code></pre>

<blockquote>
<p>æˆ–è€…æ˜¯æ‰“å¼€æ´»åŠ¨ç›‘è§†å™¨æœç´¢ä¹‹ååœ¨å’”æ“¦æ‰</p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/DeveloperDocument/master/%E7%8E%A9%E8%BD%ACiOS%E5%BC%80%E5%8F%91%EF%BC%9A%E6%90%AD%E5%BB%BAMac%20OS%E6%9C%AC%E5%9C%B0SVN%E6%9C%8D%E5%8A%A1%E5%99%A8/5.png" alt="5"/></p>

<hr/>

<h3 id="toc_7">é¦–æ¬¡å¯¼å…¥å·¥ç¨‹æ–‡ä»¶åˆ°SVNæœåŠ¡å™¨</h3>

<blockquote>
<p><strong>SVN</strong>æœåŠ¡å™¨å¼„å¥½äº†, ç°åœ¨å°±æ˜¯è¦å¯¼å…¥å·¥ç¨‹æ–‡ä»¶åˆ°æœåŠ¡å™¨å»äº†</p>
</blockquote>

<pre><code class="language-vim">    svn import /Users/imac/Documents/AFNetworking svn://localhost/MyCode --username=admin --password=123456 -m &quot;åˆå§‹åŒ–å¯¼å…¥&quot;
</code></pre>

<blockquote>
<p>è¿™é‡Œè§£é‡Šä¸€ä¸‹è¿™æ¡å‘½ä»¤æ˜¯å•¥æ„æ€:<br/>
* <strong>/Users/imac/Documents/AFNetworking</strong>è¿™ä¸€æ®µæŒ‡çš„æ˜¯éœ€è¦å¯¼å…¥çš„å·¥ç¨‹æ–‡ä»¶.<br/>
* <strong>svn://localhost/MyCode</strong>æŒ‡çš„æ˜¯æŠŠå·¥ç¨‹æ–‡ä»¶ä¸Šä¼ åˆ°<strong>MyCode</strong>è¿™ä¸ªç›®å½•ä¸‹.<br/>
* <strong>--username=admin --password=123456</strong>æŒ‡çš„æ˜¯æ ¡éªŒç”¨æˆ·åå’Œå¯†ç .<br/>
* <strong>-m &quot;åˆå§‹åŒ–å¯¼å…¥&quot;</strong>æŒ‡çš„æ˜¯æäº¤çš„ä¿¡æ¯.</p>
</blockquote>

<hr/>

<h3 id="toc_8">ä»SVNæœåŠ¡å™¨ä¸‹è½½å·¥ç¨‹æ–‡ä»¶åˆ°æœ¬åœ°</h3>

<blockquote>
<p>ä¸Šä¼ å·¥ç¨‹æˆ‘ä»¬å·²ç»çŸ¥é“äº†, é‚£ä¸‹è½½å·¥ç¨‹æˆ‘ä»¬ä¹Ÿæ¥è¯´ä¸€è¯´.</p>
</blockquote>

<pre><code class="language-vim">    svn checkout svn://localhost/mycode --username=admin --password=123456 /Users/imac/Documents/code
</code></pre>

<blockquote>
<p>è¿™é‡Œå°±ä¸è§£é‡Šäº†å’Œä¸Šé¢é‚£æ¡å‘½ä»¤æ„æ€å·®ä¸å¤š.</p>
</blockquote>

<hr/>

<h3 id="toc_9">äºŒæ¬¡æäº¤ä»£ç åˆ°æœåŠ¡å™¨</h3>

<blockquote>
<p>äºŒæ¬¡æäº¤æ˜¯æœ‰ä¸€ä¸ªå‰æçš„, é‚£å°±æ˜¯ä½ é¦–å…ˆéœ€è¦åœ¨<strong>SVN</strong>æœåŠ¡å™¨ä¸Šä¸‹è½½ä»£ç åˆ°æœ¬åœ°, ç„¶åå†å»ä¿®æ”¹è¿™ä¸€ä»½ä»£ç , æ‰èƒ½å¤ŸäºŒæ¬¡æäº¤.<br/>
<dr/><br/>
é¦–å…ˆæˆ‘ä»¬å¾—å»åˆ°å·¥ç¨‹ç›®å½•:</p>
</blockquote>

<pre><code class="language-vim">    cd /Users/imac/Documents/code
</code></pre>

<blockquote>
<p>ç„¶åå†è¾“å…¥å‘½ä»¤:</p>
</blockquote>

<pre><code class="language-vim">    svn commit -m &quot;ä¿®æ”¹éƒ¨åˆ†ä»£ç &quot;
</code></pre>

<blockquote>
<p>è¿™æ ·å­å°±å¯ä»¥æŠŠ<strong>/Users/imac/Documents/code</strong>è¿™ä¸ªç›®å½•ä¸‹æ‰€æœ‰ä¿®æ”¹è¿‡çš„ä»£ç éƒ½æäº¤åˆ°æœåŠ¡å™¨<br/>
<dr/><br/>
è¿™äº›éƒ½æ˜¯åŸºäº<a href="http://blog.csdn.net/langzi7758521/article/details/51646598">ç»ˆç«¯æ“ä½œ</a>çš„æƒ…å†µæ¥è¯´çš„, æˆ‘è¿™é‡Œæ¨èä½¿ç”¨<strong><font color=red>Cornerstone</font></strong>, æ›´åŠ çš„ç®€å•æ–¹ä¾¿, è‡³äºå“ªé‡Œæœ‰å…è´¹ç‰ˆ, å¤§æ¦‚å¯ä»¥å»ç™¾åº¦æœä¸€æœ, ä¸€å †ä¸€å †çš„~~</p>
</blockquote>

<hr/>

<h3 id="toc_10">æƒé™é”™è¯¯</h3>

<blockquote>
<p>å¦‚æœä½ åœ¨å¯¼å…¥å·¥ç¨‹æ—¶å€™å‡ºç°<strong>E000013</strong>çš„é”™è¯¯, å¦‚ä¸‹:</p>
</blockquote>

<pre><code class="language-vim">svn: E000013: Can&#39;t open file &#39;/Users/xxx/Documents/svn/XXX/db/txn-current-lock&#39;: Permission denied
</code></pre>

<blockquote>
<p>è¿™ä¸ªé”™è¯¯ä¸€èˆ¬æ¥è¯´å°±æ˜¯ä½ çš„<strong>svn</strong>æ–‡ä»¶å¤¹æƒé™æ²¡å¼€æ”¾, åªè¦è¿›å…¥åˆ°ä½ çš„<strong>SVN</strong>ç›®å½•ä¸‹, è¾“å…¥ä¸‹é¢çš„å‘½ä»¤å°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜äº†.<br/>
æˆ‘è¿™è¾¹çš„ç›®å½•æ˜¯<strong>/Users/imac/Documents/svn/MyCode</strong></p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/DeveloperDocument/master/%E7%8E%A9%E8%BD%ACiOS%E5%BC%80%E5%8F%91%EF%BC%9A%E6%90%AD%E5%BB%BAMac%20OS%E6%9C%AC%E5%9C%B0SVN%E6%9C%8D%E5%8A%A1%E5%99%A8/6.png" alt="6"/></p>

<pre><code class="language-vim">    /*MyCodeå°±æ˜¯ä½ åˆ›å»ºSVNæœåŠ¡å™¨çš„æ–‡ä»¶å¤¹*/
    sudo chown -R $(id -u):$(id -g) MyCode
    chmod -R u+w MyCode
</code></pre>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ç©è½¬iOSå¼€å‘ï¼š5.ã€ŠCore Animationã€‹CALayerçš„Transforms]]></title>
    <link href="https://cainrun.github.io/14777052484078.html"/>
    <updated>2016-10-29T09:40:48+08:00</updated>
    <id>https://cainrun.github.io/14777052484078.html</id>
    <content type="html"><![CDATA[
<h3 id="toc_0">ä½œè€…æ„Ÿè¨€</h3>

<blockquote>
<p>ä¹‹å‰æˆ‘ä»¬æ‰€äº†è§£çš„<strong>CALayer</strong>éƒ½æ˜¯æ¯”è¾ƒæŠ½è±¡åŒ–, å¥½åœ¨<a href="https://cainrun.github.io/14775511877452.html">ã€ŠCore Animationã€‹CALayerçš„è§†è§‰æ•ˆæœ</a>è§£å†³æˆ‘ä»¬è¿™äº›è§†è§‰åŠ¨ç‰©çš„å­¦ä¸œè¥¿çš„æ¯ç‡¥, ä»Šå¤©æˆ‘ä»¬å°±æ¥è®²è®²<strong>Transforms</strong>, ä¹Ÿå°±æ˜¯<strong>CALayer</strong>çš„<strong>Transforms</strong>.</p>

<p><dr/><br/>
<strong><font color=purple>æœ€å:</font></strong><br/>
<strong><font color=purple>å¦‚æœä½ æœ‰æ›´å¥½çš„å»ºè®®æˆ–è€…å¯¹è¿™ç¯‡æ–‡ç« æœ‰ä¸æ»¡çš„åœ°æ–¹, è¯·è”ç³»æˆ‘, æˆ‘ä¼šå‚è€ƒä½ ä»¬çš„æ„è§å†è¿›è¡Œä¿®æ”¹, è”ç³»æˆ‘æ—¶, è¯·å¤‡æ³¨</strong><code>Core Animation</code><strong>å¦‚æœè§‰å¾—å¥½çš„è¯, å¸Œæœ›å¤§å®¶ä¹Ÿå¯ä»¥æ‰“èµä¸€ä¸‹~å˜»å˜»~ç¥å¤§å®¶å­¦ä¹ æ„‰å¿«~è°¢è°¢~</font></strong></p>
</blockquote>

<span id="more"></span><!-- more -->

<hr/>

<h3 id="toc_1">ç®€ä»‹</h3>

<blockquote>
<p><strong>CALayer Transforms</strong>è®²å¾—æ˜¯<strong>CALayer</strong>ä¸€äº›æˆ‘ä»¬èƒ½å¤Ÿçœ‹å¾—è§çš„ä¸œè¥¿, è¿™äº›çŸ¥è¯†ç‚¹åœ¨æˆ‘ä»¬æ—¥å¸¸å¼€å‘ä¸­ä¹Ÿä¼šæœ‰ç”¨åˆ°çš„, æ¯”å¦‚<strong>Affine Transforms</strong>, <strong>3D Transforms</strong>, <strong>Solid Objects</strong>ç­‰ç­‰, å¾…æˆ‘ä»¬ä¸€ä¸€å»è®²è§£.</p>
</blockquote>

<hr/>

<h3 id="toc_2">Affine Transforms</h3>

<blockquote>
<p><strong>Affine Transforms</strong>çš„ä¸­æ–‡æ„æ€å«åšä»¿å°„è½¬æ¢, åœ¨å‰ä¸€ç¯‡æ–‡ç« çš„æ—¶å€™æˆ‘ä»¬å°±ä½¿ç”¨è¿‡<strong>transform</strong>æ¥æ—‹è½¬<strong>UIView</strong>, ä½†é‚£æ—¶å€™æˆ‘ä»¬åªæ˜¯ç®€å•çš„ä½¿ç”¨ç½¢äº†, å¹¶æ²¡æœ‰è¯´æ˜å®ƒçš„åŸç†.<br/>
<dr/><br/>
å®é™…ä¸Š<strong>UIView</strong>é‡Œçš„<strong>transform</strong>æ˜¯<strong>CAAffineTransform</strong>ç±»å‹, ç”¨äºåšäºŒç»´ç©ºé—´çš„æ—‹è½¬, ç¼©æ”¾, å¹³ç§»ç­‰æ“ä½œ, è€Œä¸”<strong>CAAffineTransform</strong>å¯ä»¥å’Œä¸€ä¸ªäºŒç»´ç©ºé—´çš„å‘é‡, æ¯”å¦‚<strong>CGPoint</strong>åš<strong>3x2</strong>çš„çŸ©é˜µ.<br/>
<dr/><br/>
å¤§æ¦‚çš„è¿ç®—åŸç†å°±æ˜¯, ç”¨<strong>CGPoint</strong>çš„æ¯ä¸€åˆ—å’Œ<strong>CGAffineTransform</strong>çŸ©é˜µçš„æ¯ä¸€åˆ—å¯¹åº”çš„å…ƒç´ è¿›è¡Œç›¸ä¹˜å†æ±‚å’Œ, è¿™æ ·å­å°±ä¼šå½¢æˆä¸€ä¸ªæ–°çš„<strong>CGPoint</strong>.<br/>
<dr/><br/>
è¯´åˆ°è¿™é‡Œ, åº”è¯¥ä¼šæœ‰äººæœ‰ç–‘æƒ‘, <strong>CGAffineTransform</strong>å’Œ<strong>CGPoint</strong>å®Œå…¨éƒ½ä¸æ˜¯ä¸€æ ·ä¸œè¥¿, æ€ä¹ˆèƒ½åšè¿ç®—å‘¢? å…¶å®å¹¶ä¸æ˜¯çš„, å½“ä½ ä½¿ç”¨å®ƒä»¬ä¸¤ä¸ªè¿›è¡Œè¿ç®—çš„æ—¶å€™, ç³»ç»Ÿä¼šè‡ªåŠ¨è¡¥ä¸Šä¸€äº›ç¼ºå°‘çš„å…ƒç´ , ä½¿å¾—<strong>CGAffineTransform</strong>å’Œ<strong>CGPoint</strong>è¿›è¡Œä¸€ä¸€å¯¹åº”, ä½†è¿ç®—å®Œä¹‹å, è¿™äº›å¡«å……å€¼å°±ä¼šè¢«æŠ›å¼ƒæ‰, ä¸ä¼šè¿›è¡Œä¿å­˜, ä»…ä»…åªæ˜¯ç”¨æ¥åšè¿ç®—ç½¢äº†.<br/>
<dr/><br/>
æ‰€ä»¥æˆ‘ä»¬é€šå¸¸é‡åˆ°çš„äºŒç»´å˜æ¢éƒ½æ˜¯ä½¿ç”¨<strong>3x3</strong>, è€Œä¸æ˜¯åˆšåˆšæ‰€è¯´åˆ°çš„<strong>2x3</strong>, ä½†åœ¨æŸäº›æƒ…å†µä¸‹æˆ‘ä»¬ä¹Ÿä¼šé‡åˆ°<strong>2x3</strong>çš„æ ¼å¼çŸ©é˜µ, è¿™å°±æ˜¯æ‰€è°“çš„ä»¥åˆ—ä¸ºä¸»(è¿™ä¸ªç­‰ä¸‹ç”¨äº‹ä¾‹æ¥æŸ¥çœ‹å§), ä½†æ— è®ºå¦‚ä½•éƒ½å¥½, åªè¦èƒ½å¤Ÿä¿æŒä¸€è‡´, ç”¨ä»€ä¹ˆæ ¼å¼åˆä½•å¦¨å‘¢?<br/>
<dr/><br/>
å½“å¯¹å›¾å±‚è¿›è¡ŒçŸ©é˜µå˜æ¢æ—¶, å›¾å±‚çŸ©å½¢å†…çš„æ¯ä¸€ä¸ªç‚¹éƒ½è¢«ç›¸åº”çš„åšå˜æ¢, ä»è€Œå½¢æˆä¸€ä¸ªæ–°çš„å››è¾¹å½¢çš„å½¢çŠ¶, <strong>CGAffineTransform</strong>ä¸­çš„&quot;ä»¿å°„&quot;çš„æ„æ€æ˜¯æ— è®ºä½ å¦‚ä½•å»æ”¹å˜çŸ©é˜µçš„å€¼, å›¾å±‚ä¸­å¹³è¡Œçš„ä¸¤æ¡çº¿åœ¨å˜æ¢ä¹‹åä»ç„¶ä¿æŒå¹³è¡Œ, è¿™å°±æ˜¯<strong>CGAffineTransform</strong>çš„&quot;ä»¿å°„&quot;.</p>
</blockquote>

<h4 id="toc_3">Creating a CGAffineTransform - åˆ›å»ºä¸€ä¸ªCGAffineTransform</h4>

<blockquote>
<p>å…¶å®å¯¹çŸ©é˜µæ•°å­¦çš„é˜è¿°æ—©å°±è¶…è¿‡äº†<strong>Core Animation</strong>çš„è®¨è®ºèŒƒå›´äº†, å¦‚æœä½ æ˜¯å¯¹çŸ©é˜µæ•°å­¦ä¸€ç‚¹éƒ½ä¸äº†è§£çš„è¯, é‚£ä½ å°±è¦å“­æ™•åœ¨å•æ‰€äº†, ä¸è¿‡è¿˜å¥½, <strong>Core Graphics</strong>æä¾›äº†ä¸€ç³»åˆ—çš„<strong>API</strong>, å¯¹å®Œå…¨æ²¡æœ‰æ•°å­¦åŸºç¡€çš„å¼€å‘è€…æ¥è®²ä¹Ÿèƒ½å¤Ÿåšä¸€äº›ç®€å•çš„å˜æ¢, æ¯”å¦‚:</p>
</blockquote>

<pre><code class="language-objectivec">    CGAffineTransformMakeRotation(CGFloat angle);
    CGAffineTransformMakeScale(CGFloat sx, CGFloat sy);
    CGAffineTransformMakeTranslation(CGFloat tx, CGFloat ty);
</code></pre>

<blockquote>
<p>åœ¨<strong>UIView</strong>å¯ä»¥é€šè¿‡è®¾ç½®<strong>transform</strong>å±æ€§è¿›è¡Œå˜æ¢, ä½†å®é™…ä¸Šè¿˜æ˜¯å¯¹CGLayerè¿›è¡Œäº†ä¸€äº›å›¾å±‚è½¬å˜çš„å°è£….<br/>
<dr/><br/>
<strong>CALayer</strong>åŒæ ·ä¹Ÿæœ‰ä¸€ä¸ª<strong>transform</strong>å±æ€§, å®ƒå«åš<strong>affineTransform</strong>, ä½†å®ƒçš„ç±»å‹æ˜¯<strong>CATransform3D</strong>, è€Œä¸æ˜¯<strong>CGAffineTransform</strong>, è¿™ä¸ªåé¢å†è§£é‡Šä¸€ä¸‹ç¥é©¬æ˜¯<strong>CATransform3D</strong>.<br/>
<dr/><br/>
ç›´æ¥æ¥çœ‹Demoå§:</p>
</blockquote>

<pre><code class="language-objectivec">- (void)viewTransform {
    
    self.view.backgroundColor = [UIColor grayColor];
    
    UIImageView *imageView = [[UIImageView alloc] initWithFrame:CGRectMake(100, 100, 100, 100)];
    
    imageView.image = [UIImage imageNamed:@&quot;expression&quot;];
    
    [self.view addSubview:imageView];
    
    // æ—‹è½¬
    CGAffineTransform transform = CGAffineTransformMakeRotation(M_PI_4);
    imageView.layer.affineTransform = transform;
    
    // ç¼©æ”¾
//    CGAffineTransform scaleTransform = CGAffineTransformMakeScale(0.5, 0.5);
//    imageView.layer.affineTransform = scaleTransform;
    
    // å¹³ç§»
//    CGAffineTransform translationTransform = CGAffineTransformMakeTranslation(50, 50);
//    imageView.layer.affineTransform = translationTransform;
}
</code></pre>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/5.Transforms/images/1.png" alt="1"/><br/>
<img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/5.Transforms/images/2.png" alt="2"/></p>

<blockquote>
<p>æ³¨æ„ä¸€ä¸‹, æˆ‘ä»¬åœ¨è¿™é‡Œä½¿ç”¨çš„æ˜¯<strong>M_PI_4</strong>, è€Œä¸æ˜¯æˆ‘ä»¬è‡ªå·±è¾“å…¥çš„ç¥é©¬<strong>45</strong>ä¹‹ç±»çš„æ•°å­—, å› ä¸ºåœ¨<strong>iOS</strong>å½“ä¸­, ä½¿ç”¨çš„çš„æ˜¯å¼§åº¦å•ä½, è€Œä¸æ˜¯è§’åº¦å•ä½, å¼§åº¦ç”¨æ•°å­¦å¸¸é‡æ˜¯è¡¨ç¤ºä¸º<strong>pi</strong>, ä¸€ä¸ª<strong>pi</strong>å°±ä¸º<strong>180Â°</strong>, è€Œå››åˆ†ä¹‹ä¸€åº¦å°±æ˜¯<strong>45Â°</strong>äº†.<br/>
<dr/><br/>
ä½†è¿™é‡Œä¼šæœ‰ä¸€ä¸ªé—®é¢˜, è¿™äº›å®éƒ½æ˜¯ç³»ç»Ÿæä¾›ç»™æˆ‘ä»¬çš„, å¦‚æœä½ è¦è‡ªå·±å»åŠ è½½æ›´å¤šæˆ–è€…æ˜¯æ‰©å±•çš„è¯, å¯ä»¥è‡ªå·±æ‰‹åŠ¨å»å†™ä¸€ä¸ª<strong>API</strong>.</p>
</blockquote>

<h4 id="toc_4">Combining Transforms - æ··åˆå˜æ¢</h4>

<blockquote>
<p><strong>Core Graphics</strong>æä¾›äº†ä¸€ç³»åˆ—çš„APIå¯ä»¥åœ¨ä¸€ä¸ª<strong>transform</strong>çš„åŸºç¡€ä¸Šåšæ›´æ·±å±‚æ¬¡çš„<strong>transform</strong>, æ¯”å¦‚è¯´ç¼©æ”¾ä¹‹åå†æ—‹è½¬, æ¯”å¦‚ä¸‹é¢å‡ ä¸ª<strong>API</strong>:<br/>
<dr/></p>
</blockquote>

<pre><code class="language-objectivec">    CGAffineTransformRotate(CGAffineTransform t, CGFloat angle);
    CGAffineTransformScale(CGAffineTransform t, CGFloat sx, CGFloat sy);
    CGAffineTransformTranslate(CGAffineTransform t, CGFloat tx, CGFloat ty)
</code></pre>

<blockquote>
<p>å½“ä½ æ“çºµä¸€ä¸ª<strong>transform</strong>çš„æ—¶å€™, éœ€è¦å…ˆåˆ›å»ºä¸€ä¸ª<strong>CGAffineTransform</strong>ç±»å‹çš„ç©ºå€¼, ç›´æ¥æŠŠ<strong>CGAffineTransformIdentity</strong>èµ‹å€¼è¿‡å»å°±å¥½äº†, è¿™ä¸ªç§°ä¸ºå•ä½çŸ©é˜µ.<br/>
<dr/><br/>
å¦‚æœä½ éœ€è¦æŠŠä¸¤ä¸ªå·²ç»å†™å¥½çš„<strong>transform</strong>åˆæˆä¸ºä¸€ä¸ªçš„è¯, ä½ å¯ä»¥ä½¿ç”¨ç³»ç»Ÿæä¾›çš„<strong>API</strong>:</p>
</blockquote>

<pre><code class="language-objectivec">CGAffineTransformConcat(CGAffineTransform t1, CGAffineTransform t2);
</code></pre>

<blockquote>
<p>ä¸è¯´é‚£ä¹ˆå¤šåºŸè¯äº†, ç›´æ¥æ¥çœ‹Demoå§:</p>
</blockquote>

<pre><code class="language-objectivec">- (void)viewCombiningTransforms {
    
    UIImageView *imageView = [[UIImageView alloc] initWithFrame:CGRectMake(100, 100, 100, 100)];
    
    imageView.image = [UIImage imageNamed:@&quot;expression&quot;];
    
    [self.view addSubview:imageView];
    
    CGAffineTransform transform = CGAffineTransformIdentity;
    
    // æ—‹è½¬
    transform = CGAffineTransformRotate(transform, M_PI_4);
    // ç¼©æ”¾
    transform = CGAffineTransformScale(transform, 0.5f, 0.5f);
    // å¹³ç§»
    transform = CGAffineTransformTranslate(transform, 200, 0);
    
    imageView.layer.affineTransform = transform;
}
</code></pre>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/5.Transforms/images/3.png" alt="3"/><br/>
<img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/5.Transforms/images/4.png" alt="4"/></p>

<blockquote>
<p>çœ‹åˆ°å›¾ç‰‡çš„æ—¶å€™, ä½ ä¼šå‘ç°ç»“æœå¥½åƒå’Œæƒ³è±¡æœ‰äº›å·®å¼‚, ä¸ºä»€ä¹ˆä¼šå¹³ç§»äº†é‚£ä¹ˆå¤š? åŸå› æ˜¯åœ¨äºå½“ä½ æŒ‰é¡ºåºåšäº†<strong>transform</strong>, ä¸Šä¸€ä¸ª<strong>transform</strong>ä¼šå½±å“åˆ°ä¸‹ä¸€ä¸ª<strong>transform</strong>, æ‰€ä»¥å¹³ç§»ä¹‹å, ä½ ä¼šå‘ç°åŒæ ·è¢«ç¼©æ”¾å’Œæ—‹è½¬äº†, è¿™å°±æ˜¯æ„å‘³ç€, ä½ åœ¨æ—‹è½¬ä¹‹åçš„å¹³ç§»å’Œå¹³ç§»ä¹‹åçš„æ—‹è½¬è®²ä¼šå¾—åˆ°ä¸¤ç§ä¸åŒçš„ç»“æœ, è¿™ä¸ªå¤§å®¶éœ€è¦æ³¨æ„ä¸€ä¸‹.</p>
</blockquote>

<hr/>

<h3 id="toc_5">3D Transforms</h3>

<blockquote>
<p>åœ¨ä¹‹å‰, æˆ‘ä»¬æœ‰æåŠè¿‡<strong>zPosition</strong>è¿™ä¸ªå±æ€§, å¯ä»¥ä»ç”¨æˆ·è§’åº¦çš„æ¥è®©è®©å›¾å±‚è¿œç¦»æˆ–è€…æ˜¯é è¿‘,<strong>CATransform</strong>ç±»å‹çš„<strong>transform</strong>å¯ä»¥çœŸæ­£åšåˆ°è®©å›¾å±‚åœ¨<strong>3D</strong>ç©ºé—´å†…å¹³ç§»æˆ–è€…æ—‹è½¬.<br/>
<dr/><br/>
å’Œ<strong>CGAffineTransform</strong>ç±»ä¼¼,<strong>CATransform3D</strong>ä¹Ÿæ˜¯ä¸€ä¸ªçŸ©é˜µ, ä½†å’Œä¹‹é—´æ‰€è¯´çš„<strong>2x3</strong>çŸ©é˜µä¸ä¸€æ ·,<strong>CATransform3D</strong>æ˜¯ä¸€ä¸ªå¯ä»¥åœ¨3Dç©ºé—´å†…åšå˜æ¢çš„<strong>4x4</strong>çŸ©é˜µ.<br/>
<dr/><br/>
å’Œ<strong>CGAffineTransform</strong>çŸ©é˜µç±»ä¼¼, <strong>Core Animation</strong>ä¹Ÿæä¾›äº†ä¸€ç³»åˆ—çš„ä½¿ç”¨æ–¹æ³•, ç”¨æ¥åˆ›å»ºå’Œç»„åˆ<strong>CATransform3D</strong>çŸ©é˜µ, äº<strong>Core Graphics</strong>çš„å‡½æ•°ç›¸æ¯”, ä¹Ÿåªæ˜¯åœ¨<strong>3D</strong>çš„å¹³ç§»å’Œæ—‹è½¬ä¸­å¤šå‡ºäº†ä¸€ä¸ª<strong>z</strong>å‚æ•°, è€Œæ—‹è½¬çš„APIé™¤äº†æœ‰angleå‚æ•°ä¹‹å¤–, è¿˜å¤šå‡ºäº†<strong>x</strong>, <strong>y</strong>, <strong>z</strong>ç­‰ä¸‰ä¸ªå‚æ•°, åˆ†åˆ«å†³å®šäº†æ¯ä¸ªåæ ‡è½´æ–¹å‘ä¸Šçš„æ—‹è½¬, æ¯”å¦‚:</p>
</blockquote>

<pre><code class="language-objectivec">
CATransform3DMakeRotation(CGFloat angle, CGFloat x, CGFloat y, CGFloat z);
CATransform3DMakeScale(CGFloat sx, CGFloat sy, CGFloat sz);
CATransform3DMakeTranslation(Gloat tx, CGFloat ty, CGFloat tz);
</code></pre>

<blockquote>
<p>åœ¨ä¹‹å‰çš„æ–‡ç« é‡Œ, æˆ‘ä»¬éƒ½åº”è¯¥äº†è§£äº†åœ¨<strong>iOS</strong>å½“ä¸­, åŸç‚¹<strong>{0, 0}</strong>æ˜¯åœ¨å·¦ä¸Šè§’, <strong>x</strong>è½´æ­£æ–¹å‘ä¸ºå³è¾¹, <strong>y</strong>è½´æ­£æ–¹å‘ä¸ºä¸‹è¾¹, åœ¨<strong>Mac OS</strong>å½“ä¸­åˆ™æ˜¯å’Œ<strong>iOS</strong>ç›¸å, ä½†æ˜¯<strong>Z</strong>è½´å‘¢, åˆ™æ˜¯åˆ†åˆ«å’Œ<strong>x</strong>, <strong>y</strong>è½´åˆ†åˆ«å‚ç›´, æŒ‡å‘è§†è§’å¤–ä¸ºæ­£æ–¹å‘, è¯´é‚£ä¹ˆå¤š, ç›´æ¥æ¥çœ‹ä»£ç å§:</p>
</blockquote>

<pre><code class="language-objectivec">- (void)viewTransforms3D {
    
    UIImageView *imageView = [[UIImageView alloc] initWithFrame:CGRectMake(100, 100, 100, 100)];
    
    imageView.image = [UIImage imageNamed:@&quot;expression&quot;];
    
    [self.view addSubview:imageView];

    CATransform3D transform = CATransform3DMakeRotation(M_PI_4, 0, 1, 0);
    imageView.layer.transform = transform;
}
</code></pre>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/5.Transforms/images/5.png" alt="5"/><br/>
<img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/5.Transforms/images/6.png" alt="6"/><br/>
<img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/5.Transforms/images/7.png" alt="7"/></p>

<h4 id="toc_6">Perspective Projection</h4>

<blockquote>
<p>æ‰€è°“çš„<strong>Perspective Projection</strong>å°±æ˜¯é€è§†æŠ•å½±, è¿™é‡Œéœ€è¦æ™®åŠä¸€äº›çŸ¥è¯†(è™½ç„¶æˆ‘ä¹Ÿçœ‹ä¸å¤ªæ‡‚).<br/>
<dr/><br/>
åœ¨ç°å®ç”Ÿæ´»ä¸­, å½“ç‰©ä½“è¿œç¦»æˆ‘ä»¬çš„æ—¶å€™, ä¼šç”±äºè§†è§’çš„é—®é¢˜, ç‰©ä½“çœ‹èµ·æ¥ä¼šå˜å°, ç†è®ºä¸Šè¯´è¿œç¦»æˆ‘ä»¬çš„è§†å›¾è¾¹è¦æ¯”é è¿‘è§†è§’è¾¹æ›´çŸ­, ä½†å®é™…ä¸Š, æˆ‘ä»¬çš„è§†è§’æ˜¯ç­‰è·ç¦»çš„, ä¹Ÿå°±æ˜¯åœ¨<strong>3D Transform</strong>ä¸­ä»ç„¶ä¿æŒå¹³è¡Œ, å’Œä¹‹å‰æåˆ°çš„ä»¿å°„å˜æ¢æœ‰äº›ç±»ä¼¼.<br/>
<dr/><br/>
æ‰€ä»¥ä¸ºäº†åšä¸€äº›ä¿®æ­£, æˆ‘ä»¬éœ€è¦å¼•å…¥<strong>æŠ•å½±å˜æ¢</strong>, åˆç§°ä¸º<strong>zå˜æ¢</strong>, æ¥å¯¹ä¸€äº›åšäº†å˜æ¢çš„çŸ©é˜µåšä¸€äº›ä¿®æ”¹, æ—‹è½¬çš„é™¤å¤–, <strong>Core Animation</strong>, å½“ä¸­å¹¶æ²¡æœ‰ç»™æˆ‘ä»¬æä¾›ç›´æ¥è®¾ç½®é€è§†å˜æ¢çš„å‡½æ•°, æ‰€ä»¥æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨å»ä¿®æ”¹çŸ©é˜µå€¼, ä½†å¾ˆåº†å¹¸çš„æ˜¯, è¿™ä¸ªä¿®æ”¹æ˜¯å¾ˆç®€å•çš„, ç›´æ¥æ¥çœ‹ä»£ç å§:</p>
</blockquote>

<pre><code class="language-objectivec">- (void)viewPerspectiveProjection {
    
    UIImageView *imageView = [[UIImageView alloc] initWithFrame:CGRectMake(100, 100, 100, 100)];
    
    imageView.image = [UIImage imageNamed:@&quot;expression&quot;];
    
    [self.view addSubview:imageView];
    
    CATransform3D transform = CATransform3DMakeRotation(M_PI_4, 0, 1, 0);
    imageView.layer.transform = transform;
    
    CATransform3D transform3DIdentity = CATransform3DIdentity;
    transform3DIdentity.m34 = - 1.0 / 500.0;
    transform3DIdentity = CATransform3DRotate(transform3DIdentity, M_PI_4, 0, 1, 0);
    imageView.layer.transform = transform3DIdentity;
}
</code></pre>

<blockquote>
<p>åœ¨<strong>CATransform3D</strong>ä¸­, æœ‰ä¸€ä¸ª<strong>m34</strong>çš„å…ƒç´ , å®ƒæ˜¯ç”¨äºæŒ‰æ¯”ä¾‹æ¥ç¼©æ”¾<strong>X</strong>å’Œ<strong>Y</strong>çš„å€¼, ä»è€Œæ¥è®¡ç®—ç¦»è§†è§’çš„è·ç¦».<br/>
<dr/><br/>
<strong>m34</strong>çš„é»˜è®¤å€¼ä¸º0, æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½®<strong>m34</strong>æ¥åº”ç”¨é€è§†æ•ˆæœ, å…¬å¼æ˜¯<strong>-1.0/d</strong>, <strong>d</strong>ä»£è¡¨äº†æƒ³è±¡ä¸­è§†è§’ç›¸æœºå’Œå±å¹•ä¹‹é—´çš„è·ç¦», ä»¥åƒç´ ä¸ºå•ä½, é€šå¸¸è®¾ç½®<strong>500-1000</strong>ä¹‹é—´, ä½†æ˜¯å¯¹äºä¸€äº›ç‰¹æ®Šè§†å›¾, è®¾ç½®çš„å€¼è¦å°ä¸€äº›, æˆ–è€…å¤§ä¸€äº›è¦æ¯”<strong>500-1000</strong>è¦å¥½ä¸€äº›, æ‰€ä»¥è¿™äº›å€¼å¹¶ä¸æ˜¯å›ºå®šçš„, æœ€å¥½æ˜¯æ ¹æ®éœ€æ±‚æ¥è°ƒèŠ‚, ä¸ç„¶ä¼šå‡ºç°æ¹¿ç–¹, æˆ–è€…æ˜¯å¤±å»é€è§†æ•ˆæœ.</p>
</blockquote>

<h4 id="toc_7">The Vanishing Point</h4>

<blockquote>
<p><strong>The Vanishing Point</strong>ç¿»è¯‘è¿‡æ¥å«åš<strong>æ¶ˆå¤±ç‚¹</strong>, æ„æ€æ˜¯å½“åœ¨é€è§†è§’åº¦ç»˜å›¾æ—¶, åŸç†è§†è§‰è§’åº¦çš„ç‰©ä½“å°†ä¼šå˜å°å˜è¿œ, è¿œç¦»åˆ°ä¸€ä¸ªæé™çš„æ—¶å€™, æ‰€æœ‰ç‰©ä½“æœ€åéƒ½ä¼šæ±‡èšå¹¶ä¸”æ¶ˆå¤±åœ¨åŒä¸€ä¸ªç‚¹.<br/>
<dr/><br/>
åœ¨ç°å®ç”Ÿæ´»ä¸­, è¿™ä¸ªç‚¹é€šå¸¸éƒ½æ˜¯è§†å›¾çš„ä¸­å¿ƒ, å¦‚æœè¦åœ¨åº”ç”¨ä¸­åˆ›å»ºæ‹ŸçœŸæ•ˆæœçš„é€è§†, è¿™ä¸ªç‚¹ä¸€èˆ¬æ˜¯åœ¨å±å¹•çš„é‡ç‚¹, è‡³å°‘æ˜¯æ‰€æœ‰3Då¯¹è±¡çš„è§†å›¾ä¸­ç‚¹.<br/>
<dr/><br/>
åœ¨<strong>Core Animation</strong>ä¸­, è¿™ä¸ªç‚¹æ˜¯ä½äºå˜æ¢å›¾å±‚çš„<strong>anchorPoint</strong>(å½“ç„¶ä¹Ÿæœ‰ä¸€äº›ç‰¹æ®Šçš„æƒ…å†µ), ä¹Ÿå°±æ˜¯è¯´, å½“å›¾å±‚å‘ç”Ÿå˜æ¢çš„æ—¶å€™, è¿™ä¸ªç‚¹æ°¸è¿œä½äºå›¾å±‚å˜æ¢é’±çš„<strong>anchorPoint</strong>ä½ç½®.<br/>
<dr/><br/>
å½“æˆ‘ä»¬æ”¹å˜ä¸€ä¸ªå›¾å±‚çš„<strong>position</strong>æ—¶, ä¹ŸåŒæ—¶æ”¹å˜äº†å®ƒçš„æ¶ˆå¤±ç‚¹, æ‰€ä»¥åœ¨æˆ‘ä»¬åš3Då˜æ¢çš„æ—¶å€™è¦è®°ä½.<br/>
<dr/><br/>
å½“æˆ‘ä»¬å»è°ƒæ•´è§†å›¾çš„<strong>m34</strong>æ¥è®©è§†å›¾æ›´åŠ æœ‰3Dæ•ˆæœ, é€šå¸¸è¦æŠŠå®ƒæ”¾ç½®åœ¨å±å¹•çš„ä¸­å¤®, ç„¶åé€šè¿‡å¹³ç§»æ¥æŠŠå®ƒç§»åŠ¨åˆ°æŒ‡å®šçš„ä½ç½®, è¿™æ ·å­åš, å°±å¯ä»¥è®©æ‰€æœ‰çš„3Då›¾å±‚éƒ½æœ‰åŒä¸€ä¸ªæ¶ˆå¤±ç‚¹.</p>
</blockquote>

<h4 id="toc_8">Sublayer Transform</h4>

<blockquote>
<p>å¦‚æœåœ¨å¼€å‘ä¸­, æˆ‘ä»¬æœ‰å¤šä¸ªè§†å›¾æˆ–è€…å¤šä¸ªå›¾å±‚, è€Œä¸”ä»–ä»¬éƒ½è¦åš3Då˜æ¢, é‚£æˆ‘ä»¬å°±è¦å¯¹è¿™äº›è§†å›¾æˆ–è€…å›¾å±‚æ¯ä¸ªéƒ½è®¾ç½®ç›¸åŒçš„<strong>m34</strong>å€¼, å¹¶ä¸”è¿˜è¦ç¡®ä¿åœ¨å˜æ¢é’±éƒ½åœ¨å±å¹•ä¸­å¤®éƒ½æœ‰ä¸€ä¸ªç›¸åŒçš„<strong>position</strong>, å½“ç„¶, æˆ‘ä»¬å¯ä»¥è‡ªå·±å°è£…ä¸€ä¸‹, ä½†è¿™æ ·å­ä¹Ÿéå¸¸çš„è›‹ç–¼, é‚£è¯¥æ€ä¹ˆåšå‘¢?<br/>
<dr/><br/>
åœ¨<strong>CALayer</strong>ä¸­æœ‰ä¸€ä¸ªå±æ€§å«åš<strong>sublayerTransform</strong>, å®ƒä¹Ÿæ˜¯<strong>CATransform3D</strong>ç±»å‹, ä½†å’Œæˆ‘ä»¬ä¸€ä¸ªä¸€ä¸ªçš„å»è®¾ç½®å›¾å±‚ä¸åŒ, å®ƒå°†ä¼šå½±å“æ‰€æœ‰çš„å­å›¾å±‚, è¿™å°±æ˜¯è¯´æ˜äº†, æˆ‘ä»¬åªè¦ä½¿ç”¨<strong>sublayerTransform</strong>, å°±å¯ä»¥ä¸€æ¬¡æ€§çš„æŠŠæ‰€æœ‰å­å›¾å±‚éƒ½æ”¹å˜.<br/>
<dr/><br/>
è¿™ä¹Ÿå¯ä»¥æä¾›å¦ä¸€ä¸ªå¥½å¤„, å°±æ˜¯å½“æˆ‘ä»¬ä½¿ç”¨<strong>sublayerTransform</strong>å±æ€§æ—¶, æˆ‘ä»¬å°±ä¸éœ€è¦å†å¯¹å­å›¾å±‚æŒ¨ä¸ªæŒ¨ä¸ªçš„å»è®¾ç½®æ¶ˆå¤±ç‚¹, å› ä¸ºæ¶ˆå¤±ç‚¹å°†ä¼šè¢«è®¾ç½®åœ¨å®¹å™¨å›¾å±‚çš„ä¸­å¿ƒç‚¹, é‚£æˆ‘ä»¬å°±å¯ä»¥éšæ„è®¾ç½®<strong>position</strong>å’Œ<strong>frame</strong>æ¥æ”¾ç½®å­å›¾å±‚, è¿˜æ˜¯ç›´æ¥æ¥çœ‹Demoå§:</p>
</blockquote>

<pre><code class="language-objectivec">- (void)viewSublayerTransform {
    
    UIImageView *imageViewOne = [[UIImageView alloc] initWithFrame:CGRectMake(80, 100, 100, 100)];
    
    imageViewOne.image = [UIImage imageNamed:@&quot;expression&quot;];
    
    UIImageView *imageViewTwo = [[UIImageView alloc] initWithFrame:CGRectMake(250, 100, 100, 100)];
    
    imageViewTwo.image = [UIImage imageNamed:@&quot;expression&quot;];

    [self.view addSubview:imageViewOne];
    [self.view addSubview:imageViewTwo];
    
    CATransform3D perspective = CATransform3DIdentity; perspective.m34 = - 1.0 / 500.0;
    
    self.view.layer.sublayerTransform = perspective;
    
    CATransform3D transform1 = CATransform3DMakeRotation(M_PI_4, 0, 1, 0);
    
    imageViewOne.layer.transform = transform1;
    
    CATransform3D transform2 = CATransform3DMakeRotation(-M_PI_4, 0, 1, 0);
    
    imageViewTwo.layer.transform = transform2;
}
</code></pre>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/5.Transforms/images/8.png" alt="8"/><br/>
<img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/5.Transforms/images/9.png" alt="9"/><br/>
<img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/5.Transforms/images/10.png" alt="10"/></p>

<h4 id="toc_9">Backfaces</h4>

<blockquote>
<p>æˆ‘ä»¬æ—¢ç„¶å¯ä»¥åœ¨3Dåœºæ™¯ä¸‹æ—‹è½¬å›¾å±‚, å½“ç„¶ä¹Ÿå¯ä»¥ä»èƒŒé¢å»è§‚å¯Ÿå®ƒ, æ¯”å¦‚æˆ‘ä»¬æŠŠç¿»è½¬çš„è§’åº¦è®¾ç½®ä¸º<strong>M_PI</strong>, é‚£ä¹ˆå°±ä¼šæ˜¾ç¤ºä¸€ä¸ªé•œåƒçš„å›¾å±‚, æˆ‘ä»¬æ¥çœ‹çœ‹ä»£ç :</p>
</blockquote>

<pre><code class="language-objectivec">- (void)viewBackfaces {
    UIImageView *imageView = [[UIImageView alloc] initWithFrame:CGRectMake(100, 100, 100, 100)];
    
    imageView.image = [UIImage imageNamed:@&quot;expression&quot;];
    
    [self.view addSubview:imageView];
        
    CATransform3D transform3DIdentity = CATransform3DIdentity;
    transform3DIdentity.m34 = - 1.0 / 500.0;
    transform3DIdentity = CATransform3DRotate(transform3DIdentity, M_PI, 0, 1, 0);
    imageView.layer.transform = transform3DIdentity;
}
</code></pre>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/5.Transforms/images/11.png" alt="11"/><br/>
<img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/5.Transforms/images/12.png" alt="12"/></p>

<h4 id="toc_10">Layer Flattening</h4>

<blockquote>
<p>æœ‰äººä¼šé—®, å¦‚æœæˆ‘ä»¬å¯¹å·²ç»åšè¿‡å˜æ¢çš„å›¾å±‚åšåæ–¹å‘çš„ä¼šå‘ç”Ÿå•¥äº‹?<br/>
<dr/><br/>
åœ¨ç†è®ºä¸Šæ¥è®², æˆ‘ä»¬å¦‚æœå¯¹å†…éƒ¨å›¾å±‚åšäº†ä¸€ä¸ª-45åº¦çš„æ—‹è½¬, å¦‚æœè¦æ¢å¤æ­£å¸¸, åˆ™è¦åšç›¸åçš„å˜æ¢, æ‰èƒ½ç›¸äº’æŠµæ¶ˆ, ä¸ºäº†éªŒè¯ä¸€ä¸‹, æˆ‘ä»¬å…ˆè¯•è¯•:</p>
</blockquote>

<pre><code class="language-objectivec">- (void)viewLayerFlattening {
    
    UIView *view = [[UIView alloc] initWithFrame:CGRectMake(50, 50, 200, 200)];
    view.backgroundColor = [UIColor blueColor];
    
    [self.view addSubview:view];
    
    UIImageView *imageView = [[UIImageView alloc] initWithFrame:CGRectMake(50, 50, 100, 100)];
    
    imageView.image = [UIImage imageNamed:@&quot;expression&quot;];
    
    [view addSubview:imageView];
    
    CATransform3D outer = CATransform3DMakeRotation(M_PI_4, 0, 0, 1);
    view.layer.transform = outer;
    
    CATransform3D inner = CATransform3DMakeRotation(-M_PI_4, 0, 0, 1);
    imageView.layer.transform = inner;
}
</code></pre>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/5.Transforms/images/13.png" alt="13"/><br/>
<img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/5.Transforms/images/14.png" alt="14"/></p>

<blockquote>
<p>çœ‹ç»“æœ, å’Œæˆ‘ä»¬æƒ³è±¡çš„ä¸€æ ·, å†è¯•è¯•å†3Då˜åŒ–çš„æƒ…å†µä¸‹èƒ½ä¸èƒ½æŠµæ¶ˆ, ç»§ç»­çœ‹ä»£ç :</p>
</blockquote>

<pre><code class="language-objectivec">    UIView *view = [[UIView alloc] initWithFrame:CGRectMake(50, 50, 200, 200)];
    view.backgroundColor = [UIColor blueColor];
    
    [self.view addSubview:view];
    
    UIImageView *imageView = [[UIImageView alloc] initWithFrame:CGRectMake(50, 50, 100, 100)];
    
    imageView.image = [UIImage imageNamed:@&quot;expression&quot;];
    
    [view addSubview:imageView];
    
//    CATransform3D outer = CATransform3DMakeRotation(M_PI_4, 0, 0, 1);
//    view.layer.transform = outer;
//    
//    CATransform3D inner = CATransform3DMakeRotation(-M_PI_4, 0, 0, 1);
//    imageView.layer.transform = inner;
    
    // 3D Trans
    CATransform3D outer = CATransform3DIdentity; outer.m34 = -1.0 / 500.0;
    outer = CATransform3DRotate(outer, M_PI_4, 0, 1, 0); view.layer.transform = outer;
    
    CATransform3D inner = CATransform3DIdentity; inner.m34 = -1.0 / 500.0;
    inner = CATransform3DRotate(inner, -M_PI_4, 0, 1, 0); imageView.layer.transform = inner;
</code></pre>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/5.Transforms/images/15.png" alt="15"/><br/>
<img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/5.Transforms/images/16.png" alt="16"/></p>

<blockquote>
<p>è¿™é‡Œæˆ‘å¹¶æ²¡æœ‰ä½¿ç”¨<strong>sublayerTransform</strong>å±æ€§, å› ä¸ºè¿™é‡Œé¢çš„å›¾å±‚å¹¶ä¸æ˜¯å®¹å™¨å›¾å±‚ç›´æ¥çš„å­å›¾å±‚, æ‰€ä»¥è¿™é‡Œåˆ†åˆ«å¯¹å›¾å±‚è®¾ç½®äº†<strong>Perspective Projection</strong>.<br/>
<dr/><br/>
ç»“æœä¹Ÿæ˜¯å’Œæˆ‘ä»¬æ‰€é¢„æœŸçš„ä¸å¤ªä¸€æ ·, è™½ç„¶æŒ‰é“ç†æ¥è®²æ˜¯æ˜¾ç¤ºæ­£å¸¸çš„æ–¹å—, ä½†å®é™…ä¸Šå¹¶ä¸æ˜¯çš„.<br/>
<dr/><br/>
åœ¨<strong>Core Animation</strong>å½“ä¸­, 3Då›¾å±‚å­˜åœ¨äº3Dç©ºé—´ä¹‹å†…, ä½†å®ƒä»¬å¹¶ä¸æ˜¯å­˜åœ¨åŒä¸€ä¸ª, å…¶å®æ¯ä¸€ä¸ªå›¾å±‚çš„3Dåœºæ™¯éƒ½æ˜¯æ‰å¹³åŒ–çš„, å½“æˆ‘ä»¬æ­£é¢è§‚å¯Ÿä¸€ä¸ªå›¾å±‚æ—¶, çœ‹åˆ°çš„å›¾å±‚å…¶å®æ˜¯ç”±å­å›¾å±‚åˆ›å»ºçš„3Dåœºæ™¯, å½“ä½ å€¾æ–œè¿™ä¸ªå›¾å±‚æ—¶, ä¼šå‘ç°è¿™ä¸ª3Dåœºæ™¯åªæ˜¯è¢«ç»˜åˆ¶åœ¨å›¾å±‚çš„è¡¨é¢ç½¢äº†.<br/>
<dr/><br/>
æ€»ä¹‹ä¸€å¥è¯è¯´å®Œ, ç”¨<strong>Core Animation</strong>åˆ›å»ºéå¸¸è´Ÿè´£çš„3Dåœºæ™¯æ˜¯å¾ˆè›‹ç–¼çš„, å› ä¸ºæˆ‘ä»¬ä¸èƒ½ç›´æ¥åˆ›å»ºä¸€ä¸ªä¸ªå›¾å±‚çš„å»å¥—, ç„¶åæ„å»ºæˆä¸€ä¸ª3Dç»“æ„çš„å›¾å±‚å…³ç³», åˆšåˆšä¹Ÿè¯´äº†, åœ¨ç›¸åŒåœºæ™¯ä¸‹ä»»ä½•3Dè¡¨é¢å¿…é¡»å’ŒåŒæ ·çš„å›¾å±‚ä¿æŒä¸€è‡´, è¿™æ˜¯å› ä¸ºæ¯ä¸€ä¸ªçˆ¶è§†å›¾éƒ½æŠŠå®ƒçš„å­è§†å›¾æ‰å¹³åŒ–äº†.<br/>
<dr/><br/>
é‚£è¿™ä¸ªæœ‰åŠæ³•è§£å†³å—? å½“ç„¶æœ‰, ä½¿ç”¨<strong>CALayer</strong>å°±å¯ä»¥å•¦, åœ¨<strong>CALayer</strong>ä¸­, æœ‰ä¸€ä¸ªå«åš<strong>CATransformLayer</strong>çš„å­ç±»å°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜, è¿™ä¸ªåé¢å†è¯´å§.</p>
</blockquote>

<hr/>

<h3 id="toc_11">Solid Objects</h3>

<blockquote>
<p><strong>Solid Objects</strong>ç¿»è¯‘è¿‡æ¥å°±å«åšå›ºä½“å¯¹è±¡, å‰é¢æˆ‘ä»¬æ‡‚å¾—äº†ä¸€ä¸¢ä¸¢çš„3Dç©ºé—´å›¾å±‚å¸ƒå±€, ç°åœ¨æˆ‘ä»¬å°è¯•ç€æ¥åˆ›å»ºä¸€ä¸ªå›ºæ€çš„3Då¯¹è±¡(ä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€è°“çš„éª°å­), ç›´æ¥æ¥çœ‹ä»£ç å§:</p>
</blockquote>

<pre><code class="language-objectivec">- (void)viewSolidObjects {
    
    CATransform3D perspective = CATransform3DIdentity;
    perspective.m34 = -1.0 / 500.0;

    perspective = CATransform3DRotate(perspective, -M_PI_4, 1, 0, 0);
    perspective = CATransform3DRotate(perspective, -M_PI_4, 0, 1, 0);

    self.view.layer.sublayerTransform = perspective;
    
    CATransform3D transform = CATransform3DMakeTranslation(0, 0, 100);

    for (NSInteger i = 0; i &lt; 6; i++) {
        
        UILabel *label = [[UILabel alloc] initWithFrame:CGRectMake(0, 0, 200, 200)];
        
        label.backgroundColor = [UIColor whiteColor];
        label.textColor = [UIColor redColor];
        label.layer.borderColor = [UIColor blackColor].CGColor;
        label.layer.borderWidth = 0.5;
        label.tag = i;
        label.text = [NSString stringWithFormat:@&quot;%ld&quot;, i + 1];
        label.font = [UIFont systemFontOfSize:30];
        label.textAlignment = NSTextAlignmentCenter;
        
        switch (label.tag) {
            case 0: {
                
                [self addLabel:label withTransform:transform];
            }
                break;
            case 1: {
                transform = CATransform3DMakeTranslation(100, 0, 0);
                transform = CATransform3DRotate(transform, M_PI_2, 0, 1, 0);
                [self addLabel:label withTransform:transform];
            }
                break;
            case 2: {
                transform = CATransform3DMakeTranslation(0, -100, 0);
                transform = CATransform3DRotate(transform, M_PI_2, 1, 0, 0);
                [self addLabel:label withTransform:transform];
            }
                break;
            case 3: {
                transform = CATransform3DMakeTranslation(0, 100, 0);
                transform = CATransform3DRotate(transform, -M_PI_2, 1, 0, 0);
                [self addLabel:label withTransform:transform];
            }
                break;
            case 4: {
                transform = CATransform3DMakeTranslation(-100, 0, 0);
                transform = CATransform3DRotate(transform, -M_PI_2, 0, 1, 0);
                [self addLabel:label withTransform:transform];
            }
                break;
            case 5: {
                transform = CATransform3DMakeTranslation(0, 0, -100);
                transform = CATransform3DRotate(transform, M_PI, 0, 1, 0);
                [self addLabel:label withTransform:transform];
            }
                break;
            default:
                break;
        }
    }
}

- (void)addLabel:(UILabel *)label withTransform:(CATransform3D)transform {
    
    [self.view addSubview:label];
    
    CGSize containerSize = self.view.bounds.size;
    label.center = CGPointMake(containerSize.width / 2.0, containerSize.height / 2.0);
    label.layer.transform = transform;
}
</code></pre>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/5.Transforms/images/17.png" alt="17"/><br/>
<img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/5.Transforms/images/18.png" alt="18"/></p>

<h4 id="toc_12">Light and Shadow</h4>

<blockquote>
<p>åˆšåˆšæˆ‘ä»¬å¼„äº†ä¸€ä¸ªçœ‹ä¸Šå»åƒæ˜¯ç«‹æ–¹ä½“çš„, ä½†æ˜¯å®ƒä»¬ä¹‹å‰çš„æ¯ä¸€ä¸ªé¢ä¹‹é—´çš„è¿æ¥å‹æ ¹å°±åˆ†è¾¨ä¸å‡º, è™½ç„¶åœ¨<strong>Core Animation</strong>å¯ä»¥ç”¨3Dæ˜¾ç¤ºå›¾å±‚, ä½†å®ƒå¹¶æ²¡æœ‰å…‰çº¿çš„æ¦‚å¿µ, å¦‚æœè¦è®©è¿™ä¸ªç«‹æ–¹ä½“çœ‹èµ·æ¥æ›´åŠ çš„çœŸå®, é‚£æˆ‘ä»¬å°±è¦æ‰‹åŠ¨ç»™å®ƒåŠ ä¸ªé˜´å½±æ•ˆæœ, è¿™ä¸ªå°±æ ¹æ®è‡ªå·±çš„éœ€æ±‚æ¥çœ‹äº†.<br/>
<dr/><br/>
è¿™é‡Œæˆ‘ä»¬ç®€å•çš„æ¥çœ‹çœ‹äº‹ä¾‹: </p>
</blockquote>

<pre><code class="language-objectivec">- (void)addLightingToLabel:(CALayer *)labelLayer {
    
    CALayer *layer = [CALayer layer];
    layer.frame = labelLayer.bounds;
    
    [labelLayer addSublayer:layer];
    
    CATransform3D transform = labelLayer.transform;
    
    GLKMatrix4 matrix4 = [self matrixFrom3DTransformation:transform];
    GLKMatrix3 matrix3 = GLKMatrix4GetMatrix3(matrix4);
    
    GLKVector3 normal = GLKVector3Make(0, 0, 1);
    normal = GLKMatrix3MultiplyVector3(matrix3, normal);
    normal = GLKVector3Normalize(normal);
    
    GLKVector3 light = GLKVector3Normalize(GLKVector3Make(LIGHT_DIRECTION));
    CGFloat dotProduct = GLKVector3DotProduct(normal, light);
    
    CGFloat shadow = 1 + dotProduct - AMBIENT_LIGHT;
    UIColor *color = [UIColor colorWithWhite:0 alpha:shadow];
    
    layer.backgroundColor = color.CGColor;
}

- (GLKMatrix4)matrixFrom3DTransformation:(CATransform3D)transform {
    GLKMatrix4 matrix = GLKMatrix4Make(transform.m11, transform.m12, transform.m13, transform.m14,
                                       transform.m21, transform.m22, transform.m23, transform.m24,
                                       transform.m31, transform.m32, transform.m33, transform.m34,
                                       transform.m41, transform.m42, transform.m43, transform.m44);
    
    return matrix;
}
</code></pre>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/5.Transforms/images/19.png" alt="19"/><br/>
<img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/5.Transforms/images/20.png" alt="20"/></p>

<h4 id="toc_13">Touch Events</h4>

<blockquote>
<p>è™½ç„¶è¯´æˆ‘ä»¬ç°åœ¨ç”¨çš„æ˜¯<strong>UILabel</strong>, å¦‚æœæˆ‘ä»¬æŠŠ3, 4, 5, 6æ¢æˆ<strong>UIButton</strong>å’Œ<strong>UIView</strong>çš„ç»„åˆ, é‚£4, 5, 6ç‚¹å‡»æŒ‰é’®æ˜¯æ— æ³•è§¦å‘ç‚¹å‡»äº‹ä»¶çš„.<br/>
<dr/><br/>
è¿™æ˜¯å› ä¸ºç”±äºè§†å›¾çš„é¡ºåº, åœ¨ä¹‹å‰æˆ‘ä»¬å°±è¯´è¿‡, ç‚¹å‡»äº‹ä»¶çš„å¤„ç†æ˜¯ç”±è§†å›¾å†çˆ¶è§†å›¾ä¸­çš„é¡ºåºå†³å®šçš„, å¹¶ä¸æ˜¯åœ¨<strong>3Dç©ºé—´</strong>çš„<strong>Zè½´é¡ºåº</strong>ä¸Š.<br/>
<dr/><br/>
ä½†åœ¨è¿™ä¸ªä¾‹å­å½“ä¸­, æˆ‘ä»¬çš„è§†å›¾çš„ç¡®æ˜¯æŒ‰ç…§é¡ºåºæ¥æ·»åŠ çš„, é‚£ä¸ºä»€ä¹ˆæŠŠ4, 5, 6æ¢æˆ<strong>UIButton</strong>å’Œ<strong>UIView</strong>ä¹‹åå°±æ— æ³•å¤„ç†ç‚¹å‡»äº‹ä»¶äº†å‘¢? é‚£æ˜¯å› ä¸ºè¢«å‰é¢çš„ä¸‰ä¸ªè§†å›¾æŒ¡ä½äº†, åœ¨è¡¨é¢ä¸Šæˆªæ–­äº†4, 5, 6çš„ç‚¹å‡»äº‹ä»¶, è¿™ä¸ªæ˜¯å’Œæ™®é€šçš„2Då¸ƒå±€åœ¨æŒ‰é’®ä¸Šè¦†ç›–ç‰©ä½“æ˜¯ä¸€æ ·çš„.<br/>
<dr/><br/>
æˆ‘ä»¬å¯ä»¥æŠŠé™¤äº†3è§†å›¾ä¹‹å¤–çš„è§†å›¾<strong>userInteractionEnabled</strong>å±æ€§éƒ½è®¾ç½®æˆ<strong>NO</strong>, è¿™æ ·å­å°±å¯ä»¥ç¦æ­¢äº‹ä»¶ä¼ é€’, æˆ–è€…é€šè¿‡ç®€å•çš„ä»£ç , æŠŠ<strong>è§†å›¾3</strong>è¦†ç›–åœ¨<strong>è§†å›¾6</strong>ä¸Š, é‚£è¿™æ ·å­æ— è®ºä½ å¦‚ä½•ç‚¹, éƒ½å¯ä»¥ç‚¹å‡»åˆ°æŒ‰é’®äº†.</p>
</blockquote>

<hr/>

<h3 id="toc_14">æ€»ç»“</h3>

<blockquote>
<p>æ€»ç»“ä¸€ä¸‹:<br/>
* AffineTransformsçš„ä½¿ç”¨<br/>
* AffineTransformsçš„æ··åˆå˜æ¢<br/>
* 3D Transformsçš„Perspective Projection<br/>
* 3D Transformsçš„The Vanishing Point<br/>
* 3D Transformsçš„Sublayer Transform<br/>
* 3D Transformsçš„Backfaces<br/>
* 3D Transformsçš„Layer Flattening<br/>
* æœ€åå†æ¥ä¸€ä¸¢ä¸¢çš„Solid Objects</p>
</blockquote>

<hr/>

<h3 id="toc_15">å·¥ç¨‹åœ°å€</h3>

<p>é¡¹ç›®åœ°å€: <a href="https://github.com/CainRun/CoreAnimation">https://github.com/CainRun/CoreAnimation</a></p>

<hr/>

<h3 id="toc_16">æœ€å</h3>

<p><center>ç å­—å¾ˆè´¹è„‘, çœ‹å®˜èµç‚¹é¥­é’±å¯å¥½</center></p>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/WeChatPay-Objective-C/Images/%E5%BE%AE%E4%BF%A1QRC.jpg" alt="å¾®ä¿¡"/></p>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/WeChatPay-Objective-C/Images/%E6%94%AF%E4%BB%98%E5%AE%9DQRC.jpg" alt="æ”¯ä»˜å®"/></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ç©è½¬iOSå¼€å‘ï¼š4.ã€ŠCore Animationã€‹CALayerçš„è§†è§‰æ•ˆæœ]]></title>
    <link href="https://cainrun.github.io/14775511877452.html"/>
    <updated>2016-10-27T14:53:07+08:00</updated>
    <id>https://cainrun.github.io/14775511877452.html</id>
    <content type="html"><![CDATA[
<h3 id="toc_0">ä½œè€…æ„Ÿè¨€</h3>

<blockquote>
<p>å‰ä¸€ç« æˆ‘ä»¬å¯¹<strong>CALayer</strong>äº†è§£çš„æ›´åŠ æ·±å…¥äº†ä¸€äº›<a href="https://cainrun.github.io/14773198375857.html">ã€ŠCore Animationã€‹CALayerçš„å‡ ä½•å›¾å±‚</a>ä»Šå¤©æˆ‘ä»¬å°±æ¥è®²è®²<strong>CALayer Visual Effects</strong>, ä¹Ÿå°±æ˜¯<strong>CALayer</strong>çš„è§†è§‰æ•ˆæœ.</p>

<p><dr/><br/>
<strong><font color=purple>æœ€å:</font></strong><br/>
<strong><font color=purple>å¦‚æœä½ æœ‰æ›´å¥½çš„å»ºè®®æˆ–è€…å¯¹è¿™ç¯‡æ–‡ç« æœ‰ä¸æ»¡çš„åœ°æ–¹, è¯·è”ç³»æˆ‘, æˆ‘ä¼šå‚è€ƒä½ ä»¬çš„æ„è§å†è¿›è¡Œä¿®æ”¹, è”ç³»æˆ‘æ—¶, è¯·å¤‡æ³¨</strong><code>Core Animation</code><strong>å¦‚æœè§‰å¾—å¥½çš„è¯, å¸Œæœ›å¤§å®¶ä¹Ÿå¯ä»¥æ‰“èµä¸€ä¸‹~å˜»å˜»~ç¥å¤§å®¶å­¦ä¹ æ„‰å¿«~è°¢è°¢~</font></strong></p>
</blockquote>

<span id="more"></span><!-- more -->

<hr/>

<h3 id="toc_1">ç®€ä»‹</h3>

<blockquote>
<p><strong>CALayer Visual Effects</strong>è®²å¾—æ˜¯<strong>CALayer</strong>ä¸€äº›æˆ‘ä»¬èƒ½å¤Ÿçœ‹å¾—è§çš„ä¸œè¥¿, è¿™äº›çŸ¥è¯†ç‚¹åœ¨æˆ‘ä»¬æ—¥å¸¸å¼€å‘ä¸­ä¹Ÿä¼šæœ‰ç”¨åˆ°çš„, æ¯”å¦‚<strong>Rounded Corners</strong>, <strong>Layer Borders</strong>, <strong>Drop Shadows</strong>, <strong>Layer Masking</strong>, <strong>Scaling Filters</strong>, <strong>Group Opacity</strong>ç­‰ç­‰, å¾…æˆ‘ä»¬ä¸€ä¸€å»è®²è§£.</p>
</blockquote>

<hr/>

<h3 id="toc_2">Rounded Corners</h3>

<blockquote>
<p><strong>Rounded Corners</strong>è¿™ä¸ªä¸œè¥¿æˆ‘ä»¬ç”¨çš„å…¶å®ä¹Ÿæ˜¯æŒºå¤šçš„, æˆ‘ä»¬éƒ½çŸ¥é“, åœ¨<strong>iOS 7</strong>ä¹‹å‰, åŸºæœ¬ä¸Šæ‰€æœ‰çš„<strong>Button</strong>éƒ½æ˜¯æ¤­åœ†å½¢çš„, è€Œè¿™äº›<strong>Button</strong>ä¹‹æ‰€ä»¥éƒ½æ˜¯æ¤­åœ†å½¢, å¤§å¤šæ•°éƒ½æ˜¯å› ä¸º<strong>Rounded Corners</strong>è¿™ä¸ªä¸œè¥¿çš„åŸå› .<br/>
<dr/><br/>
åœ¨<strong>CALayer</strong>æœ‰ä¸€ä¸ªå«<strong>conrnerRadius</strong>çš„CGFloatç±»å‹å±æ€§æ¥æ§åˆ¶ç€å›¾å±‚è§’çš„æ›²ç‡, é»˜è®¤å€¼ä¸º0, ä½ å¯ä»¥è®¾ç½®ä»»æ„æ•°å€¼, æ˜¯çš„å›¾å±‚è§’æ˜¾ç¤ºä¸ä¸€æ ·çš„æ›²ç‡, è€Œä¸”<strong>conrnerRadius</strong>è¿™ä¸ªå±æ€§æ‰€å½±å“çš„åˆ°çš„åªæœ‰è®¾ç½®è¯¥å±æ€§çš„<strong>CALayer</strong>, å¹¶ä¸ä¼šå½±å“åˆ°å­å›¾å±‚æˆ–è€…æ˜¯èƒŒæ™¯å›¾, ä½†å¦‚æœä½ è¦è®©å­å›¾å±‚æˆ–è€…æ˜¯èƒŒæ™¯å›¾ä¹Ÿè¦è·Ÿç€è¯¥<strong>CALayer</strong>è¿›è¡Œæ›²ç‡å¤„ç†, ä½ å¯ä»¥æŠŠ<strong>masksToBounds</strong>è®¾ç½®ä¸º<strong>YES</strong>, è¿™æ ·å­å°±å¯ä»¥æ»¡è¶³ä½ çš„éœ€æ±‚äº†.<br/>
<dr/><br/>
æˆ‘ä»¬ç›´æ¥æ¥çœ‹çœ‹Demoå§:</p>
</blockquote>

<pre><code class="language-objectivec">- (void)layerRoundedCorners {
    
    UIView *view = [[UIView alloc] initWithFrame:CGRectMake(100, 100, 100, 100)];
    
    view.backgroundColor = [UIColor redColor];
    view.layer.cornerRadius = 50.f;
    view.layer.masksToBounds = YES;
    
    CALayer *layer = [CALayer layer];
    
    layer.backgroundColor = [UIColor blueColor].CGColor;
    layer.frame = CGRectMake(50, 50, 50, 50);
    
    [view.layer addSublayer:layer];
    [self.view addSubview:view];
}
</code></pre>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/4.VisualEffects/images/1.png" alt="1"/></p>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/4.VisualEffects/images/2.png" alt="2"/></p>

<blockquote>
<p><strong><font color=red>PS: è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ç‚¹, ç”±äº</strong>masksToBounds<strong>å’Œ</strong>conrnerRadius<strong>è¿™ä¸¤ä¸ªå±æ€§åŒæ—¶ä½¿ç”¨æ˜¯æŒºæ¶ˆè€—æ€§èƒ½çš„, å¦‚æœä½ æ˜¯è¦å¤§é¢ç§¯çš„å»ä½¿ç”¨, ä¼šé€ æˆå¡é¡¿ç°è±¡, æ¯”å¦‚è¯´åœ¨</strong>UICollectionView<strong>æˆ–è€…æ˜¯</strong>UITableView<strong>ä¸Šä½¿ç”¨.</font></strong></p>
</blockquote>

<hr/>

<h3 id="toc_3">Layer Borders</h3>

<blockquote>
<p><strong>CALayer</strong>è¿˜æœ‰ä¸¤ä¸ªæ›´å¥½ç©çš„å±æ€§, è¿™ä¹Ÿæ˜¯åœ¨<strong>iOS 7</strong>ä¹‹å‰<strong>Button</strong>ä¼šé»˜è®¤å®ç°çš„ä¸¤ä¸ªå±æ€§, ä¸€ä¸ªå«åš<strong>borderWidth</strong>, ä¸€ä¸ªå«åš<strong>borderColor</strong>.<br/>
<dr/></p>

<ul>
<li><strong>borderWidth</strong>: è¿™æ˜¯ä¸€ä¸ª<strong>CGFloat</strong>ç±»å‹çš„å±æ€§, æ˜¯ç”¨æ¥è®¾ç½®<strong>CALayer</strong>è¾¹æ¡†å®½åº¦, é»˜è®¤å€¼æ˜¯ä¸º0.</li>
<li><strong>borderColor</strong>: è¿™æ˜¯ä¸€ä¸ª<strong>CGColorRef</strong>ç±»å‹çš„å±æ€§, æ‰€ä»¥ä½ ä¸èƒ½ç»™å®ƒç›´æ¥è®¾ç½®ä¸€ä¸ª<strong>UIColor</strong>å¯¹è±¡, å‰é¢æˆ‘ä»¬å·²ç»å¯¹<strong>CGColorRef</strong>è¿™ä¸ªä¸œä¸œè¿›è¡Œäº†ç®€å•çš„ä»‹ç», è¿™é‡Œæˆ‘ä»¬åªéœ€è¦çŸ¥é“ç›´æ¥ç»™å®ƒèµ‹ä¸ªå€¼å°±å¥½äº†, è¿˜æœ‰å°±æ˜¯<strong>borderColor</strong>æ˜¯ç”¨æ¥è®¾ç½®<strong>CALayer</strong>è¾¹æ¡†é¢œè‰², åœ¨<strong>iOS 7</strong>ä¹‹å‰é»˜è®¤å€¼æ˜¯ä¸ºé»‘è‰², <strong>iOS 7</strong>ä¹‹åé»˜è®¤å€¼æ˜¯ä¸ºé€æ˜.</li>
</ul>

<p><dr/><br/>
æˆ‘ä»¬ç›´æ¥æ¥çœ‹Demoå§:</p>
</blockquote>

<pre><code class="language-objectivec">- (void)layerBorders {
    
    UIView *view = [[UIView alloc] initWithFrame:CGRectMake(100, 100, 100, 100)];
    
    view.backgroundColor = [UIColor blueColor];
    view.layer.borderWidth = 5.f;
    view.layer.borderColor = [UIColor redColor].CGColor;
    
    [self.view addSubview:view];
}
</code></pre>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/4.VisualEffects/images/3.png" alt="3"/></p>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/4.VisualEffects/images/4.png" alt="4"/></p>

<hr/>

<h3 id="toc_4">Drop Shadows</h3>

<blockquote>
<p>åœ¨<strong>iOS</strong>å½“ä¸­, è¿˜æœ‰ä¸€ä¸ªç‰¹æ€§, å«åš<strong>Drop Shadows(é˜´å½±)</strong>, å…¶å®è¿™ä¸ªä¹Ÿä¸ç®—æ˜¯<strong>iOS</strong>ç‰¹æœ‰çš„, æ¯•ç«Ÿåœ¨<strong>Mac OS</strong>é‡Œæ—©å°±å·²ç»æœ‰è¿™ä¸ªç‰¹æ€§äº†.<br/>
<dr/><br/>
é˜´å½±å¾€å¾€æ˜¯èµ·æš—ç¤ºä½œç”¨, æ¯”å¦‚è¯´ä½ ç°åœ¨æ­£åœ¨æ˜¾ç¤ºçš„çª—å£, å‘¨è¾¹å°±ä¼šå¸¦ä¸Šé˜´å½±, æˆ–è€…æ˜¯å¼ºè°ƒé‡Œé¢çš„æŸä¸ªå›¾å±‚çš„ä¼˜å…ˆçº§, å¤§å¤šæ•°æ—¶å€™åªæ˜¯ç”¨æ¥è£…é¥°ç½¢äº†.<br/>
<dr/><br/>
è®¾ç½®é˜´å½±çš„æ—¶å€™ä¹Ÿæ˜¯å¾ˆç®€å•, ç›´æ¥ç»™<strong>shadowOpacity</strong>å±æ€§è®¾ç½®ä¸€ä¸ªå¤§äº<strong>0.0</strong>çš„å€¼å°±å¥½äº†, <strong>shadowOpacity</strong>è¿™ä¸ªå±æ€§å¯è®¾ç½®çš„å€¼æ˜¯åœ¨<strong>0.0~1.0</strong>ä¹‹é—´, é»˜è®¤æ˜¯<strong>0.f</strong>, æœ€å¤§å€¼æ˜¯<strong>1.f</strong>, å¦‚æœç›´æ¥è®¾ç½®ä¸º<strong>1.f</strong>, é‚£ä¹ˆå°†ä¼šæ˜¾ç¤ºä¸€ä¸ªè½»å¾®æ¨¡ç³Šçš„é»‘è‰²é˜´å½±åœ¨å›¾å±‚çš„ä¸Šæ–¹, å¦å¤–, ä½ å¯ä»¥é€šè¿‡<strong>CALayer</strong>æ‰€æä¾›çš„<strong>shadowColor</strong>, <strong>shadowOffset</strong>, <strong>shadowRadius</strong>å¯¹é˜´å½±è¿›è¡Œä¸€äº›é¢å¤–çš„æ“ä½œ, è¿™é‡Œå°±ä¸ä¸€ä¸€ä»‹ç»äº†, å„ä½ç«¥é‹ä»¬å¯ä»¥è‡ªè¡Œå°è¯•ä¸€ä¸‹~<br/>
<dr/><br/>
è¯´åˆ°è¿™é‡Œ, ä¼šæœ‰äººé—®, ä¸ºä»€ä¹ˆé˜´å½±æ˜¯åœ¨å›¾å±‚çš„ä¸Šæ–¹å‘¢? å…¶å®åœ¨ä¹‹å‰æˆ‘ä»¬å°±æœ‰äº†è§£è¿‡Mac OSå’ŒiOSçš„ä¸€äº›ä¸œè¥¿, åŸºæœ¬ä¸ŠiOSçš„ä¸€äº›ä¸œè¥¿éƒ½æ˜¯ä»Mac OSæ¬è¿‡æ¥, ç„¶åå†æ”¹æ”¹çš„, åŒ…æ‹¬è¿™ä¸ªé˜´å½±ä¹Ÿæ˜¯å¦‚æ­¤, æ‰€ä»¥ä½ æ‰ä¼šçœ‹åˆ°åœ¨iOSå½“ä¸­é˜´å½±æ˜¯åè¿‡æ¥çš„, è¿™é‡Œæˆ‘ä»¬åªéœ€è¦è®¾ç½®ä¸€ä¸‹<strong>shadowOffset</strong>å°±å¯ä»¥æ­£å¸¸æ˜¾ç¤ºäº†.<br/>
<dr/><br/>
ç›´æ¥çœ‹Demoå§:</p>
</blockquote>

<pre><code class="language-objectivec">- (void)layerDropShadows {
    
    UIView *view = [[UIView alloc] initWithFrame:CGRectMake(100, 100, 100, 100)];
    
    view.backgroundColor = [UIColor redColor];
    view.layer.shadowOpacity = 1.0f;
    view.layer.shadowOffset = CGSizeMake(0, 3);
    view.layer.shadowRadius = 10.f;
    view.layer.shadowColor = [UIColor blueColor].CGColor;
    
    [self.view addSubview:view];
}
</code></pre>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/4.VisualEffects/images/5.png" alt="5"/></p>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/4.VisualEffects/images/6.png" alt="6"/></p>

<h4 id="toc_5">Shadow Clipping</h4>

<blockquote>
<p>è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªæ¯”è¾ƒå¥½ç©çš„ä¸œè¥¿, å°±æ˜¯é˜´å½±å‰ªåˆ‡, æˆ‘ä»¬éƒ½çŸ¥é“<strong>CALayer</strong>è¶…å‡ºäº†<strong>UIView</strong>çš„èŒƒå›´, å¦‚æœè¦å‰ªåˆ‡æ‰çš„è¯, åªèƒ½ç”¨<strong>masksToBounds</strong>è¿™ä¸ªå±æ€§å»å‰ªåˆ‡.<br/>
<dr/><br/>
ä½†è¿™æ ·å­ä¼šå¸¦æ¥å¦ä¸€ä¸ªçš„é—®é¢˜, å› ä¸ºä¸€æ—¦ä½¿ç”¨<strong>masksToBounds</strong>è¿™ä¸ªå±æ€§, å‰ªåˆ‡æ‰çš„å°±ä¸åªæ˜¯å¤šå‡ºæ¥çš„éƒ¨åˆ†, ä¼šè¿é˜´å½±éƒ¨åˆ†éƒ½ä¸€èµ·å‰ªåˆ‡å®Œ, ä¸ºäº†é˜²æ­¢é˜´å½±ä¹Ÿè·Ÿç€è¢«å‰ªåˆ‡æ‰, æˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸€ä¸ªæ¯”è¾ƒç¬¨çš„æ–¹æ³•, å°±æ˜¯å†åˆ›å»ºå¤šä¸€ä¸ª<strong>CALayer</strong>, è®©å®ƒå»åˆ›å»ºé˜´å½±éƒ¨åˆ†, å¦ä¸€ä¸ª<strong>CALayer</strong>å»å‰ªåˆ‡å†…å®¹å°±å¯ä»¥äº†.<br/>
<dr/><br/>
æˆ‘ä»¬è¿˜æ˜¯ç›´æ¥çœ‹Demoå§:</p>
</blockquote>

<pre><code class="language-objectivec">- (void)layerShadowClipping {
    
    UIView *contentView = [[UIView alloc] initWithFrame:CGRectMake(0, 0, 100, 100)];
    UIView *blueView = [[UIView alloc] initWithFrame:CGRectMake(50, 50, 100, 100)];
    UIView *shadowView = [[UIView alloc] initWithFrame:CGRectMake(100, 100, 100, 100)];
    
    contentView.backgroundColor = [UIColor grayColor];
    blueView.backgroundColor = [UIColor blueColor];
    
    contentView.layer.masksToBounds = YES;
    
    shadowView.layer.shadowOpacity = 1.0f;
    shadowView.layer.shadowOffset = CGSizeMake(0, 0.5f);
    shadowView.layer.shadowColor = [UIColor redColor].CGColor;

    [contentView addSubview:blueView];
    [shadowView addSubview:contentView];
    
    [self.view addSubview:shadowView];
}
</code></pre>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/4.VisualEffects/images/7.png" alt="7"/></p>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/4.VisualEffects/images/8.png" alt="8"/></p>

<h4 id="toc_6">shadowPath</h4>

<blockquote>
<p>æˆ‘ä»¬éƒ½çŸ¥é“å…¶å®é˜´å½±æ˜¯æ²¡æœ‰å½¢æ€çš„, å®ƒæ˜¯æ ¹æ®å›¾å±‚çš„å½¢çŠ¶æ¥è¿›è¡Œæ˜¾ç¤º, å¦‚æœåœ¨ä¸€ä¸ªè§†å›¾å½“ä¸­æœ‰å¾ˆå¤šå­å›¾å±‚, ç„¶åè¦ä¸€ä¸ªä¸€ä¸ªçš„å»è®¡ç®—é˜´å½±çš„å½¢çŠ¶, é‚£æ˜¯éå¸¸è€—æ€§èƒ½çš„, ä½†å¦‚æœåœ¨å¼€å‘ä¹‹å‰ä½ å°±å·²ç»çŸ¥é“é˜´å½±çš„å½¢çŠ¶, é‚£ä¹ˆä½ å°±å¯ä»¥æå‰è®¾ç½®å¥½, è¿™æ ·å­å°±å¯ä»¥ä¼˜åŒ–æ€§èƒ½äº†, è€Œè¿™ä¸ªå±æ€§å°±æ˜¯<strong>shadowPath</strong>, <br/>
<dr/><br/>
<strong>shadowPath</strong>æ˜¯<strong>CGPathRef</strong>ç±»å‹, å¯ä»¥è¯´æ˜¯ä¸€ä¸ªæŒ‡å‘<strong>CGPath</strong>çš„æŒ‡é’ˆ, è€Œ<strong>CGPath</strong>æ˜¯ä¸€ä¸ª<strong>Core Graphics</strong>å¯¹è±¡, å¯ä»¥ç”¨æ¥ä»»æ„æç»˜ä¸€ä¸ªçŸ¢é‡å›¾å½¢, æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨å®ƒæ¥æç»˜é˜´å½±, å¤§å¤§çš„æå‡æ€§èƒ½.<br/>
<dr/><br/>
æˆ‘ä»¬ç›´æ¥æ¥çœ‹Demoå§:</p>
</blockquote>

<pre><code class="language-objectivec">- (void)layerShadowPath {
    
    UIView *shadowViewOne = [[UIView alloc] initWithFrame:CGRectMake(50, 50, 100, 100)];
    UIView *shadowViewTwo = [[UIView alloc] initWithFrame:CGRectMake(50, 250, 100, 100)];

    shadowViewOne.layer.shadowOpacity = 0.5f;
    shadowViewTwo.layer.shadowOpacity = 0.5f;
    
    CGMutablePathRef squarePath = CGPathCreateMutable();
    CGPathAddRect(squarePath, NULL, shadowViewOne.bounds);
    shadowViewOne.layer.shadowPath = squarePath;
    
    CGPathRelease(squarePath);
    
    CGMutablePathRef circlePath = CGPathCreateMutable();
    CGPathAddEllipseInRect(circlePath, NULL, shadowViewTwo.bounds);
    shadowViewTwo.layer.shadowPath = circlePath;
    
    CGPathRelease(circlePath);

    [self.view addSubview:shadowViewOne];
    [self.view addSubview:shadowViewTwo];
}
</code></pre>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/4.VisualEffects/images/9.png" alt="9"/></p>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/4.VisualEffects/images/10.png" alt="10"/></p>

<hr/>

<h3 id="toc_7">Layer Masking</h3>

<blockquote>
<p>æˆ‘ä»¬éƒ½çŸ¥é“å¦‚æœæˆ‘ä»¬è¦å‰ªåˆ‡è¶…å‡ºèŒƒå›´çš„å›¾å±‚å¯ä»¥ä½¿ç”¨<strong>masksToBounds</strong>, é€šè¿‡<strong>conrnerRadius</strong>å¯ä»¥è®¾ç½®å›¾å±‚ä¸ºåœ†è§’, ä½†å¦‚æœä½ éœ€è¦è®¾ç½®ä¸€ä¸ªä¸è§„æ•´çš„å›¾å±‚æ—¶, ç”¨ä¸Šé¢çš„ä¸¤ä¸ªå±æ€§æ˜¯æ²¡æ³•å®ç°çš„.<br/>
<dr/><br/>
è™½ç„¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ª<strong>32ä½</strong>ä¸”å¸¦æœ‰<strong>alpha</strong>é€šé“çš„<strong>png</strong>å›¾ç‰‡å¯ä»¥å®ç°, ä½†è¿™ä¸ªæ–¹æ³•ä¹Ÿæ˜¯æœ‰å±€é™çš„, ä¸èƒ½ä»¥åŠ¨æ€ç¼–ç çš„å½¢å¼ç”Ÿæˆè’™ç‰ˆ, ä¹Ÿä¸èƒ½è®©å­å›¾å±‚æˆ–è€…å­è§†å›¾ä¹Ÿè£å‰ªæˆåŒæ ·çš„å½¢çŠ¶.<br/>
<dr/><br/>
è‹¹æœä¸ºäº†è§£å†³è¿™ä¸ªä¸ºé¢˜, åœ¨<strong>CALayer</strong>å½“ä¸­æä¾›äº†ä¸€ä¸ª<strong>CGLayer</strong>ç±»å‹, åå«<strong>mask</strong>çš„å±æ€§, æœ‰ç€å’Œå…¶ä»–CALayerä¸€æ ·çš„å¸ƒå±€å±æ€§, å®ƒå°±åƒæ˜¯ä¸€ä¸ªå­å›¾å±‚, ç›¸å¯¹äºçˆ¶å›¾å±‚æ¥è¿›è¡Œå¸ƒå±€çš„, ä½†å®ƒåˆåŒºåˆ«äºå­å›¾å±‚, å®ƒæ˜¯å®šä¹‰çˆ¶å›¾å±‚å¯è§éƒ¨åˆ†çš„.<br/>
<dr/><br/>
è™½ç„¶<strong>mask</strong>é‡Œä¹Ÿæœ‰<strong>Color</strong>è¿™ä¸ªå±æ€§, ä½†å®ƒå¹¶æ²¡å•¥ç”¨, çœŸæ­£é‡è¦çš„æ˜¯å›¾å±‚çš„è½®å»“, å®ƒå°±åƒæ˜¯ä¸€å°åˆ‡å‰²æœºä¸€æ ·, å®å¿ƒå›¾å±‚éƒ¨åˆ†ä¼šè¢«ä¿ç•™, å…¶ä»–çš„å°±ä¼šä½œä¸ºåƒåœ¾ä¸€æ ·è¢«æŠ›å¼ƒ.<br/>
<dr/><br/>
æˆ‘ä»¬ç›´æ¥æ¥çœ‹Demoå§:</p>
</blockquote>

<pre><code class="language-objectivec">- (void)layerMasking {
    
    UIImageView *imageView = [[UIImageView alloc] initWithFrame:CGRectMake(100, 100, 100, 100)];
    
    imageView.image = [UIImage imageNamed:@&quot;arrow&quot;];
    
    CALayer *maskLayer = [CALayer layer];
    UIImage *maskImage = [UIImage imageNamed:@&quot;star&quot;];
    
    maskLayer.frame = imageView.bounds;
    maskLayer.contents = (__bridge id _Nullable)(maskImage.CGImage);
    
    imageView.layer.mask = maskLayer;
    
    [self.view addSubview:imageView];
}
</code></pre>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/4.VisualEffects/images/11.png" alt="11"/></p>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/4.VisualEffects/images/12.png" alt="12"/></p>

<hr/>

<h3 id="toc_8">Scaling Filters</h3>

<blockquote>
<p>è¿™é‡Œæˆ‘ä»¬æåŠä¸€ä¸ªç‚¹, æ˜¯å…³äºå›¾ç‰‡æ˜¾ç¤ºçš„ä¸€ä¸ªé—®é¢˜, æˆ‘ä»¬éƒ½çŸ¥é“å¦‚æœè¦è®©ä¸€ä¸ª<strong>CALayer</strong>æ˜¾ç¤ºä¸€å¼ å›¾ç‰‡æ˜¯ç›´æ¥ç»™å®ƒçš„<strong>contents</strong>ç›´æ¥è®¾ç½®å†…å®¹, ä½†æ˜¯å‘¢, è¿™ä¸ªå›¾ç‰‡æ˜¯å¦æ­£ç¡®çš„æ˜¾ç¤º, ç”»è´¨å¦‚ä½•, æˆ‘ä»¬éƒ½æ— ä»è€ŒçŸ¥.<br/>
<dr/><br/>
ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜,<strong>CALayer</strong>åˆ†åˆ«æä¾›äº†<strong>minificationFilter</strong>å’Œ<strong>magnificationFilter</strong>å±æ€§, å®ƒä»¬éƒ½æ˜¯<strong>NSString</strong>ç±»å‹, è¯´åˆ°è¿™é‡Œ, æœ‰äººä¼šç–‘é—®, ç›´æ¥æ˜¾ç¤ºä¸å°±æ˜¯æœ€å¥½çš„ä¹ˆ, ä¸ºå•¥è¦é‚£ä¹ˆéº»çƒ¦, å…¶å®ä¸ä¸€å®šçš„, åŸå› çš„è¯, å¤§æ¦‚æœ‰ä¸‰ç‚¹å§:<br/>
<dr/></p>

<ul>
<li>èƒ½å¤Ÿæ˜¾ç¤ºæœ€å¥½çš„ç”»è´¨, æŒ‡çš„æ˜¯åƒç´ æ²¡æœ‰è¢«å‹ç¼©ä¹Ÿæ²¡æœ‰è¢«æ‹‰ä¼¸.</li>
<li>å¯ä»¥èŠ‚çœèµ„æº, æ¯”å¦‚ç¥é©¬å†…å­˜, å­˜å‚¨ä¹‹ç±»çš„.</li>
<li>å¯ä»¥ä¼˜åŒ–æ€§èƒ½, å‡è½»CPUçš„å‹åŠ›.
<dr/></li>
</ul>

<p>æ‰“ä¸ªæ¯”æ–¹, æ¯”å¦‚æˆ‘ä»¬å¼€å‘çš„æ—¶å€™, æœ‰ä¸ªå¤´åƒçœç•¥å›¾, è¿™ä¸ªæ—¶å€™å‘¢, ä½ è¯´æ˜¯ç”¨å…¨å›¾æ¯”è¾ƒå¥½, è¿˜æ˜¯å‹ç¼©è¿‡çš„æ¯”è¾ƒå¥½? ç­”æ¡ˆè‚¯å®šæ˜¯å‹ç¼©è¿‡çš„æ¯”è¾ƒå¥½, å› ä¸ºå¯ä»¥çœèµ„æº.<br/>
<dr/><br/>
é¡ºä¾¿è¯´è¯´, è¿™ä¸¤ä¸ªå±æ€§å¯è®¾ç½®çš„å€¼åˆ†åˆ«æ˜¯:</p>

<ul>
<li>kCAFilterLinear(é»˜è®¤å€¼)</li>
<li>kCAFilterNearest</li>
<li>kCAFilterTrilinear
<dr/>
è¯´é‚£ä¹ˆå¤š, ç›´æ¥æ¥çœ‹Demoå§:</li>
</ul>
</blockquote>

<pre><code class="language-objectivec">- (void)layerScalingFilters {
    
    UIImageView *imageViewOne = [[UIImageView alloc] initWithFrame:CGRectMake(0, 100, self.view.bounds.size.width / 2, 200)];
    UIImageView *imageViewTwo = [[UIImageView alloc] initWithFrame:CGRectMake(self.view.bounds.size.width / 2, 100, self.view.bounds.size.width / 2, 200)];
    UIImageView *imageViewThree = [[UIImageView alloc] initWithFrame:CGRectMake(0, 300, self.view.bounds.size.width / 2, 200)];
    
    imageViewOne.image = [UIImage imageNamed:@&quot;expression&quot;];
    imageViewTwo.image = [UIImage imageNamed:@&quot;expression&quot;];
    imageViewThree.image = [UIImage imageNamed:@&quot;expression&quot;];

    imageViewOne.layer.magnificationFilter = kCAFilterNearest;
    imageViewTwo.layer.magnificationFilter = kCAFilterLinear;
    imageViewThree.layer.magnificationFilter = kCAFilterTrilinear;

    imageViewOne.layer.minificationFilter = kCAFilterNearest;
    imageViewTwo.layer.minificationFilter = kCAFilterLinear;
    imageViewThree.layer.minificationFilter = kCAFilterTrilinear;
    
    [self.view addSubview:imageViewOne];
    [self.view addSubview:imageViewTwo];
    [self.view addSubview:imageViewThree];
}
</code></pre>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/4.VisualEffects/images/13.png" alt="13"/></p>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/4.VisualEffects/images/14.png" alt="14"/></p>

<blockquote>
<p>é¢...è¿™ä¸ªæœ‰äº›å°´å°¬, çœ‹èµ·æ¥çš„æ•ˆæœåŒºåˆ«ä¸å¤ªå¤§...å‡‘åˆç€çœ‹å§..</p>
</blockquote>

<hr/>

<h3 id="toc_9">Group Opacity</h3>

<blockquote>
<p>æœ€å, æˆ‘ä»¬æ¥è¯´è¯´<strong>Group Opacity</strong>è¿™ä¸ªä¸œè¥¿, åœ¨<strong>iOS 7</strong>ä¹‹å‰, å¦‚æœä½ åœ¨ä¸€ä¸ª<strong>Button</strong>ä¸Šæ·»åŠ ä¸€ä¸ªè§†å›¾, åœ¨<strong>alpha</strong>è®¾ç½®ä¸º<strong>50%</strong>çš„æƒ…å†µä¸‹ä¼šå‡ºç°å›¾å±‚æœ‰åˆ†å‰², éœ€è¦è®¾ç½®<strong>shouldRasterize</strong>å’Œ<strong>rasterizationScale</strong>ä¸¤ä¸ªå±æ€§æ‰èƒ½ä½¿å¾—åœ¨åŠé€æ˜çš„æƒ…å†µä¸‹çœ‹èµ·æ¥æ˜¯ä¸€ä½“, ä½†æ˜¯è¿™ä¸ªé—®é¢˜åœ¨<strong>iOS 7</strong>ä¹‹åå°±å·²ç»è§£å†³äº†, ç°åœ¨<strong>shouldRasterize</strong>å±æ€§æ›´å¤šçš„æ˜¯ç”¨æ¥è§£å†³<strong>UITableView</strong>é‡Œçš„<strong>CALayer</strong>åœ†è§’æ˜¾ç¤ºå›¾å±‚çš„å¤„ç†, è¿™é‡Œå°±ä¸åšå¤šçš„è§£é‡Šäº†, æœ‰å…´è¶£çš„ç«¥é‹ä»¬å¯ä»¥å»è°·æ­Œæœæœ<strong>shouldRasterize</strong>çš„ç”¨æ³•, éƒ½æ˜¯æŒºç®€å•çš„~</p>
</blockquote>

<hr/>

<h3 id="toc_10">æ€»ç»“</h3>

<blockquote>
<p>æ€»ç»“ä¸€ä¸‹, è¿™ä¸€ç« æˆ‘ä»¬äº†è§£æ›´å¤šçš„æ˜¯<strong>CALayer</strong>è‚‰çœ¼ä¸Šèƒ½çœ‹åˆ°çš„ä¸œè¥¿, æ¯”å¦‚:<br/>
<br/></p>

<ul>
<li><strong>Rounded Corners</strong>: åœ¨è¿™ä¸ªçŸ¥è¯†ç‚¹é‡Œ, æˆ‘ä»¬äº†è§£äº†<strong>CALayer</strong>åœ†è§’çš„å¤„ç†.</li>
<li><strong>Layer Borders</strong>: åœ¨è¿™ä¸ªçŸ¥è¯†ç‚¹é‡Œ, æˆ‘ä»¬äº†è§£äº†<strong>CALayer</strong>è¾¹æ¡†çš„å¤„ç†, åŒ…æ‹¬è¾¹æ¡†çš„åšåº¦, ä»¥åŠé¢œè‰²ç­‰</li>
<li><strong>Drop Shadows</strong>: åœ¨è¿™ä¸ªçŸ¥è¯†ç‚¹é‡Œ, æˆ‘ä»¬çŸ¥é“äº†<strong>CALayer</strong>é˜´å½±çš„å¤„ç†.</li>
<li><strong>Layer Masking</strong>: åœ¨è¿™ä¸ªçŸ¥è¯†ç‚¹é‡Œ, æˆ‘ä»¬äº†è§£äº†<strong>CALayer</strong>å¯ä»¥ä½œä¸ºä¸€ä¸ª<strong>mask</strong>å»ä½¿ç”¨, å¹¶ä¸”å¯ä»¥æ˜¾ç¤ºä¸åŒä¸è§„åˆ™çš„å½¢çŠ¶.</li>
<li><strong>Scaling Filters</strong>: åœ¨è¿™ä¸ªçŸ¥è¯†ç‚¹é‡Œ, æˆ‘ä»¬çŸ¥é“<strong>CALayer</strong>å¯ä»¥æ›´æ”¹æ˜¾ç¤ºçš„ç”»è´¨, ä¼˜åŒ–æ˜¾ç¤ºçš„èµ„æºç­‰ç­‰.</li>
<li><strong>Group Opacity</strong>: åœ¨è¿™ä¸ªçŸ¥è¯†ç‚¹é‡Œ, è™½ç„¶åœ¨<strong>iOS 7</strong>ä¹‹åå·²ç»è§£å†³äº†è¿™ä¸ªé—®é¢˜, ä½†æˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠ<strong>shouldRasterize</strong>å±æ€§è¿ç”¨åœ¨å…¶ä»–çš„åœ°æ–¹.</li>
</ul>
</blockquote>

<hr/>

<h3 id="toc_11">å·¥ç¨‹åœ°å€</h3>

<p>é¡¹ç›®åœ°å€: <a href="https://github.com/CainRun/CoreAnimation">https://github.com/CainRun/CoreAnimation</a></p>

<hr/>

<h3 id="toc_12">æœ€å</h3>

<p><center>ç å­—å¾ˆè´¹è„‘, çœ‹å®˜èµç‚¹é¥­é’±å¯å¥½</center></p>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/WeChatPay-Objective-C/Images/%E5%BE%AE%E4%BF%A1QRC.jpg" alt="å¾®ä¿¡"/></p>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/WeChatPay-Objective-C/Images/%E6%94%AF%E4%BB%98%E5%AE%9DQRC.jpg" alt="æ”¯ä»˜å®"/></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ç©è½¬iOSå¼€å‘ï¼š3.ã€ŠCore Animationã€‹CALayerçš„å‡ ä½•å›¾å±‚]]></title>
    <link href="https://cainrun.github.io/14773198375857.html"/>
    <updated>2016-10-24T22:37:17+08:00</updated>
    <id>https://cainrun.github.io/14773198375857.html</id>
    <content type="html"><![CDATA[
<h3 id="toc_0">ä½œè€…æ„Ÿè¨€</h3>

<blockquote>
<p>å‰ä¸€ç« æˆ‘ä»¬äº†è§£çœŸæ­£äº†<strong>CALayer</strong>æ˜¯å¹²å˜›çš„, <a href="https://cainrun.github.io/14771496782021.html">ã€ŠCore Animationã€‹åˆè¯†CALayer</a>ä»Šå¤©æˆ‘ä»¬å°±æ¥è®²è®²<strong>CALayer Geometry</strong>.<br/>
<dr/><br/>
<strong><font color=purple>æœ€å:</font></strong><br/>
<strong><font color=purple>å¦‚æœä½ æœ‰æ›´å¥½çš„å»ºè®®æˆ–è€…å¯¹è¿™ç¯‡æ–‡ç« æœ‰ä¸æ»¡çš„åœ°æ–¹, è¯·è”ç³»æˆ‘, æˆ‘ä¼šå‚è€ƒä½ ä»¬çš„æ„è§å†è¿›è¡Œä¿®æ”¹, è”ç³»æˆ‘æ—¶, è¯·å¤‡æ³¨</strong><code>Core Animation</code><strong>å¦‚æœè§‰å¾—å¥½çš„è¯, å¸Œæœ›å¤§å®¶ä¹Ÿå¯ä»¥æ‰“èµä¸€ä¸‹~å˜»å˜»~ç¥å¤§å®¶å­¦ä¹ æ„‰å¿«~è°¢è°¢~</font></strong></p>
</blockquote>

<span id="more"></span><!-- more -->

<hr/>

<h3 id="toc_1">ç®€ä»‹</h3>

<blockquote>
<p><strong>CALayer Geometry</strong>è®²å¾—æ˜¯å›¾å±‚çš„å‡ ä½•, ä¸»è¦å†…å®¹åˆ†åˆ«æœ‰<strong>Layout</strong>, <strong>anchorPoint</strong>, <strong>Coordinate Systems</strong>, <strong>Hit Testing</strong>, <strong>Automatic Layout</strong>, å¾…æˆ‘ä»¬ä¸€ä¸€å»äº†è§£å’Œå­¦ä¹ ~</p>
</blockquote>

<hr/>

<h3 id="toc_2">Layout</h3>

<blockquote>
<p><strong>Layout</strong>é¡¾åæ€ä¹‰å°±æ˜¯å¸ƒå±€çš„æ„æ€, è¿™ä¸€æ®µè®²çš„æ˜¯è§†å›¾å’Œå›¾å±‚ç®€å•çš„å¸ƒå±€, æ¯”å¦‚<strong>UIView</strong>é‡Œé¢æœ‰<strong>frame</strong>, <strong>bounds</strong>, <strong>center</strong>, <strong>CALayer</strong>é‡Œé¢æœ‰<strong>frame</strong>, <strong>bounds</strong>, <strong>position</strong>.<br/>
<dr/><br/>
è¿™é‡Œå¯¹å¸ƒå±€å±æ€§è¿›è¡Œä¸€ä¸‹è§£é‡Š: <br/>
<dr/></p>

<ul>
<li><strong>frame</strong>: ä»£è¡¨äº†çš„æ˜¯å›¾å±‚å¤–éƒ¨çš„ä¸€ä¸ªåæ ‡è½´, ä¹Ÿæ˜¯ç›¸å¯¹äºçˆ¶è§†å›¾.</li>
<li><strong>bounds</strong>: ä»£è¡¨äº†çš„æ˜¯å†…éƒ¨åæ ‡è½´, å®ƒçš„åŸç‚¹æ°¸è¿œéƒ½æ˜¯<strong>{0, 0}</strong>, æ˜¯ç›¸å¯¹äºæœ¬è§†å›¾çš„ä½ç½®å’Œå¤§å°.</li>
<li><strong>center</strong>ä»¥åŠ<strong>position</strong>: ä»£è¡¨çš„æ˜¯ç°å¯¹äºçˆ¶è§†å›¾æ‰€åœ¨çš„ä½ç½®, ä¹Ÿå°±æ˜¯æˆ‘ä»¬ç»å¸¸æ‰€è¯´çš„ä¸­å¿ƒç‚¹, ä½†æ˜¯å‘¢, å…¶å®è¿™ä¸ªè¯´æ³•ä¸å¤ªå¯¹, å…¶å®æ˜¯åº”è¯¥ç›¸å¯¹äºçˆ¶è§†å›¾<strong>anchorPoint</strong>å±æ€§æ‰€åœ¨çš„ä½ç½®æ‰å¯¹,<strong>anchorPoint</strong>å±æ€§æˆ‘ä»¬åé¢å†è§£é‡Š, ç°åœ¨è®©å®ƒæ‰“ä¸€ä¸‹é…±æ²¹å…ˆ.</li>
</ul>

<p>æˆ‘ä»¬æ¥çœ‹çœ‹Demoä¸­çš„å®ä¾‹:</p>
</blockquote>

<pre><code class="language-objectivec">
- (void)viewDidLoad {
    [super viewDidLoad];
    
    [self logViewAndLayer];
}

- (void)logViewAndLayer {

    NSLog(@&quot;View X: %f&quot;, self.view.center.x);
    NSLog(@&quot;View Y: %f&quot;, self.view.center.y);
    NSLog(@&quot;View Frame Width: %f&quot;, self.view.frame.size.width);
    NSLog(@&quot;View Frame Height: %f&quot;, self.view.frame.size.height);
    NSLog(@&quot;View Bounds Width: %f&quot;, self.view.bounds.size.width);
    NSLog(@&quot;View Bounds Height: %f&quot;, self.view.bounds.size.height);
    NSLog(@&quot;\n&quot;);
    NSLog(@&quot;Layer X: %f&quot;, self.view.layer.position.x);
    NSLog(@&quot;Layer Y: %f&quot;, self.view.layer.position.y);
    NSLog(@&quot;Layer Frame Width: %f&quot;, self.view.layer.frame.size.width);
    NSLog(@&quot;Layer Frame Height: %f&quot;, self.view.layer.frame.size.height);
    NSLog(@&quot;Layer Bounds Width: %f&quot;, self.view.layer.bounds.size.width);
    NSLog(@&quot;Layer Bounds Height: %f&quot;, self.view.layer.bounds.size.height);
}
</code></pre>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/3.LayerGeometry/images/1.png" alt="1"/></p>

<blockquote>
<p>åœ¨è¿™é‡Œ, æˆ‘ä»¬çœ‹åˆ°<strong>layer</strong>çš„<strong>frame</strong>, <strong>bounds</strong>, <strong>position</strong>å’Œ<strong>UIView</strong>çš„<strong>frame</strong>, <strong>bounds</strong>, <strong>center</strong>éƒ½æ˜¯ä¸€è‡´çš„.<br/>
<dr/><br/>
ä½†æ˜¯åœ¨<strong>UIView</strong>é‡Œ, <strong>frame</strong>, <strong>bounds</strong>, <strong>center</strong>è¿™ä¸‰ä¸ªå±æ€§åªæ˜¯å­˜å–æ–¹æ³•ç½¢äº†, å½“<strong>UIView</strong>å¯¹<strong>frame</strong>å±æ€§è¿›è¡Œæ“ä½œæ—¶, å…¶å®æ˜¯å¯¹<strong>CALayer</strong>çš„<strong>frame</strong>è¿›è¡Œæ“ä½œ, æ˜¯ä¸èƒ½å¤Ÿè„±ç¦»äº†<strong>CALayer</strong>çš„å»æ”¹å˜è§†å›¾çš„<strong>frame</strong>.<br/>
<dr/><br/>
<strong>frame</strong>è¿™ä¸ªå±æ€§å¯¹äº<strong>UIView</strong>å’Œ<strong>CALayer</strong>æ¥è¯´, å®ƒæ˜¯ä¸€ä¸ªæ¯”è¾ƒç„çš„å±æ€§, å®ƒçš„å€¼æ˜¯æ ¹æ®<strong>UIView</strong>æˆ–è€…æ˜¯<strong>CALayer</strong>çš„<strong>bounds</strong>, <strong>center</strong>/<strong>position</strong>, <strong>transform</strong>è®¡ç®—æ‰€å¾—åˆ°çš„ä¸€ä¸ªå€¼, ä¸€æ—¦ä½ å»æ”¹å˜äº†<strong>bounds</strong>, <strong>center</strong>/<strong>position</strong>, <strong>transform</strong>å…¶ä¸­ä¸€ä¸ªå€¼, <strong>frame</strong>ä¹Ÿä¼šéšä¹‹è€Œæ”¹å˜, å½“ç„¶å•¦, ä½ å»æ”¹å˜<strong>frame</strong>, <strong>bounds</strong>, <strong>center</strong>/<strong>position</strong>, <strong>transform</strong>è¿™ä¸‰ä¸ªå€¼ä¹Ÿä¼šè·Ÿç€æ”¹å˜çš„.<br/>
<dr/><br/>
<strong><font color=red>PS: è¿™é‡Œè¿˜éœ€è¦æä¸€ç‚¹, å¦‚æœä½ å¯¹</strong>CALayer<strong>è¿›è¡Œäº†</strong>transform<strong>çš„æ—‹è½¬æˆ–è€…æ˜¯ç¼©æ”¾æ—¶,</strong> frame<strong>æ‰€æ˜¾ç¤ºçš„å®½é«˜ä¸</strong>bounds<strong>çš„å®½é«˜å°±ä¸ä¼šå†ä¸€æ ·äº†.</font></strong></p>

<p>ç›´æ¥æ¥çœ‹Demoå§:</p>
</blockquote>

<pre><code class="language-objectivec">- (void)layerTransform {
    
    UIView *view = [[UIView alloc] initWithFrame:CGRectMake(20, 20, 100, 100)];
    
    view.backgroundColor = [UIColor redColor];
    
    [self.view addSubview:view];
    
    view.layer.transform = CATransform3DMakeRotation(M_PI_4, 1, 1, 0.5);
    
    NSLog(@&quot;View X: %f&quot;, view.center.x);
    NSLog(@&quot;View Y: %f&quot;, view.center.y);
    NSLog(@&quot;View Frame Width: %f&quot;, view.frame.size.width);
    NSLog(@&quot;View Frame Height: %f&quot;, view.frame.size.height);
    NSLog(@&quot;View Bounds Width: %f&quot;, view.bounds.size.width);
    NSLog(@&quot;View Bounds Height: %f&quot;, view.bounds.size.height);
    NSLog(@&quot;\n&quot;);
    NSLog(@&quot;Layer X: %f&quot;, view.layer.position.x);
    NSLog(@&quot;Layer Y: %f&quot;, view.layer.position.y);
    NSLog(@&quot;Layer Frame Width: %f&quot;, view.layer.frame.size.width);
    NSLog(@&quot;Layer Frame Height: %f&quot;, view.layer.frame.size.height);
    NSLog(@&quot;Layer Bounds Width: %f&quot;, view.layer.bounds.size.width);
    NSLog(@&quot;Layer Bounds Height: %f&quot;, view.layer.bounds.size.height);
}
</code></pre>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/3.LayerGeometry/images/2.png" alt="2"/></p>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/3.LayerGeometry/images/3.png" alt="3"/></p>

<hr/>

<h3 id="toc_3">AnchorPoint</h3>

<blockquote>
<p><strong>anchorPoint</strong>è¿™ä¸ªå±æ€§å, ä¹Ÿå«ä½œ<strong>é”šç‚¹</strong>, æŒ‡çš„ä¸€ä¸ª<strong>UIView</strong>å’Œ<strong>CALayer</strong>ç›¸å¯¹äºçˆ¶è§†å›¾çš„ä½ç½®å‚è€ƒç‚¹, å·¦ä¸Šè§’ä¸º<strong>{0, 0}</strong>, å±…ä¸­ä¸º<strong>{0.5, 0.5}</strong>, å³ä¸‹è§’ä¸º<strong>{1, 1}</strong>, é»˜è®¤éƒ½æ˜¯ä½äºçˆ¶è§†å›¾å±‚çš„ä¸­ç‚¹, ä¹Ÿå°±æ˜¯<strong>{0.5, 0.5}</strong>.<br/>
<dr/><br/>
åœ¨<strong>UIView</strong>å½“ä¸­, <strong>anchorPoint</strong>å±æ€§å¹¶æ²¡æœ‰å…¬å¼€å‡ºæ¥, ä½ åªèƒ½æ“ä½œ<strong>center</strong>è¿™ä¸ªå€¼, é—´æ¥æ€§çš„ç»™<strong>anchorPoint</strong>èµ‹å€¼, <strong>CALayer</strong>ä¹Ÿå¯ä»¥é€šè¿‡æ”¹å˜<strong>position</strong>æ¥ç»™<strong>anchorPoint</strong>è¿›è¡Œèµ‹å€¼, ä»è€Œæ”¹å˜<strong>CALayer</strong>çš„<strong>frame</strong>.<br/>
<dr/><br/>
è¿™é‡Œè¿˜éœ€è¦æåŠä¸€ç‚¹, å¦‚æœä½ æ”¹å˜äº†<strong>CALayer</strong>çš„<strong>anchorPoint</strong>, é‚£ä¹ˆ<strong>CALayer</strong>çš„<strong>frame</strong>ä¹Ÿä¼šè¢«æ”¹å˜, é‚£ä¹ˆ<strong>anchorPoint</strong>å±æ€§æ‰€æ˜¾ç¤ºçš„å€¼å†ä¹Ÿä¸æ˜¯è¯¥<strong>CALayer</strong>çš„ä¸­å¿ƒç‚¹, ä½†<strong>bounds</strong>,<strong>position</strong>è¿™äº›å€¼å¹¶ä¸ä¼šè¢«æ”¹å˜.</p>

<p>æˆ‘ä»¬ç›´æ¥æ¥çœ‹çœ‹Demoå§~</p>
</blockquote>

<pre><code class="language-objectivec">- (void)viewAnchorPoint {
    
    UIView *viewOne = [[UIView alloc] initWithFrame:CGRectMake(100, 100, 100, 100)];

    viewOne.backgroundColor = [UIColor grayColor];

    NSLog(@&quot;before X: %f&quot;, viewOne.layer.frame.origin.x);
    NSLog(@&quot;before Y: %f&quot;, viewOne.layer.frame.origin.y);
    
    // change anchorPoint
    viewOne.layer.anchorPoint = CGPointMake(0.1f, 0.1f);

    NSLog(@&quot;After X: %f&quot;, viewOne.layer.frame.origin.x);
    NSLog(@&quot;After Y:%f&quot;, viewOne.layer.frame.origin.y);
    
    UIView *viewTwo = [[UIView alloc] init];
    
    viewTwo.backgroundColor = [UIColor redColor];
    viewTwo.bounds = CGRectMake(0, 0, 100, 100);
    viewTwo.center = viewOne.center;

    [self.view addSubview:viewOne];
    [self.view addSubview:viewTwo];
}
</code></pre>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/3.LayerGeometry/images/4.png" alt="4"/></p>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/3.LayerGeometry/images/5.png" alt="5"/></p>

<blockquote>
<p>ä¸€èˆ¬æ¥è®², èƒ½å¤Ÿç”¨åˆ°<strong>anchorPoint</strong>å±æ€§çš„åœºæ™¯, å¤§å¤šæ•°éƒ½æ˜¯åœ¨ä¸å›¾å±‚å åŠ æ–¹é¢, ä¸ç„¶åŸºæœ¬å¸ƒå±€å°±å·²ç»å¤Ÿç”¨äº†, å½“ç„¶, è¿™åªæ˜¯åœ¨ç®€å•é¡µé¢çš„åŸºç¡€ä¸Šæ¥è®²è€Œå·², è¿˜æ˜¯çœ‹ä¸ªäººéœ€æ±‚å§.</p>
</blockquote>

<hr/>

<h3 id="toc_4">Coordinate Systems</h3>

<blockquote>
<p><strong>Coordinate Systems</strong>ä¹Ÿå«ä½œåæ ‡ç³», å’Œ<strong>UIView</strong>ä¸€æ ·,<strong>CALayer</strong>ä¹Ÿæ˜¯ç›¸å¯¹äºçˆ¶å›¾å±‚å¹¶ä¸”æŒ‰ç…§å±‚çº§å…³ç³»æ¥æ‘†æ”¾, å¦‚æœçˆ¶å›¾å±‚çš„ä½ç½®å‘ç”Ÿäº†å˜åŒ–, é‚£ä¹ˆå­å›¾å±‚ä¹Ÿä¼šéšä¹‹è€Œæ”¹å˜.<br/>
<dr/><br/>
ä½†æŸäº›æƒ…å†µä¸‹, ä½ æƒ³è¦çŸ¥é“è¿™ä¸ªå›¾å±‚çš„ç»å¯¹ä½ç½®, æˆ–è€…æ˜¯ç›¸å¯¹äºå¦ä¸€ä¸ªå›¾å±‚çš„ä½ç½®æ—¶, ä½ å°±å¯ä»¥ä½¿ç”¨CALayeræ‰€æä¾›çš„å‡ ä¸ªAPIè¿›è¡Œå¤„ç†äº†:</p>
</blockquote>

<pre><code class="language-objectivec">    - (CGPoint)convertPoint:(CGPoint)point toView:(nullable UIView *)view;
    - (CGPoint)convertPoint:(CGPoint)point fromView:(nullable UIView *)view;
    - (CGRect)convertRect:(CGRect)rect toView:(nullable UIView *)view;
    - (CGRect)convertRect:(CGRect)rect fromView:(nullable UIView *)view;
</code></pre>

<blockquote>
<p>è¿™äº›æ–¹æ³•ï¼Œå¯ä»¥é‡‡å–ä»»ä½•ä¸€å±‚çš„åæ ‡ç³»ä¸­æ‰€å®šä¹‰çš„ç‚¹æˆ–çŸ©å½¢ï¼Œå¹¶å°†å…¶è½¬æ¢åˆ°å¦ä¸€ä¸ªåæ ‡ç³»ã€‚</p>
</blockquote>

<h4 id="toc_5">ç¿»è½¬CALayerçš„å‡ ä½•å›¾å±‚</h4>

<blockquote>
<p>è¿™é‡Œå†æ™®åŠä¸€ä¸ªæ¦‚å¿µ, æˆ‘ä»¬éƒ½çŸ¥é“åœ¨<strong>iOS</strong>å½“ä¸­<strong>CALayer</strong>çš„<strong>position</strong>æ˜¯åœ¨çˆ¶å›¾å±‚çš„å·¦ä¸Šè§’, ä½†åœ¨<strong>Mac OS</strong>å½“ä¸­, ä¸€èˆ¬æ¥è¯´æ˜¯åœ¨å·¦ä¸‹è§’, è€Œ<strong>Core Animation</strong>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜, æä¾›äº†ä¸€ä¸ª<strong>BOOL</strong>å±æ€§<strong>geometryFlipped</strong>æ¥é€‚é…è¿™ä¸¤ç§æƒ…å†µ, å®ƒå†³å®šäº†ä¸€ä¸ªå›¾å±‚çš„åæ ‡æ˜¯å¦ç›¸å¯¹äºçˆ¶å›¾å±‚ä¸”å‚ç›´ç¿»è½¬, å¦‚æœåœ¨<strong>iOS</strong>ä¸ŠæŠŠ<strong>geometryFlipped</strong>è®¾ç½®ä¸º<strong>YES</strong>çš„è¯, é‚£ä¹ˆå›¾å±‚çš„æ’ç‰ˆå°±ä¼šæ²¿ç€åº•éƒ¨æ¥æ’ç‰ˆ, è€Œä¸æ˜¯æˆ‘ä»¬é€šå¸¸æ‰€çœ‹åˆ°çš„é‚£æ ·, åŒ…æ‹¬å®ƒçš„å­å›¾å±‚ä¹Ÿæ˜¯å¦‚æ­¤, é™¤éä½ å†æŠŠå­å›¾å±‚é‡Œçš„<strong>geometryFlipped</strong>å±æ€§è®¾ç½®ä¸º<strong>YES</strong>.</p>

<p>ç›´æ¥çœ‹Demoå§:</p>
</blockquote>

<pre><code class="language-objectivec">- (void)layerGeometryFlipped {
    
    UIView *view = [[UIView alloc] initWithFrame:CGRectMake(100, 100, 100, 100)];
    
    view.backgroundColor = [UIColor blueColor];
    view.layer.geometryFlipped = YES;
    
    CALayer *layer = [CALayer layer];
    
    layer.frame = CGRectMake(0, 0, 25, 25);
    layer.backgroundColor = [UIColor redColor].CGColor;
    
    [view.layer addSublayer:layer];
    
    [self.view addSubview:view];
}
</code></pre>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/3.LayerGeometry/images/6.png" alt="6"/></p>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/3.LayerGeometry/images/7.png" alt="7"/></p>

<h4 id="toc_6">Zåæ ‡è½´</h4>

<blockquote>
<p>å…¶å®<strong>CALayer</strong>é™¤äº†æœ‰<strong>UIView</strong>å¸¸è§„çš„äºŒç»´åæ ‡è½´ä¹‹å¤–, è¿˜æœ‰ä¸€ä¸ª<strong>Zåæ ‡è½´</strong>, ä¹Ÿå°±æ˜¯è¯´<strong>CALayer</strong>å­˜åœ¨äºä¸‰ç»´ç©ºé—´å½“ä¸­.<br/>
<dr/><br/>
é™¤äº†æˆ‘ä»¬ä¹‹å‰æ¥è§¦è¿‡çš„<strong>position</strong>å’Œ<strong>anchorPoint</strong>ä¹‹å¤–, è¿˜æœ‰ä¸¤ä¸ª<strong>Zåæ ‡è½´</strong>çš„å±æ€§, å«åš<strong>zPosition</strong>å’Œ<strong>anchorPointZ</strong>, ä¸”éƒ½æ˜¯<strong>CGFloat</strong>ç±»å‹.<br/>
<dr/><br/>
<strong>zPosition</strong>è¿™ä¸ªå±æ€§åœ¨é€šå¸¸æƒ…å†µä¸‹å¹¶ä¸å¸¸ç”¨, åœ¨åé¢æˆ‘ä»¬æ¶‰åŠåˆ°ä¸€äº›3Dè½¬æ¢çš„å†…å®¹æ—¶æ‰ä¼šå»ä½¿ç”¨è¿™ä¸ª<strong>zPosition</strong>å±æ€§, <strong>zPosition</strong>å±æ€§é™¤äº†ç”¨æ¥åš3Dè½¬æ¢ä¹‹å¤–, æ›´å¤šæ˜¯ç”¨æ¥æ”¹å˜<strong>CALayer</strong>çš„æ˜¾ç¤ºé¡ºåºäº†.</p>

<p>æ¥çœ‹çœ‹Demoå§</p>
</blockquote>

<pre><code class="language-objectivec">- (void)viewsZPosition {
    
    UIView *greenView = [[UIView alloc] initWithFrame:CGRectMake(100, 100, 100, 100)];
    
    greenView.backgroundColor = [UIColor greenColor];
    greenView.layer.zPosition = 1.0f;
    
    UIView *redView = [[UIView alloc] initWithFrame:CGRectMake(150, 150, 100, 100)];
    
    redView.backgroundColor = [UIColor redColor];
    
    [self.view addSubview:greenView];
    [self.view addSubview:redView];
}
</code></pre>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/3.LayerGeometry/images/8.png" alt="8"/></p>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/3.LayerGeometry/images/9.png" alt="9"/></p>

<hr/>

<h3 id="toc_7">Hit Testing</h3>

<blockquote>
<p>åœ¨ä¹‹å‰çš„æ–‡ç« é‡Œ, æˆ‘ä»¬çŸ¥é“CALayerå¹¶ä¸èƒ½å¤„ç†ä»»ä½•å“åº”é“¾çš„äº‹ä»¶, æ‰€ä»¥ä¸èƒ½ç›´æ¥å»å¤„ç†è§¦æ‘¸äº‹ä»¶æˆ–è€…æ‰‹åŠ¿, ä½†æ˜¯å‘¢, CALayeræä¾›äº†ä¸€äº›æ–¹æ³•å¯ä»¥è®©ä½ çŸ¥é“ä½ çŸ¥é“ä½ ç‚¹å‡»äº†è¿™ä¸ªCALayer.</p>
</blockquote>

<pre><code class="language-objectivec">- (void)containsPoint;
- (void)hitTest;
</code></pre>

<blockquote>
<p>æˆ‘ä»¬ç›´æ¥æ¥çœ‹çœ‹ä»£ç å§:</p>
</blockquote>

<pre><code class="language-objectivec">- (void)hitTestingLayer {
    
    _backgroundView = [[UIView alloc] initWithFrame:CGRectMake(100, 100, 100, 100)];
    
    _backgroundView.backgroundColor = [UIColor grayColor];
    
    _blueLayer = [CALayer layer];
    
    _blueLayer.backgroundColor = [UIColor blueColor].CGColor;
    _blueLayer.frame = CGRectMake(25, 25, 50, 50);
    
    [_backgroundView.layer addSublayer:_blueLayer];
    
    [self.view addSubview:_backgroundView];
}

- (void)touchesBegan:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event {
    
    CGPoint point = [[touches anyObject] locationInView:self.view];
    
    CALayer *layer = [self.backgroundView.layer hitTest:point];
    
    UIAlertView *alerView = [[UIAlertView alloc] initWithTitle:@&quot;ä½ ç‚¹å‡»äº†å±å¹•&quot;
                                                       message:@&quot;&quot;
                                                      delegate:nil
                                             cancelButtonTitle:@&quot;ç¡®å®š&quot;
                                             otherButtonTitles:nil, nil];

    if (layer == self.blueLayer) {
        
        alerView.message = @&quot;ä½ ç‚¹ä¸­äº†è“è‰²çš„Layer&quot;;
        
    } else if (layer == self.backgroundView.layer){
        
        alerView.message = @&quot;ä½ ç‚¹ä¸­äº†ç°è‰²çš„Layer&quot;;
        
    } else {
        alerView.message = @&quot;ä½ ç‚¹ä¸­äº†å…¶ä»–çš„Layer&quot;;
    }
    
    [alerView show];
}
</code></pre>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/3.LayerGeometry/images/10.png" alt="10"/></p>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/3.LayerGeometry/images/11.png" alt="11"/></p>

<hr/>

<h3 id="toc_8">Automatic Layout</h3>

<blockquote>
<p>æ‰€è°“çš„<strong>Automatic Layout</strong>å°±æ˜¯æˆ‘ä»¬ç»å¸¸æ‰€è¯´çš„è‡ªåŠ¨å¸ƒå±€, è‡ªåŠ¨å¸ƒå±€æ˜¯è‹¹æœåœ¨<strong>iOS 6</strong>çš„æ—¶å€™å¼•å…¥è¿›æ¥çš„ä¸€å¥—å¸ƒå±€æœºåˆ¶, ä½†å½“æ—¶å¥½åƒ<strong>Xcode</strong>ä¸å¤Ÿç»™åŠ›, æœ€ç»ˆå¹¶æ²¡æœ‰å¾—åˆ°å¾ˆå¥½çš„è¿ç”¨.<br/>
<dr/><br/>
åœ¨<strong>Mac OS</strong>å½“ä¸­<strong>CALayer</strong>æœ‰ä¸€ä¸ªå«åš<strong>layoutManager</strong>çš„å±æ€§, å®ƒå¯ä»¥é€šè¿‡<strong>CALayoutManager</strong>åè®®å’Œ<strong>CAConstraintLayoutManger</strong>ç±»æ¥å®ç°è‡ªåŠ¨å¸ƒå±€, ä½†è¿™ä¸ªä¸œä¸œåœ¨<strong>iOS</strong>ä¸Šå¹¶ä¸èƒ½ä½¿ç”¨, è¯¦ç»†æˆ‘ä¹Ÿä¸å¤ªäº†è§£.<br/>
<dr/><br/>
å†è¡¥å……å¤šä¸€ç‚¹, åœ¨æˆ‘ä»¬å¯¹<strong>UIView</strong>ä½¿ç”¨è‡ªåŠ¨å¸ƒå±€çš„æ—¶å€™, ä½ å¯ä»¥ç›´æ¥ä½¿ç”¨<strong>UIView</strong>æä¾›çš„<strong>UIViewAutoresizingMask</strong>å’Œ<strong>NSLayoutConstraint</strong>ä¸¤ä¸ªAPIè¿›è¡Œå¸ƒå±€, ä½†å¦‚æœä½ è¦å¯¹ä¸€ä¸ª<strong>CALayer</strong>è¿›è¡Œå¸ƒå±€çš„è¯, é‚£ä¹ˆæœ€ç®€å•çš„æ–¹å¼å°±æ˜¯ä½¿ç”¨<strong>CALayerDelegate</strong>æä¾›çš„<strong>API</strong>:</p>
</blockquote>

<pre><code class="language-objectivec"> - (void)layoutSublayersOfLayer:(CALayer *)layer;
</code></pre>

<blockquote>
<p>å½“<strong>CALayer</strong>çš„<strong>bounds</strong>å‘ç”Ÿäº†æ”¹å˜æˆ–è€…<strong>- (void)setNeedsLayout;</strong>æ–¹æ³•è¢«è°ƒç”¨çš„æ—¶å€™, ä¸Šé¢æ‰€æåŠçš„<strong>API</strong>å°±ä¼šè¢«è°ƒç”¨, è¿™æ ·å­ä½ å°±å¯ä»¥åœ¨ä¸Šé¢æ‰€æåŠçš„<strong>API</strong>é‡Œæ‰‹åŠ¨å»è°ƒæ•´<strong>CALayer</strong>çš„å¸ƒå±€.<br/>
<dr/><br/>
ä½†è¿™æ ·å­ä¼šæœ‰ä¸€ä¸ªè‡´å‘½çš„é—®é¢˜, ç”±äº<strong>CALayer</strong>å¹¶æ²¡æœ‰<strong>autoresizingMask</strong>ä»¥åŠ<strong>constraints</strong>å±æ€§, æ‰€ä»¥ä¸èƒ½åƒ<strong>UIView</strong>é‚£æ ·è‡ªé€‚åº”å±å¹•æ—‹è½¬, è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆç»å¤§å¤šæ•°äººé€‰æ‹©ä½¿ç”¨<strong>UIView</strong>è¿›è¡Œå¸ƒå±€çš„åŸå› ä¹‹ä¸€.<br/>
<dr/><br/>
è¿™é‡Œæˆ‘å°±ä¸å¤šè¯´äº†, è‡ªåŠ¨å¸ƒå±€çš„çŸ¥è¯†ç‚¹åœ¨è°·æ­Œæœä¸€å¤§å †, æœ‰ç¥é©¬<strong>xib</strong>çš„, <strong>storyboard</strong>çš„, è¿˜æœ‰çº¯ä»£ç çš„, ä½†æ˜¯å‘¢, çº¯ä»£ç çš„è‡ªåŠ¨å¸ƒå±€æˆ‘åªæœ<strong><a href="https://github.com/SnapKit/Masonry">Masonry</a></strong>, ä¹Ÿæœ‰<strong><a href="https://github.com/SnapKit/SnapKit">Swift</a></strong>ç‰ˆæœ¬çš„, å¤§å®¶å¯ä»¥è‡ªè¡Œå»äº†è§£ä¸€ä¸‹, ä½¿ç”¨æ•™ç¨‹ç¥é©¬çš„, åœ¨è°·æ­Œæœæœä¹Ÿæ˜¯æœ‰ä¸€å †çš„, è¿™é‡Œå°±ä¸åšä»‹ç»äº†~</p>
</blockquote>

<hr/>

<h3 id="toc_9">æ€»ç»“</h3>

<blockquote>
<p>è¯´äº†é‚£ä¹ˆå¤š, å¸¸è§„çš„æ€»ç»“ä¸€ä¸‹, è¿™æ¬¡æˆ‘ä»¬æ›´æ·±å…¥çš„äº†è§£äº†<strong>CALayer</strong>å‡ ä½•å›¾å±‚, å…¶ä¸­åŒ…æ‹¬: </p>

<ul>
<li><strong>Layout</strong>:<strong>CALayer</strong>çš„å¸¸è§„å¸ƒå±€</li>
<li><strong>AnchorPoint</strong>: <strong>CALayer</strong>çš„é”šç‚¹</li>
<li><strong>Coordinate Systems</strong>: <strong>CALayer</strong>çš„åæ ‡è½´, å…¶ä¸­åŒ…æ‹¬å¦‚ä½•ç¿»è½¬<strong>CALayer</strong>çš„å‡ ä½•å›¾å±‚, è¿˜æœ‰å°±æ˜¯<strong>Zåæ ‡è½´</strong>.</li>
<li><strong>Hit Testing</strong>: <strong>CALayer</strong>å¦‚ä½•çŸ¥é“ç”¨æˆ·æ˜¯å¦ç‚¹å‡»è¯¥å›¾å±‚</li>
<li><strong>Automatic Layout</strong>: æœ‰å…³äº<strong>CALayer</strong>ä»¥åŠ<strong>UIView</strong>çš„è‡ªåŠ¨å¸ƒå±€, ä»¥åŠä¸€ä¸ªç¬¬ä¸‰æ–¹çš„å¸ƒå±€æ¡†æ¶</li>
</ul>
</blockquote>

<hr/>

<h3 id="toc_10">å·¥ç¨‹åœ°å€</h3>

<p>é¡¹ç›®åœ°å€: <a href="https://github.com/CainRun/CoreAnimation">https://github.com/CainRun/CoreAnimation</a></p>

<hr/>

<h3 id="toc_11">æœ€å</h3>

<p><center>ç å­—å¾ˆè´¹è„‘, çœ‹å®˜èµç‚¹é¥­é’±å¯å¥½</center></p>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/WeChatPay-Objective-C/Images/%E5%BE%AE%E4%BF%A1QRC.jpg" alt="å¾®ä¿¡"/></p>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/WeChatPay-Objective-C/Images/%E6%94%AF%E4%BB%98%E5%AE%9DQRC.jpg" alt="æ”¯ä»˜å®"/></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ç©è½¬iOSå¼€å‘ï¼š2.ã€ŠCore Animationã€‹åˆè¯†CALayer]]></title>
    <link href="https://cainrun.github.io/14771496782021.html"/>
    <updated>2016-10-22T23:21:18+08:00</updated>
    <id>https://cainrun.github.io/14771496782021.html</id>
    <content type="html"><![CDATA[
<h3 id="toc_0">ä½œè€…æ„Ÿè¨€</h3>

<blockquote>
<p>å‰é¢æˆ‘ä»¬ç®€å•ä»‹ç»äº†ä¸€äº›å›¾å±‚ä¸è§†å›¾çš„å…³ç³», ä¹Ÿä»‹ç»äº†<strong>CALayer</strong>ä»¥åŠ<strong>UIView</strong>çš„ç›¸åŒç‚¹å’ŒåŒºåˆ«, æ²¡çœ‹è¿‡çš„æœ‹å‹å¯ä»¥å»çœ‹çœ‹<a href="https://cainrun.github.io/14770254062641.html">ã€ŠCore Animationã€‹åŸºç¡€æ¦‚å¿µ</a>ä»Šå¤©æˆ‘ä»¬å°±ç€é‡çš„æ¥è®²è®²<strong>CALayer</strong>.<br/>
<dr/><br/>
<strong><font color=purple>æœ€å:</font></strong><br/>
<strong><font color=purple>å¦‚æœä½ æœ‰æ›´å¥½çš„å»ºè®®æˆ–è€…å¯¹è¿™ç¯‡æ–‡ç« æœ‰ä¸æ»¡çš„åœ°æ–¹, è¯·è”ç³»æˆ‘, æˆ‘ä¼šå‚è€ƒä½ ä»¬çš„æ„è§å†è¿›è¡Œä¿®æ”¹, è”ç³»æˆ‘æ—¶, è¯·å¤‡æ³¨</strong><code>Core Animation</code><strong>å¦‚æœè§‰å¾—å¥½çš„è¯, å¸Œæœ›å¤§å®¶ä¹Ÿå¯ä»¥æ‰“èµä¸€ä¸‹~å˜»å˜»~ç¥å¤§å®¶å­¦ä¹ æ„‰å¿«~è°¢è°¢~</font></strong></p>
</blockquote>

<span id="more"></span><!-- more -->

<hr/>

<h3 id="toc_1">ç®€ä»‹</h3>

<blockquote>
<p>å‰é¢æˆ‘ä»¬å·²ç»ç®€å•ä»‹ç»äº†ä»€ä¹ˆæ˜¯<strong>CALayer</strong>, <strong>CALayer</strong>ä¸»è¦æ˜¯ç”¨æ¥åšä»€ä¹ˆçš„, ç°åœ¨æˆ‘ä»¬æ¥æ›´åŠ æ·±å…¥çš„äº†è§£<strong>CALayer</strong>åˆ°åº•æœ‰äº›ä»€ä¹ˆä¸œè¥¿ä¾›ç»™æˆ‘ä»¬å»ä½¿ç”¨çš„.</p>
</blockquote>

<hr/>

<h3 id="toc_2">CALayerçš„Contentså±æ€§</h3>

<blockquote>
<p>åœ¨<strong>CALayer</strong>ä¸­, æœ‰è¿™ä¹ˆä¸€ä¸ª<strong>contents</strong>å±æ€§, é‚£ä¹ˆ<strong>contents</strong>è¿™ä¸ªå±æ€§æ˜¯ç”¨æ¥åšä»€ä¹ˆçš„å‘¢? æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€æ®µå®˜æ–¹è§£é‡Š.<br/>
<dr/><br/>
<strong><font color=blue>An object that provides the contents of the layer. Animatable.</font></strong><br/>
<dr/><br/>
ä»å­—é¢ä¸Šæ„æ€æ¥çœ‹, è¿™æ˜¯ä¸€ä¸ªæä¾›å›¾å±‚å†…å®¹çš„å¯¹è±¡, å¹¶ä¸”æ˜¯<strong>id</strong>ç±»å‹, ä¹Ÿå°±æ„å‘³ç€, æˆ‘ä»¬å¯ä»¥ç»™è¿™ä¸ª<strong>contents</strong>å±æ€§èµ‹ä»»æ„çš„å€¼, æ¯•ç«Ÿæ˜¯<strong>id</strong>ç±»å‹å˜›, ä½†åœ¨å®é™…æ“ä½œä¸­, æ˜¯è¡Œä¸é€šçš„, ä¸ºä»€ä¹ˆ? <br/>
<dr/><br/>
è¿™é‡Œå°±è¦ç‰µæ‰¯åˆ°<strong>Mac OS</strong>äº†, å› ä¸ºåœ¨<strong>Mac OS</strong>å½“ä¸­, ç»™<strong>CALayer</strong>ä¸­çš„<strong>contents</strong>å±æ€§èµ‹å€¼, æ— è®ºæ˜¯<strong>CGImage</strong>è¿˜æ˜¯<strong>NSImage</strong>, éƒ½èƒ½å¾—åˆ°å¯¹åº”çš„æ•ˆæœ, è€Œåœ¨<strong>iOS</strong>å½“ä¸­, åªèƒ½èµ‹å€¼<strong>CGImage</strong>, æˆ–è®¸åˆ°äº†è¿™é‡Œ, ä½ ä¼šè§‰å¾—æŒºç®€å•çš„, ä½†å‘µå‘µäº†, è¿™é‡Œè¿˜è¦ç‰µæ‰¯åˆ°æŒ‡é’ˆçš„é—®é¢˜(ä¸ªäººå¯¹æŒ‡é’ˆæœ‰äº›æ™•).<br/>
<dr/><br/>
å®é™…ä¸Š, æˆ‘ä»¬ç»™<strong>contents</strong>å±æ€§èµ‹<strong>CGImage</strong>çš„æ—¶å€™, çœŸæ­£èµ‹å€¼çš„æ˜¯<strong>CGImageRef</strong>, å®ƒæ˜¯æŒ‡å‘<strong>CGImage</strong>çš„æŒ‡é’ˆ, ç”¨è¿‡<strong>UIImage</strong>çš„æœ‹å‹åº”è¯¥ä¼šå‘ç°, <strong>UIImage</strong>å½“ä¸­æœ‰ä¸€ä¸ª<strong>CGImage</strong>çš„å±æ€§, è¿™ä¸ªå±æ€§çš„è¿”å›å€¼å°±æ˜¯<strong>CGImageRef</strong>.<br/>
<dr/><br/>
æŸäº›ç«¥é‹ä¼šè¯´, æ—¢ç„¶æ˜¯<strong>CGImageRef</strong>ç±»å‹çš„è¯, é‚£ç›´æ¥èµ‹å€¼ç»™<strong>contents</strong>ä¸å°±å¥½äº†ä¹ˆ, å…¶å®å¹¶ä¸æ˜¯æ»´, ç›´æ¥è¿™ä¹ˆèµ‹å€¼ä¼šæŠ¥ç¼–è¯‘é”™è¯¯æ»´, ä¸ºä»€ä¹ˆ?? <br/>
<dr/><br/>
å› ä¸º<strong>CGImageRef</strong>å¹¶ä¸æ˜¯ä¸€ä¸ªçœŸæ­£çš„<strong>Cocoa</strong>å¯¹è±¡, å®ƒæ˜¯å±äº<strong>Core Foundation</strong>é‡Œçš„ä¸œè¥¿(ä»€ä¹ˆæ˜¯<strong>Core Foundation</strong>? å˜¿å˜¿, è‡ªè¡Œç™¾åº¦å»å§~~), é‚£ä¹ˆæˆ‘ä»¬å°±æ²¡åŠæ³•ç»™<strong>contents</strong>èµ‹å€¼å—? è‚¯å®šä¸æ˜¯å•¦, æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€äº›å…³é”®å­—è¿›è¡Œèµ‹å€¼, å°±èƒ½å¤Ÿå¾—åˆ°å¯¹åº”çš„æ•ˆæœäº†, ä»£ç å¦‚ä¸‹:</p>
</blockquote>

<pre><code class="language-objectivec">- (void)viewDidLoad {
    [super viewDidLoad];

    self.view.backgroundColor = [UIColor lightGrayColor];
    
    UIView *layerView = [[UIView alloc] init];
    layerView.backgroundColor = [UIColor whiteColor];
    layerView.center = self.view.center;
    layerView.bounds = CGRectMake(0, 0, 200, 200);
    
    [self.view addSubview:layerView];
    
    UIImage *image = [UIImage imageNamed:@&quot;bear&quot;];
    
    layerView.layer.contents = (__bridge id _Nullable)(image.CGImage);
}
</code></pre>

<blockquote>
<p>è¿™é‡Œæä¸€ç‚¹å“ˆ, è¿™ä¸ªå…³é”®å­—åœ¨<strong>éARCå†…å­˜ç®¡ç†æœºåˆ¶</strong>ä¸­æ˜¯ä¸éœ€è¦åŠ æ»´, ä½†æ˜¯å‘¢, ç‰¹ä¹ˆçš„, ä½ ä¸ºå•¥ä¸ç”¨<strong>ARC</strong>? ä¼°è®¡è¿ä½ è‡ªå·±éƒ½ä¼šè¿™ä¹ˆé—®ä½ è‡ªå·±äº†.<br/>
<dr/><br/>
æ•ˆæœå›¾: </p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/2.CALayer/images/1.png" alt="1"/></p>

<blockquote>
<p>çœ‹å®Œæ•ˆæœå›¾ä¹‹å, æˆ‘ä»¬å†çœ‹çœ‹å®ƒçš„å±‚çº§ç»“æ„, ä½ å°±ä¼šå‘ç°å’Œæˆ‘ä»¬ä½¿ç”¨çš„<strong>UIImageView</strong>å®Œå…¨ä¸€æ¨¡ä¸€æ ·, ä¸ä¿¡? æˆ‘ç»™ä½ ä»¬åŠ ä¸ªUIImageViewçœ‹çœ‹~</p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/2.CALayer/images/2.png" alt="2"/></p>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/2.CALayer/images/3.png" alt="3"/></p>

<blockquote>
<p>è™½ç„¶æˆ‘ä»¬å¹¶ä¸æ˜¯é€šè¿‡ä½¿ç”¨<strong>UIImageView</strong>æ¥å®ç°åŠ è½½å›¾ç‰‡çš„, ä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡<strong>Layer</strong>å±‚ç»™<strong>UIView</strong>è¿›è¡ŒåŠ è½½å›¾ç‰‡, é…±ç´«çš„è¯, å¤§å®¶æ˜¯ä¸æ˜¯å¯¹è‹¹æœå¦‚ä½•å°è£…<strong>UIImageView</strong>æœ‰äº†ä¸€ä¸ªæ€è·¯å‘¢?</p>
</blockquote>

<hr/>

<h3 id="toc_3">CALayerçš„ContentGravityå±æ€§</h3>

<blockquote>
<p>ä¸çŸ¥é“ä½ ä»¬æœ‰æ²¡æœ‰å‘ç°, æˆ‘ä»¬æ‰€å±•ç¤ºçš„å›¾ç‰‡æœ‰ä¸€äº›å˜å½¢, å¦‚æœæ˜¯ç”¨<strong>UIImageView</strong>çš„è¯, æˆ‘ä»¬å¯ä»¥ç›´æ¥è®¾ç½®<strong>contentModel</strong>è¿™ä¸ªå±æ€§, ä½¿å¾—å›¾ç‰‡æ­£å¸¸æ˜¾ç¤º, ä½†å¦‚æœæ˜¯åœ¨<strong>CALayer</strong>å‘¢? <br/>
<dr/><br/>
å½“ç„¶<strong>CALayer</strong>ä¹Ÿæœ‰ä¸€ä¸ªç±»ä¼¼<strong>contentModel</strong>çš„å±æ€§, å®ƒå«åš<strong>contentGravity</strong>, è™½ç„¶åå­—æœ‰äº›å·®åˆ«, ä½†æ˜¯ä½¿ç”¨æ•ˆæœéƒ½æ˜¯å·®ä¸å¤šçš„~~<br/>
<dr/><br/>
è¿›å…¥å¤´æ–‡ä»¶ä¹‹åæˆ‘ä»¬ä¼šçœ‹åˆ°<strong>contentGravity</strong>å¯ä»¥èµ‹å€¼çš„é€‰é¡¹æœ‰:</p>

<ul>
<li>kCAGravityCenter</li>
<li>kCAGravityTop</li>
<li>kCAGravityBottom</li>
<li>kCAGravityLeft</li>
<li>kCAGravityRight</li>
<li>kCAGravityTopLeft</li>
<li>kCAGravityTopRight</li>
<li>kCAGravityBottomLeft</li>
<li>kCAGravityBottomRight</li>
<li>kCAGravityResize</li>
<li>kCAGravityResizeAspect</li>
<li>kCAGravityResizeAspectFill
<dr/>
ç°åœ¨æˆ‘ä»¬å°±æ¥æ”¹æ”¹å·¥ç¨‹é‡Œçš„ä»£ç :</li>
</ul>
</blockquote>

<pre><code class="language-objectivec">    layerView.layer.contentsGravity = kCAGravityResizeAspect;
</code></pre>

<blockquote>
<p>æ•ˆæœå›¾: </p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/2.CALayer/images/4.png" alt="4"/></p>

<blockquote>
<p>é…±ç´«å›¾ç‰‡æ˜¾ç¤ºæ­£ç¡®å•¦~~è²Œä¼¼<strong>UIImageView</strong>çš„<strong>contentModel</strong>ä¹Ÿå°±æ˜¯è¿™ä¹ˆå®ç°çš„~</p>
</blockquote>

<hr/>

<h3 id="toc_4">CALayerçš„ContentsScaleå±æ€§</h3>

<blockquote>
<p>å…¶å®æˆ‘åœ¨æƒ³, æˆ‘æ˜¯ä¸æ˜¯ä¸åº”è¯¥æŠŠ<strong>CALayer</strong>é‡Œçš„æ‰€æœ‰å±æ€§éƒ½æ‹¿å‡ºæ¥è®²ä¸€è®²? åªæ˜¯ç®€å•è®²ä¸€äº›é‡è¦çš„å¥½äº†, æ¥ä¸‹æ¥çš„å°±æ˜¯<strong>contentsScale</strong>.<br/>
<dr/><br/>
<strong>contentsScale</strong>è¿™ä¸ªå±æ€§ä¸»è¦æ˜¯å®šä¹‰å›¾å±‚çš„åƒç´ å’Œè§†å›¾æ¯”ä¾‹å¤§å°, é»˜è®¤æƒ…å†µæ˜¯<strong>1.0</strong>, è€Œä¸”æ˜¯<strong>CGFloat</strong>ç±»å‹.<br/>
<dr/><br/>
ä½†å¦‚æœä½ çš„<strong>CALayer</strong>å·²ç»è®¾ç½®äº†<strong>contentsGravity</strong>, é‚£ä¹ˆå†è®¾ç½®<strong>contentsScale</strong>, æ•ˆæœå°±æ˜¯æ²¡å¤šå¤§å½±å“, æˆ–è€…ç›´æ¥è¯´å‹æ ¹å°±æ²¡å½±å“å§, å¦‚æœä½ åªæ˜¯æƒ³ç€å•çº¯çš„æ”¾å¤§ç¼©å°<strong>CALayer</strong>, å¯ä»¥ç›´æ¥ä½¿ç”¨<strong>transform</strong>å’Œ<strong>affineTransForm</strong>å®ç°ä½ æƒ³è¦çš„æ•ˆæœ, åç»­ä¼šè¯¦ç»†è®²è§£<strong>transforms</strong>.<br/>
<dr/><br/>
å½“ç„¶æ”¾å¤§ç¼©å°è‚¯å®šä¹Ÿä¸æ˜¯<strong>contentsScale</strong>å±æ€§çš„ä¸»è¦ä½œç”¨, è¿™é‡Œå°±éœ€è¦è§£é‡Šä¸€ä¸‹<strong>contentsScale</strong>: <br/>
<dr/><br/>
<strong>contentsScale</strong>ä¸»è¦æ˜¯æ”¯æŒ<strong>Retina</strong>æœºåˆ¶çš„ä¸€éƒ¨åˆ†, å®ƒæ˜¯ç”¨æ¥åˆ¤æ–­ç»˜åˆ¶å›¾å±‚æ—¶åº”è¯¥éœ€è¦åˆ›å»ºå¤šå¤§çš„ç©ºé—´, å’Œéœ€è¦æ˜¾ç¤ºå›¾ç‰‡çš„æ‹‰ä¼¸åº¦,<strong>UIView</strong>ä¹Ÿæœ‰ä¸€ä¸ªç±»ä¼¼çš„å±æ€§, å«åš<strong>contentScaleFactor</strong>, åªæ˜¯æˆ‘ä»¬éå¸¸å°‘çš„å»ä½¿ç”¨ç½¢äº†.<br/>
<dr/><br/>
è¿™ä¸ªæ—¶å€™æˆ‘ä»¬æ¥æ”¹æ”¹å·¥ç¨‹é‡Œçš„ä»£ç , è®©<strong>contentsScale</strong>å‘ˆç°æ•ˆæœ: </p>
</blockquote>

<pre><code class="language-objectivec">- (void)viewDidLoad {
    [super viewDidLoad];
    
    self.view.backgroundColor = [UIColor lightGrayColor];
    
    UIView *layerView = [[UIView alloc] init];
    layerView.backgroundColor = [UIColor whiteColor];
    layerView.center = self.view.center;
    layerView.bounds = CGRectMake(0, 0, 200, 200);
    
    [self.view addSubview:layerView];
    
    
    UIImage *image = [UIImage imageNamed:@&quot;bear&quot;];
    
    layerView.layer.contents = (__bridge id _Nullable)(image.CGImage);
    
    layerView.layer.contentsGravity = kCAGravityCenter;
    layerView.layer.contentsScale = image.scale;
}
</code></pre>

<blockquote>
<p>æ•ˆæœå›¾: </p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/2.CALayer/images/5.png" alt="5"/></p>

<hr/>

<h3 id="toc_5">CALayerçš„MaskToBoundså±æ€§</h3>

<blockquote>
<p>çœ‹å®Œäº†<strong>contentsScale</strong>å±æ€§, ç°åœ¨æˆ‘ä»¬ç»§ç»­æ¥çœ‹<strong>maskToBounds</strong>å±æ€§.<br/>
<dr/><br/>
æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€æ®µå®˜æ–¹æ–‡å­—ä»‹ç»: <br/>
<dr/><br/>
<strong><font color=blue>A Boolean indicating whether sublayers are clipped to the layerâ€™s bounds. Animatable.</font></strong><br/>
<dr/><br/>
çœ‹å®Œä¹‹å, æˆ‘ä»¬çŸ¥é“è¿™ä¸ªå±æ€§æ˜¯ä¸€ä¸ª<strong>BOOL</strong>ç±»å‹, é—®ä½ å¦‚æœå­å›¾å±‚è¶…å‡ºäº†è§†å›¾å±‚, æ˜¯å¦å‰ªåˆ‡æ‰, å¦‚æœä½ è®¾ç½®ä¸º<strong>YES</strong>, é‚£å°±å‰ªåˆ‡æ‰äº†, é»˜è®¤ä¸º<strong>NO</strong>.<br/>
<dr/><br/>
å°±æ‹¿æˆ‘ä»¬åˆšåˆšçš„å·¥ç¨‹ä½œä¸ºä¸€ä¸ªäº‹ä¾‹æ¥è®², é‚£å¼ å›¾ç‰‡è‚¯å®šæ˜¯è¶…è¿‡äº†è§†å›¾å±‚çš„, å¦‚æœæˆ‘ä»¬æŠŠ<strong>maskToBounds</strong>å±æ€§è®¾ç½®ä¸º<strong>YES</strong>, æ•ˆæœå°±ä¸ä¸€æ ·äº†:</p>
</blockquote>

<pre><code class="language-objectivec">- (void)viewDidLoad {
    [super viewDidLoad];

    self.view.backgroundColor = [UIColor lightGrayColor];
    
    UIView *layerView = [[UIView alloc] init];
    layerView.backgroundColor = [UIColor whiteColor];
    layerView.center = self.view.center;
    layerView.bounds = CGRectMake(0, 0, 200, 200);
    
    [self.view addSubview:layerView];
    
    
    UIImage *image = [UIImage imageNamed:@&quot;bear&quot;];
    
    layerView.layer.contents = (__bridge id _Nullable)(image.CGImage);
    
    layerView.layer.contentsGravity = kCAGravityCenter;
    layerView.layer.contentsScale = image.scale;
    layerView.layer.masksToBounds = YES;
}
</code></pre>

<blockquote>
<p>æ•ˆæœå›¾:</p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/2.CALayer/images/6.png" alt="6"/></p>

<hr/>

<h3 id="toc_6">CALayerçš„ContentsRectå±æ€§</h3>

<blockquote>
<p><strong>CALayer</strong>æœ‰ä¸€ä¸ªå±æ€§å«åš<strong>contentsRect</strong>, å®ƒæ˜¯å¯ä»¥æ ¹æ®è¾“å…¥çš„åæ ‡è½´æ¥æ˜¾ç¤ºåŒºåŸŸå—çš„å›¾å±‚, è€Œ<strong>frame</strong>,<strong>bounds</strong>åˆ™æ˜¯ä»¥ç‚¹æ¥è®¡ç®—çš„, åœ¨è¿™é‡Œå®ƒä»¬æœ‰ä¸€äº›åŒºåˆ«.<br/>
<dr/><br/>
è¿˜æœ‰ä¸€ä¸ªæ³¨æ„ç‚¹, <strong>contentsRect</strong>çš„åæ ‡è½´é»˜è®¤æ˜¯<strong>{0, 0, 1, 1}</strong>, å•ä½åæ ‡ä¸€èˆ¬æŒ‡å®šçš„æ˜¯<strong>0~1</strong>ä¹‹é—´, å¦‚æœå°äºè¿™ä¸ªæ•°, æˆ–è€…æ˜¯å¤§äºè¿™ä¸ªæ•°, å“¼å“¼, ä½ è‡ªå·±è¯•è¯•çœ‹å§~<br/>
<dr/><br/>
è¯´åˆ°è¿™é‡Œ, åº”è¯¥ä¼šæœ‰äººæœ‰äº›ç–‘æƒ‘, ç¥é©¬æ˜¯ç‚¹? éš¾é“å’Œåƒç´ ä¸ä¸€æ ·çš„ä¹ˆ? é‚£å°±å…ˆæ¥æ™®åŠä¸€ä¸‹å…ˆå§(è¿™é‡Œæˆ‘æ˜¯æœåˆ°çš„ä¸€äº›æ¯”è¾ƒä¸­è‚¯çš„è¯´æ³•)~<br/>
</br><br/>
ç‚¹: <br/>
<dr/> </p>

<ul>
<li>åœ¨<strong>iOS</strong>å’Œ<strong>Mac OS</strong>ä¸­æœ€å¸¸è§çš„åæ ‡ä½“ç³»ã€‚</li>
<li>ç‚¹å°±åƒæ˜¯è™šæ‹Ÿçš„åƒç´ , ä¹Ÿè¢«ç§°ä½œé€»è¾‘åƒç´ ã€‚</li>
<li>åœ¨æ ‡å‡†è®¾å¤‡ä¸Š, ä¸€ä¸ªç‚¹å°±æ˜¯ä¸€ä¸ªåƒç´ , ä½†æ˜¯åœ¨<strong>Retina</strong>è®¾å¤‡ä¸Š, ä¸€ä¸ªç‚¹ç­‰äº<strong>2*2</strong>ä¸ªåƒç´ ã€‚</li>
<li><strong>iOS</strong>ç”¨ç‚¹ä½œä¸ºå±å¹•çš„åæ ‡æµ‹ç®—ä½“ç³»å°±æ˜¯ä¸ºäº†åœ¨<strong>Retina</strong>è®¾å¤‡å’Œæ™®é€šè®¾å¤‡ä¸Šèƒ½æœ‰ä¸€è‡´çš„è§†è§‰æ•ˆæœã€‚</li>
</ul>

<p></br><br/>
åƒç´ :<br/>
<dr/></p>

<ul>
<li>ç‰©ç†åƒç´ åæ ‡å¹¶ä¸ä¼šç”¨æ¥å±å¹•å¸ƒå±€, ä½†æ˜¯ä»ç„¶ä¸å›¾ç‰‡æœ‰ç›¸å¯¹å…³ç³»ã€‚ </li>
<li><strong>UIImage</strong>æ˜¯ä¸€ä¸ªå±å¹•åˆ†è¾¨ç‡è§£å†³æ–¹æ¡ˆ, æ‰€ä»¥æŒ‡å®šç‚¹æ¥åº¦é‡å¤§å°ã€‚</li>
<li><p>ä½†æ˜¯ä¸€äº›åº•å±‚çš„å›¾ç‰‡è¡¨ç¤ºå¦‚<strong>CGImage</strong>å°±ä¼šä½¿ç”¨åƒç´ , æ‰€ä»¥ä½ è¦æ¸…æ¥šåœ¨<strong>Retina</strong>è®¾å¤‡å’Œæ™®é€šè®¾å¤‡ä¸Š, ä»–ä»¬è¡¨ç°å‡ºæ¥äº†ä¸åŒçš„å¤§å°ã€‚<br/>
</br><br/>
å•ä½: <br/>
<dr/></p></li>
<li><p>å¯¹äºä¸å›¾ç‰‡å¤§å°æˆ–æ˜¯å›¾å±‚è¾¹ç•Œç›¸å…³çš„æ˜¾ç¤º, å•ä½åæ ‡æ˜¯ä¸€ä¸ªæ–¹ä¾¿çš„åº¦é‡æ–¹å¼, å½“å¤§å°æ”¹å˜çš„æ—¶å€™, ä¹Ÿä¸éœ€è¦å†æ¬¡è°ƒæ•´ã€‚</p></li>
<li><p>å•ä½åæ ‡åœ¨<strong>OpenGL</strong>è¿™ç§çº¹ç†åæ ‡ç³»ç»Ÿä¸­ç”¨å¾—å¾ˆå¤š,<strong>Core Animation</strong>ä¸­ä¹Ÿç”¨åˆ°äº†å•ä½åæ ‡ã€‚<br/>
</br><br/>
è¿™é‡Œæˆ‘ä»¬è¿˜æ˜¯ç»§ç»­æ‹¿åˆšåˆšçš„å·¥ç¨‹æ¥æ¼”ç¤º: </p></li>
</ul>
</blockquote>

<pre><code class="language-objectivec">- (void)viewDidLoad {
    [super viewDidLoad];

    self.view.backgroundColor = [UIColor lightGrayColor];
    
    UIView *layerView = [[UIView alloc] init];
    layerView.backgroundColor = [UIColor whiteColor];
    layerView.center = self.view.center;
    layerView.bounds = CGRectMake(0, 0, 200, 200);
    
    [self.view addSubview:layerView];
    
    
    UIImage *image = [UIImage imageNamed:@&quot;bear&quot;];
    
    layerView.layer.contents = (__bridge id _Nullable)(image.CGImage);
    
    layerView.layer.contentsGravity = kCAGravityCenter;
    layerView.layer.contentsScale = image.scale;
    layerView.layer.masksToBounds = YES;
    layerView.layer.contentsRect = CGRectMake(0, 0, 0.5, 0.5);
}
</code></pre>

<blockquote>
<p>æ•ˆæœå›¾: </p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/2.CALayer/images/7.png" alt="7"/></p>

<blockquote>
<p>è¡¥å……ä¸€äº›é¢å¤–çš„çŸ¥è¯†ç‚¹:<br/>
<dr/><br/>
<strong>contentsRect</strong>åœ¨<strong>App</strong>å½“ä¸­, è¿˜æœ‰ä¸€ä¸ªæ›´å¥½ç©çš„ç”¨æ³•å«åš<strong>image sprites</strong>, å¦‚æœä½ æœ‰æ¸¸æˆå¼€å‘ç»éªŒçš„è¯, ä½ è‚¯å®šå¯¹<strong>image sprites</strong>ä¸é™Œç”Ÿ, ç”šè‡³æ˜¯éå¸¸ç†Ÿç»ƒçš„ä½¿ç”¨, å¯ä»¥ä½¿å›¾ç‰‡ç‹¬ç«‹çš„å˜æ›´åœ¨å±å¹•ä¸Šæ˜¾ç¤ºçš„ä½ç½®.<br/>
<dr/><br/>
ä½†å¦‚æœæˆ‘ä»¬æŠ›å¼€æ¸¸æˆå¼€å‘æ¥è¯´çš„è¯, åœ¨æˆ‘ä»¬æ—¥å¸¸ç”Ÿæ´»å½“ä¸­, å¾®åšå°±æ˜¯ä¸€ä¸ªç»å…¸çš„ä»£è¡¨, æŠŠå›¾ç‰‡æ‹¼æ¥æˆä¸€å¼ å¤§å›¾ç‰‡, ç„¶åå†åˆ†äº«å‡ºå», è¿™é‡Œä½¿ç”¨çš„å°±æ˜¯<strong>contentsRect</strong>, è¿™æ ·å­çš„å¥½å¤„å°±æ˜¯å¯ä»¥å‡å°‘å†…å­˜çš„ä½¿ç”¨, è½½å…¥çš„æ—¶é—´, è¿˜æœ‰æ¸²æŸ“çš„æ€§èƒ½ç­‰ç­‰.<br/>
<dr/><br/>
è¿™é‡Œæˆ‘å°±ä¸åšæ¼”ç¤ºäº†, æ„Ÿå…´è¶£çš„ç«¥é‹å¯ä»¥ åˆ°ç½‘ä¸Šæ‰¾æ‰¾èµ„æ–™.</p>
</blockquote>

<hr/>

<h3 id="toc_7">CALayerçš„ContentsCenterå±æ€§</h3>

<blockquote>
<p>è®²åˆ°è¿™é‡Œ, å·²ç»ç®—æ˜¯<strong>CALayer</strong>æœ€åçš„ä¸€ä¸ªå±æ€§äº†, å®ƒå«åš<strong>contentsCenter</strong>, å®ƒçš„æ„æ€æ¯”è¾ƒæ‹—å£, å®ƒæ˜¯ä¸€ä¸ª<strong>CGRect</strong>, ä¸”å®šä¹‰äº†ä¸€ä¸ªå›ºå®šçš„è¾¹æ¡†å’Œä¸€ä¸ªå›¾å±‚ä¸Šå¯æ‹‰ä¼¸çš„åŒºåŸŸ.<br/>
<dr/><br/>
å¦‚æœä½ åªæ˜¯å•å•æ”¹å˜<strong>contentsCenter</strong>çš„å€¼, å¹¶ä¸ä¼šå½±å“åˆ°<strong>CALayer</strong>çš„æ˜¾ç¤ºæ•ˆæœ, è¦åŒæ—¶å»æ”¹å˜è¿™ä¸ªå›¾å±‚çš„å¤§å°, æ‰èƒ½çœ‹åˆ°æ•ˆæœ.<br/>
<dr/><br/>
æˆ‘ä»¬è¿˜æ˜¯ç›´æ¥çœ‹ä»£ç å§, åœ¨æˆ‘ä»¬åŸå…ˆçš„é¡¹ç›®ä¸Šæ·»åŠ ä¸€ä¸ªæ–¹æ³•, å¹¶ä¸”åŠ å¤šä¸€ä¸ª<strong>UIView</strong>ç±»:</p>
</blockquote>

<pre><code class="language-objectivec">- (void)viewDidLoad {
    [super viewDidLoad];
    
    self.view.backgroundColor = [UIColor lightGrayColor];
    
    UIView *layerView = [[UIView alloc] init];
    layerView.backgroundColor = [UIColor whiteColor];
    layerView.center = self.view.center;
    layerView.bounds = CGRectMake(0, 0, 200, 200);
    
    [self.view addSubview:layerView];
    
    
    UIImage *image = [UIImage imageNamed:@&quot;bear&quot;];
    
    /**
     *  Contents
     */
    layerView.layer.contents = (__bridge id _Nullable)(image.CGImage);
    
    /**
     *  ContentsGravity
     */
    layerView.layer.contentsGravity = kCAGravityCenter;
    
    /**
     *  ContentsScale
     */
    layerView.layer.contentsScale = image.scale;
    
    /**
     *  MasksToBounds
     */
    layerView.layer.masksToBounds = YES;
    
    /**
     *  contentsRect
     */
    layerView.layer.contentsRect = CGRectMake(0, 0, 1.1, 1.1);
    
    
    [self addImage:[UIImage imageNamed:@&quot;bear&quot;] withContensRect:CGRectMake(0.25, 0.25, 0.5, 0.5)];
}

- (void)addImage:(UIImage *)image withContensRect:(CGRect)rect {
    
    UIView *view = [[UIView alloc] initWithFrame:CGRectMake(0, 0, 200, 200)];
    
    view.layer.contents = (__bridge id _Nullable)(image.CGImage);
    view.layer.contentsCenter = rect;
    
    [self.view addSubview:view];
}
</code></pre>

<blockquote>
<p>æ•ˆæœå›¾:</p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/2.CALayer/images/8.png" alt="8"/></p>

<blockquote>
<p>è¡¥å……ä¸€ä¸ªçŸ¥è¯†ç‚¹, å¦‚æœä½ æ˜¯ä½¿ç”¨Storyboardæˆ–è€…æ˜¯xibçš„è¯, ä½ å¯ä»¥åœ¨å³ä¾§çš„æ ç›®çœ‹åˆ°<strong>contentsCenter</strong></p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/2.CALayer/images/9.png" alt="9"/></p>

<hr/>

<h3 id="toc_8">CALayerçš„Delegate</h3>

<blockquote>
<p>é™åˆ°è¿™é‡Œ, åŸºæœ¬ä¸Šå°±å·²ç»ä»‹ç»å®Œäº†<strong>CALayer</strong>, ä½†è¿˜æœ‰ä¸€ç‚¹ä¹Ÿæ˜¯éœ€è¦æä¸€æçš„, <strong>CALayer</strong>é™¤äº†ä½¿ç”¨<strong>contents</strong>èµ‹å€¼<strong>CGImage</strong>æ¥æ˜¾ç¤ºå›¾å±‚ä¹‹å, è¿˜å¯ä»¥ä½¿ç”¨<strong>Core Graphics</strong>å»è¿›è¡Œç»˜åˆ¶, åœ¨<strong>UIView</strong>å°±å¯ä»¥çœ‹åˆ°è¿™ä¸ªæ–¹æ³•, å«åš<strong>-drawRect:</strong>.<br/>
<dr/><br/>
<strong>-drawRect:</strong>æ–¹æ³•é»˜è®¤æ²¡æœ‰å»å®ç°, å› ä¸ºåœ¨<strong>UIView</strong>ä¸­,<strong>backing image</strong>å¹¶ä¸æ˜¯å¿…é¡»çš„, ä½†å¦‚æœä½ å»è°ƒç”¨<strong>-drawRect:</strong>æ–¹æ³•, é‚£ä¹ˆUIViewå°±ä¼šç»™ä½ ç”Ÿæˆä¸€ä¸ªæ–°çš„<strong>backing image</strong>, è€Œè¿™ä¸ª<strong>backing image</strong>çš„åƒç´ å°ºå¯¸ç­‰äºè§†å›¾å¤§å°ä¹˜ä»¥<strong>contentsScale</strong>çš„å€¼.<br/>
<dr/><br/>
è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ä¸ªç‚¹, å¦‚æœä½ çš„è§†å›¾é‡Œä¸éœ€è¦åˆ›å»ºä¸€ä¸ª<strong>backing image</strong>çš„è¯, åƒä¸‡ä¸è¦å»å†™ä¸€ä¸ªç©ºçš„<strong>-drawRect:</strong>æ–¹æ³•, è¿™æ ·å­å°±ä¼šå¯¹CPUä¸å†…å­˜é€ æˆæµªè´¹, è¿™ä¹Ÿæ˜¯è‹¹æœå®˜æ–¹å»ºè®®çš„.<br/>
<dr/><br/>
æˆ‘ä»¬å…ˆæ¥è§£é‡Šä¸€ä¸‹<strong>-drawRect:</strong>æ–¹æ³•çš„å®ç°åŸç†:<br/>
<dr/></p>

<ul>
<li>å½“<strong>-drawRect:</strong>è¢«è°ƒç”¨,<strong>UIView</strong>ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„<strong>backing image</strong>.</li>
<li>ä¼šä½¿ç”¨<strong>Core Graphics</strong>å¯¹<strong>backing image</strong>è¿›è¡Œæç»˜.</li>
<li>ç„¶åè¿™ä¸ªæç»˜å¥½çš„<strong>backing image</strong>ä¼šè¢«ç¼“å­˜èµ·æ¥, ç­‰åˆ°å®ƒéœ€è¦è¢«æ›´æ–°çš„æ—¶å€™, å°±ä¼šå»ä½¿ç”¨.
<dr/>
å½“ç„¶, æˆ‘ä»¬è‡ªå·±ä¹Ÿå¯ä»¥æ‰‹åŠ¨å»è°ƒç”¨, æ¯”å¦‚å»è°ƒç”¨<strong>-setNeedsDisplay:</strong>, é‚£ä¹ˆè¢«é‡æ–°ç»˜åˆ¶çš„<strong>backing image</strong>å°±ä¼šç«‹é©¬æ˜¾ç¤ºå‡ºæ¥äº†.
<dr/>
æ€»è€Œè¨€ä¹‹, <strong>-drawRect:</strong>çœ‹ä¼¼æ˜¯<strong>UIView</strong>çš„æ–¹æ³•, ä½†å®é™…ä¸Šéƒ½æ˜¯åœ¨å†…éƒ¨å¯¹CALayerè¿›è¡Œäº†é‡ç»˜ä»¥åŠç¼“å­˜çš„æ“ä½œ.
<dr/>
è¿˜æœ‰, <strong>CALayer</strong>ä¹Ÿæœ‰ä¸€ä¸ª<strong>delegate</strong>çš„å±æ€§, è€Œä¸”æ˜¯<strong>id</strong>ç±»å‹, å¹¶å®ç°<strong>CALayerDelegate</strong>åè®®, å½“<strong>CALayer</strong>éœ€è¦ä¸€ä¸ªç‰¹å®šå†…å®¹æ—¶, å°±ä¼šä»ä»£ç†æ–¹æ³•é‡Œå»è¯·æ±‚, ç”±äº<strong>CALayerDelegate</strong>æ˜¯ä¸€ä¸ªéæ­£å¼çš„åè®®, æ‰€ä»¥å¹¶æ²¡æœ‰ç¥é©¬å±æ€§ç»™ä½ å¼•ç”¨, ç›´æ¥è°ƒç”¨ä»£ç†æ–¹æ³•å°±å¯ä»¥äº†.
<dr/>
å½“éœ€è¦è¢«é‡ç»˜çš„æ—¶å€™, <strong>CALayer</strong>å°±ä¼šå»è°ƒç”¨:</li>
</ul>
</blockquote>

<pre><code class="language-objectivec">    -(void)displayLayer:(CALayer *)layer;
</code></pre>

<blockquote>
<p>å¦‚æœä½ è¿˜æƒ³å†é‡ç»˜çš„æ—¶å€™è®¾ç½®ä¸€ä¸‹<strong>contents</strong>çš„è¯, é‚£ä¹ˆå°±è¦åœ¨è¿™ä¸ªæ–¹æ³•é‡Œå»å®ç°, ä¸ç„¶åœ¨åˆ«çš„æ–¹æ³•é‡Œå°±æ²¡æ³•åšåˆ°äº†.<br/>
<dr/><br/>
ä½†å¦‚æœæ²¡æœ‰å®ç°ä»¥ä¸Šçš„æ–¹æ³•æ—¶, é‚£ä¹ˆå°±ä¼šå»è°ƒç”¨:</p>
</blockquote>

<pre><code class="language-objectivec">    - (void)drawLayer:(CALayer *)layer inContext:(CGContextRef)ctx;
</code></pre>

<blockquote>
<p>åœ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•ä¹‹å‰, <strong>CALayer</strong>ä¼šåˆ›å»ºä¸€ä¸ªé€‚åˆå°ºå¯¸çš„<strong>backing image</strong>, å½“ç„¶, å°ºå¯¸è‚¯å®šæ˜¯ç”±<strong>bounds</strong>å’Œ<strong>contentsScale</strong>å†³å®šçš„, è¿˜æœ‰ä¸€ä¸ª<strong>Core Graphics</strong>ç»˜åˆ¶çš„ä¸Šä¸‹æ–‡, æœªç»˜åˆ¶<strong>backing image</strong>åšå‡†å¤‡, ç­‰çš„å°±æ˜¯<strong>ctx</strong>çš„ä¼ å…¥.<br/>
<dr/><br/>
è¯´äº†é‚£ä¹ˆå¤šæˆ‘ä»¬ç›´æ¥ç”¨ä»£ç æ¼”ç¤ºå§~</p>
</blockquote>

<pre><code class="language-objectivec">- (void)createNewLayerWithSuperView {
    
    // Background View
    UIView *backgroundView = [[UIView alloc] initWithFrame:CGRectMake(220, 0, 100, 100)];
    backgroundView.backgroundColor = [UIColor whiteColor];
    
    [self.view addSubview:backgroundView];
    
    // Blue Layer
    CALayer *blueLayer = [CALayer layer];
    
    blueLayer.frame = CGRectMake(25, 25, 50, 50);
    blueLayer.backgroundColor = [UIColor blueColor].CGColor;
    
    // Set Layer Delegate
    blueLayer.delegate = self;
    
    // Set Layer contentsScale
    blueLayer.contentsScale = [UIScreen mainScreen].scale;
    
    [backgroundView.layer addSublayer:blueLayer];
    
    [blueLayer display];
}

- (void)drawLayer:(CALayer *)layer inContext:(CGContextRef)ctx {
    
    CGContextSetLineWidth(ctx, 5);
    CGContextSetStrokeColorWithColor(ctx, [UIColor redColor].CGColor);
    CGContextStrokeEllipseInRect(ctx, layer.bounds);
}
</code></pre>

<blockquote>
<p>æ•ˆæœå›¾: </p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/2.CALayer/images/10.png" alt="10"/></p>

<blockquote>
<p>çœ‹åˆ°æ•ˆæœå›¾ä»£ç ä¹‹å, æœ‰ä¸¤ç‚¹æˆ‘ä»¬æ˜¯éœ€è¦æ³¨æ„ä¸€ä¸‹çš„:<br/>
<dr/></p>

<ul>
<li>ä¸åŒçš„<strong>CALayer</strong>åœ¨ä¸åŒçš„<strong>UIView</strong>è§†å›¾ä¸­ä½¿ç”¨, æ˜¯ä¸ä¼šè‡ªåŠ¨å»é‡è½½å®ƒçš„å†…å®¹çš„, æ‰€ä»¥åœ¨äº‹ä¾‹å½“ä¸­, æˆ‘ä»¬ç”¨<strong>blueLayer</strong>è°ƒç”¨äº†<strong>display</strong>è¿™ä¸ªæ–¹æ³•.</li>
<li>åœ¨äº‹ä¾‹å½“ä¸­, æˆ‘ä»¬å¹¶æ²¡æœ‰å¯¹<strong>blueLayer</strong>è®¾ç½®<strong>masksToBounds</strong>å±æ€§, ä½†æ‰€ç»˜åˆ¶çš„é‚£ä¸ªåœ†ä»ç„¶è¢«è£å‰ªäº†ä¸€äº›, è¿™ä¸ªæ˜¯å› ä¸ºæˆ‘ä»¬åœ¨ä½¿ç”¨<strong>CALayerDelegate</strong>çš„æ—¶å€™, å¹¶æ²¡æœ‰è®©éœ€è¦æç»˜çš„<strong>backing image</strong>æ”¯æŒè¶…å‡ºè¾¹ç•Œå¤–çš„æ”¯æŒ.</li>
</ul>

<p><dr/><br/>
èŠåˆ°è¿™é‡Œ, è™½ç„¶æˆ‘ä»¬çŸ¥é“äº†<strong>CALayerDelegate</strong>, ä½†åœ¨å®é™…å¼€å‘å½“ä¸­, æˆ‘ä»¬åŸºæœ¬ä¸Šéå¸¸éå¸¸å°‘å»æ¥è§¦å®ƒ, å› ä¸ºå½“<strong>UIView</strong>åˆ›å»º<strong>backing image</strong>çš„æ—¶å€™, å°±ä¼šé»˜è®¤æŠŠ<strong>CALayerDelegate</strong>è®¾ç½®ä¸ºå®ƒè‡ªå·±, åŒæ—¶ä¹Ÿä¼šæä¾›ä¸€ä¸ª<strong>- (void)displayLayer:(CALayer *)layer;</strong>çš„å®ç°, æ‰€ä»¥åŸºæœ¬ä¸Šä¸ä¼šé‡åˆ°ä»€ä¹ˆé—®é¢˜.<br/>
<dr/><br/>
å½“ä½ ä½¿ç”¨æœ‰<strong>backing image</strong>çš„<strong>UIView</strong>æ—¶, ä½ ä¹Ÿä¸å¿…å®ç°ä¸‹é¢ä¸¤ä¸ªæ–¹æ³•</p>
</blockquote>

<pre><code class="language-objectivec">    - (void)displayLayer:(CALayer *)layer;
    - (void)drawLayer:(CALayer *)layer inContext:(CGContextRef)ctx;
</code></pre>

<blockquote>
<p>å› ä¸º<strong>UIView</strong>æä¾›äº†ä¸€ä¸ª<strong>- (void)drawRect:(CGRect)rect;</strong>çš„æ–¹æ³•, åªè¦ä½ å®ç°äº†è¿™ä¸ªæ–¹æ³•, é‚£ä¹ˆå‰©ä¸‹çš„ä¸œè¥¿<strong>UIView</strong>éƒ½æ˜¯å…¨éƒ¨å¸®ä½ å®Œæˆ.</p>
</blockquote>

<hr/>

<h3 id="toc_9">æ€»ç»“ä¸€ä¸‹</h3>

<blockquote>
<p>ä¸å¾—ä¸è¯´, è¿™æ¬¡çš„å†…å®¹æœ‰äº›å¤š, è¿˜æ˜¯æ¥æ€»ç»“ä¸€ä¸‹:<br/>
<dr/></p>

<ul>
<li><strong>contents</strong>æ˜¯ç»™<strong>CALayer</strong>è®¾ç½®å†…å®¹çš„ä¸€ä¸ªå±æ€§</li>
<li><strong>ContentGravity</strong>æ˜¯ç»™<strong>CALayer</strong>è®¾ç½®å†…å®¹çš„æ˜¾ç¤º, ç±»ä¼¼<strong>UIView</strong>çš„<strong>contentModel</strong>.</li>
<li><strong>contentsScale</strong>å®šä¹‰å›¾å±‚çš„åƒç´ å’Œè§†å›¾æ¯”ä¾‹å¤§å°, é»˜è®¤å¤§å°ä¸º<strong>1.0f</strong>, å¹¶ä¸”æ˜¯CGFloatç±»å‹.</li>
<li><strong>maskToBounds</strong>æ˜¯ä¸€ä¸ª<strong>BOOL</strong>ç±»å‹, é»˜è®¤ä¸º<strong>NO</strong>, å¦‚æœè®¾ç½®ä¸º<strong>YES</strong>, åˆ™ä¼šè£å‰ªæ‰è¶…å‡ºè§†å›¾çš„éƒ¨åˆ†.</li>
<li><strong>contentsRect</strong>æ˜¯ä¸€ä¸ªåæ ‡è½´, é»˜è®¤æ˜¯<strong>CGRectMake(0, 0, 1, 1)</strong>, è¾“å…¥å¯¹åº”çš„åæ ‡è½´, å¯ä»¥è®©<strong>CALayer</strong>æ˜¾ç¤ºæ‰€è¾“å…¥åæ ‡è½´çš„åŒºåŸŸå†…å®¹.</li>
<li><strong>cntentsCenter</strong>æ˜¯ç”¨æ¥å®šä¹‰ä¸€ä¸ªå›ºå®šçš„è¾¹æ¡†å’Œä¸€ä¸ªå›¾å±‚ä¸Šå¯æ‹‰ä¼¸çš„åŒºåŸŸ.</li>
<li><strong>delegate</strong>æ˜¯ç”¨æ¥å®šä¹‰CALayerDelegateå¯¹è±¡, å½“UIViewåˆ›å»ºCALayerçš„æ—¶å€™, é»˜è®¤å°±ä¼šå®ç°, å¹¶ä¸”æä¾›ä¸€ä¸ª<strong>- (void)displayLayer:(CALayer *)layer;</strong>æ–¹æ³•çš„å®ç°.</li>
</ul>
</blockquote>

<hr/>

<h3 id="toc_10">å·¥ç¨‹åœ°å€</h3>

<p>é¡¹ç›®åœ°å€: <a href="https://github.com/CainRun/CoreAnimation">https://github.com/CainRun/CoreAnimation</a></p>

<hr/>

<h3 id="toc_11">æœ€å</h3>

<p><center>ç å­—å¾ˆè´¹è„‘, çœ‹å®˜èµç‚¹é¥­é’±å¯å¥½</center></p>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/WeChatPay-Objective-C/Images/%E5%BE%AE%E4%BF%A1QRC.jpg" alt="å¾®ä¿¡"/></p>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/WeChatPay-Objective-C/Images/%E6%94%AF%E4%BB%98%E5%AE%9DQRC.jpg" alt="æ”¯ä»˜å®"/></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ç©è½¬iOSå¼€å‘ï¼š1.ã€ŠCore Animationã€‹åŸºç¡€æ¦‚å¿µ]]></title>
    <link href="https://cainrun.github.io/14770254062641.html"/>
    <updated>2016-10-21T12:50:06+08:00</updated>
    <id>https://cainrun.github.io/14770254062641.html</id>
    <content type="html"><![CDATA[
<h3 id="toc_0">ä½œè€…æ„Ÿè¨€</h3>

<blockquote>
<p>æœ€è¿‘ä½œè€…ä¸€ç›´æœ‰ä¸€äº›è¿·ç³Š, æ„Ÿè§‰åœ¨ç ”ç©¶ä¸Šæœ‰äº†ä¸€äº›è¿·ç³Š, ä¸çŸ¥é“æ€ä¹ˆå¾€ä¸‹ç ”ç©¶äº†, å’¨è¯¢äº†ä¸€ä¸‹æœ‹å‹å’Œä¸€äº›å‰è¾ˆ, å†³å®šå…ˆç©ä¸€ç©<strong>Core Animation</strong>, æ¯•ç«Ÿæ˜¯<strong>iOS</strong>çš„æ ¸å¿ƒå±‚ä¹‹ä¸€, ä¹Ÿæ˜¯æœ€å¸å¼•äººçš„åœ°æ–¹ä¹‹ä¸€, ä»Šå¤©å°±è®©æˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹<strong>Core Animation</strong>çš„ä¸€äº›æ¦‚å¿µçŸ¥è¯†.<br/>
<dr/><br/>
<strong><font color=purple>æœ€å:</font></strong><br/>
<strong><font color=purple>å¦‚æœä½ æœ‰æ›´å¥½çš„å»ºè®®æˆ–è€…å¯¹è¿™ç¯‡æ–‡ç« æœ‰ä¸æ»¡çš„åœ°æ–¹, è¯·è”ç³»æˆ‘, æˆ‘ä¼šå‚è€ƒä½ ä»¬çš„æ„è§å†è¿›è¡Œä¿®æ”¹, è”ç³»æˆ‘æ—¶, è¯·å¤‡æ³¨</strong><code>Core Animation</code><strong>å¦‚æœè§‰å¾—å¥½çš„è¯, å¸Œæœ›å¤§å®¶ä¹Ÿå¯ä»¥æ‰“èµä¸€ä¸‹~å˜»å˜»~ç¥å¤§å®¶å­¦ä¹ æ„‰å¿«~è°¢è°¢~</font></strong></p>
</blockquote>

<span id="more"></span><!-- more -->

<hr/>

<h3 id="toc_1">ç®€ä»‹</h3>

<blockquote>
<ul>
<li><strong>Core Animation</strong>æ˜¯<strong>iOS</strong>ä¸<strong>OS X</strong>å¹³å°ä¸Šè´Ÿè´£å›¾å½¢æ¸²æŸ“ä¸åŠ¨ç”»çš„åŸºç¡€è®¾æ–½ã€‚</li>
<li><strong>Core Animation</strong>å¯ä»¥åŠ¨ç”»è§†å›¾å’Œå…¶ä»–çš„å¯è§†å…ƒç´ ã€‚</li>
<li><strong>Core Animation</strong>ä¸ºä½ å®Œæˆäº†å®ç°åŠ¨ç”»æ‰€éœ€çš„å¤§éƒ¨åˆ†ç»˜å¸§å·¥ä½œã€‚</li>
<li>ä½ åªéœ€åœ¨é…ç½®å°‘é‡çš„åŠ¨ç”»å‚æ•°ï¼ˆå¦‚å¼€å§‹ç‚¹ä½ç½®å’Œç»“æŸç‚¹ä½ç½®ï¼‰å°±å¯å¯åŠ¨<strong>Core Animation</strong>ã€‚</li>
<li><strong>Core Animation</strong>å°†å¤§éƒ¨åˆ†å®é™…çš„ç»˜å›¾ä»»åŠ¡äº¤ç»™äº†å›¾å½¢ç¡¬ä»¶å¤„ç†ï¼Œå›¾å½¢ç¡¬ä»¶ä¼šåŠ é€Ÿå›¾å½¢æ¸²æŸ“çš„é€Ÿåº¦ã€‚</li>
<li>è¿™ç§è‡ªåŠ¨åŒ–çš„å›¾å½¢åŠ é€Ÿè®©åŠ¨ç”»å…·æœ‰æ›´é«˜çš„å¸§ç‡ä¸”æ›´åŠ å¹³æ»‘ï¼Œä½†è¿™å¹¶ä¸ä¼šå¢åŠ <strong>CPU</strong>çš„è´Ÿæ‹…è€Œå¯¼è‡´å½±å“ä½ åº”ç”¨çš„è¿è¡Œé€Ÿåº¦ã€‚</li>
</ul>

<p>ä»¥ä¸Šçš„æ–‡å­—éƒ½æ˜¯ä»å®˜æ–¹æ–‡æ¡£é‡Œç›´æ¥æ‹·è´çš„, å¦‚æœæœ‰å•¥é—®é¢˜, ç›´æ¥å»PK<a href="https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/CoreAnimation_guide/Introduction/Introduction.html">é€šç”¨å®˜æ–¹æ–‡æ¡£</a>å’Œ<a href="https://developer.apple.com/library/content/documentation/WindowsViews/Conceptual/ViewPG_iPhoneOS/Introduction/Introduction.html">iOSå®˜æ–¹æ–‡æ¡£</a>~~</p>
</blockquote>

<hr/>

<h3 id="toc_2">å›¾å±‚ä¸è§†å›¾ç»“æ„</h3>

<blockquote>
<p>åœ¨æˆ‘ä»¬æ—¥å¸¸å¼€å‘<strong>iOS</strong>æˆ–è€…æ˜¯<strong>Mac</strong>åº”ç”¨ä¸­, æˆ‘ä»¬éƒ½é¿å…ä¸äº†å¯¹<strong>UI</strong>çš„å¸ƒå±€(ä¸ç„¶è¦UIè®¾è®¡å¸ˆå¹²å˜›), é‚£æˆ‘ä»¬ä¸€èˆ¬æ˜¯æ€ä¹ˆå»çœ‹åº”ç”¨ä¸­çš„å›¾å±‚ç»“æ„å‘¢? è®©æˆ‘ä»¬ç›´æ¥æ¥çœ‹ä¸€ä¸ª<strong>Demo</strong>å§.</p>

<p>åˆ›å»ºä¸€ä¸ªæ–°çš„é¡¹ç›®, ç„¶ååœ¨é¡¹ç›®å½“ä¸­éšæ„æ·»åŠ ä¸€ä¸ªæˆ–è€…å¤šä¸ª<strong>UI</strong>æ§ä»¶.</p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/1.viewLayer/images/1.png" alt="1"/></p>

<blockquote>
<p>è¿è¡Œäº†é¡¹ç›®ä¹‹å, æ‰¾åˆ°æŸ¥çœ‹å›¾å±‚çš„æŒ‰é’®, ç‚¹å‡»ä¹‹åå°±ä¼šè·³è½¬åˆ°æŸ¥çœ‹å›¾å±‚çš„ç•Œé¢.</p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/1.viewLayer/images/2.png" alt="2"/></p>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/1.viewLayer/images/3.png" alt="3"/></p>

<blockquote>
<p>å†æ¢ä¸ªè§’åº¦çœ‹çœ‹~~</p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/CoreAnimation/master/1.viewLayer/images/4.png" alt="4"/></p>

<blockquote>
<p>åœ¨<strong>iOS</strong>å½“ä¸­, æ— è®ºæ˜¯ç¥é©¬<strong>UIButton</strong>,<strong>UIScrollView</strong>, è¿˜æ˜¯ç¥é©¬<strong>UITableView</strong>, éƒ½æ˜¯åŸºäº<strong>UIView</strong>åŸºç±»æ´¾ç”Ÿè€Œæ¥çš„, è€Œ<strong>UIView</strong>æ˜¯å¯ä»¥å¤„ç†<strong>Touch</strong>äº‹ä»¶, ä¹Ÿæ”¯æŒ<strong>Core Graphics</strong>çš„ç»˜ç”», ä¹Ÿå¯ä»¥åšä»¿å°„å˜æ¢(ä¹Ÿå°±æ˜¯ç¥é©¬æ—‹è½¬, ç¼©æ”¾äº‹ä»¶), å½“ç„¶, ä¹Ÿå¯ä»¥åšç±»ä¼¼äºæ»‘åŠ¨, æ¸å˜ç­‰<strong>UIView</strong>åŸºç¡€åŠ¨ç”».</p>
</blockquote>

<hr/>

<h3 id="toc_3">CALayer</h3>

<blockquote>
<p><strong>CALayer</strong>å…¶å®æ˜¯å’Œ<strong>UIView</strong>çš„æ¦‚å¿µå·®ä¸å¤š, ä¹Ÿæ˜¯åŒæ ·è¢«å±‚çº§å…³ç³»æ ‘æ‰€ç®¡ç†, ä¹Ÿä¸€æ ·æœ‰ç¥é©¬å›¾ç‰‡, æ–‡æœ¬, èƒŒæ™¯è‰²ç­‰å†…å®¹, æˆ–è€…æ˜¯ç®¡ç†ä¸€äº›å­å›¾å±‚ç­‰ç­‰, ä½†<strong>CALayer</strong>å’Œ<strong>UIView</strong>æœ€å¤§çš„åŒºåˆ«æ˜¯åœ¨äº,<strong>CALayer</strong>å¹¶ä¸èƒ½å¤„ç†ç”¨æˆ·äº¤äº’, å³ä½¿<strong>CALayer</strong>æä¾›äº†ä¸€äº›æ–¹æ³•æ¥åˆ¤æ–­è§¦ç‚¹æ˜¯å¦åœ¨å›¾å±‚çš„èŒƒå›´ä¹‹å†….</p>
</blockquote>

<hr/>

<h3 id="toc_4">UIViewå’ŒCALayerå±‚çº§å…³ç³»</h3>

<blockquote>
<p>ç”¨è¿‡<strong>UIView</strong>çš„æœ‹å‹ä»¬å…¶å®éƒ½çŸ¥é“, æ¯ä¸€ä¸ª<strong>UIView</strong>å½“ä¸­éƒ½æœ‰ä¸€ä¸ª<strong>CALayer</strong>å®ä¾‹çš„å›¾å±‚å±æ€§, ä¹Ÿå°±æ˜¯æ‰€è°“<strong>backing layer</strong>.</p>

<p><strong>UIView</strong>çš„èŒè´£æ˜¯ç”¨æ¥åˆ›å»ºå¹¶ç®¡ç†è¿™ä¸ªå›¾å±‚, ä»¥ç¡®ä¿å±‚çº§å…³ç³»ä¸­æ·»åŠ æˆ–è€…è¢«ç§»é™¤çš„æ—¶å€™, æ‰€å…³è”çš„<strong>Layer</strong>ä¹Ÿä¼šæœ‰åŒæ ·çš„æ“ä½œ.</p>

<p>è™½ç„¶<strong>UIView</strong>æ˜¯ä½œä¸ºä¸€ä¸ªç®¡ç†è€…, ä½†å®é™…ä¸Šæ˜¾ç¤ºåœ¨å±å¹•ä¸Šä»¥åŠåšåŠ¨ç”»æ•ˆæœçš„éƒ½æ˜¯<strong>Layer</strong>,<strong>UIView</strong>ä»…ä»…åªæ˜¯å¯¹<strong>Layer</strong>çš„ä¸€ä¸ªå°è£…, æä¾›äº†ä¸€äº›è€Œå¤–çš„æ–¹æ³•, æ¯”å¦‚<strong>Touch</strong>çš„åŠŸèƒ½,<strong>Core Animation</strong>åº•å±‚æ–¹æ³•çš„é«˜çº§<strong>API</strong>, æ‰€ä»¥<strong>UIView</strong>å’Œ<strong>CALayer</strong>æ˜¯å¤„äºä¸€ä¸ªå¹³çº§çš„å…³ç³».</p>
</blockquote>

<hr/>

<h3 id="toc_5">ç–‘æƒ‘</h3>

<blockquote>
<p>è¯´åˆ°è¿™é‡Œ, å°±ä¼šæœ‰ä¸€ä¸ªç–‘æƒ‘, ä¸ºä»€ä¹ˆè‹¹æœè¦æŠŠ<strong>UIView</strong>å’Œ<strong>CALayer</strong>å¤„äºä¸€ä¸ªå¹³çº§çš„å…³ç³»å‘¢?(æˆ–è®¸æœ‰äººä¼šæœ‰è¿™æ ·å­çš„ç–‘é—®)</p>

<p>å…¶å®åŸå› å¾ˆç®€å•, æ˜¯ä¸ºäº†èŒè´£åˆ†ç¦», ä¹Ÿç®—æ˜¯æ¨¡å—åŒ–åˆ’åˆ†å§, å› ä¸ºåœ¨<strong>Mac OS</strong>å½“ä¸­, å¹¶æ²¡æœ‰<strong>UIView</strong>è¿™ä¸ªç±», æ‰€ä»¥å¹¶ä¸èƒ½å¤„ç†<strong>Touch</strong>äº‹ä»¶, ä½†å´æœ‰<strong>CALayer</strong>, æ‰€ä»¥è‹¹æœä¸ºäº†èƒ½å¤Ÿè®©<strong>Mac OS</strong>å’Œ<strong>iOS</strong>ä¸¤ä¸ªç³»ç»Ÿç›¸äº’å…±äº«ä»£ç , ç›´æ¥æŠŠ<strong>CALayer</strong>ç»™ç‹¬ç«‹å‡ºæ¥äº†~~</p>
</blockquote>

<hr/>

<h3 id="toc_6">CALayerçš„èƒ½åŠ›</h3>

<blockquote>
<p>å…¶å®åœ¨ç³»ç»Ÿåº“å½“ä¸­, è‹¹æœå·²ç»é€šè¿‡<strong>UIView</strong>æä¾›äº†è®¸å¤šé«˜çº§çš„<strong>API</strong>, é—´æ¥çš„ä½¿å¾—åŠ¨ç”»å˜å¾—å¾ˆç®€å•.</p>

<p>ä½†è¿™æ ·å­å°±å¸¦æ¥å¦å¤–çš„ä¸€ä¸ªé—®é¢˜, å°±æ˜¯çµæ´»æ€§çš„ç¼ºå¤±, æ‰“ä¸ªæ¯”æ–¹, å¦‚æœä½ æƒ³åœ¨åº•å±‚åšä¸€äº›é¢å¤–çš„æ“ä½œ, é€šè¿‡ç³»ç»Ÿæä¾›çš„<strong>API</strong>æ˜¯æ²¡æ³•å®ç°çš„, è¿™ä¸ªæ—¶å€™, æˆ‘ä»¬é™¤äº†å»å­¦ä¹ å’Œäº†è§£<strong>Core Animation</strong>ä¹‹å¤–, å†ä¹Ÿæ²¡æœ‰å…¶ä»–é€”å¾„äº†.</p>

<p>é‚£ä¹ˆè¯´åˆ°åº•,<strong>CALayer</strong>åˆ°åº•èƒ½ç”¨æ¥åšä»€ä¹ˆå‘¢? æœ‰å¥½å‡ ä¸ªç‚¹, æ¯”å¦‚:</p>

<ul>
<li>é˜´å½±, åœ†è§’, è¾¹æ¡†</li>
<li>3Då˜æ¢(æ¯”å¦‚æ‹‰ä¼¸, æ”¾å¤§, ç¼©å°ç­‰)</li>
<li>éçŸ©å½¢èŒƒå›´</li>
<li>é€æ˜é®ç½©</li>
<li>å¤šçº§éçº¿æ€§åŠ¨ç”»</li>
</ul>

<p>å¤§è‡´ä¸Šå°±è¿™ä¸€äº›, åç»­æˆ‘ä»¬ä¼šé€šè¿‡å­¦ä¹ <strong>Core Animation</strong>, ä¼šäº†è§£æ›´å¤šçš„<strong>Layer</strong>, ä»¥åŠæ€ä¹ˆåˆ©ç”¨<strong>Layer</strong>åšå‡ºæˆ‘ä»¬æƒ³åšçš„æ•ˆæœ.</p>
</blockquote>

<hr/>

<h3 id="toc_7">ä½¿ç”¨CALayer</h3>

<blockquote>
<p>ä¸€èˆ¬æ¥è®², åœ¨æˆ‘ä»¬æ—¥å¸¸å¼€å‘ä¸­, éƒ½æ˜¯é¢å¯¹è§†å›¾å¼€å‘, ä½†å¦‚æœæŸäº›ç‰¹æ®Šçš„åœºæ™¯, æˆ‘ä»¬è¿˜æ˜¯éœ€è¦é¢å‘CALayeræ¥è¿›è¡Œå¼€å‘çš„, æ¯”å¦‚</p>

<ul>
<li>å¼€å‘ä¸€ä¸ªå¯åŒæ—¶åœ¨Mac OSå’ŒiOSä¸¤ä¸ªå¹³å°ä¸Šä½¿ç”¨çš„åº”ç”¨</li>
<li>ä½¿ç”¨å¤šç§çš„CALayerå­ç±», å¹¶ä¸”ä¸æƒ³åˆ›å»ºä¸€ä¸ªUIViewå»å°è£…å®ƒä»¬</li>
<li>åšä¸€äº›å¯¹æ€§èƒ½ç‰¹åˆ«æŒ‘å‰”çš„å·¥ä½œ(æš‚æ—¶æˆ‘ä¹Ÿæ²¡æƒ³åˆ°, çŸ¥é“çš„æœ‹å‹å¯ä»¥å’Œæˆ‘è¯´è¯´)</li>
</ul>

<p>ä½†æ€»çš„æ¥è¯´, ç›´æ¥é¢å‘è§†å›¾å¼€å‘, è¦æ¯”é¢å‘<strong>CALayer</strong>å¼€å‘çš„è¦ç®€å•.</p>
</blockquote>

<hr/>

<h3 id="toc_8">æ€»ç»“ä¸€ä¸‹</h3>

<blockquote>
<p>è¯´äº†é‚£ä¹ˆå¤šä¸œè¥¿, å…¶å®é‡ç‚¹å°±é‚£ä¹ˆå‡ ä¸ª: </p>

<ul>
<li>CALayerä¸UIViewæ˜¯å¹³çº§å…³ç³»</li>
<li>CALayerä¸UIViewçš„ç›¸åŒç‚¹ä¸åŒºåˆ«</li>
<li>CALayerå¯è·¨å¹³å°ä½¿ç”¨</li>
<li>CALayerä¸èƒ½å¤Ÿå“åº”äº‹ä»¶</li>
<li>UIViewæ˜¯åŸºäºCALayerå°è£…çš„ä¸€ä¸ªç±», å¹¶æä¾›<strong>Touch</strong>äº‹ä»¶</li>
</ul>
</blockquote>

<hr/>

<h3 id="toc_9">å·¥ç¨‹åœ°å€</h3>

<p>é¡¹ç›®åœ°å€: <a href="https://github.com/CainRun/CoreAnimation">https://github.com/CainRun/CoreAnimation</a></p>

<hr/>

<h3 id="toc_10">æœ€å</h3>

<p><center>ç å­—å¾ˆè´¹è„‘, çœ‹å®˜èµç‚¹é¥­é’±å¯å¥½</center></p>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/WeChatPay-Objective-C/Images/%E5%BE%AE%E4%BF%A1QRC.jpg" alt="å¾®ä¿¡"/></p>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/WeChatPay-Objective-C/Images/%E6%94%AF%E4%BB%98%E5%AE%9DQRC.jpg" alt="æ”¯ä»˜å®"/></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ç©è½¬iOSå¼€å‘ï¼šTouch IDé›†æˆ]]></title>
    <link href="https://cainrun.github.io/14758230794995.html"/>
    <updated>2016-10-07T14:51:19+08:00</updated>
    <id>https://cainrun.github.io/14758230794995.html</id>
    <content type="html"><![CDATA[
<h3 id="toc_0">ä½œè€…æ„Ÿè¨€</h3>

<blockquote>
<p>è¿™ä¸ªå›½åº†ç”±äºç§ç§åŸå› , è¿‡çš„ä¸å¤ªå®‰ç¨³, æ¬å®¶, åŠè¯, ä¸œè·‘è¥¿è·‘, å¿™çš„å‹æ ¹å°±ä¸åƒæ˜¯åœ¨è¿‡èŠ‚....ä¸è¿‡ç®—äº†, æŒ‘æœ€åä¸€å¤©å†™å†™åšæ–‡.<br/>
<dr/><br/>
<strong><font color=purple>æœ€å:</font></strong><br/>
<strong><font color=purple>å¦‚æœä½ æœ‰æ›´å¥½çš„å»ºè®®æˆ–è€…å¯¹è¿™ç¯‡æ–‡ç« æœ‰ä¸æ»¡çš„åœ°æ–¹, è¯·è”ç³»æˆ‘, æˆ‘ä¼šå‚è€ƒä½ ä»¬çš„æ„è§å†è¿›è¡Œä¿®æ”¹, è”ç³»æˆ‘æ—¶, è¯·å¤‡æ³¨</strong><code>Apple Pay</code><strong>å¦‚æœè§‰å¾—å¥½çš„è¯, å¸Œæœ›å¤§å®¶ä¹Ÿå¯ä»¥æ‰“èµä¸€ä¸‹~å˜»å˜»~ç¥å¤§å®¶å­¦ä¹ æ„‰å¿«~è°¢è°¢~</font></strong></p>
</blockquote>

<span id="more"></span><!-- more -->

<hr/>

<h3 id="toc_1">ç®€ä»‹</h3>

<blockquote>
<p><strong><code>Touch ID</code></strong>æ˜¯è‹¹æœå…¬å¸çš„ä¸€ç§æŒ‡çº¹è¯†åˆ«æŠ€æœ¯ã€‚è‹¹æœæŠŠç”¨æˆ·çš„æŒ‡çº¹æ•°æ®å­˜æ”¾åœ¨å¤„ç†å™¨çš„<strong><code>å®‰å…¨åŒºåŸŸ</code></strong>ä¸­ï¼Œå……åˆ†ä¿æŠ¤ç”¨æˆ·çš„æ•°æ®å®‰å…¨ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè‹¹æœè¿˜æœ‰å¦å¤–ä¸€é“æŒ‡çº¹æ•°æ®å®‰å…¨é˜²çº¿ï¼Œä»¥ä¸€ç§å‰æ‰€æœªæœ‰çš„ç¡¬ä»¶æŠ€æœ¯å®ç°äº†å¯¹ç”¨æˆ·æ•°æ®çš„ä¿æŠ¤ã€‚</p>

<p>åœ¨é›†æˆçš„æ—¶å€™éå¸¸çš„ç®€å•, åŸºæœ¬ä¸Šæ²¡å¤šå°‘ä¸œè¥¿å¯ä»¥å†™çš„, è¿™é‡Œæˆ‘å°±ç®€å•çš„å†™å†™.</p>

<p><strong><font color=red>PS: ç”±äºTouch IDåªèƒ½åœ¨çœŸæœºä¸Šè°ƒè¯•, æ‰€ä»¥æ¨¡æ‹Ÿå™¨æ˜¯æ²¡æ³•ç”¨æ¥è°ƒè¯•.</font></strong></p>
</blockquote>

<hr/>

<h3 id="toc_2">åˆ›å»ºå·¥ç¨‹</h3>

<blockquote>
<p>ç›´æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„å·¥ç¨‹, å¹¶ä¸”å‘½åä¸º<strong><code>SimpleTouchID</code></strong>, ç„¶ååœ¨<strong><code>Storyboard</code></strong>æ‹–ä¸€ä¸ª<strong><code>UIButton</code></strong>, ç„¶åå…³è”åˆ°<strong><code>ViewController</code></strong>.</p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/SimpleTouchID/master/images/1.png" alt="1"/></p>

<blockquote>
<p>å…³è”å®Œæˆä¹‹å, å¯¼å…¥<strong><code>LocalAuthentication</code></strong>ä¾èµ–åº“, åœ¨<strong><code>ViewController</code></strong>ä¹Ÿåˆ«å¿˜è®°å¯¼å…¥.</p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/SimpleTouchID/master/images/2.png" alt="2"/><br/>
<img src="https://raw.githubusercontent.com/CainRun/SimpleTouchID/master/images/3.png" alt="3"/></p>

<hr/>

<h3 id="toc_3">å®ç°Touch IDæ ¡éªŒ</h3>

<blockquote>
<p>è¿™é‡Œçš„ä»£ç éå¸¸ç®€å•è¿™é‡Œå°±ä¸ç»†è¯´äº†, å”¯ä¸€ä¸å¤ªä¸€æ ·çš„å°±æ˜¯, åœ¨<strong><code>iOS 9</code></strong>ä¹‹åæ–°å¢äº†ä¸‰ä¸ªæ ¡éªŒçš„çŠ¶æ€, å¤§å®¶å¯ä»¥çœ‹çœ‹<strong><code>Demo</code></strong>é‡Œçš„æ³¨é‡Š.</p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/SimpleTouchID/master/images/4.png" alt="4"/><br/>
<img src="https://raw.githubusercontent.com/CainRun/SimpleTouchID/master/images/5.png" alt="5"/></p>

<hr/>

<h3 id="toc_4">æœ€ç»ˆæ•ˆæœ</h3>

<p><img src="https://raw.githubusercontent.com/CainRun/SimpleTouchID/master/images/0.gif" alt="0"/></p>

<hr/>

<h3 id="toc_5">å·¥ç¨‹åœ°å€</h3>

<p>é¡¹ç›®åœ°å€: <a href="https://github.com/CainRun/SimpleTouchID">https://github.com/CainRun/SimpleTouchID</a></p>

<hr/>

<h3 id="toc_6">æœ€å</h3>

<p><center>ç å­—å¾ˆè´¹è„‘, çœ‹å®˜èµç‚¹é¥­é’±å¯å¥½</center></p>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/WeChatPay-Objective-C/Images/%E5%BE%AE%E4%BF%A1QRC.jpg" alt="å¾®ä¿¡"/></p>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/WeChatPay-Objective-C/Images/%E6%94%AF%E4%BB%98%E5%AE%9DQRC.jpg" alt="æ”¯ä»˜å®"/></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ç©è½¬iOSå¼€å‘ï¼šé›†æˆ Apple Pay]]></title>
    <link href="https://cainrun.github.io/14747805717408.html"/>
    <updated>2016-09-25T13:16:11+08:00</updated>
    <id>https://cainrun.github.io/14747805717408.html</id>
    <content type="html"><![CDATA[
<h3 id="toc_0">ä½œè€…æ„Ÿè¨€</h3>

<blockquote>
<p>åœ¨ä¸­ç§‹è¿‡åç»ˆäºæŠŠå›½å†…çš„ä¸‰å¤§æ”¯ä»˜å¹³å°<strong><code>SDK</code></strong>é›†æˆéƒ½æå®šäº†, ç°åœ¨æˆ‘ä»¬ç»ˆäºå¯ä»¥æ¥ç ”ç©¶<strong><code>Apple</code></strong>è‡ªå®¶çš„æ”¯ä»˜<strong><code>Apple Pay</code></strong><br/>
<dr/><br/>
<strong><font color=purple>æœ€å:</font></strong><br/>
<strong><font color=purple>å¦‚æœä½ æœ‰æ›´å¥½çš„å»ºè®®æˆ–è€…å¯¹è¿™ç¯‡æ–‡ç« æœ‰ä¸æ»¡çš„åœ°æ–¹, è¯·è”ç³»æˆ‘, æˆ‘ä¼šå‚è€ƒä½ ä»¬çš„æ„è§å†è¿›è¡Œä¿®æ”¹, è”ç³»æˆ‘æ—¶, è¯·å¤‡æ³¨</strong><code>Apple Pay</code><strong>å¦‚æœè§‰å¾—å¥½çš„è¯, å¸Œæœ›å¤§å®¶ä¹Ÿå¯ä»¥æ‰“èµä¸€ä¸‹~å˜»å˜»~ç¥å¤§å®¶å­¦ä¹ æ„‰å¿«~è°¢è°¢~</font></strong></p>
</blockquote>

<span id="more"></span><!-- more -->

<hr/>

<h3 id="toc_1">ç®€ä»‹</h3>

<blockquote>
<p><strong><code>Apple Pay</code></strong>å‘¢, æ˜¯<strong><code>Apple</code></strong>åœ¨2014å¹´çš„æ—¶å€™å‘å¸ƒçš„åŠŸèƒ½, æ˜¯åŸºäºNFCä¸Šå¼€å‘çš„, æ‰€ä»¥åœ¨<strong><code>2014</code></strong>å¹´ä¹‹å‰çš„æœºå‹éƒ½æ˜¯ä¸æ”¯æŒçš„, æ¯”å¦‚<strong><code>iPhone 5</code></strong>å’Œ<strong><code>iPhone 5s</code></strong>, ä½†å¯ä»¥é€šè¿‡å¦å¤–çš„æ–¹æ³•, æ¯”å¦‚è¿æ¥<strong><code>Apple Watch</code></strong>å°±å¯ä»¥ç”¨äº†, åœ¨2016å¹´çš„2æœˆ18å·, ä¸­å›½åœ°åŒºæ‰æ­£å¼ä¸Šçº¿<strong><code>Apple Pay</code></strong>, æ—¢ç„¶å·²ç»æ¥åˆ°äº†, æˆ‘ä»¬å°±è¦å»çœ‹çœ‹æ€ä¹ˆå»ä½¿ç”¨<strong><code>Apple Pay</code></strong>å•¦.</p>
</blockquote>

<hr/>

<h3 id="toc_2">å‡†å¤‡å·¥ä½œ</h3>

<blockquote>
<p>æ—¢ç„¶æ˜¯<strong><code>Apple</code></strong>è‡ªå®¶çš„åŠŸèƒ½, é‚£æˆ‘ä»¬è‚¯å®šè¦å»å…ˆæŸ¥çœ‹ä¸€ä¸‹<strong><a href="https://developer.apple.com/apple-pay/Getting-Started-with-Apple-Pay.pdf">Apple Payæ–‡æ¡£</a></strong>, äº†è§£äº†ä¸€ä¸‹æ–‡æ¡£çš„å†…å®¹, å®ƒæ˜¯éœ€è¦å»å¼€å‘è€…ä¸­å¿ƒç”³è¯·ä¸€ä¸ª<strong><code>Merchant IDè¯ä¹¦</code></strong>, é‚£äº‹ä¸å®œè¿Ÿ, æˆ‘ä»¬èµ¶ç´§å»ç”³è¯·ä¸€ä¸ª.</p>
</blockquote>

<hr/>

<h3 id="toc_3">ç”³è¯·å•†åŠ¡è¯ä¹¦</h3>

<blockquote>
<p>å…¶å®ç”³è¯·å•†åŠ¡è¯ä¹¦å’Œç”³è¯·<strong><code>App ID</code></strong>è¯ä¹¦çš„æ­¥éª¤æ²¡å•¥åŒºåˆ«, æœ€å¤§çš„åŒºåˆ«å°±æ˜¯åœ¨äºä¸€äº›å°ç»†èŠ‚, é¦–å…ˆæˆ‘ä»¬è¦å»æ‰“å¼€<strong><a href="https://developer.apple.com">å¼€å‘è€…ä¸­å¿ƒ</a></strong>, ç™»å½•ä¹‹å, æˆ‘ä»¬æ‰¾åˆ°<strong><code>Merchant IDè¯ä¹¦</code></strong>ç”³è¯·çš„åœ°æ–¹, ç”³è¯·ä¸€ä¸‹<strong><code>Merchant IDè¯ä¹¦</code></strong>.</p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/ApplePay-Objective-C/images/1.png" alt="1"/><br/>
<img src="https://raw.githubusercontent.com/CainRun/PayProject/master/ApplePay-Objective-C/images/2.png" alt="2"/></p>

<blockquote>
<p>æ‰¾åˆ°ä¹‹å, æˆ‘ä»¬è¾“å…¥ä¸€äº›ä¿¡æ¯, æ¯”å¦‚<strong><code>Merchant ID Description</code></strong>, ç„¶åå°±æ˜¯<strong><code>Identifier</code></strong>.</p>

<p>PS: <strong><code>Identifier</code></strong>æ˜¯å”¯ä¸€çš„, å¦‚æœåˆ«äººä½¿ç”¨ä½ æ‰€è¾“å…¥çš„<strong><code>Identifier</code></strong>, <strong><code>Apple</code></strong>å°±ä¼šå«ä½ æ›´æ¢æˆå¦ä¸€ä¸ª</p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/ApplePay-Objective-C/images/3.png" alt="3"/><br/>
<img src="https://raw.githubusercontent.com/CainRun/PayProject/master/ApplePay-Objective-C/images/4.png" alt="4"/><br/>
<img src="https://raw.githubusercontent.com/CainRun/PayProject/master/ApplePay-Objective-C/images/5.png" alt="5"/></p>

<blockquote>
<p>ç°åœ¨æˆ‘ä»¬å·²ç»æå®šäº†ç¬¬ä¸€æ­¥, å·²ç»æœ‰äº†<strong><code>Merchant ID</code></strong>, æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦å»åˆ›å»º<strong><code>Merchant IDè¯ä¹¦</code></strong>.</p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/ApplePay-Objective-C/images/6.png" alt="6"/><br/>
<img src="https://raw.githubusercontent.com/CainRun/PayProject/master/ApplePay-Objective-C/images/7.png" alt="7"/></p>

<blockquote>
<p>è¿™é‡Œä¼šé—®ä¸€ä¸ªé—®é¢˜, æ˜¯å¦è¦è®¾ç½®æˆä¸­å›½åœ°åŒºç‰¹æœ‰çš„<strong><code>Apple Pay</code></strong>, <strong><code>App</code></strong>åªæ˜¯é¢å¯¹å›½å†…çš„è¯, é‚£è¿™ä¸ªé€‰æ‹©<strong><code>YES</code></strong>å°±å¥½äº†, å¦‚æœæ˜¯å…¨çƒæ€§çš„<strong><code>App</code></strong>, é‚£å°±é€‰æ‹©<strong><code>NO</code></strong>, å½“ç„¶è¿™ä¸ªä¹Ÿä¸æ˜¯å¼ºåˆ¶æ€§, è‡ªå·±çœ‹ç€åŠå§~~æˆ‘è¿™é‡Œå°±é€‰æ‹©<strong><code>NO</code></strong>.</p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/ApplePay-Objective-C/images/8.png" alt="8"/></p>

<blockquote>
<p>æ¥ä¸‹æ¥å°±æ˜¯é‡å¤´æˆäº†, æˆ‘ä»¬è¿™é‡Œéœ€è¦ä»”ç»†çœ‹ä¸€ä¸‹Appleç»™æˆ‘ä»¬çš„æç¤º, æˆ‘ä»¬è¦ç”Ÿæˆçš„è¯ä¹¦ç±»å‹æ˜¯<strong><code>ECC</code></strong>, å¹¶ä¸”æ˜¯<strong><code>256bits</code></strong>.</p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/ApplePay-Objective-C/images/9.png" alt="9"/></p>

<blockquote>
<p>æ‰“å¼€ç³»ç»Ÿçš„é’¥åŒ™ä¸², åˆ›å»ºæˆ‘ä»¬æ‰€éœ€çš„ç±»å‹è¯ä¹¦.</p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/ApplePay-Objective-C/images/10.png" alt="10"/><br/>
<img src="https://raw.githubusercontent.com/CainRun/PayProject/master/ApplePay-Objective-C/images/11.png" alt="11"/><br/>
<img src="https://raw.githubusercontent.com/CainRun/PayProject/master/ApplePay-Objective-C/images/12.png" alt="12"/><br/>
<img src="https://raw.githubusercontent.com/CainRun/PayProject/master/ApplePay-Objective-C/images/13.png" alt="13"/></p>

<blockquote>
<p>åˆ›å»ºå®Œæˆä¹‹åå°±å¯ä»¥å…³é—­äº†, ç„¶ååœ¨å¼€å‘è€…ä¸­å¿ƒç‚¹å‡»<strong><code>Continue</code></strong>, ç”±äºæˆ‘åˆ›å»ºçš„æ—¶å€™, æ˜¯æŠŠè¯ä¹¦æ”¾åœ¨æ¡Œé¢ä¸Šçš„, æ‰€ä»¥å¼€å‘è€…ä¸­å¿ƒé‡Œé€‰æ‹©çš„è¯ä¹¦ä¹Ÿæ˜¯é€‰æ‹©æ¡Œé¢ä¸Šçš„è¿™ä¸ªè¯ä¹¦, ç„¶åå†ç‚¹å‡»<strong><code>Continue</code></strong>å°±æå®šäº†.</p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/ApplePay-Objective-C/images/14.png" alt="14"/></p>

<blockquote>
<p>ä½†æ˜¯åˆ«å¿˜äº†æˆ‘ä»¬è¿˜è¦ä¸‹è½½è¿™ä¸ªè¯ä¹¦å“¦, ä¸‹è½½å®Œæˆåè¦åŒå‡»æ·»åŠ åˆ°æˆ‘ä»¬çš„é’¥åŒ™ä¸²é‡Œå»~</p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/ApplePay-Objective-C/images/15.png" alt="15"/></p>

<blockquote>
<p>å‰©ä¸‹æ€ä¹ˆå»å¼„<strong><code>é…ç½®æ–‡ä»¶</code></strong>ä»¥åŠ<strong><code>App IDè¯ä¹¦</code></strong>, æˆ‘è¿™é‡Œå°±ä¸åšå¤šä»‹ç»äº†, ç¬¬ä¸€æ¬¡å°è¯•çš„ç«¥é‹å¯ä»¥è‡ªè¡Œåˆ°<a href="http://www.jianshu.com/p/61d1b4c33f5f">iOS APPä¸Šæ¶æµç¨‹è¯¦è§£</a>, <a href="http://www.jianshu.com/p/2813abee7187">å®Œæ•´çš„iOSä¸Šæ¶Appæµç¨‹</a>æŸ¥çœ‹å“ˆ~</p>
</blockquote>

<hr/>

<h3 id="toc_4">å…³è”Merchant ID</h3>

<blockquote>
<p>åˆšåˆšæˆ‘ä»¬å·²ç»ç”³è¯·å¥½äº†<strong><code>Merchant IDè¯ä¹¦</code></strong>, åœ¨ç”³è¯·å®Œæˆ<strong><code>App ID</code></strong>ä¹‹å, æˆ‘ä»¬è¦å°±è¦å»æ‰¾åˆ°åˆšåˆšåˆ›å»ºå¥½çš„<strong><code>App ID</code></strong>, ç„¶åå…³è”ä¸Šæˆ‘ä»¬çš„<strong><code>Merchant ID</code></strong>.</p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/ApplePay-Objective-C/images/16.png" alt="16"/><br/>
<img src="https://raw.githubusercontent.com/CainRun/PayProject/master/ApplePay-Objective-C/images/17.png" alt="17"/><br/>
<img src="https://raw.githubusercontent.com/CainRun/PayProject/master/ApplePay-Objective-C/images/18.png" alt="18"/><br/>
<img src="https://raw.githubusercontent.com/CainRun/PayProject/master/ApplePay-Objective-C/images/19.png" alt="19"/><br/>
<img src="https://raw.githubusercontent.com/CainRun/PayProject/master/ApplePay-Objective-C/images/20.png" alt="20"/></p>

<blockquote>
<p>é…±ç´«, æˆ‘ä»¬å°±å…³è”å®Œæˆäº†, ä¸‹é¢æ¥å°±æ˜¯åœ¨ä¹‹å‰çš„æ”¯ä»˜å·¥ç¨‹é‡Œæ·»åŠ ä¸€ä¸ªæ–°çš„å·¥ç¨‹, å‘½åä¸º<strong><code>ApplePay-Objective-C</code></strong></p>
</blockquote>

<hr/>

<h3 id="toc_5">å¼€å¯Apple Pay</h3>

<blockquote>
<p>æ‰“å¼€æˆ‘ä»¬æ–°å»ºçš„å·¥ç¨‹, ç„¶åæ·»åŠ æˆ‘ä»¬çš„<strong><code>Merchant ID</code></strong>, å‹¾ä¸Š<strong><code>Apple Pay</code></strong>çš„é€‰é¡¹, ç„¶åæˆ‘ä»¬å°±æ¥å†™å®ç°ä»£ç å•¦~~</p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/ApplePay-Objective-C/images/21.png" alt="21"/></p>

<hr/>

<h3 id="toc_6">å®ç°Apple Pay</h3>

<blockquote>
<p>å®ç°<strong><code>Apple Pay</code></strong>çš„ä»£ç å…¶å®å¾ˆç®€å•, éµå¾ª<strong><code>PKPaymentAuthorizationViewControllerDelegate</code></strong>ä»£ç†, å®ç°ä¸¤ä¸ªå¿…é¡»å®ç°çš„ä»£ç†æ–¹æ³•, è¿™æ˜¯ç¬¬ä¸€æ­¥, ç¬¬äºŒæ­¥å°±æ˜¯åˆ›å»ºä¸€ä¸ª<strong><code>PKPaymentRequest</code></strong>è¯·æ±‚, ç„¶åå†åˆ›å»º<strong><code>PKPaymentAuthorizationViewController</code></strong>, æœ€ç»ˆå°±å¯ä»¥å®ç°<strong><code>Apple Pay</code></strong>æ”¯ä»˜å•¦~ä¸‹é¢æ˜¯ä»£ç æˆªå›¾, ç”±äºä»£ç è¿‡å¤š, è¿™é‡Œå°±ä¸è´´å‡ºæ¥äº†, å¤§å®¶éœ€è¦çš„è¯, å°±å»çœ‹çœ‹Demoå§~~~</p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/ApplePay-Objective-C/images/22.png" alt="22"/><br/>
<img src="https://raw.githubusercontent.com/CainRun/PayProject/master/ApplePay-Objective-C/images/23.png" alt="23"/></p>

<blockquote>
<p>é¡ºä¾¿è¯´ä¸€å£°, <strong><code>Apple Pay</code></strong>çš„å›½é™…åŒ–ä¸éœ€è¦æˆ‘ä»¬å»å®ç°, å†…éƒ¨å°±å·²ç»å®ç°äº†</p>
</blockquote>

<hr/>

<h3 id="toc_7">æœ€ç»ˆæ•ˆæœ</h3>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/ApplePay-Objective-C/images/24.gif" alt="24"/></p>

<hr/>

<h3 id="toc_8">å·¥ç¨‹åœ°å€</h3>

<p>é¡¹ç›®åœ°å€: <a href="https://github.com/CainRun/PayProject">https://github.com/CainRun/PayProject</a></p>

<hr/>

<h3 id="toc_9">æœ€å</h3>

<p><center>ç å­—å¾ˆè´¹è„‘, çœ‹å®˜èµç‚¹é¥­é’±å¯å¥½</center></p>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/WeChatPay-Objective-C/Images/%E5%BE%AE%E4%BF%A1QRC.jpg" alt="å¾®ä¿¡"/></p>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/WeChatPay-Objective-C/Images/%E6%94%AF%E4%BB%98%E5%AE%9DQRC.jpg" alt="æ”¯ä»˜å®"/></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ç©è½¬iOSå¼€å‘ï¼šé›†æˆ Union Pay - é“¶è”æ”¯ä»˜]]></title>
    <link href="https://cainrun.github.io/14740149724404.html"/>
    <updated>2016-09-16T16:36:12+08:00</updated>
    <id>https://cainrun.github.io/14740149724404.html</id>
    <content type="html"><![CDATA[
<h3 id="toc_0">ä½œè€…æ„Ÿè¨€</h3>

<blockquote>
<p>å‰é¢å·²ç»æŠŠ<strong><code>WeChat SDK</code></strong>çš„æ”¯ä»˜, <strong><code>AliPay SDK</code></strong>æå¾—ä¸ƒä¸ƒå…«å…«äº†, æ¥ä¸‹æ¥å°±æ˜¯é“¶è”æ”¯ä»˜çš„<strong><code>Union Pay SDK</code></strong>.<br/>
<dr/><br/>
<strong><font color=purple>æœ€å:</font></strong><br/>
<strong><font color=purple>å¦‚æœä½ æœ‰æ›´å¥½çš„å»ºè®®æˆ–è€…å¯¹è¿™ç¯‡æ–‡ç« æœ‰ä¸æ»¡çš„åœ°æ–¹, è¯·è”ç³»æˆ‘, æˆ‘ä¼šå‚è€ƒä½ ä»¬çš„æ„è§å†è¿›è¡Œä¿®æ”¹, è”ç³»æˆ‘æ—¶, è¯·å¤‡æ³¨</strong><code>Union Pay SDK</code><strong>å¦‚æœè§‰å¾—å¥½çš„è¯, å¸Œæœ›å¤§å®¶ä¹Ÿå¯ä»¥æ‰“èµä¸€ä¸‹~å˜»å˜»~ç¥å¤§å®¶å­¦ä¹ æ„‰å¿«~è°¢è°¢~</font></strong></p>
</blockquote>

<span id="more"></span><!-- more -->

<hr/>

<h3 id="toc_1">ç®€ä»‹</h3>

<blockquote>
<p>é“¶è”å˜›, ç”¨è¿‡é“¶è¡Œå¡çš„äººéƒ½æ‡‚çš„, æˆ‘ä»¬å¤§å¤©æœçš„äº§ç‰©, ä¸»è¦æ˜¯ç”¨æ¥è”åˆå¤§å¤©æœå„ä¸ªé“¶è¡Œ, å®ç°å„ä¸ªé“¶è¡Œäº’é€š, å¯è·¨è¡Œ, è·¨åŒº, è·¨å¢ƒä½¿ç”¨ç­‰ç­‰....å…¶å®æ¢äº†ä¸€å¥è¯æ¥è¯´, å°±æ˜¯ä¸­å›½ç‰ˆçš„<strong><code>VISA</code></strong>, <strong><code>MasterCard</code></strong>, è™½ç„¶é“¶è”èµ·æ­¥çš„æ¯”è¾ƒæ™š, ä½†å‘å±•çš„è„šæ­¥ä¸æ¯”<strong><code>VISA</code></strong>, <strong><code>MasterCard</code></strong>è¦å·®.</p>
</blockquote>

<hr/>

<h3 id="toc_2">å‡†å¤‡å·¥ä½œ</h3>

<blockquote>
<p>åœ¨è¿™é‡Œ, æˆ‘ä¸å¾—ä¸åæ§½ä¸€ä¸‹, å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡é›†æˆé“¶è”çš„ç«¥é‹, ä¼°è®¡ä¸€å¼€å§‹è¿˜çœŸæ˜¯å¤Ÿå‘›çš„, æˆ–è®¸ä½ è¿<strong><code>SDK</code></strong>éƒ½æ‰¾ä¸åˆ°åœ¨å“ªé‡Œä¸‹è½½, è¿™ç½‘ç«™è¿˜çœŸçš„å¾ˆéš¾æ‰¾, æ‰€ä»¥æˆ‘åœ¨è¿™é‡Œè´´å‡ºæ¥ç»™ä½ ä»¬äº†, æ–¹ä¾¿å„ä½ç«¥é‹ä»¬è‡ªè¡Œå»æŸ¥æ‰¾ä¸‹è½½<strong><a href="https://open.unionpay.com">å•†å®¶æŠ€æœ¯æœåŠ¡</a></strong><br/>
<dr/><br/>
è¿™é‡Œè¿˜æœ‰æ€ä¹ˆå»æŸ¥æ‰¾SDKçš„ç¤ºä¾‹, å¤§å®¶ä¹Ÿçœ‹çœ‹å‘—</p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/UnionPay-Objective-C/images/1.png" alt="1"/></p>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/UnionPay-Objective-C/images/2.png" alt="2"/></p>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/UnionPay-Objective-C/images/3.png" alt="3"/></p>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/UnionPay-Objective-C/images/4.png" alt="4"/></p>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/UnionPay-Objective-C/images/5.png" alt="5"/></p>

<blockquote>
<p>è¿™é‡Œæˆ‘ä¸‹è½½ä¸‹æ¥çš„æ˜¯3.3.3ç‰ˆæœ¬, 54.8MBå¤§å°, æˆ–è®¸ä¹‹åé“¶è”ä¼šç»§ç»­æ›´æ–°SDKåŒ…, è¿™ä¸ªçš„è¯, å¤§å®¶çœ‹ç€åŠå§~~</p>
</blockquote>

<hr/>

<h3 id="toc_3">åºŸè¯æ¥ä¸€æ®µ</h3>

<blockquote>
<p>æƒ¯ä¾‹, ç»§ç»­æ¥ä¸€æ®µåºŸè¯, æ‰“å¼€æˆ‘ä»¬ä¹‹å‰çš„é›†æˆ<strong><code>WeChat SDK</code></strong>å’Œ<strong><code>AliPay SDk</code></strong>çš„å·¥ç¨‹, æ–°å»ºä¸€ä¸ªå·¥ç¨‹å«åš<strong><code>UnionPay-Objective-C</code></strong>çš„æ–°å·¥ç¨‹</p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/UnionPay-Objective-C/images/6.png" alt="6"/></p>

<hr/>

<h3 id="toc_4">é…ç½®å·¥ç¨‹</h3>

<blockquote>
<p>é…ç½®å·¥ç¨‹çš„è¯, é¦–å…ˆæˆ‘ä»¬è¦å¼•å…¥<strong><code>Union Pay SDK</code></strong>çš„ä¾èµ–åŒ…, ä¸€å…±äº”ä¸ª, è¿™æˆ–è®¸æ˜¯ç¬¬ä¸‰æ–¹æ”¯ä»˜å“å°é‡Œéœ€è¦å¯¼å…¥æœ€å°‘ä¾èµ–çš„.</p>

<ul>
<li>LocalAuthentication.framework</li>
<li>SystemConfiguration.framework</li>
<li>CoreGraphics.framework</li>
<li>CFNetwork.framework</li>
<li>libz.tbd</li>
</ul>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/UnionPay-Objective-C/images/7.png" alt="7"/></p>

<blockquote>
<p>ç„¶åå‘¢, æˆ‘ä»¬éœ€è¦å»åˆ°<strong><code>Info.plist</code></strong>é‡Œ, æ·»åŠ ä¸‰ä¸ªå±æ€§</p>

<ul>
<li>App Transport Security Settings

<ul>
<li>Allow Arbitrary Loads</li>
</ul></li>
<li>Application requires iPhone environment</li>
<li>LSApplicationQueriesSchemes

<ul>
<li>uppaysdk</li>
<li>uppaywallet</li>
<li>uppayx1</li>
<li>uppayx2</li>
<li>uppayx3</li>
</ul></li>
</ul>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/UnionPay-Objective-C/images/8.png" alt="8"/></p>

<blockquote>
<p>æ¥ä¸‹æ¥, æˆ‘ä»¬è¦å»æ·»åŠ <strong><code>URL Schemes</code></strong>äº†, </p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/UnionPay-Objective-C/images/9.png" alt="9"/></p>

<blockquote>
<p>æœ€å, å°±æ˜¯æˆ‘ä»¬è¦æŠŠ<strong><code>Union Pay SDK</code></strong>å¯¼è¿›æ¥äº†, è¿™æ ·å­å°±é…ç½®å¥½æ•´ä¸ªå·¥ç¨‹äº†, é¡ºå¸¦è¯´ä¸€å£°, è¿™ä¸ª<strong><code>SDK</code></strong>åœ¨<strong><code>paymentcontrol</code></strong>è¿™ä¸ªç›®å½•ä¸‹~</p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/UnionPay-Objective-C/images/10.png" alt="10"/></p>

<blockquote>
<p>å·®ç‚¹åˆ«å¿˜äº†æŠŠ<strong><code>-ObjC</code></strong>è¿™ä¸ªå®åŠ ä¸Š, ä¸ç„¶æ²¡æ³•è·‘</p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/UnionPay-Objective-C/images/11.png" alt="11"/></p>

<hr/>

<h3 id="toc_5">å¸ƒå±€UIç•Œé¢</h3>

<blockquote>
<p>æƒ¯ä¾‹, è¿™é‡Œæˆ‘ä»¬ä¹Ÿæ˜¯åªç»™ä¸€ä¸ª<strong><code>UIButton</code></strong>ä»¥åŠä¸€ä¸ª<strong><code>Action</code></strong>äº‹ä»¶.</p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/UnionPay-Objective-C/images/12.png" alt="12"/></p>

<hr/>

<h3 id="toc_6">è¡¥å……å¤šä¸€ä¸ªç‚¹</h3>

<blockquote>
<p>è¿™é‡Œè¿˜éœ€è¦è¡¥å……ä¸€ä¸ªç‚¹, ç”±äºé“¶è”æ˜¯é‡‡ç”¨<strong><code>C</code></strong>ã€<strong><code>C++</code></strong>ä»¥åŠ<strong><code>Objective-C</code></strong>æ··ç¼–çš„, æ‰€ä»¥è¿™ä¸ªæœ‰äº›è›‹ç–¼, å®˜æ–¹æä¾›ä¸‰ç§æ–¹å¼å»é€‚é…, æˆ‘è¿™é‡Œé‡‡ç”¨äº†æœ€ç®€å•çš„ä¸€ç§, ç›´æ¥æŠŠ<strong><code>.m</code></strong>æ”¹æˆ<strong><code>.mm</code></strong>.</p>
</blockquote>

<p><strong><font color=purple>ç¬¬ä¸€ç§</font></strong></p>

<blockquote>
<ul>
<li><p>ç”±äºæ”¯ä»˜æ§ä»¶ä½¿ç”¨åˆ°äº†<strong><code>C</code></strong>ã€<strong><code>C++</code></strong>å’Œ<strong><code>Objective-C</code></strong>æ··ç¼–çš„æƒ…å†µï¼Œæ‰€ä»¥å•†æˆ·å·¥ç¨‹å¼•å…¥<strong><code>UPPaymentControl.h</code></strong>å¤´æ–‡ä»¶ä»¥åå¯èƒ½ä¼šå‡ºç°é“¾æ¥é”™è¯¯ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸‰ç§æ–¹å¼è§£å†³ï¼š</p>

<ul>
<li><p>å°†æ¶‰åŠåˆ°å¼•ç”¨<strong><code>UPPaymentControl.h</code></strong>çš„æºæ–‡ä»¶çš„åç¼€åéƒ½æ”¹ä¸º<strong><code>.mm</code></strong>ï¼›</p></li>
<li><p>å¦‚æœå•†æˆ·ä¸æƒ³ä¿®æ”¹æºæ–‡ä»¶çš„åç¼€åï¼Œå¯ä»¥åœ¨å·¥ç¨‹ä¸­æ·»åŠ ä¸€ä¸ªç©ºçš„ç»§æ‰¿è‡ª<strong><code>NSObject</code></strong>çš„ç±»ï¼Œå¹¶å°†æ–‡ä»¶.måç¼€åè¯¥æ”¹ä¸º.mmå³å¯æ–¹æ³•ä¸º<strong><code>New File</code></strong> -&gt; <strong><code>Objective-C class</code></strong> -&gt; <strong><code>ç±»åè‡ªå–</code></strong> -&gt; <strong><code>ä¿å­˜</code></strong> -&gt; <strong><code>ä¿®æ”¹åç¼€åä¸º.mm</code></strong>ï¼›</p></li>
<li><p>å°†å·¥ç¨‹çš„<strong><code>compile source as</code></strong>é€‰é¡¹çš„å€¼è®¾ç½®ä¸º<strong><code>Objectiveâ€“C++</code></strong>ï¼›</p></li>
</ul></li>
</ul>
</blockquote>

<p><strong><font color=purple>ç¬¬äºŒç§</font></strong></p>

<blockquote>
<ul>
<li>ç”±äºåœ¨Demoå·¥ç¨‹ä¸­æ·»åŠ äº†è‡ªå®šä¹‰çš„åº“æ–‡ä»¶<strong><code>libPaymentControl.a</code></strong>
ï¼Œå½“ç¼–è¯‘Demoå·¥ç¨‹æ—¶ï¼Œåº”è¯¥æ£€æŸ¥å·¥ç¨‹è®¾ç½®<strong><code>Search Paths</code></strong>é‡Œçš„<strong><code>Framework Search Paths</code></strong>ã€<strong><code>Header Search Paths</code></strong>ã€<strong><code>Library Search Paths</code></strong>çš„è·¯å¾„è®¾ç½®ï¼Œçœ‹è®¾ç½®è·¯å¾„æ˜¯å¦æ­£ç¡®ï¼Œå¦å¤–è¿˜è¦æ³¨æ„é‡Œè¾¹æ˜¯å¦å¤šä½™ä¸€äº›ä¸ç¡®å®šçš„è·¯å¾„ã€‚</li>
</ul>
</blockquote>

<p><strong><font color=purple>ç¬¬ä¸‰ç§</font></strong></p>

<blockquote>
<ul>
<li>å°†<strong><code>Xcode</code></strong>å·¥ç¨‹ä¸­<strong><code>Build Setting</code></strong> -&gt; <strong><code>Apple LLVM compiler Language</code></strong>æ ‡ç­¾ä¸‹çš„<strong><code>C++ Language Dialect</code></strong>å’Œ<strong><code>C++ Standard Library</code></strong>å±æ€§å€¼ä¿®æ”¹ä¸º<strong><code>Compiler Default</code></strong>å¦‚å®åœ¨æ— æ³•è§£å†³ï¼Œå°è¯•æ·»åŠ <strong><code>-ObjC</code></strong>å®çš„åœ°æ–¹ä¿®æ”¹ä¸º<strong><code>-force_load</code></strong> + <strong><code>ç©ºæ ¼</code></strong> + <strong><code>æ§ä»¶è·¯å¾„</code></strong>ï¼Œå¦‚ï¼š<strong><code>-force_load $(PROJECT_DIR)/ libPaymentControl.a</code></strong>ï¼Œå¦‚æœè¿˜æŠ¥é”™ï¼Œä¸Šä¸‹æ–‡åº”è¯¥ä¼šæœ‰<strong><code>libPaymentControl.a</code></strong>æ–‡ä»¶æ‰¾ä¸åˆ°å¼‚å¸¸ï¼Œæ¯”å¦‚<strong><code>ld: file not found: /Users/apple/Desktop/Communication 2/ libPaymentControl.a
clang: error: linker command failed with exit code 1 (use -v to see invocation)</code></strong>
è¯·ç¡®å®š<strong><code>libPaymentControl.a</code></strong>æ–‡ä»¶ç¡®å®å­˜åœ¨äºæ­¤è·¯å¾„ï¼Œå¯èƒ½ä¸ºä¸Šä¸‹æ–‡è·¯å¾„é…é”™ã€‚</li>
</ul>
</blockquote>

<hr/>

<h3 id="toc_7">å®ç°é“¶è”æ”¯ä»˜</h3>

<blockquote>
<p>é›†æˆçš„æ—¶å€™, è¿™é‡Œæˆ‘ä»¬éœ€è¦åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤, ä¸€ä¸ªæ˜¯ç½‘ç»œ, ä¸€ä¸ªæ˜¯æœ¬åœ°æ“ä½œ.</p>
</blockquote>

<p><strong><font color=purple>æœ¬åœ°éƒ¨åˆ†</font></strong></p>

<blockquote>
<p>æ‰€è°“çš„æœ¬åœ°éƒ¨åˆ†, æŒ‡çš„å°±æ˜¯å¼¹æ¡†, ç­æ¡†çš„ä¸€äº›æ“ä½œ, è¿˜æœ‰å‘èµ·ç½‘ç»œä¸€äº›ç‚¹å‡»äº‹ä»¶ç­‰ç­‰.</p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/UnionPay-Objective-C/images/13.png" alt="13"/></p>

<p><strong><font color=purple>ç½‘ç»œéƒ¨åˆ†</font></strong></p>

<blockquote>
<p>é“¶è”æ”¯ä»˜éœ€è¦ç”¨åˆ°ä¸€ä¸ªç½‘ç»œäº¤äº’çš„æµç¨‹, è¿™é‡Œçš„è¯, æˆ‘ä»¬ç›´æ¥å¼•ç”¨<strong><code>Demo</code></strong>é‡Œçš„ä»£ç , ç„¶åå†åŠ ä»¥ä¿®æ”¹ä¸€ä¸¢ä¸¢, å°±å¯ä»¥äº†~</p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/UnionPay-Objective-C/images/14.png" alt="14"/></p>

<hr/>

<h3 id="toc_8">æµ‹è¯•æ”¯ä»˜</h3>

<blockquote>
<p>åœ¨æµ‹è¯•æ”¯ä»˜è¿™ç‚¹ä¸Š, å¾®ä¿¡å’Œé“¶è”éƒ½åšçš„æŒºä¸é”™çš„, å”¯ç‹¬æ”¯ä»˜å®è¿™ä¸ªè¿ä¸ªæµ‹è¯•è´¦å·éƒ½ä¸æä¾›, çœŸçš„æ˜¯è›‹ç–¼...ç–¼...ç–¼, æ‰“å¼€é“¶è”æ¥å…¥æŒ‡å—, é‡Œé¢å°±ä¼šæœ‰ä¸¤ä¸ªæµ‹è¯•å¡å·.</p>
</blockquote>

<table>
<thead>
<tr>
<th>æµ‹è¯•è´¦å·</th>
<th>æµ‹è¯•ä¿¡æ¯</th>
</tr>
</thead>

<tbody>
<tr>
<td>å§“å</td>
<td>å¼ ä¸‰</td>
</tr>
<tr>
<td>æ‰‹æœºå·ç </td>
<td>18100000000</td>
</tr>
<tr>
<td>è¯ä»¶ç±»å‹</td>
<td>01èº«ä»½è¯</td>
</tr>
<tr>
<td>è¯ä»¶å·</td>
<td>510265790128303</td>
</tr>
<tr>
<td>æ‹›å•†é“¶è¡Œå¡</td>
<td>6226090000000048</td>
</tr>
<tr>
<td>å¯†ç </td>
<td>111101</td>
</tr>
<tr>
<td>éªŒè¯ç </td>
<td>123456ï¼ˆ<strong><font color=red>å…ˆç‚¹è·å–éªŒè¯ç ä¹‹åå†è¾“å…¥</font></strong>ï¼‰</td>
</tr>
</tbody>
</table>

<table>
<thead>
<tr>
<th>æµ‹è¯•è´¦å·</th>
<th>æµ‹è¯•ä¿¡æ¯</th>
</tr>
</thead>

<tbody>
<tr>
<td>å§“å</td>
<td>å¼ ä¸‰</td>
</tr>
<tr>
<td>æ‰‹æœºå·ç </td>
<td>18100000000</td>
</tr>
<tr>
<td>è¯ä»¶ç±»å‹</td>
<td>01èº«ä»½è¯</td>
</tr>
<tr>
<td>CVN2</td>
<td>248</td>
</tr>
<tr>
<td>æœ‰æ•ˆæœŸ</td>
<td>1219</td>
</tr>
<tr>
<td>è¯ä»¶å·</td>
<td>510265790128303</td>
</tr>
<tr>
<td>åå¤é“¶è¡Œè´·è®°å¡</td>
<td>6226388000000095</td>
</tr>
<tr>
<td>å¯†ç </td>
<td>111101</td>
</tr>
<tr>
<td>éªŒè¯ç </td>
<td>123456ï¼ˆ<strong><font color=red>å…ˆç‚¹è·å–éªŒè¯ç ä¹‹åå†è¾“å…¥</font></strong>ï¼‰</td>
</tr>
</tbody>
</table>

<hr/>

<h3 id="toc_9">æœ€ç»ˆæ•ˆæœ</h3>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/UnionPay-Objective-C/images/15.png" alt="15"/></p>

<hr/>

<h3 id="toc_10">å·¥ç¨‹åœ°å€</h3>

<p>é¡¹ç›®åœ°å€: <a href="https://github.com/CainRun/PayProject">https://github.com/CainRun/PayProject</a></p>

<hr/>

<h3 id="toc_11">æœ€å</h3>

<p><center>ç å­—å¾ˆè´¹è„‘, çœ‹å®˜èµç‚¹é¥­é’±å¯å¥½</center></p>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/WeChatPay-Objective-C/Images/%E5%BE%AE%E4%BF%A1QRC.jpg" alt="å¾®ä¿¡"/></p>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/WeChatPay-Objective-C/Images/%E6%94%AF%E4%BB%98%E5%AE%9DQRC.jpg" alt="æ”¯ä»˜å®"/></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ç©è½¬iOSå¼€å‘ï¼šé›†æˆ AliPay - æ”¯ä»˜å®]]></title>
    <link href="https://cainrun.github.io/14739456388212.html"/>
    <updated>2016-09-15T21:20:38+08:00</updated>
    <id>https://cainrun.github.io/14739456388212.html</id>
    <content type="html"><![CDATA[
<h3 id="toc_0">ä½œè€…æ„Ÿè¨€</h3>

<blockquote>
<p>å‰é¢æˆ‘å·²ç»å†™äº†ä¸€ç¯‡å…³äº<strong><code>WeChat SDK</code></strong>çš„æ”¯ä»˜ç¯‡, é‚£æˆ‘ä»¬ç»§ç»­ç ”ç©¶æ¥ä¸‹æ¥çš„æ”¯ä»˜<strong><code>SDK</code></strong>, è¿™æ¬¡å°±æ˜¯å›½æ°‘æ”¯ä»˜è½¯ä»¶<strong><code>æ”¯ä»˜å®</code></strong>, ä¸‹é¢å°±è®©æˆ‘ä»¬æ¥çœ‹çœ‹æ€ä¹ˆé›†æˆ<strong><code>AliPay SDK</code></strong>.<br/>
<dr/><br/>
<strong><font color=purple>æœ€å:</font></strong><br/>
<strong><font color=purple>å¦‚æœä½ æœ‰æ›´å¥½çš„å»ºè®®æˆ–è€…å¯¹è¿™ç¯‡æ–‡ç« æœ‰ä¸æ»¡çš„åœ°æ–¹, è¯·è”ç³»æˆ‘, æˆ‘ä¼šå‚è€ƒä½ ä»¬çš„æ„è§å†è¿›è¡Œä¿®æ”¹, è”ç³»æˆ‘æ—¶, è¯·å¤‡æ³¨</strong><code>AliPay SDK</code><strong>å¦‚æœè§‰å¾—å¥½çš„è¯, å¸Œæœ›å¤§å®¶ä¹Ÿå¯ä»¥æ‰“èµä¸€ä¸‹~å˜»å˜»~ç¥å¤§å®¶å­¦ä¹ æ„‰å¿«~è°¢è°¢~</font></strong></p>
</blockquote>

<span id="more"></span><!-- more -->

<hr/>

<h3 id="toc_1">ç®€ä»‹</h3>

<blockquote>
<p>æ”¯ä»˜å®SDK, åªè¦åšè¿‡æ”¯ä»˜ç±»Appçš„, éƒ½ç™¾åˆ†ç™¾æ¥è§¦è¿‡, è‡³äºä¸ºä»€ä¹ˆé‚£ä¹ˆå¤šäººå–œæ¬¢ç”¨æ”¯ä»˜å®, è¿™ä¸ªæˆ‘å°±ä¸åœ¨è¿™é‡Œåšè§£é‡Šäº†, å¤§å®¶éƒ½æ‡‚çš„, ä½†æ˜¯å‘¢, ç”±äºåœ¨é˜¿é‡Œå·´å·´çš„å‘å±•ä¸‹, æ”¯ä»˜å®æ…¢æ…¢ä¸èš‚èšé‡‘æœæ•´åˆ, ç”šè‡³è¿å¼€æ”¾å¹³å°åå­—éƒ½æ”¹æˆ<strong><code>èš‚èšé‡‘æœå¼€æ”¾å¹³å°</code></strong>, ä½†æ— è®ºæ€ä¹ˆæ ·, æ”¯ä»˜å®éƒ½æ˜¯è¡Œä¸šå†…å®‰å…¨æ€§æœ€é«˜çš„,</p>
</blockquote>

<hr/>

<h3 id="toc_2">å‡†å¤‡å·¥ä½œ</h3>

<blockquote>
<p>å…¶å®é›†æˆ<strong><code>AliPay SDK</code></strong>å’Œ<strong><code>WeChat SDK</code></strong>æœ‰äº›ç±»ä¼¼, å°±è¿<strong><code>å•†å®¶ID</code></strong>çš„ç”³è¯·, <strong><code>App ID</code></strong>çš„ç”³è¯·, æµç¨‹éƒ½å·®ä¸å¤š, è¯¦ç»†è¿™é‡Œæˆ‘å°±ä¸åœ¨è¿™é‡Œè®²è§£äº†, å¤§å®¶å¯ä»¥å»<strong><a href="https://b.alipay.com/">æ”¯ä»˜å®å•†å®¶å•†æˆ·æœåŠ¡å¹³å°</a></strong>äº†è§£äº†è§£.</p>
</blockquote>

<hr/>

<h3 id="toc_3">ä¸‹è½½SDKåŒ…</h3>

<blockquote>
<p>ç”±äºèš‚èšé‡‘æœå’Œæ”¯ä»˜å®çš„æ•´åˆ, å°±è¿SDKçš„èµ„æºéƒ½æ”¹äº†, å¤§å®¶å¯ä»¥å»<strong><a href="https://doc.open.alipay.com/">å¼€æ”¾å¹³å°-æ–‡æ¡£ä¸­å¿ƒ</a></strong>æ‰¾åˆ°èµ„æºä¸‹è½½.</p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/AliPay-Objective-C/images/1.png" alt="1"/></p>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/AliPay-Objective-C/images/2.png" alt="2"/></p>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/AliPay-Objective-C/images/3.png" alt="3"/></p>

<hr/>

<h3 id="toc_4">ç»§ç»­æ¥æ®µåºŸè¯</h3>

<blockquote>
<p>SDKåŒ…ä¸‹è½½å¥½äº†ä¹‹å, æˆ‘ä»¬å»åˆ°ä¹‹å‰çš„é‚£ä¸ªæ”¯ä»˜å·¥ç¨‹å»ºç«‹æˆ‘ä»¬çš„æ–°å·¥ç¨‹, å‘½åä¸º<strong><code>AliPay-Objective-C</code></strong>, æ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥ç»§ç»­é›†æˆ<strong><code>AliPay SDK</code></strong>äº†.</p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/AliPay-Objective-C/images/4.png" alt="4"/></p>

<hr/>

<h3 id="toc_5">é…ç½®æ–‡ä»¶</h3>

<blockquote>
<p>ç°åœ¨æˆ‘ä»¬å»ºç«‹å¥½äº†å·¥ç¨‹, ç„¶åæˆ‘ä»¬å’Œé›†æˆ<strong><code>WeChat SDK</code></strong>ä¸€æ ·, éœ€è¦é…ç½®ä¸€ä¸‹å·¥ç¨‹, è¿™æ ·å­æˆ‘ä»¬æ‰èƒ½è®©<strong><code>AliPay SDK</code></strong>æ­£å¸¸å·¥ä½œ.<br/>
<dr/><br/>
ç°åœ¨è®©æˆ‘ä»¬æ¥æ‰“å¼€å·¥ç¨‹çš„<strong><code>Info.plist</code></strong>æ–‡ä»¶, æ·»åŠ ä¸€äº›é…ç½®.</p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/AliPay-Objective-C/images/5.png" alt="5"/></p>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/AliPay-Objective-C/images/6.png" alt="6"/></p>

<hr/>

<h3 id="toc_6">æ·»åŠ ä¾èµ–åŒ…</h3>

<blockquote>
<p>å’Œ<strong><code>WeChat SDK</code></strong>ä¸€æ ·, <strong><code>AliPay SDK</code></strong>ä¸€æ ·æ˜¯éœ€è¦å¯¼å…¥ä¾èµ–åŒ…çš„, ä½†æ˜¯è¿™ä¸ªä¾èµ–åŒ…è¦æ¯”<strong><code>WeChat SDK</code></strong>è¦å¤šä¸€äº›, è¿™ä¸ªæ¯”è¾ƒè›‹ç–¼.</p>

<ul>
<li><strong>UIKit.framework</strong></li>
<li><strong>CoreMotion.framework</strong></li>
<li><strong>CFNetWork.framework</strong></li>
<li><strong>Foundation.framework</strong></li>
<li><strong>CoreGraphics.framework</strong></li>
<li><strong>CoreText.framework</strong></li>
<li><strong>QuartzCore.framework</strong></li>
<li><strong>CoreTelephony.framework</strong></li>
<li><strong>SystemConfiguration.framework</strong></li>
<li><strong>libz.tbd</strong></li>
<li><strong>libc++.tbd</strong></li>
</ul>

<p><dr/><br/>
è¿™äº›éƒ½æ˜¯æ‰€éœ€çš„ä¾èµ–åº“, çœŸçš„æ˜¯éå¸¸çš„è›‹ç–¼.</p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/AliPay-Objective-C/images/7.png" alt="7"/></p>

<hr/>

<h3 id="toc_7">æ³¨å†ŒApp ID</h3>

<blockquote>
<p>ç”±äº<strong><code>AliPay SDK</code></strong>æ˜¯ä¸éœ€è¦åœ¨<strong><code>AppDelegate.m</code></strong>æ–‡ä»¶é‡Œæ³¨å†Œçš„, æ‰€ä»¥æ³¨å†Œ<strong><code>App ID</code></strong>è¿™ä¸ªæ­¥éª¤æˆ‘ä»¬å°±å¿½ç•¥äº†.</p>
</blockquote>

<hr/>

<h3 id="toc_8">å¸ƒå±€UIç•Œé¢</h3>

<blockquote>
<p>è¿™é‡Œçš„UIå¸ƒå±€ç•Œé¢å°±å’Œ<strong><code>WeChat SDK</code></strong>é‚£æ ·, ç›´æ¥æ‹–ä¸€ä¸ª<strong><code>UIButton</code></strong>, ä»¥åŠåŠ ä¸€ä¸ª<strong><code>Action</code></strong>äº‹ä»¶å°±å¥½äº†.</p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/AliPay-Objective-C/images/8.png" alt="8"/></p>

<hr/>

<h3 id="toc_9">æ³¨æ„!!!</h3>

<blockquote>
<p>ç”±äº<strong><code>AliPay</code></strong>æ”¹ç‰ˆäº†, å¦‚æœæ˜¯è€ç‰ˆæœ¬çš„SDKéœ€è¦æ›´æ–°åˆ°æœ€æ–°çš„è¯, ä¸€å®šè¦å»å¥½å¥½çš„è¯»ä¸€ä¸‹æ¥å£æ–‡æ¡£, å› ä¸ºè¿™é‡Œéœ€è¦æ·»åŠ å¤šä¸¤ä¸ªé¢å¤–åº“ä»¥åŠä¸€äº›ä¾èµ–çš„ç­¾åæ–‡ä»¶, è¿™ä¸¤ä¸ªåº“åœ¨<strong><code>AliPay</code></strong>çš„èµ„æºåŒ…é‡Œå¯ä»¥æ‰¾åˆ°.</p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/AliPay-Objective-C/images/9.png" alt="9"/></p>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/AliPay-Objective-C/images/10.png" alt="10"/></p>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/AliPay-Objective-C/images/11.png" alt="11"/></p>

<blockquote>
<p>æŠŠè¿™äº›ä¾èµ–æ–‡ä»¶éƒ½æ‹–å…¥æˆ‘ä»¬çš„å·¥ç¨‹é‡Œ, è¿™æ ·å­æˆ‘ä»¬å°±èƒ½æ­£å¸¸çš„å®Œæˆå¼€å‘äº†~~</p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/AliPay-Objective-C/images/12.png" alt="12"/></p>

<hr/>

<h3 id="toc_10">é›†æˆSDK</h3>

<blockquote>
<p>ä¹‹å‰çš„æ‰€æœ‰å‡†å¤‡å·¥ä½œéƒ½å·²ç»åšå¥½äº†, ç°åœ¨é‡ç‚¹æ¥äº†, å°±è®©æˆ‘ä»¬çœ‹çœ‹æ€ä¹ˆå®ç°æ”¯ä»˜å®æ”¯ä»˜!</p>
</blockquote>

<p><dr/></p>

<blockquote>
<p>é¦–å…ˆæˆ‘ä»¬éœ€è¦ä¸€ä¸ªè®¢å•å¯¹è±¡, è¿™é‡Œæˆ‘ä»¬å‘½åä¸º<strong><code>AliPayOther</code></strong>, è¿˜æœ‰ä¸€ä¸ª<strong><code>AliPayBizContent</code></strong>, ç„¶åå£°æ˜ä¸€äº›å±æ€§, å¹¶ä¸”åœ¨å†…éƒ¨å®ç°ä¸€äº›æ–¹æ³•, ç”±äºè¿™é‡Œçš„ä»£ç æ¯”è¾ƒå¤š, è¿™é‡Œå°±ä¸åˆ—ä¸¾äº†, å„ä½ç«¥é‹ä»¬è¿˜æ˜¯è‡ªè¡Œå»ç¿»ç¿»å·¥ç¨‹å§~~</p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/AliPay-Objective-C/images/13.png" alt="13"/></p>

<blockquote>
<p>ç„¶åå‘¢, æˆ‘ä»¬å°±è¦æŠŠä¸¤ä¸ªé‡é‡çº§çš„æ–‡ä»¶æ‹–å…¥åˆ°å·¥ç¨‹, ä¸€ä¸ªå°±æ˜¯<strong><code>AlipaySDK.bundle</code></strong>, ä¸€ä¸ªæ˜¯<strong><code>AlipaySDK.framework</code></strong>, è¿™ä¸¤ä¸ªæ–‡ä»¶ä¹Ÿæ˜¯åœ¨<strong><code>AliPay</code></strong>çš„èµ„æºåŒ…é‡Œå¯ä»¥æ‰¾åˆ°.</p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/AliPay-Objective-C/images/14.png" alt="14"/></p>

<blockquote>
<p>å¯¼å…¥ä¹‹åç¼–è¯‘ä¸€ä¸‹, Xcodeå±…ç„¶æç¤ºå‡ºé”™äº†!!!</p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/AliPay-Objective-C/images/15.png" alt="15"/></p>

<blockquote>
<p>çœ‹äº†ä¸€ä¸‹é”™è¯¯ä¿¡æ¯, æç¤º<strong><code>NSObject</code></strong>, æˆ‘æƒ³åº”è¯¥æ˜¯<strong><code>&lt;Foundation/Foundation.h&gt;</code></strong>æ²¡æœ‰å¯¼å…¥åˆ°å¯¹åº”çš„æ–‡ä»¶é‡Œå»å§, è¯•è¯•çœ‹å…ˆ</p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/AliPay-Objective-C/images/16.png" alt="16"/></p>

<blockquote>
<p>æˆ‘å±®è‰¸èŠ”èŒ», ä¸€äº›é—®é¢˜è§£å†³äº†, å¦ä¸€äº›é—®é¢˜åˆå‡ºæ¥äº†, ä»”ç»†ä¸€çœ‹, æˆ‘å‹’ä¸ªå», åŸæ¥æ˜¯å¿˜äº†å¯¼å…¥åˆšåˆšæ‰€è¯´çš„<strong><code>libcrypto.a</code></strong>ä»¥åŠ<strong><code>libssl.a</code></strong>åº“äº†...æˆ‘è¯´æ€ä¹ˆå¥½åƒå°‘äº†ä¸¤ä¸ªä¸œè¥¿, èµ¶ç´§å¯¼å…¥è¿›å»~</p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/AliPay-Objective-C/images/17.png" alt="17"/></p>

<blockquote>
<p>å¯¼å…¥å®Œä¹‹å, è¿˜æœ‰ä¸€ä¸ªé”™è¯¯, æˆ‘ä¹Ÿæ˜¯é†‰é†‰å“’....å°¼ç›, è¿™æ˜¯ç©æˆ‘å‘¢....ä»¥å‰å¯¼å…¥SDKé‚£æœ‰é‚£ä¹ˆéº»çƒ¦å•Š...ç¿»äº†ä¸€ä¸‹æ–‡æ¡£, å‘ç°è¦æ·»åŠ ä¸€ä¸ª<strong><code>Header</code></strong>çš„é“¾æ¥....æˆ‘ä¹Ÿæ˜¯é†‰äº†, è¿™ä¸ªé“¾æ¥çš„å†™æ³•æ˜¯<strong><code>$(SRCROOT)/(å·¥ç¨‹å)</code></strong>, æˆ‘è¿™é‡Œæ‰€å†™çš„æ˜¯<strong><code>$(SRCROOT)/AliPay-Objective-C</code></strong></p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/AliPay-Objective-C/images/18.png" alt="18"/></p>

<hr/>

<h3 id="toc_11">å®ç°æ”¯ä»˜å®æ”¯ä»˜</h3>

<blockquote>
<p>å¥½äº†, æˆ‘ä»¬æŠŠé‡åˆ°çš„å‘å¡«å®Œä¹‹å, ç°åœ¨å°±æ¥å®ç°æ”¯ä»˜å®æ”¯ä»˜, è¿™é‡Œæˆ‘ä»¬å°±ç›´æ¥æŠŠ<strong><code>AliPayDemo</code></strong>é‡Œçš„ä»£ç ç›´æ¥æ‹·è´è¿‡æ¥, </p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/AliPay-Objective-C/images/19.png" alt="19"/></p>

<blockquote>
<p>æ·»åŠ å®Œä¹‹å, åˆ«å¿˜äº†å¤„ç†<strong><code>AliPay</code></strong>å›è°ƒå›æ¥çš„ä¿¡æ¯, é¡ºä¾¿è¯´è¯´, è¿™é‡Œçš„ä»£ç†æ–¹æ³•ä¼šæœ‰ä¸¤ä¸ª, ä¸€ä¸ªæ˜¯<strong><code>iOS 9</code></strong>ä¹‹åæ‰æœ‰çš„æ–°æ–¹æ³•, å¤§å®¶å¯ä»¥åŠ¨åŠ¨å°è„‘è¢‹, çœ‹çœ‹æ€ä¹ˆæ ·å°è£…æ‰ä¼šæ¯”è¾ƒå¥½ä¸€äº›~</p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/AliPay-Objective-C/images/20.png" alt="20"/></p>

<blockquote>
<p>åˆ°è¿™é‡Œæˆ‘ä»¬å°±å·²ç»é›†æˆå®Œæ¯•äº†, ç”±äºæ”¯ä»˜å®çš„Demoé‡Œæ²¡æœ‰æä¾›<strong><code>App ID</code></strong>å’Œ<strong><code>ç§é’¥</code></strong>, æ‰€ä»¥æˆ‘ä»¬è¿™é‡Œæ˜¾ç¤ºçš„æ•ˆæœåªèƒ½æ˜¯é…±ç´«äº†...éœ€è¦æµ‹è¯•çš„ç«¥é‹ä»¬åªèƒ½è‡ªå·±å»ç”³è¯·<strong><code>App ID</code></strong>å’Œ<strong><code>ç§é’¥</code></strong>äº†</p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/AliPay-Objective-C/images/21.png" alt="21"/></p>

<hr/>

<h3 id="toc_12">å·¥ç¨‹åœ°å€</h3>

<p>é¡¹ç›®åœ°å€: <a href="https://github.com/CainRun/PayProject">https://github.com/CainRun/PayProject</a></p>

<hr/>

<h3 id="toc_13">æœ€å</h3>

<p><center>ç å­—å¾ˆè´¹è„‘, çœ‹å®˜èµç‚¹é¥­é’±å¯å¥½</center></p>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/WeChatPay-Objective-C/Images/%E5%BE%AE%E4%BF%A1QRC.jpg" alt="å¾®ä¿¡"/></p>

<p><img src="https://raw.githubusercontent.com/CainRun/PayProject/master/WeChatPay-Objective-C/Images/%E6%94%AF%E4%BB%98%E5%AE%9DQRC.jpg" alt="æ”¯ä»˜å®"/></p>

]]></content>
  </entry>
  
</feed>
